<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.12.0"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: VEC-0: Linear elasticity</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script>
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">VEC-0: Linear elasticity</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#tutorial_elastic_strong_form">Strong form</a>
  </li>
  <li class="level1">
    <a href="#tutorial_elastic_weak_form">Discretisation</a>
  </li>
  <li class="level1">
    <a href="#tutorial_elastic_code_dissection">Implementation</a>
    <ul>
      <li class="level2">
        <a href="#tutorial_elastic_problem_set_up">Problem setup</a>
      </li>
      <li class="level2">
        <a href="#tutorial_elastic_dirichlet">Essential boundary conditions</a>
      </li>
      <li class="level2">
        <a href="#tutorial_elastic_pushing_operators">Pushing operators to pipeline</a>
        <ul>
          <li class="level3">
            <a href="#tutorial_elastic_integration_rule">Integration rule</a>
          </li>
          <li class="level3">
            <a href="#tutorial_elastic_pushing_stiffness_matrix">Pushing domain stiffness matrix</a>
          </li>
          <li class="level3">
            <a href="#tutorial_elastic_internal_force_matrix">Pushing internal forces</a>
          </li>
          <li class="level3">
            <a href="#tutorial_elastic_neumann">Natural boundary conditions</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#tutorial_elastic_solver_setup">Solver setup</a>
      </li>
      <li class="level2">
        <a href="#tutorial_elastic_postprocessing">Postprocessing pipeline</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#tutorial_elastic_code_run_and_post">Running code and visualisation</a>
  </li>
  <li class="level1">
    <a href="#tutorial_elastic_code_source_code">Plain program</a>
  </li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>Prerequisites of this tutorial include <a class="el" href="basic_tutorials_mesh_generation_2d.html">MSH-1: Create a 2D mesh from Gmsh</a> and <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a></dd>
<dd>
High order geometry and schurs complement are present in the current code but outside the scope of this tutorial refer to <a class="el" href="tutorial_plastic_problem.html">ADV-0: Plastic problem</a></dd></dl>
<p><br  />
</p>
<dl class="section note"><dt>Note</dt><dd>Intended learning outcome:<ul>
<li>general structure of a program developed using <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></li>
<li>idea of <a href="http://mofem.eng.gla.ac.uk/mofem/html/struct_mo_f_e_m_1_1_simple.html">Simple Interface</a> in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and how to use it</li>
<li>implementing vector valued problems like linear elasticity</li>
<li>implementing boundary conditions specified on the part of the boundary</li>
<li>developing code that can be compiled for 2D or 3D cases</li>
<li>use of default forms integrators</li>
<li>pushing UDOs to the <em>Pipeline</em></li>
<li>utilisation of tools to convert outputs (MOAB) and visualise them (Paraview)</li>
</ul>
</dd></dl>
<p>The solution of the linear elasticity problem is presented in this tutorial. Lets consider an isotropic elastic cantilever beam with prescribed gravity load as presented in <a class="el" href="#figure1_problem_schematic">Figure 1</a>.</p>
<p><a class="anchor" id="figure1_problem_schematic"></a></p><div class="image">
<img src="vec0_load_beam.png" alt="" width="600px"/>
<div class="caption">
Figure 1: Cantilever beam considered in this example.</div></div>
<h1><a class="anchor" id="tutorial_elastic_strong_form"></a>
Strong form</h1>
<p>In order to compute displacement vector field \(\mathbf{u}\), every point in the beam has to satisfy balance of linear momentum and boundary conditions as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
  \label{eq:momentum_balance}
  \begin{cases}
  \nabla \cdot \boldsymbol \sigma \left(\mathbf u(\mathbf{x}) \right) + \mathbf b =0 &amp; \text { in }  \Omega \\
  \mathbf u(\mathbf{x}) = \bar{\mathbf{u}} &amp; \text { on }  \partial\Omega^\mathbf{u} \\
  \boldsymbol \sigma \cdot \mathbf n = \bar {\mathbf t} &amp; \text { on }  \partial\Omega^\mathbf{t}
\end{cases}
\end{align}
\]
</p>
<p>where \(\mathbf{b}\) are body forces, \( \bar{\mathbf{u}} \) are fixed displacements, \( \bar{\mathbf{t}} \) is traction vector and \(\mathbf{n}\) is the unit normal vector on the boundary and \( \boldsymbol \sigma \) is the Cauchy stress tensor. In case of linear elasticity, small strains are assumed whereby the stress measure is defined as:</p>
<p class="formulaDsp">
\[
\begin{align}
\boldsymbol \sigma =&amp; \mathbb D : \frac{1}{2} (\nabla \mathbf u^\text{T} + \nabla \mathbf u) 
\end{align}
\]
</p>
<p> where \( \mathbb D  \) is the 4th order elasticity tensor.</p>
<h1><a class="anchor" id="tutorial_elastic_weak_form"></a>
Discretisation</h1>
<p>Following a standard Galerkin approach as in <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a>, the governing equations are discretised into weak form as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
\int_{\Omega} \nabla  \delta \mathbf u  : \boldsymbol \sigma(\mathbf u) \, \mathrm d \Omega= - \int_{\Omega} \delta \mathbf u \cdot \mathbf b \, \mathrm d \Omega  + \int_{\partial{\Omega}^\mathbf t} \delta \mathbf u \cdot \bar{\mathbf t} \, \mathrm d S \quad \forall\, \delta \mathbf u \in \mathbf{H}^1_0(\Omega) 
\end{align}
\]
</p>
<p>To approximate displacements \( \mathbf u\) and variance of displacements \( \delta \mathbf u\), once again we will use <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s hierarchical shape functions:     </p><p class="formulaDsp">
\[
\begin{align}
 \mathbf u \approx   \mathbf u^{h}=\sum_{j=0}^{N-1} \phi_{j}  \bar{\mathbf{u}}_{j}, \quad \quad \delta \mathbf u \approx  \delta \mathbf u^{h}=\sum_{j=0}^{N-1} \phi_{j} \delta \bar{\mathbf{u}}_{j}
\end{align}
\]
</p>
<p>By substituting the above definitions into the weak form, the global system \( \mathbf{K U}=\mathbf{F}\) can be assembled, where elements contributions from every finite elements are computed as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
\mathbf K_{i j}^{e}&amp;=\int_{\Omega^{e}} \nabla \phi_{i}  \mathbb D  \nabla \phi_{j} \, \mathrm d \Omega  \\
\mathbf F_{i}^{e}&amp;=\int_{\partial \Omega^{e}} \phi_{i} \mathbf t  \, \mathrm d S + \int_{\Omega^{e}} \phi_{i} \mathbf b  \, \mathrm d \Omega 
\end{align}
\]
</p>
<p>The Gauss quadrature is utilised to calculate the integrals.</p>
<h1><a class="anchor" id="tutorial_elastic_code_dissection"></a>
Implementation</h1>
<p>In this section we will focus on the procedure to setup and solve vector-valued problems such as elasticity in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> using <a class="el" href="struct_mo_f_e_m_1_1_simple.html" title="Simple interface for fast problem set-up.">MoFEM::Simple</a> and Form Integrators, which are template UDOs used for common operations. <br  />
 The code developed for this example can be compiled for both 2D and 3D cases by assigning the input parameter <em>EXECUTABLE_DIMENSION</em> in the <em>CMakeFiles.txt</em> prior to compilation and is used throughout the code to define the constant variable <em>SPACE_DIM</em> which is used as a template paramenter to assign the dimension of the executable:</p>
<div class="fragment"><div class="line"><span class="comment"></span><span class="keyword">constexpr</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> =</div>
<div class="line">    <a class="code hl_define" href="plastic_8cpp.html#a49d2a41e935ccc68adc5a9268619cba1">EXECUTABLE_DIMENSION</a>; <span class="comment">//&lt; Space dimension of problem, mesh</span><span class="comment"></span></div>
</div><!-- fragment --><p>Based on <em>SPACE_DIM</em> appropriate element types are defined in the following snippet for example, <em>DomainEle</em> in 2D are defined as faces while in 3D they are defined as volumes:</p>
<div class="fragment"><div class="line"><span class="comment"></span><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">EntData</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">EntitiesFieldData::EntData</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#ac94bc5f632538c35d02cd487d55b31d2">DomainEle</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager_1_1_elements_and_ops_by_dim.html">PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;::DomainEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a81eee41c11480cdc68dc9e63bef4e113">BoundaryEle</a> =</div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager_1_1_elements_and_ops_by_dim.html">PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;::BoundaryEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="class_domain_ele_op.html">DomainEleOp</a> = DomainEle::UserDataOperator;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="class_boundary_ele_op.html">BoundaryEleOp</a> = BoundaryEle::UserDataOperator;<span class="comment"></span></div>
</div><!-- fragment --><p>The main program then consists of a series of functions when invoking the function <a class="el" href="struct_example.html#a9bc8db5cd1e1c4dc349ea7f0c1ec6bae" title="[Run problem]">Example::runProblem()</a>:</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#a9bc8db5cd1e1c4dc349ea7f0c1ec6bae">Example::runProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a02c31f36ea2bb1fa2e4968b4ebab5793">readMesh</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1">setupProblem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef">boundaryCondition</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a">assembleSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a715f389c012e659483ec314add372458">solveSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad1586d950420195d03d20479b2cedd06">outputResults</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a6eda930af795f95e64047fbc35d80826">checkResults</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><p>where <a class="el" href="struct_example.html#a02c31f36ea2bb1fa2e4968b4ebab5793" title="[Run problem]">Example::readMesh()</a> executes the mesh reading procedure, refer to <a class="el" href="basic_tutorials_mesh_generation_2d.html">MSH-1: Create a 2D mesh from Gmsh</a> and <a class="el" href="basic_tutorials_mesh_generation_3d.html">MSH-2: Create a 3D mesh from Gmsh</a> for an introduction to mesh generation.</p>
<h2><a class="anchor" id="tutorial_elastic_problem_set_up"></a>
Problem setup</h2>
<p>The first function, <a class="el" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1" title="[Run problem]">Example::setupProblem()</a> is used to setup the problem and involves adding the displacement field <em>U</em> on the entities of the mesh and determine the base function space, base, field rank and base order. For this problem We are adding displacement field <em>U</em> as both domain and a boundary field.</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1">Example::setupProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a> *<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a>&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> bases { AINSWORTH, DEMKOWICZ, LASBASETOPT };</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *list_bases[LASBASETOPT] = {<span class="stringliteral">&quot;ainsworth&quot;</span>, <span class="stringliteral">&quot;demkowicz&quot;</span>};</div>
<div class="line">  PetscInt choice_base_value = AINSWORTH;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#abee82d436d03244c6886fc99f71116f0">PetscOptionsGetEList</a>(PETSC_NULL, NULL, <span class="stringliteral">&quot;-base&quot;</span>, list_bases,</div>
<div class="line">                              LASBASETOPT, &amp;choice_base_value, PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_enumeration" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5">FieldApproximationBase</a> <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>;</div>
<div class="line">  <span class="keywordflow">switch</span> (choice_base_value) {</div>
<div class="line">  <span class="keywordflow">case</span> AINSWORTH:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform)</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Set AINSWORTH_LEGENDRE_BASE for displacements&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> DEMKOWICZ:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a9b4f9fbc1a88eda9b2cde0df10ca23bf">DEMKOWICZ_JACOBI_BASE</a>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform)</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Set DEMKOWICZ_JACOBI_BASE for displacements&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a35e0a7e42f81919e776c310c509598da">LASTBASE</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add field</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addDomainField(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addBoundaryField(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> = 3;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a2d7af8e1af9a42f3180d8cc96f8f8c06">PetscOptionsGetInt</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-order&quot;</span>, &amp;<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>, PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addDataField(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setFieldOrder(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setFieldOrder(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, 2);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setUp();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> project_ho_geometry = [&amp;]() {</div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_projection10_node_coords_on_field.html">Projection10NodeCoordsOnField</a> ent_method(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="group__mofem__loops.html#ga06843828fb475925d003a31b991c425e">loop_dofs</a>(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, ent_method);</div>
<div class="line">  };</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> project_ho_geometry();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a55db6ee7b037f883685d61baabd7ace4">PetscOptionsGetBool</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-plane_strain&quot;</span>, &amp;<a class="code hl_variable" href="thermo__elastic_8cpp.html#a2d904277dc8c08a4df97ddeb77a27447">is_plane_strain</a>,</div>
<div class="line">                             PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> coords_dim = <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a756249f6051982de377518e519ba8da4">PetscOptionsGetRealArray</a>(NULL, NULL, <span class="stringliteral">&quot;-field_eval_coords&quot;</span>,</div>
<div class="line">                                  <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), &amp;coords_dim,</div>
<div class="line">                                  &amp;<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>) {</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a> = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a> =</div>
<div class="line">        <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_field_evaluator_interface.html">FieldEvaluatorInterface</a>&gt;()-&gt;getData&lt;DomainEle&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 3) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_field_evaluator_interface.html">FieldEvaluatorInterface</a>&gt;()-&gt;buildTree3D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName());</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_field_evaluator_interface.html">FieldEvaluatorInterface</a>&gt;()-&gt;buildTree2D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>-&gt;setEvalPoints(<a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1);</div>
<div class="line">    <span class="keyword">auto</span> no_rule = [](int, int, int) { <span class="keywordflow">return</span> -1; };</div>
<div class="line">    <span class="keyword">auto</span> field_eval_fe_ptr = <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>-&gt;feMethodPtr.lock();</div>
<div class="line">    field_eval_fe_ptr-&gt;getRuleHook = no_rule;</div>
<div class="line"> </div>
<div class="line">    field_eval_fe_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_vector_field_values.html">OpCalculateVectorFieldValues&lt;SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><p>The space selected for displacement field U is <code>H1</code> and dimension is <em>SPACE_DIM</em> that corresponds to a vector field with <em>SPACE_DIM</em> number of coefficients. Additionally, we define command line parameters <em>-base</em> and <em>-order</em> that specify the base and order of our base respectively with <code>AINSWORTH_LEGENDRE_BASE</code> and 2nd order selected by default.</p>
<h2><a class="anchor" id="tutorial_elastic_dirichlet"></a>
Essential boundary conditions</h2>
<p>The next function, <a class="el" href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef" title="[Set up problem]">Example::boundaryCondition()</a> is used to apply homogeneous Dirichlet boundary conditions for our problem by utilise <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s utility to remove degrees of freedom from a problem through the <em>BcManager</em> interface.</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef">Example::boundaryCondition</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_bc_manager.html">BcManager</a>&gt;();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_X&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 0, 0);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_Y&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 1, 1);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_Z&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 2, 2);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">                                           <span class="stringliteral">&quot;REMOVE_ALL&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, 0, 3);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;pushMarkDOFsOnEntities&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_displacement_cubit_bc_data.html">DisplacementCubitBcData</a>&gt;(</div>
<div class="line">      <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// adding MPCs</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;addBlockDOFsToMPCs(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><p>For the examples considered in this tutorial, the provided meshes contain only one meshset <em>FIX_ALL</em> that will essentially fix displacements in all directions to zero. In <a class="el" href="#figure2_problem_fix_all">Figure 2</a> we show selected triangles on the face of triangles that are used to define the <em>FIX_ALL</em> meshset. While for the 2D case, we select edge elements instead.</p>
<p><a class="anchor" id="figure2_problem_fix_all"></a></p><div class="image">
<img src="boundary_cond_canti.png" alt="" width="300px"/>
<div class="caption">
Figure 2: FIX_ALL block meshset specified on the mesh of the cantilever for 3D case. </div></div>
<h2><a class="anchor" id="tutorial_elastic_pushing_operators"></a>
Pushing operators to pipeline</h2>
<p>The next function of the main program, <a class="el" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a" title="[Push operators to pipeline]">Example::assembleSystem()</a> is responsible for defining pipelines used to evaluate linear and bilinear forms of the system (refer to <a class="el" href="user_data_operators_table.html">User data operators table</a>) and assembly of the global matrices and vectors.</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a">Example::assembleSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_bc_manager.html">BcManager</a>&gt;();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Integration rule]</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">auto</span> <a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a> = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> integration_rule_bc = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainRhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainLhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryRhsIntegrationRule(integration_rule_bc);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryLhsIntegrationRule(integration_rule_bc);<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Integration rule]</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpDomainLhsPipeline(), {H1}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpDomainRhsPipeline(), {H1}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM - 1, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryRhsPipeline(), {NOSPACE}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM - 1, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryLhsPipeline(), {NOSPACE}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Push domain stiffness matrix to pipeline]</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">auto</span> mat_D_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Assemble domain stiffness matrix</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainLhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::verbose);</div>
<div class="line">  pip-&gt;getOpDomainLhsPipeline().push_back(<span class="keyword">new</span> <a class="code hl_typedef" href="elastic_8cpp.html#ac30928f1dc05b650e220f7ed36fba6f0">OpK</a>(<span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, mat_D_ptr));<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Push domain stiffness matrix to pipeline]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Push Internal forces]</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">auto</span> mat_grad_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_strain_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_stress_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_class" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient&lt;SPACE_DIM, SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line">                                                               mat_grad_ptr));</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainRhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::inform);</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_symmetrize_tensor.html">OpSymmetrizeTensor&lt;SPACE_DIM&gt;</a>(mat_grad_ptr, mat_strain_ptr));</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_tensor_times_symmetric_tensor.html">OpTensorTimesSymmetricTensor&lt;SPACE_DIM, SPACE_DIM&gt;</a>(</div>
<div class="line">          mat_strain_ptr, mat_stress_ptr, mat_D_ptr));</div>
<div class="line"> </div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_typedef" href="elastic_8cpp.html#a51443eacad72e4f0e15edcfee7852e15">OpInternalForce</a>(<span class="stringliteral">&quot;U&quot;</span>, mat_stress_ptr,</div>
<div class="line">                          [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Push Internal forces]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Push Body forces]</span></div>
<div class="line"><span class="comment"></span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">DomainRhsBCs::AddFluxToPipeline&lt;OpDomainRhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpDomainRhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, Sev::inform);<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Push Body forces]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Push natural boundary conditions]</span></div>
<div class="line"><span class="comment"></span>  <span class="comment">// Add force boundary condition</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">BoundaryRhsBCs::AddFluxToPipeline&lt;OpBoundaryRhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryRhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, -1, Sev::inform);</div>
<div class="line">  <span class="comment">// Add case for mix type of BCs</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_lhs_pipeline_impl.html">BoundaryLhsBCs::AddFluxToPipeline&lt;OpBoundaryLhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryLhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, Sev::verbose);<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Push natural boundary conditions]</span></div>
<div class="line"><span class="comment"></span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><h3><a class="anchor" id="tutorial_elastic_integration_rule"></a>
Integration rule</h3>
<p>The first part of this function, sets and pushes the integration rule for the finite element method to the pipeline.</p>
<div class="fragment"><div class="line"><span class="comment"></span>  <span class="keyword">auto</span> <a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a> = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> integration_rule_bc = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainRhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainLhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryRhsIntegrationRule(integration_rule_bc);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryLhsIntegrationRule(integration_rule_bc);<span class="comment"></span></div>
</div><!-- fragment --><h3><a class="anchor" id="tutorial_elastic_pushing_stiffness_matrix"></a>
Pushing domain stiffness matrix</h3>
<p>The second part of this function, first calculates the local elasticity tensor through <code>addMatBlockOps</code> function depending on the <code>MAT_ELASTIC</code> block defined in the mesh file, then pushes the LHS stiffness matrix using alias <code><a class="el" href="struct_op_k.html">OpK</a></code> to the LHS pipeline.</p>
<div class="fragment"><div class="line"><span class="comment"></span>  <span class="keyword">auto</span> mat_D_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Assemble domain stiffness matrix</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainLhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::verbose);</div>
<div class="line">  pip-&gt;getOpDomainLhsPipeline().push_back(<span class="keyword">new</span> <a class="code hl_typedef" href="elastic_8cpp.html#ac30928f1dc05b650e220f7ed36fba6f0">OpK</a>(<span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, mat_D_ptr));<span class="comment"></span></div>
</div><!-- fragment --><p>The local elasticty tensor \( \mathbb D\) is calculate using the formula below:     </p><p class="formulaDsp">
\[
\begin{align}
\mathbb D_{ijkl} = G \left[ \delta_{ik} \delta_{jl} + \delta_{il} \delta_{jk} \right] + A (K - \frac{2}{3} G) \left[  \delta_{ij} \delta_{kl} \right]
\end{align}
\]
</p>
<p> where \( K\) and \( G\) are bulk and shear modulus, respectively. The coefficient \( A\) depends on the dimension of the problem, for 3D cases and plane strain formulation it is simply \( A = 1\), whereas for plane stress it takes the following form:</p>
<p class="formulaDsp">
\[
\begin{align}
 A=\frac{2 G}{K+\frac{4}{3} G}
\end{align}
\]
</p>
<p>Using the <a class="el" href="class_f_tensor_1_1_index.html">FTensor::Index</a> type these formulas can be directly implemented using Einstein's summation convention as shown below, within the <a class="el" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">Example::addMatBlockOps()</a> function:</p>
<div class="fragment"><div class="line"><span class="comment"></span>      <span class="keyword">auto</span> set_material_stiffness = [&amp;]() {</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;i&#39;</span>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;j&#39;</span>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;k&#39;</span>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;l&#39;</span>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>;</div>
<div class="line">        <span class="keyword">constexpr</span> <span class="keyword">auto</span> <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a> = <a class="code hl_class" href="class_f_tensor_1_1_kronecker___delta__symmetric.html">FTensor::Kronecker_Delta_symmetric&lt;int&gt;</a>();</div>
<div class="line">        <span class="keywordtype">double</span> A = 1.;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 2 &amp;&amp; !<a class="code hl_variable" href="thermo__elastic_8cpp.html#a2d904277dc8c08a4df97ddeb77a27447">is_plane_strain</a>) {</div>
<div class="line">          A = 2 * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a> /</div>
<div class="line">              (<a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#ad7a361d6ac98acaf4fc56c736441c249">bulk_modulus_K</a> + (4. / 3.) * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keyword">auto</span> t_D = getFTensor4DdgFromMat&lt;SPACE_DIM, SPACE_DIM, 0&gt;(*mat_D_ptr);</div>
<div class="line">        t_D(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>) =</div>
<div class="line">            2 * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a> * ((<a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>) ^ <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>)) / 4.) +</div>
<div class="line">            A * (<a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#ad7a361d6ac98acaf4fc56c736441c249">bulk_modulus_K</a> - (2. / 3.) * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a>) * <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) *</div>
<div class="line">                <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>);</div>
<div class="line">      };<span class="comment"></span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Note that depending on <em>SPACE_DIM</em> our code will appropriately sum over all the indices and set coefficient \( A \) for plane stress or 3D case.</dd></dl>
<p>The operator <code><a class="el" href="struct_op_k.html">OpK</a></code> integrates the bilinear form:</p>
<p class="formulaDsp">
\[
\begin{align}
 \mathbf K^e_{ij} = \int_{\Omega^e} \nabla \phi_i \mathbb D \nabla \phi_j \, \mathrm d \Omega
\end{align}
\]
</p>
<p>and subsequently assembles it into global system matrix \( \mathbf K \). Note that once again, a new operator does not have to be defined as <code><a class="el" href="struct_op_k.html">OpK</a></code> is simply an alias to existing operator from <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s repertoire. To that operator we are passing previously defined container that stores elasticity tensor \( \mathbb D \).</p>
<div class="fragment"><div class="line"><span class="comment"></span><span class="keyword">using </span><a class="code hl_struct" href="struct_op_k.html">OpK</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_forms_integrators_1_1_assembly.html">FormsIntegrators&lt;DomainEleOp&gt;::Assembly</a>&lt;A&gt;<a class="code hl_class" href="class_bi_linear_form.html">::BiLinearForm</a>&lt;</div>
<div class="line">    <a class="code hl_variable" href="operators__tests_8cpp.html#a99b759dd71581f497626034776727d3d">I</a>&gt;::OpGradSymTensorGrad&lt;BASE_DIM, SPACE_DIM, SPACE_DIM, 0&gt;;<span class="comment"></span></div>
</div><!-- fragment --><p>The utilised <code>OpGradSymTensorGrad</code> form integrator template of Bilinear Form has four parameters: rank of the base, rank of row field, rank of the column field and finally, the increment of elasticity tensor, which in case of homogeneous material can be set to 0.</p>
<p>More info about available Form Integrators can be found in <a class="el" href="user_data_operators_table.html">User data operators table</a>.</p>
<h3><a class="anchor" id="tutorial_elastic_internal_force_matrix"></a>
Pushing internal forces</h3>
<p>The next part of the <a class="el" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a" title="[Push operators to pipeline]">Example::assembleSystem()</a> function calculates the internal forces for the system which is required to enforce the boundary conditions (defined as \( \mathbf K \mathbf u_e \) refer to <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a> for an in depth description). For elastic problems, this requires calculating the displacement gradient \( \nabla \mathbf u \), strain \( \boldsymbol \varepsilon \) and stress \( \boldsymbol \sigma \) of the system by pushing the relevant operatiors to the RHS pipeline. </p><div class="fragment"><div class="line"><span class="comment"></span>  <span class="keyword">auto</span> mat_grad_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_strain_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_stress_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_class" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient&lt;SPACE_DIM, SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line">                                                               mat_grad_ptr));</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainRhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::inform);</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_symmetrize_tensor.html">OpSymmetrizeTensor&lt;SPACE_DIM&gt;</a>(mat_grad_ptr, mat_strain_ptr));</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_tensor_times_symmetric_tensor.html">OpTensorTimesSymmetricTensor&lt;SPACE_DIM, SPACE_DIM&gt;</a>(</div>
<div class="line">          mat_strain_ptr, mat_stress_ptr, mat_D_ptr));</div>
<div class="line"> </div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_typedef" href="elastic_8cpp.html#a51443eacad72e4f0e15edcfee7852e15">OpInternalForce</a>(<span class="stringliteral">&quot;U&quot;</span>, mat_stress_ptr,</div>
<div class="line">                          [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));<span class="comment"></span></div>
</div><!-- fragment --><p> This is achieved by pushing a series of operators as follows:</p><ul>
<li><code><a class="el" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient</a></code> computes the gradient of the displacement field \( \nabla \mathbf u^{h}=\sum_{m=0}^{N-1} \nabla \phi_m \bar{\mathbf u}_m \)</li>
<li><code>OpSymmetrizeTensor</code> symmetrises the previously computed gradient to compute small strain tensor \( \boldsymbol \varepsilon = \frac{1}{2} (\nabla \mathbf u^\text{T} + \nabla \mathbf u)  \)</li>
<li><code>OpTensorTimesSymmetricTensor</code> is another form integrator that computes Cauchy stress: \( \boldsymbol \sigma = \mathbb D : \boldsymbol \varepsilon \)</li>
<li><code>OpInternalForce</code> is an alias of the FormsIntegrators <code>OpGradTimesSymTensor</code> which computes \( (\mathbf K \mathbf u_e)_j = \nabla \phi_i \mathbf \sigma_{ij} \)</li>
</ul>
<h3><a class="anchor" id="tutorial_elastic_neumann"></a>
Natural boundary conditions</h3>
<p>For natural boundary conditions we will only specify simple gravity load on the entire domain. We have to push into our Domain RHS pipeline an operator that calculates the following integral:     </p><p class="formulaDsp">
\[
\begin{align}
\mathbf F_{i}^{e}&amp;=\int_{\Omega^{e}} \phi_{i} \mathbf b \, \mathrm d V
\end{align}
\]
</p>
<p>This operation can be done by utilsing the <code>DomanRhsBc::AddFluxToPipeline</code> alias which applies a flux User Data Operator into RHS pipeline as shown below. </p><div class="fragment"><div class="line"><span class="comment"></span>  <span class="comment">// Add force boundary condition</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">BoundaryRhsBCs::AddFluxToPipeline&lt;OpBoundaryRhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryRhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, -1, Sev::inform);</div>
<div class="line">  <span class="comment">// Add case for mix type of BCs</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_lhs_pipeline_impl.html">BoundaryLhsBCs::AddFluxToPipeline&lt;OpBoundaryLhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryLhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, Sev::verbose);<span class="comment"></span></div>
</div><!-- fragment --><h2><a class="anchor" id="tutorial_elastic_solver_setup"></a>
Solver setup</h2>
<p>With appropriately defined pipelines for assembling the global system of equations \( \mathbf{K} \mathbf{U} = \mathbf{F} \), the next functions <a class="el" href="struct_example.html#a715f389c012e659483ec314add372458" title="[Solve]">Example::solveSystem()</a> sets up PETSc solver and calculates it directly or iteratively based on specified settings.</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#a715f389c012e659483ec314add372458">Example::solveSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> solver = pip-&gt;createKSP();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(solver);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> dm = <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDM();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> = <a class="code hl_function" href="group__dm.html#gac26499a0d7716b8a666c872f0e900254">createDMVector</a>(dm);</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a> = <a class="code hl_function" href="namespace_mo_f_e_m.html#a681e912e2d0043503d2da810dc186d73">vectorDuplicate</a>(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> set_essential_bc = [&amp;]() {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="comment">// This is low level pushing finite elements (pipelines) to solver</span></div>
<div class="line">    <span class="keyword">auto</span> ksp_ctx_ptr = <a class="code hl_function" href="namespace_mo_f_e_m.html#a7b5f68c486bfae245ee57c6b49fabc8d">getDMKspCtx</a>(dm);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> pre_proc_rhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line">    <span class="keyword">auto</span> post_proc_rhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line">    <span class="keyword">auto</span> post_proc_lhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> get_pre_proc_hook = [&amp;]() {</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_pre_proc.html">EssentialPreProc&lt;DisplacementCubitBcData&gt;</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, pre_proc_rhs,</div>
<div class="line">                                                       {});</div>
<div class="line">    };</div>
<div class="line">    pre_proc_rhs-&gt;preProcessHook = get_pre_proc_hook();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> get_post_proc_hook_rhs = [<span class="keyword">this</span>, post_proc_rhs]() {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_post_proc_rhs.html">EssentialPostProcRhs&lt;DisplacementCubitBcData&gt;</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>,</div>
<div class="line">                                                           post_proc_rhs, 1.)();</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_post_proc_rhs.html">EssentialPostProcRhs&lt;MPCsType&gt;</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_rhs, 1.)();</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> get_post_proc_hook_lhs = [<span class="keyword">this</span>, post_proc_lhs]() {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a>;</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_post_proc_lhs.html">EssentialPostProcLhs&lt;DisplacementCubitBcData&gt;</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>,</div>
<div class="line">                                                           post_proc_lhs, 1.)();</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_post_proc_lhs.html">EssentialPostProcLhs&lt;MPCsType&gt;</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_lhs)();</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    post_proc_rhs-&gt;postProcessHook = get_post_proc_hook_rhs;</div>
<div class="line">    post_proc_lhs-&gt;postProcessHook = get_post_proc_hook_lhs;</div>
<div class="line"> </div>
<div class="line">    ksp_ctx_ptr-&gt;getPreProcComputeRhs().push_front(pre_proc_rhs);</div>
<div class="line">    ksp_ctx_ptr-&gt;getPostProcComputeRhs().push_back(post_proc_rhs);</div>
<div class="line">    ksp_ctx_ptr-&gt;getPostProcSetOperators().push_back(post_proc_lhs);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> setup_and_solve = [&amp;]() {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    BOOST_LOG_SCOPED_THREAD_ATTR(<span class="stringliteral">&quot;Timeline&quot;</span>, attrs::timer());</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSetUp&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(solver);</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSetUp &lt;= Done&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSolve&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSolve &lt;= Done&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="group__mofem__log__manager.html#ga47d7053307c012af4b78f8a09e21fa83">MOFEM_LOG_CHANNEL</a>(<span class="stringliteral">&quot;TIMER&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="group__mofem__log__manager.html#ga202c2d0258d78f4c0d60ecac64bf2252">MOFEM_LOG_TAG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, <span class="stringliteral">&quot;timer&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_essential_bc();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (A == AssemblyType::BLOCK_SCHUR || A == AssemblyType::SCHUR) {</div>
<div class="line">    <span class="keyword">auto</span> schur_ptr = <a class="code hl_function" href="struct_set_up_schur.html#a9c9d1d7c1d1056006209d2b2c6aeddfc">SetUpSchur::createSetUpSchur</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> schur_ptr-&gt;setUp(solver);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> setup_and_solve();</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> setup_and_solve();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga490784c9685a7e4068b83ca2babc1ba1">DMoFEMMeshToLocalVector</a>(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>) {</div>
<div class="line">    <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 3) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_field_evaluator_interface.html">FieldEvaluatorInterface</a>&gt;()-&gt;evalFEAtThePoint3D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1e-12, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">          <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName(), <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(),</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(), <span class="keyword">nullptr</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f">MF_EXIST</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_field_evaluator_interface.html">FieldEvaluatorInterface</a>&gt;()-&gt;evalFEAtThePoint2D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1e-12, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">          <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName(), <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(),</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(), <span class="keyword">nullptr</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f">MF_EXIST</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>-&gt;size1()) {</div>
<div class="line">      <span class="keyword">auto</span> t_disp = <a class="code hl_function" href="namespace_mo_f_e_m.html#a82e89fad6ef326b49efc9a72d08a7d9c">getFTensor1FromMat&lt;SPACE_DIM&gt;</a>(*<a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>);</div>
<div class="line">      <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 2)</div>
<div class="line">        <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;FieldEvaluator&quot;</span>, Sev::inform)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;U_X: &quot;</span> &lt;&lt; t_disp(0) &lt;&lt; <span class="stringliteral">&quot; U_Y: &quot;</span> &lt;&lt; t_disp(1);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;FieldEvaluator&quot;</span>, Sev::inform)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;U_X: &quot;</span> &lt;&lt; t_disp(0) &lt;&lt; <span class="stringliteral">&quot; U_Y: &quot;</span> &lt;&lt; t_disp(1)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; U_Z: &quot;</span> &lt;&lt; t_disp(2);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="_log_manager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><p>Note that in case of simple linear problems like elasticity considered therein the above snippet will look very similar. A detailed description of each function can be found e.g. in <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a>.</p>
<h2><a class="anchor" id="tutorial_elastic_postprocessing"></a>
Postprocessing pipeline</h2>
<p>Finally, once the solver calculations are completed and solution vector is obtained, it is necessary to save the data on the visualisation mesh and compute quantities of interest like strains and stresses. In function <a class="el" href="struct_example.html#ad1586d950420195d03d20479b2cedd06" title="[Solve]">Example::outputResults()</a> we will define pipeline to postprocess the results and save the calculated values to the output mesh.</p>
<div class="fragment"><div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_example.html#ad1586d950420195d03d20479b2cedd06">Example::outputResults</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  <span class="keyword">auto</span> det_ptr = boost::make_shared&lt;VectorDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> jac_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> inv_jac_ptr = boost::make_shared&lt;MatrixDouble&gt;();<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Postprocess clean]</span></div>
<div class="line"><span class="comment"></span>  pip-&gt;getDomainRhsFE().reset();</div>
<div class="line">  pip-&gt;getDomainLhsFE().reset();</div>
<div class="line">  pip-&gt;getBoundaryRhsFE().reset();</div>
<div class="line">  pip-&gt;getBoundaryLhsFE().reset();<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Postprocess clean]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">  //! [Postprocess initialise]</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">auto</span> post_proc_mesh = boost::make_shared&lt;moab::Core&gt;();</div>
<div class="line">  <span class="keyword">auto</span> post_proc_begin = boost::make_shared&lt;PostProcBrokenMeshInMoabBaseBegin&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_mesh);</div>
<div class="line">  <span class="keyword">auto</span> post_proc_end = boost::make_shared&lt;PostProcBrokenMeshInMoabBaseEnd&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_mesh);<span class="comment"></span></div>
<div class="line"><span class="comment">  //! [Postprocess initialise]</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">  <span class="keyword">auto</span> calculate_stress_ops = [&amp;](<span class="keyword">auto</span> &amp;pip) {</div>
<div class="line">    <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(pip, {<a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">    <span class="keyword">auto</span> mat_grad_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    <span class="keyword">auto</span> mat_strain_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    <span class="keyword">auto</span> mat_stress_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    pip.push_back(<span class="keyword">new</span> <a class="code hl_class" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient&lt;SPACE_DIM, SPACE_DIM&gt;</a>(</div>
<div class="line">        <span class="stringliteral">&quot;U&quot;</span>, mat_grad_ptr));</div>
<div class="line">    <span class="keyword">auto</span> mat_D_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip, <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>, mat_D_ptr, Sev::verbose);</div>
<div class="line">    pip.push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_symmetrize_tensor.html">OpSymmetrizeTensor&lt;SPACE_DIM&gt;</a>(mat_grad_ptr, mat_strain_ptr));</div>
<div class="line">    pip.push_back(<span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_tensor_times_symmetric_tensor.html">OpTensorTimesSymmetricTensor&lt;SPACE_DIM, SPACE_DIM&gt;</a>(</div>
<div class="line">        mat_strain_ptr, mat_stress_ptr, mat_D_ptr));</div>
<div class="line">    <span class="keyword">auto</span> u_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    pip.push_back(<span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_vector_field_values.html">OpCalculateVectorFieldValues&lt;SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;U&quot;</span>, u_ptr));</div>
<div class="line">    <span class="keyword">auto</span> x_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    pip.push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_vector_field_values.html">OpCalculateVectorFieldValues&lt;SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, x_ptr));</div>
<div class="line">    <span class="keywordflow">return</span> boost::make_tuple(u_ptr, x_ptr, mat_strain_ptr, mat_stress_ptr);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> get_tag_id_on_pmesh = [&amp;](<span class="keywordtype">bool</span> post_proc_skin)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">int</span> def_val_int = 0;</div>
<div class="line">    <a class="code hl_class" href="class_tag.html">Tag</a> tag_mat;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_get_handle(</div>
<div class="line">        <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>, 1, MB_TYPE_INTEGER, tag_mat,</div>
<div class="line">        MB_TAG_CREAT | MB_TAG_SPARSE, &amp;def_val_int);</div>
<div class="line">    <span class="keyword">auto</span> meshset_vec_ptr =</div>
<div class="line">        <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_meshsets_manager.html">MeshsetsManager</a>&gt;()-&gt;getCubitMeshsetPtr(</div>
<div class="line">            std::regex((boost::format(<span class="stringliteral">&quot;%s(.*)&quot;</span>) % <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>).str()));</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_range.html">Range</a> skin_ents;</div>
<div class="line">    std::unique_ptr&lt;Skinner&gt; skin_ptr;</div>
<div class="line">    <span class="keywordflow">if</span> (post_proc_skin) {</div>
<div class="line">      skin_ptr = std::make_unique&lt;Skinner&gt;(&amp;<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>());</div>
<div class="line">      <span class="keyword">auto</span> boundary_meshset = <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getBoundaryMeshSet();</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_entities_by_handle(boundary_meshset,</div>
<div class="line">                                                      skin_ents, <span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a> : meshset_vec_ptr) {</div>
<div class="line">      <a class="code hl_class" href="class_range.html">Range</a> ents_3d;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_entities_by_handle(<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>-&gt;getMeshset(), ents_3d,</div>
<div class="line">                                                      <span class="keyword">true</span>);</div>
<div class="line">      <span class="keywordtype">int</span> <span class="keyword">const</span> <span class="keywordtype">id</span> = <a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>-&gt;getMeshsetId();</div>
<div class="line">      ents_3d = ents_3d.subset_by_dimension(<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">      <span class="keywordflow">if</span> (post_proc_skin) {</div>
<div class="line">        <a class="code hl_class" href="class_range.html">Range</a> skin_faces;</div>
<div class="line">        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> skin_ptr-&gt;find_skin(0, ents_3d, <span class="keyword">false</span>, skin_faces);</div>
<div class="line">        ents_3d = intersect(skin_ents, skin_faces);</div>
<div class="line">      }</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_clear_data(tag_mat, ents_3d, &amp;<span class="keywordtype">id</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> tag_mat;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> post_proc_domain = [&amp;](<span class="keyword">auto</span> post_proc_mesh) {</div>
<div class="line">    <span class="keyword">auto</span> post_proc_fe =</div>
<div class="line">        boost::make_shared&lt;PostProcEleDomain&gt;(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_mesh);</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPPMap</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPostProcMapInMoab&lt;SPACE_DIM, SPACE_DIM&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> [u_ptr, x_ptr, mat_strain_ptr, mat_stress_ptr] =</div>
<div class="line">        calculate_stress_ops(post_proc_fe-&gt;getOpPtrVector());</div>
<div class="line"> </div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_typedef" href="photon__diffusion_8cpp.html#ada3f24ae35ae50faea3df2b474ea2f37">OpPPMap</a>(</div>
<div class="line"> </div>
<div class="line">            post_proc_fe-&gt;getPostProcMesh(), post_proc_fe-&gt;getMapGaussPts(),</div>
<div class="line"> </div>
<div class="line">            {},</div>
<div class="line"> </div>
<div class="line">            {{<span class="stringliteral">&quot;U&quot;</span>, u_ptr}, {<span class="stringliteral">&quot;GEOMETRY&quot;</span>, x_ptr}},</div>
<div class="line"> </div>
<div class="line">            {},</div>
<div class="line"> </div>
<div class="line">            {{<span class="stringliteral">&quot;STRAIN&quot;</span>, mat_strain_ptr}, {<span class="stringliteral">&quot;STRESS&quot;</span>, mat_stress_ptr}}</div>
<div class="line"> </div>
<div class="line">            )</div>
<div class="line"> </div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    post_proc_fe-&gt;setTagsToTransfer({get_tag_id_on_pmesh(<span class="keyword">false</span>)});</div>
<div class="line">    <span class="keywordflow">return</span> post_proc_fe;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> post_proc_boundary = [&amp;](<span class="keyword">auto</span> post_proc_mesh) {</div>
<div class="line">    <span class="keyword">auto</span> post_proc_fe =</div>
<div class="line">        boost::make_shared&lt;PostProcEleBdy&gt;(mField, post_proc_mesh);</div>
<div class="line">    <a class="code hl_struct" href="struct_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM - 1, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">        post_proc_fe-&gt;getOpPtrVector(), {}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">    <span class="keyword">auto</span> op_loop_side =</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_loop_side.html">OpLoopSide&lt;SideEle&gt;</a>(mField, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName(), <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">    <span class="comment">// push ops to side element, through op_loop_side operator</span></div>
<div class="line">    <span class="keyword">auto</span> [u_ptr, x_ptr, mat_strain_ptr, mat_stress_ptr] =</div>
<div class="line">        calculate_stress_ops(op_loop_side-&gt;getOpPtrVector());</div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector().push_back(op_loop_side);</div>
<div class="line">    <span class="keyword">auto</span> mat_traction_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_elastic_example_1_1_op_calculate_traction.html">ElasticExample::OpCalculateTraction</a>(mat_stress_ptr,</div>
<div class="line">                                                mat_traction_ptr));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPPMap</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPostProcMapInMoab&lt;SPACE_DIM, SPACE_DIM&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_typedef" href="photon__diffusion_8cpp.html#ada3f24ae35ae50faea3df2b474ea2f37">OpPPMap</a>(</div>
<div class="line"> </div>
<div class="line">            post_proc_fe-&gt;getPostProcMesh(), post_proc_fe-&gt;getMapGaussPts(),</div>
<div class="line"> </div>
<div class="line">            {},</div>
<div class="line"> </div>
<div class="line">            {{<span class="stringliteral">&quot;U&quot;</span>, u_ptr}, {<span class="stringliteral">&quot;GEOMETRY&quot;</span>, x_ptr}, {<span class="stringliteral">&quot;T&quot;</span>, mat_traction_ptr}},</div>
<div class="line"> </div>
<div class="line">            {},</div>
<div class="line"> </div>
<div class="line">            {{<span class="stringliteral">&quot;STRAIN&quot;</span>, mat_strain_ptr}, {<span class="stringliteral">&quot;STRESS&quot;</span>, mat_stress_ptr}}</div>
<div class="line"> </div>
<div class="line">            )</div>
<div class="line"> </div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    post_proc_fe-&gt;setTagsToTransfer({get_tag_id_on_pmesh(<span class="keyword">true</span>)});</div>
<div class="line">    <span class="keywordflow">return</span> post_proc_fe;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  PetscBool post_proc_skin_only = PETSC_FALSE;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 3) {</div>
<div class="line">    post_proc_skin_only = PETSC_TRUE;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a55db6ee7b037f883685d61baabd7ace4">PetscOptionsGetBool</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-post_proc_skin_only&quot;</span>,</div>
<div class="line">                               &amp;post_proc_skin_only, PETSC_NULL);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (post_proc_skin_only == PETSC_FALSE) {</div>
<div class="line">    pip-&gt;getDomainRhsFE() = post_proc_domain(post_proc_mesh);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    pip-&gt;getBoundaryRhsFE() = post_proc_boundary(post_proc_mesh);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaf4d3fe19e4d76504628e614fd388c33f">DMoFEMPreProcessFiniteElements</a>(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDM(),</div>
<div class="line">                                        post_proc_begin-&gt;getFEMethod());</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;loopFiniteElements();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga3fcdbd5c74eba11ee82492e57d730756">DMoFEMPostProcessFiniteElements</a>(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDM(),</div>
<div class="line">                                         post_proc_end-&gt;getFEMethod());</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc_end-&gt;writeFile(<span class="stringliteral">&quot;out_elastic.h5m&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
</div><!-- fragment --><p>We can reuse LHS domain pipeline, for the purpose of postprocessing. The following line resets (cleans) the operators pushed previously for each pipeline. </p><div class="fragment"><div class="line"><span class="comment"></span>  pip-&gt;getDomainRhsFE().reset();</div>
<div class="line">  pip-&gt;getDomainLhsFE().reset();</div>
<div class="line">  pip-&gt;getBoundaryRhsFE().reset();</div>
<div class="line">  pip-&gt;getBoundaryLhsFE().reset();<span class="comment"></span></div>
</div><!-- fragment --><p>In the next few lines we create various postprocessing objects including the reference mesh and lists of elements to postprocess. </p><div class="fragment"><div class="line"><span class="comment"></span>  <span class="keyword">auto</span> post_proc_mesh = boost::make_shared&lt;moab::Core&gt;();</div>
<div class="line">  <span class="keyword">auto</span> post_proc_begin = boost::make_shared&lt;PostProcBrokenMeshInMoabBaseBegin&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_mesh);</div>
<div class="line">  <span class="keyword">auto</span> post_proc_end = boost::make_shared&lt;PostProcBrokenMeshInMoabBaseEnd&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, post_proc_mesh);<span class="comment"></span></div>
</div><!-- fragment --><p>Then we define a series of functions including, <code>calculate_stress_ops</code>, <code>post_proc_domain</code> and <code>post_proc_boundary</code> which push the operators required to output the displacement \( \mathbf{u} \), current position \( \mathbf{x} \), strain \( \boldsymbol{\varepsilon} \) and stress \( \boldsymbol{\sigma} \) for the domain and boundary.</p>
<h1><a class="anchor" id="tutorial_elastic_code_run_and_post"></a>
Running code and visualisation</h1>
<p>In order to run the program that we have been discussing in this tutorial, you will do the following steps</p><ul>
<li>First, go to the directory where the binary file named <code>elastic</code> is located. Depending on how you install <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> shown in this page <a class="el" href="installation.html">Installation with Spack (Scripts)</a>, going to the directory would be something similar to this<ul>
<li>For user version installation <div class="fragment"><div class="line">cd mofem_install/um_view/tutorials/vec-0/</div>
</div><!-- fragment --></li>
<li>For developer version installation <div class="fragment"><div class="line">cd mofem_install/mofem-cephas/mofem/users_modules/um-build-RelWithDebInfo-abcd1234/tutorials/vec-0</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Second, check the parameters in the <em>param_file.petsc</em>. These are PETSc parameters and you should only use parameters that are needed for a particular solver, in this case KSP solver. Only the following parameters should be uncommented <div class="fragment"><div class="line"><span class="preprocessor">## Linear solver</span></div>
<div class="line">-ksp_type fgmres </div>
<div class="line">-pc_type lu </div>
<div class="line">-pc_factor_mat_solver_type mumps</div>
<div class="line">-ksp_monitor</div>
</div><!-- fragment --></li>
<li>Third, in the terminal, run commands to partition the input mesh and start the analysis <div class="fragment"><div class="line">./elastic_3d -file_name beam_3D.cub -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 2</div>
<div class="ttc" id="adg__projection_8cpp_html_ad7eceded84ace5678d9df3e44f47d475"><div class="ttname"><a href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a></div><div class="ttdeci">constexpr int order</div><div class="ttdef"><b>Definition</b> <a href="dg__projection_8cpp_source.html#l00018">dg_projection.cpp:18</a></div></div>
</div><!-- fragment --> where a second order polynomial of approximation is selected.</li>
</ul>
<p>This will produce <em>out_elastic.h5m</em> file which we can convert using </p><div class="fragment"><div class="line">mbconvert out_elastic.h5m out_elastic_3D.vtk</div>
</div><!-- fragment --><p>The file <em>out_elastic_3D.vtk</em> can be opened in Paraview. Using the filter <code>WarpByVector</code> allows to visualise the deformation as shown in <a class="el" href="#figure3_output">Figure 3</a>.</p>
<p>We can also compute 2D case of the beam. Following the same process as that for 3D with the commands: </p><div class="fragment"><div class="line">./elastic_2d -file_name beam_2D.cub -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 2</div>
</div><!-- fragment --><p> and generate vtk file using: </p><div class="fragment"><div class="line">mbconvert out_elastic.h5m out_elastic_2D.vtk</div>
</div><!-- fragment --><p><a class="anchor" id="figure3_output"></a></p><div class="image">
<img src="beams_2D_3D_case.gif" alt="" width="800px"/>
<div class="caption">
Figure 3: Deformation of cantilever beams for 2D and 3D case. The color map represents displacements U.</div></div>
<p>Note that the beams, both for 2D and 3D cases experience spurious deformation at the free end. This is a known feature of small strain kinematic description. To mitigate this issue, a large strain geometrically nonlinear formulation can be used. The extension of the above tutorial to such nonlinear case can be found in <a class="el" href="tutorial_nonlinear_elastic.html">VEC-2: Nonlinear elastic</a>. We propose there a simple Hencky strain measure that improves the behaviour of the material experiencing large rotations.</p>
<h1><a class="anchor" id="tutorial_elastic_code_source_code"></a>
Plain program</h1>
<p>The full source code of the main program can be accessed below: <a class="el" href="elastic_8cpp.html" title="elastic example">elastic.cpp</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.12.0
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>
