<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.5"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: VEC-0: Linear elasticity</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">VEC-0: Linear elasticity </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tutorial_elastic_strong_form">Strong form</a></li>
<li class="level1"><a href="#tutorial_elastic_weak_form">Discretisation</a></li>
<li class="level1"><a href="#tutorial_elastic_code_dissection">Implementation</a><ul><li class="level2"><a href="#tutorial_elastic_problem_set_up">Problem setup</a></li>
<li class="level2"><a href="#tutorial_elastic_common_data">Common data</a></li>
<li class="level2"><a href="#tutorial_elastic_dirichlet">Essential boundary conditions</a></li>
<li class="level2"><a href="#tutorial_elastic_neumann">Natural boundary conditions</a></li>
<li class="level2"><a href="#tutorial_elastic_lhs">Pushing operators to LHS domain pipeline</a></li>
<li class="level2"><a href="#tutorial_elastic_solver_setup">Solver setup</a></li>
<li class="level2"><a href="#tutorial_elastic_postprocessing">Postprocessing pipeline</a></li>
</ul>
</li>
<li class="level1"><a href="#tutorial_elastic_code_run_and_post">Running code and visualisation</a></li>
<li class="level1"><a href="#tutorial_elastic_code_source_code">Plain program</a></li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>Prerequisites of this tutorial include <a class="el" href="basic_tutorials_mesh_generation_2d.html">MSH-1: Create a 2D mesh from Gmsh</a> and <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a></dd></dl>
<p><br  />
</p>
<dl class="section note"><dt>Note</dt><dd>Intended learning outcome:<ul>
<li>general structure of a program developed using <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></li>
<li>idea of <a href="http://mofem.eng.gla.ac.uk/mofem/html/struct_mo_f_e_m_1_1_simple.html">Simple Interface</a> in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and how to use it</li>
<li>implementing vector valued problems like linear elasticity</li>
<li>implementing boundary conditions specified on the part of the boundary</li>
<li>developing code that can be compiled for 2D or 3D cases</li>
<li>use of default forms integrators</li>
<li>pushing UDOs to the <em>Pipeline</em></li>
<li>utilisation of tools to convert outputs (MOAB) and visualise them (Paraview)</li>
</ul>
</dd></dl>
<p>The solution of the linear elasticity problem is presented in this tutorial. Lets consider an isotropic elastic cantilever beam with prescribed gravity load as presented in <a class="el" href="tutorial_elastic_problem.html#figure1_problem_schematic">Figure 1</a>.</p>
<p ><a class="anchor" id="figure1_problem_schematic"></a></p><div class="image">
<img src="vec0_load_beam.png" alt="" width="600px"/>
<div class="caption">
Figure 1: Cantilever beam considered in this example.</div></div>
<h1><a class="anchor" id="tutorial_elastic_strong_form"></a>
Strong form</h1>
<p >In order to compute displacement vector field \(\mathbf{u}\), every point in the beam has to satisfy balance of linear momentum and boundary conditions as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
  \label{eq:momentum_balance}
  \begin{cases}
  \nabla \cdot \boldsymbol \sigma \left(\mathbf u(\mathbf{x}) \right) + \mathbf b =0 &amp; \text { in }  \Omega \\
  \mathbf u(\mathbf{x}) = \bar{\mathbf{u}} &amp; \text { on }  \partial\Omega^\mathbf{u} \\
  \boldsymbol \sigma \cdot \mathbf n = \bar {\mathbf t} &amp; \text { on }  \partial\Omega^\mathbf{t}
\end{cases}
\end{align}
\]
</p>
<p >where \(\mathbf{b}\) are body forces, \( \bar{\mathbf{u}} \) are fixed displacements, \( \bar{\mathbf{t}} \) is traction vector and \(\mathbf{n}\) is the unit normal vector on the boundary and \( \boldsymbol \sigma \) is the Cauchy stress tensor. In case of linear elasticity, small strains are assumed whereby the stress measure is defined as:</p>
<p class="formulaDsp">
\[
\begin{align}
\boldsymbol \sigma =&amp; \mathbb D : \frac{1}{2} (\nabla \mathbf u^\text{T} + \nabla \mathbf u) 
\end{align}
\]
</p>
<p> where \( \mathbb D  \) is the 4th order elasticity tensor.</p>
<h1><a class="anchor" id="tutorial_elastic_weak_form"></a>
Discretisation</h1>
<p >Following a standard Galerkin approach as in <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a>, the governing equations are discretised into weak form as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
\int_{\Omega} \nabla  \delta \mathbf u  : \boldsymbol \sigma(\mathbf u) \, \mathrm d \Omega= - \int_{\Omega} \delta \mathbf u \cdot \mathbf b \, \mathrm d \Omega  + \int_{\partial{\Omega}^\mathbf t} \delta \mathbf u \cdot \bar{\mathbf t} \, \mathrm d S \quad \forall\, \delta \mathbf u \in \mathbf{H}^1_0(\Omega) 
\end{align}
\]
</p>
<p >To approximate displacements \( \mathbf u\) and variance of displacements \( \delta \mathbf u\), once again we will use <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s hierarchical shape functions:  </p><p class="formulaDsp">
\[
\begin{align}
 \mathbf u \approx   \mathbf u^{h}=\sum_{j=0}^{N-1} \phi_{j}  \bar{\mathbf{u}}_{j}, \quad \quad \delta \mathbf u \approx  \delta \mathbf u^{h}=\sum_{j=0}^{N-1} \phi_{j} \delta \bar{\mathbf{u}}_{j}
\end{align}
\]
</p>
<p >By substituting the above definitions into the weak form, the global system \( \mathbf{K U}=\mathbf{F}\) can be assembled, where elements contributions from every finite elements are computed as follows:</p>
<p class="formulaDsp">
\[
\begin{align}
\mathbf K_{i j}^{e}&amp;=\int_{\Omega^{e}} \nabla \phi_{i}  \mathbb D  \nabla \phi_{j} \, \mathrm d \Omega  \\
\mathbf F_{i}^{e}&amp;=\int_{\partial \Omega^{e}} \phi_{i} \mathbf t  \, \mathrm d S + \int_{\Omega^{e}} \phi_{i} \mathbf b  \, \mathrm d \Omega 
\end{align}
\]
</p>
<p >The Gauss quadrature is utilised to calculate the integrals.</p>
<h1><a class="anchor" id="tutorial_elastic_code_dissection"></a>
Implementation</h1>
<p >In this section we will focus on the procedure of setting up and solving vector-valued problems like elasticity in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> using <a class="el" href="struct_mo_f_e_m_1_1_simple.html" title="Simple interface for fast problem set-up.">MoFEM::Simple</a> and Form Integrators, which are template UDOs used for common operations. <br  />
 The code developed for this example can be compiled for both 2D and 3D cases by changing the following constant variable:</p>
<div class="fragment"></div><!-- fragment --><p >The constant variable <em>SPACE_DIM</em> will be used throughout the code to determine dimension of the executable. It is also possible to setup <em>CMakeFiles.txt</em> to compile both, 2D and 3D executables (see <a class="el" href="plastic_8cpp.html">plastic.cpp</a> example).</p>
<p >Note that based on <em>SPACE_DIM</em> an appropriate type of elements is defined in the following snippet: </p><div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">EntData</a> = EntitiesFieldData::EntData;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::DomainEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::DomainEleOp</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#abd1f0351e167546d82adc28b4dd0e681">BoundaryEle</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::BoundaryEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_face_element_forces_and_sources_core_1_1_user_data_operator.html">BoundaryEleOp</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::BoundaryEleOp</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab.html">PostProcEle</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::PostProcEle</a>;</div>
<div class="ttc" id="achild__and__parent_8cpp_html_a80b637c04b8c449d54efa75ab73b67df"><div class="ttname"><a href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a></div><div class="ttdeci">ElementsAndOps&lt; SPACE_DIM &gt;::DomainEle DomainEle</div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00034">child_and_parent.cpp:34</a></div></div>
<div class="ttc" id="achild__and__parent_8cpp_html_abd1f0351e167546d82adc28b4dd0e681"><div class="ttname"><a href="child__and__parent_8cpp.html#abd1f0351e167546d82adc28b4dd0e681">BoundaryEle</a></div><div class="ttdeci">ElementsAndOps&lt; SPACE_DIM &gt;::BoundaryEle BoundaryEle</div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00039">child_and_parent.cpp:39</a></div></div>
<div class="ttc" id="astruct_elements_and_ops_html"><div class="ttname"><a href="struct_elements_and_ops.html">ElementsAndOps</a></div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00018">child_and_parent.cpp:18</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">MoFEM::EntitiesFieldData::EntData</a></div><div class="ttdoc">Data on single entity (This is passed as argument to DataOperator::doWork)</div><div class="ttdef"><b>Definition:</b> <a href="_entities_field_data_8hpp_source.html#l00127">EntitiesFieldData.hpp:127</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_face_element_forces_and_sources_core_1_1_user_data_operator_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_face_element_forces_and_sources_core_1_1_user_data_operator.html">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator</a></div><div class="ttdoc">default operator for TRI element</div><div class="ttdef"><b>Definition:</b> <a href="_face_element_forces_and_sources_core_8hpp_source.html#l00095">FaceElementForcesAndSourcesCore.hpp:96</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab.html">MoFEM::PostProcBrokenMeshInMoab</a></div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00669">PostProcBrokenMeshInMoabBase.hpp:669</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">MoFEM::VolumeElementForcesAndSourcesCore::UserDataOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="_volume_element_forces_and_sources_core_8hpp_source.html#l00108">VolumeElementForcesAndSourcesCore.hpp:109</a></div></div>
</div><!-- fragment --><p >The main program consists of a series of functions when invoking the function <a class="el" href="struct_example.html#a9bc8db5cd1e1c4dc349ea7f0c1ec6bae" title="[Run problem]">Example::runProblem()</a>:</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_example.html#a9bc8db5cd1e1c4dc349ea7f0c1ec6bae">Example::runProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a02c31f36ea2bb1fa2e4968b4ebab5793">readMesh</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1">setupProblem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef">boundaryCondition</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a">assembleSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a715f389c012e659483ec314add372458">solveSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad1586d950420195d03d20479b2cedd06">outputResults</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#a6eda930af795f95e64047fbc35d80826">checkResults</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="adefinitions_8h_html_a6c0b52978f1abc88bf8a1ba70b7308e3"><div class="ttname"><a href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a></div><div class="ttdeci">#define MoFEMFunctionBegin</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00346">definitions.h:346</a></div></div>
<div class="ttc" id="adefinitions_8h_html_acb0a46d159695a01bf667313b7788b45"><div class="ttname"><a href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a></div><div class="ttdeci">#define MoFEMFunctionReturn(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00416">definitions.h:416</a></div></div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00535">definitions.h:535</a></div></div>
<div class="ttc" id="astruct_example_html_a0105b294dd531bfee565bd59951ee5ef"><div class="ttname"><a href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef">Example::boundaryCondition</a></div><div class="ttdeci">MoFEMErrorCode boundaryCondition()</div><div class="ttdoc">[Set up problem]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00536">dynamic_first_order_con_law.cpp:536</a></div></div>
<div class="ttc" id="astruct_example_html_a014d5935b6bedac1b08a891b88c9386a"><div class="ttname"><a href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a">Example::assembleSystem</a></div><div class="ttdeci">MoFEMErrorCode assembleSystem()</div><div class="ttdoc">[Push operators to pipeline]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00647">dynamic_first_order_con_law.cpp:647</a></div></div>
<div class="ttc" id="astruct_example_html_a02c31f36ea2bb1fa2e4968b4ebab5793"><div class="ttname"><a href="struct_example.html#a02c31f36ea2bb1fa2e4968b4ebab5793">Example::readMesh</a></div><div class="ttdeci">MoFEMErrorCode readMesh()</div><div class="ttdoc">[Run problem]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00463">dynamic_first_order_con_law.cpp:463</a></div></div>
<div class="ttc" id="astruct_example_html_a6eda930af795f95e64047fbc35d80826"><div class="ttname"><a href="struct_example.html#a6eda930af795f95e64047fbc35d80826">Example::checkResults</a></div><div class="ttdeci">MoFEMErrorCode checkResults()</div><div class="ttdoc">[Postprocess results]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l01205">dynamic_first_order_con_law.cpp:1205</a></div></div>
<div class="ttc" id="astruct_example_html_a715f389c012e659483ec314add372458"><div class="ttname"><a href="struct_example.html#a715f389c012e659483ec314add372458">Example::solveSystem</a></div><div class="ttdeci">MoFEMErrorCode solveSystem()</div><div class="ttdoc">[Solve]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00893">dynamic_first_order_con_law.cpp:893</a></div></div>
<div class="ttc" id="astruct_example_html_a9bc8db5cd1e1c4dc349ea7f0c1ec6bae"><div class="ttname"><a href="struct_example.html#a9bc8db5cd1e1c4dc349ea7f0c1ec6bae">Example::runProblem</a></div><div class="ttdeci">MoFEMErrorCode runProblem()</div><div class="ttdoc">[Run problem]</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l00258">plastic.cpp:258</a></div></div>
<div class="ttc" id="astruct_example_html_ad089fd70d7ad8751df5a798e0914d0b1"><div class="ttname"><a href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1">Example::setupProblem</a></div><div class="ttdeci">MoFEMErrorCode setupProblem()</div><div class="ttdoc">[Run problem]</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l00270">plastic.cpp:270</a></div></div>
<div class="ttc" id="astruct_example_html_ad1586d950420195d03d20479b2cedd06"><div class="ttname"><a href="struct_example.html#ad1586d950420195d03d20479b2cedd06">Example::outputResults</a></div><div class="ttdeci">MoFEMErrorCode outputResults()</div><div class="ttdoc">[Solve]</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l01183">dynamic_first_order_con_law.cpp:1183</a></div></div>
</div><!-- fragment --><p >where <a class="el" href="struct_example.html#a02c31f36ea2bb1fa2e4968b4ebab5793" title="[Run problem]">Example::readMesh()</a> executes the mesh reading procedure.</p>
<h2><a class="anchor" id="tutorial_elastic_problem_set_up"></a>
Problem setup</h2>
<p >The function <a class="el" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1" title="[Run problem]">Example::setupProblem()</a> involves adding the displacement field <em>U</em> on the entities of the mesh and determine the base function space, base, field rank and base order. We are adding <em>U</em> as both domain and a boundary field.</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_example.html#ad089fd70d7ad8751df5a798e0914d0b1">Example::setupProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  Simple *<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;Simple&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> bases { AINSWORTH, DEMKOWICZ, LASBASETOPT };</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *list_bases[LASBASETOPT] = {<span class="stringliteral">&quot;ainsworth&quot;</span>, <span class="stringliteral">&quot;demkowicz&quot;</span>};</div>
<div class="line">  PetscInt choice_base_value = AINSWORTH;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#abee82d436d03244c6886fc99f71116f0">PetscOptionsGetEList</a>(PETSC_NULL, NULL, <span class="stringliteral">&quot;-base&quot;</span>, list_bases,</div>
<div class="line">                              LASBASETOPT, &amp;choice_base_value, PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_enumeration" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5">FieldApproximationBase</a> <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>;</div>
<div class="line">  <span class="keywordflow">switch</span> (choice_base_value) {</div>
<div class="line">  <span class="keywordflow">case</span> AINSWORTH:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform)</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Set AINSWORTH_LEGENDRE_BASE for displacements&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> DEMKOWICZ:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a9b4f9fbc1a88eda9b2cde0df10ca23bf">DEMKOWICZ_JACOBI_BASE</a>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform)</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Set DEMKOWICZ_JACOBI_BASE for displacements&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a> = <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a35e0a7e42f81919e776c310c509598da">LASTBASE</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add field</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addDomainField(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addBoundaryField(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> = 3;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a2d7af8e1af9a42f3180d8cc96f8f8c06">PetscOptionsGetInt</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-order&quot;</span>, &amp;<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>, PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;addDataField(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_variable" href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">base</a>, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setFieldOrder(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setFieldOrder(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, 2);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;setUp();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> project_ho_geometry = [&amp;]() {</div>
<div class="line">    Projection10NodeCoordsOnField ent_method(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="group__mofem__loops.html#ga06843828fb475925d003a31b991c425e">loop_dofs</a>(<span class="stringliteral">&quot;GEOMETRY&quot;</span>, ent_method);</div>
<div class="line">  };</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> project_ho_geometry();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a55db6ee7b037f883685d61baabd7ace4">PetscOptionsGetBool</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-plane_strain&quot;</span>, &amp;<a class="code hl_variable" href="elastic_8cpp.html#ac5f84cb094bded67fcc51791b015fcab">is_plain_strain</a>,</div>
<div class="line">                             PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> coords_dim = <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a756249f6051982de377518e519ba8da4">PetscOptionsGetRealArray</a>(NULL, NULL, <span class="stringliteral">&quot;-field_eval_coords&quot;</span>,</div>
<div class="line">                                  <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), &amp;coords_dim,</div>
<div class="line">                                  &amp;<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>) {</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a> = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a> =</div>
<div class="line">        <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;FieldEvaluatorInterface&gt;()-&gt;getData&lt;DomainEle&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 3) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;FieldEvaluatorInterface&gt;()-&gt;buildTree3D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName());</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;FieldEvaluatorInterface&gt;()-&gt;buildTree2D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>-&gt;setEvalPoints(<a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1);</div>
<div class="line">    <span class="keyword">auto</span> no_rule = [](<a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>) { <span class="keywordflow">return</span> -1; };</div>
<div class="line">    <span class="keyword">auto</span> field_eval_fe_ptr = <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>-&gt;feMethodPtr.lock();</div>
<div class="line">    field_eval_fe_ptr-&gt;getRuleHook = no_rule;</div>
<div class="line"> </div>
<div class="line">    field_eval_fe_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpCalculateVectorFieldValues&lt;SPACE_DIM&gt;(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="aacoustic_8cpp_html_ad68ed57e17c71816ecfad0ea6746c8d3"><div class="ttname"><a href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a></div><div class="ttdeci">void simple(double P1[], double P2[], double P3[], double c[], const int N)</div><div class="ttdef"><b>Definition:</b> <a href="acoustic_8cpp_source.html#l00069">acoustic.cpp:69</a></div></div>
<div class="ttc" id="achild__and__parent_8cpp_html_a541ffc988889246e44b233b777828847"><div class="ttname"><a href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a></div><div class="ttdeci">constexpr int SPACE_DIM</div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00016">child_and_parent.cpp:16</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5">FieldApproximationBase</a></div><div class="ttdeci">FieldApproximationBase</div><div class="ttdoc">approximation base</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00058">definitions.h:58</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a35e0a7e42f81919e776c310c509598da"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a35e0a7e42f81919e776c310c509598da">LASTBASE</a></div><div class="ttdeci">@ LASTBASE</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00070">definitions.h:69</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a></div><div class="ttdeci">@ AINSWORTH_LEGENDRE_BASE</div><div class="ttdoc">Ainsworth Cole (Legendre) approx. base .</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00061">definitions.h:60</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a9b4f9fbc1a88eda9b2cde0df10ca23bf"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a9b4f9fbc1a88eda9b2cde0df10ca23bf">DEMKOWICZ_JACOBI_BASE</a></div><div class="ttdeci">@ DEMKOWICZ_JACOBI_BASE</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00067">definitions.h:66</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120"><div class="ttname"><a href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a></div><div class="ttdeci">@ H1</div><div class="ttdoc">continuous field</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00085">definitions.h:85</a></div></div>
<div class="ttc" id="adg__projection_8cpp_html_ad7eceded84ace5678d9df3e44f47d475"><div class="ttname"><a href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a></div><div class="ttdeci">constexpr int order</div><div class="ttdef"><b>Definition:</b> <a href="dg__projection_8cpp_source.html#l00018">dg_projection.cpp:18</a></div></div>
<div class="ttc" id="aelastic_8cpp_html_ac5f84cb094bded67fcc51791b015fcab"><div class="ttname"><a href="elastic_8cpp.html#ac5f84cb094bded67fcc51791b015fcab">is_plain_strain</a></div><div class="ttdeci">PetscBool is_plain_strain</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00076">elastic.cpp:76</a></div></div>
<div class="ttc" id="agroup__mofem__log__manager_html_ga19fe81dc9081ceb92ced847e619ca654"><div class="ttname"><a href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a></div><div class="ttdeci">#define MOFEM_LOG(channel, severity)</div><div class="ttdoc">Log.</div><div class="ttdef"><b>Definition:</b> <a href="_log_manager_8hpp_source.html#l00308">LogManager.hpp:308</a></div></div>
<div class="ttc" id="agroup__mofem__loops_html_ga06843828fb475925d003a31b991c425e"><div class="ttname"><a href="group__mofem__loops.html#ga06843828fb475925d003a31b991c425e">MoFEM::CoreInterface::loop_dofs</a></div><div class="ttdeci">virtual MoFEMErrorCode loop_dofs(const Problem *problem_ptr, const std::string &amp;field_name, RowColData rc, DofMethod &amp;method, int lower_rank, int upper_rank, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Make a loop over dofs.</div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_a2d7af8e1af9a42f3180d8cc96f8f8c06"><div class="ttname"><a href="namespace_mo_f_e_m.html#a2d7af8e1af9a42f3180d8cc96f8f8c06">MoFEM::PetscOptionsGetInt</a></div><div class="ttdeci">PetscErrorCode PetscOptionsGetInt(PetscOptions *, const char pre[], const char name[], PetscInt *ivalue, PetscBool *set)</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_petsc_8hpp_source.html#l00142">DeprecatedPetsc.hpp:142</a></div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_a55db6ee7b037f883685d61baabd7ace4"><div class="ttname"><a href="namespace_mo_f_e_m.html#a55db6ee7b037f883685d61baabd7ace4">MoFEM::PetscOptionsGetBool</a></div><div class="ttdeci">PetscErrorCode PetscOptionsGetBool(PetscOptions *, const char pre[], const char name[], PetscBool *bval, PetscBool *set)</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_petsc_8hpp_source.html#l00182">DeprecatedPetsc.hpp:182</a></div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_a756249f6051982de377518e519ba8da4"><div class="ttname"><a href="namespace_mo_f_e_m.html#a756249f6051982de377518e519ba8da4">MoFEM::PetscOptionsGetRealArray</a></div><div class="ttdeci">PetscErrorCode PetscOptionsGetRealArray(PetscOptions *, const char pre[], const char name[], PetscReal dval[], PetscInt *nmax, PetscBool *set)</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_petsc_8hpp_source.html#l00192">DeprecatedPetsc.hpp:192</a></div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_abee82d436d03244c6886fc99f71116f0"><div class="ttname"><a href="namespace_mo_f_e_m.html#abee82d436d03244c6886fc99f71116f0">MoFEM::PetscOptionsGetEList</a></div><div class="ttdeci">PetscErrorCode PetscOptionsGetEList(PetscOptions *, const char pre[], const char name[], const char *const *list, PetscInt next, PetscInt *value, PetscBool *set)</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_petsc_8hpp_source.html#l00203">DeprecatedPetsc.hpp:203</a></div></div>
<div class="ttc" id="anamespaceconvert_html_a4db4d50b047acc94e54fdf4df9f3077c"><div class="ttname"><a href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">convert.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l00064">convert.py:64</a></div></div>
<div class="ttc" id="astruct_example_html_a4b4698c46f9a721e09626be4173f6e7a"><div class="ttname"><a href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">Example::doEvalField</a></div><div class="ttdeci">PetscBool doEvalField</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00087">elastic.cpp:87</a></div></div>
<div class="ttc" id="astruct_example_html_a55a7f7d922239c8295d04f19901540dd"><div class="ttname"><a href="struct_example.html#a55a7f7d922239c8295d04f19901540dd">Example::base</a></div><div class="ttdeci">FieldApproximationBase base</div><div class="ttdef"><b>Definition:</b> <a href="plot__base_8cpp_source.html#l00068">plot_base.cpp:68</a></div></div>
<div class="ttc" id="astruct_example_html_ab79afebe5c16553d0c38e3ec022f868f"><div class="ttname"><a href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">Example::mField</a></div><div class="ttdeci">MoFEM::Interface &amp; mField</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l00229">plastic.cpp:229</a></div></div>
<div class="ttc" id="astruct_example_html_abb8f65a996f59c821db3ef8ef9f3ed5a"><div class="ttname"><a href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">Example::fieldEvalCoords</a></div><div class="ttdeci">std::array&lt; double, SPACE_DIM &gt; fieldEvalCoords</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00088">elastic.cpp:88</a></div></div>
<div class="ttc" id="astruct_example_html_afacd95aaefb0f7fe70a573e2eec28ae9"><div class="ttname"><a href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">Example::vectorFieldPtr</a></div><div class="ttdeci">boost::shared_ptr&lt; MatrixDouble &gt; vectorFieldPtr</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00090">elastic.cpp:90</a></div></div>
<div class="ttc" id="astruct_example_html_afb69524e6d06740ece900405afe10c28"><div class="ttname"><a href="struct_example.html#afb69524e6d06740ece900405afe10c28">Example::fieldEvalData</a></div><div class="ttdeci">boost::shared_ptr&lt; FieldEvaluatorInterface::SetPtsData &gt; fieldEvalData</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00089">elastic.cpp:89</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_unknown_interface_html_a7ab248ec45fca778800dcd92e5171beb"><div class="ttname"><a href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">MoFEM::UnknownInterface::getInterface</a></div><div class="ttdeci">MoFEMErrorCode getInterface(IFACE *&amp;iface) const</div><div class="ttdoc">Get interface refernce to pointer of interface.</div><div class="ttdef"><b>Definition:</b> <a href="_unknown_interface_8hpp_source.html#l00093">UnknownInterface.hpp:93</a></div></div>
</div><!-- fragment --><p >The space chosen is <code>H1</code>, the base is <code>AINSWORTH_LEGENDRE_BASE</code> and dimension is <em>SPACE_DIM</em> that corresponds to a vector field with <em>SPACE_DIM</em> number of coefficients. Additionally, we define a command line parameter <em>-order</em> that specifies the order of our base, 2nd order is chosen as a default.</p>
<h2><a class="anchor" id="tutorial_elastic_common_data"></a>
Common data</h2>
<p >The next function in our main program: <a class="el" href="struct_example.html#a717e41915fd8c44f6eebeff08d6fa381" title="[Set up problem]">Example::createCommonData()</a> defines and initialises the data passed between UDOs. In case of elasticity, we compute elasticity tensor \( \mathbb D\) using the formula below:</p>
<p class="formulaDsp">
\[
\begin{align}
\mathbb D_{ijkl} = G \left[ \delta_{ik} \delta_{jl} + \delta_{il} \delta_{jk} \right] + A (K - \frac{2}{3} G) \left[  \delta_{ij} \delta_{kl} \right]
\end{align}
\]
</p>
<p> where \( K\) and \( G\) are bulk and shear modulus, respectively. The coefficient \( A\) depends on the dimension of the problem, for 3D cases and plane strain formulation it is simply \( A = 1\), whereas for plane stress it takes the following form:</p>
<p class="formulaDsp">
\[
\begin{align}
 A=\frac{2 G}{K+\frac{4}{3} G}
\end{align}
\]
</p>
<p >Using the <a class="el" href="class_f_tensor_1_1_index.html">FTensor::Index</a> type these formulas can be directly implemented using Einstein's summation convention as shown below:</p>
<div class="fragment"><div class="line">      <span class="keyword">auto</span> set_material_stiffness = [&amp;]() {</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'i', SPACE_DIM&gt;</a> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'j', SPACE_DIM&gt;</a> <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'k', SPACE_DIM&gt;</a> <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>;</div>
<div class="line">        <a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'l', SPACE_DIM&gt;</a> <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>;</div>
<div class="line">        <span class="keyword">constexpr</span> <span class="keyword">auto</span> <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a> = <a class="code hl_class" href="class_f_tensor_1_1_kronecker___delta__symmetric.html">FTensor::Kronecker_Delta_symmetric&lt;int&gt;</a>();</div>
<div class="line">        <span class="keywordtype">double</span> <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a> = 1.;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 2 &amp;&amp; !<a class="code hl_variable" href="elastic_8cpp.html#ac5f84cb094bded67fcc51791b015fcab">is_plain_strain</a>) {</div>
<div class="line">          <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a> = 2 * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a> /</div>
<div class="line">              (<a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#ad7a361d6ac98acaf4fc56c736441c249">bulk_modulus_K</a> + (4. / 3.) * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keyword">auto</span> t_D = getFTensor4DdgFromMat&lt;SPACE_DIM, SPACE_DIM, 0&gt;(*mat_D_ptr);</div>
<div class="line">        t_D(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>) =</div>
<div class="line">            2 * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a> * ((<a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>) ^ <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>)) / 4.) +</div>
<div class="line">            <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a> * (<a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#ad7a361d6ac98acaf4fc56c736441c249">bulk_modulus_K</a> - (2. / 3.) * <a class="code hl_variable" href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a>) * <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) *</div>
<div class="line">                <a class="code hl_variable" href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a>(<a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>);</div>
<div class="line">      };</div>
<div class="ttc" id="aclass_f_tensor_1_1_index_html"><div class="ttname"><a href="class_f_tensor_1_1_index.html">FTensor::Index</a></div><div class="ttdef"><b>Definition:</b> <a href="_index_8hpp_source.html#l00023">Index.hpp:24</a></div></div>
<div class="ttc" id="aclass_f_tensor_1_1_kronecker___delta__symmetric_html"><div class="ttname"><a href="class_f_tensor_1_1_kronecker___delta__symmetric.html">FTensor::Kronecker_Delta_symmetric</a></div><div class="ttdoc">Kronecker Delta class symmetric.</div><div class="ttdef"><b>Definition:</b> <a href="_kronecker___delta_8hpp_source.html#l00049">Kronecker_Delta.hpp:49</a></div></div>
<div class="ttc" id="adynamic__first__order__con__law_8cpp_html_ad7a361d6ac98acaf4fc56c736441c249"><div class="ttname"><a href="dynamic__first__order__con__law_8cpp.html#ad7a361d6ac98acaf4fc56c736441c249">bulk_modulus_K</a></div><div class="ttdeci">double bulk_modulus_K</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00096">dynamic_first_order_con_law.cpp:96</a></div></div>
<div class="ttc" id="adynamic__first__order__con__law_8cpp_html_af389b858d48f284c6a95e2813c119446"><div class="ttname"><a href="dynamic__first__order__con__law_8cpp.html#af389b858d48f284c6a95e2813c119446">shear_modulus_G</a></div><div class="ttdeci">double shear_modulus_G</div><div class="ttdef"><b>Definition:</b> <a href="dynamic__first__order__con__law_8cpp_source.html#l00097">dynamic_first_order_con_law.cpp:97</a></div></div>
<div class="ttc" id="afree__surface_8cpp_html_a52438586143ef05bfe922220a317c144"><div class="ttname"><a href="free__surface_8cpp.html#a52438586143ef05bfe922220a317c144">t_kd</a></div><div class="ttdeci">constexpr auto t_kd</div><div class="ttdef"><b>Definition:</b> <a href="free__surface_8cpp_source.html#l00137">free_surface.cpp:137</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a510d8658904ea5f9e62ae641c8122e49"><div class="ttname"><a href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a></div><div class="ttdeci">FTensor::Index&lt; 'l', 3 &gt; l</div><div class="ttdef"><b>Definition:</b> <a href="matrix__function_8cpp_source.html#l00021">matrix_function.cpp:21</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a8191f28ba278df9c5d32a75cadb2bbd5"><div class="ttname"><a href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a></div><div class="ttdeci">FTensor::Index&lt; 'j', 3 &gt; j</div><div class="ttdef"><b>Definition:</b> <a href="matrix__function_8cpp_source.html#l00019">matrix_function.cpp:19</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_ac93d777bbf9336cad5c09007df789c95"><div class="ttname"><a href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a></div><div class="ttdeci">FTensor::Index&lt; 'k', 3 &gt; k</div><div class="ttdef"><b>Definition:</b> <a href="matrix__function_8cpp_source.html#l00020">matrix_function.cpp:20</a></div></div>
<div class="ttc" id="aoperators__tests_8cpp_html_aaea25cacd18f8fc7fbbaa4311fe33b72"><div class="ttname"><a href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a></div><div class="ttdeci">constexpr AssemblyType A</div><div class="ttdef"><b>Definition:</b> <a href="operators__tests_8cpp_source.html#l00030">operators_tests.cpp:30</a></div></div>
</div><!-- fragment --><p >Note that depending on <em>SPACE_DIM</em> our code will appropriately sum over all the indices and set coefficient \( A \) for plane stress or 3D case. In the next lines of the program, we define a vector that will be passed to the UDOs and specify the gravity load. For this example, we will <em>hardcode</em> the load to be always 1 in the Y direction \( \mathbf{ b } = [ 0,-1,0 ]\)</p>
<div class="fragment"></div><!-- fragment --><p >It is also possible to implement passing that data from command line parameter or read it from the mesh blocksets.</p>
<p >Finally, <a class="el" href="struct_example.html#a717e41915fd8c44f6eebeff08d6fa381" title="[Set up problem]">Example::createCommonData()</a> we initialise containers that will be storing data between different UDOs. For elasticity problem we will be storing gradient of deformation, small strain tensor, stress tensor, elasticity tensor and body force vector.</p>
<div class="fragment"></div><!-- fragment --><p >In the last two lines we call previously defined lambda functions for calculating elasticity tensor and body force vector.</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_material_stiffness();</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_body_force();</div>
</div><!-- fragment --><h2><a class="anchor" id="tutorial_elastic_dirichlet"></a>
Essential boundary conditions</h2>
<p >In order to apply homogeneous Dirichlet boundary conditions for our problem, we will utilise <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s utility to remove degrees of freedom from a problem.</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_example.html#a0105b294dd531bfee565bd59951ee5ef">Example::boundaryCondition</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;Simple&gt;();</div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;BcManager&gt;();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_X&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 0, 0);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_Y&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 1, 1);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;REMOVE_Z&quot;</span>,</div>
<div class="line">                                           <span class="stringliteral">&quot;U&quot;</span>, 2, 2);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">                                           <span class="stringliteral">&quot;REMOVE_ALL&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, 0, 3);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;pushMarkDOFsOnEntities&lt;DisplacementCubitBcData&gt;(</div>
<div class="line">      <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(), <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a> = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> integration_rule_bc = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a>) {</div>
<div class="line">    <span class="keywordflow">return</span> 2 * <a class="code hl_variable" href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a> + 1;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainRhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setDomainLhsIntegrationRule(<a class="code hl_variable" href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryRhsIntegrationRule(integration_rule_bc);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pip-&gt;setBoundaryLhsIntegrationRule(integration_rule_bc);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="afree__surface_8cpp_html_a28f0c075108bbb02a47f54fccb48ea1a"><div class="ttname"><a href="free__surface_8cpp.html#a28f0c075108bbb02a47f54fccb48ea1a">integration_rule</a></div><div class="ttdeci">auto integration_rule</div><div class="ttdef"><b>Definition:</b> <a href="free__surface_8cpp_source.html#l00185">free_surface.cpp:185</a></div></div>
<div class="ttc" id="aprism__polynomial__approximation_8cpp_html_a67c2672e3debe9c63fb239645337a1bd"><div class="ttname"><a href="prism__polynomial__approximation_8cpp.html#a67c2672e3debe9c63fb239645337a1bd">approx_order</a></div><div class="ttdeci">static constexpr int approx_order</div><div class="ttdef"><b>Definition:</b> <a href="prism__polynomial__approximation_8cpp_source.html#l00014">prism_polynomial_approximation.cpp:14</a></div></div>
</div><!-- fragment --><p >The first lambda function in the snippet above <em>fix_disp</em> searches for entities in a meshset with a given name. Subsequently, these entities (<em>Range</em>) are passed to another lambda function - <em>remove_ents</em> that removes them from the problem. This operation is equivalent of setting all the degrees of freedom to zero on associated entities. For the examples considered in this tutorial, the provided meshes contain only one meshset <em>FIX_ALL</em> that will essentially fix displacements in all directions to zero. In <a class="el" href="tutorial_elastic_problem.html#figure2_problem_fix_all">Figure 2</a> we show selected triangles on the face of triangle that are used to define the <em>FIX_ALL</em> meshset. Note that in case of 2D mesh, we select edge elements.</p>
<p ><a class="anchor" id="figure2_problem_fix_all"></a></p><div class="image">
<img src="boundary_cond_canti.png" alt="" width="300px"/>
<div class="caption">
Figure 2: FIX_ALL block meshset specified on the mesh of the cantilever for 3D case. </div></div>
<h2><a class="anchor" id="tutorial_elastic_neumann"></a>
Natural boundary conditions</h2>
<p >For natural boundary conditions we will only specify simple gravity load on the entire domain. We have to push into our Domain RHS pipeline an operator that calculates the following integral:</p>
<p class="formulaDsp">
\[
\begin{align}
\mathbf F_{i}^{e}&amp;=\int_{\Omega^{e}} \phi_{i} \mathbf b \, \mathrm d V
\end{align}
\]
</p>
<p >This operation can be done by pushing <code>OpBodyForce</code> User Data Operator into RHS domain pipeline. Note that arguments of this operator are: name of the field <em>U</em>, container <em>bodyForceMatPtr</em> for vector of body force and lambda function which is defines a coefficient for our vector. The function takes three arguments, which are the coordinates of the integration points. However, in this example, we assume homogeneous body, therefore the coefficient can by simply set to 1.</p>
<div class="fragment"></div><!-- fragment --><p >The <code>OpBodyForce</code> is an alias of the specialisation of the form integrator template <code>OpBaseTimesVector</code> declared in the beginning of the file</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="multifield__plasticity_8cpp.html#ae01fc46289e803e0ce4332d7b42fba34">OpBodyForce</a> = FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;PETSC&gt;<a class="code hl_class" href="class_linear_form.html">::LinearForm</a>&lt;</div>
<div class="line">    GAUSS&gt;::OpBaseTimesVector&lt;1, SPACE_DIM, 0&gt;;</div>
<div class="ttc" id="aclass_linear_form_html"><div class="ttname"><a href="class_linear_form.html">LinearForm</a></div></div>
<div class="ttc" id="amultifield__plasticity_8cpp_html_ae01fc46289e803e0ce4332d7b42fba34"><div class="ttname"><a href="multifield__plasticity_8cpp.html#ae01fc46289e803e0ce4332d7b42fba34">OpBodyForce</a></div><div class="ttdeci">FormsIntegrators&lt; DomainEleOp &gt;::Assembly&lt; USER_ASSEMBLE &gt;::LinearForm&lt; GAUSS &gt;::OpSource&lt; 1, 3 &gt; OpBodyForce</div><div class="ttdef"><b>Definition:</b> <a href="multifield__plasticity_8cpp_source.html#l00049">multifield_plasticity.cpp:50</a></div></div>
</div><!-- fragment --><p >The first parameter in the above template specifies the dimension of the base (we use scalar base, so set to 1), second parameter requires specification of the number of the coefficients of we field we are operating on (our vector field of displacements has <em>SPACE_DIM</em> coefficients). The last parameter specifies whether the passed vector is constant for all integration points. In this case <code>bodyForceMatPtr</code> body force vector is assumed constant, (has the same values for all gauss points). However, if the considered body is heterogeneous, then the last parameter would be set to 1.</p>
<h2><a class="anchor" id="tutorial_elastic_lhs"></a>
Pushing operators to LHS domain pipeline</h2>
<p >Another function of the main program <a class="el" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a" title="[Push operators to pipeline]">Example::assembleSystem()</a> is responsible for defining pipelines used to evaluate linear and bilinear forms of the system and assembly to the global matrices and vectors.</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_example.html#a014d5935b6bedac1b08a891b88c9386a">Example::assembleSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;Simple&gt;();</div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;BcManager&gt;();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">      pip-&gt;getOpDomainLhsPipeline(), {H1}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">      pip-&gt;getOpDomainRhsPipeline(), {H1}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM - 1, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">      pip-&gt;getOpBoundaryRhsPipeline(), {NOSPACE}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM - 1, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">      pip-&gt;getOpBoundaryLhsPipeline(), {NOSPACE}, <span class="stringliteral">&quot;GEOMETRY&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> mat_D_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Assemble domain stiffness matrix</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainLhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::verbose);</div>
<div class="line">  pip-&gt;getOpDomainLhsPipeline().push_back(<span class="keyword">new</span> <a class="code hl_struct" href="struct_op_k.html">OpK</a>(<span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, mat_D_ptr));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Infernal forces</span></div>
<div class="line">  <span class="keyword">auto</span> mat_grad_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_strain_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> mat_stress_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_class" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient&lt;SPACE_DIM, SPACE_DIM&gt;</a>(<span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line">                                                               mat_grad_ptr));</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> OpSymmetrizeTensor&lt;SPACE_DIM&gt;(<span class="stringliteral">&quot;U&quot;</span>, mat_grad_ptr, mat_strain_ptr));</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">addMatBlockOps</a>(pip-&gt;getOpDomainRhsPipeline(), <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;MAT_ELASTIC&quot;</span>,</div>
<div class="line">                        mat_D_ptr, Sev::inform);</div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> OpTensorTimesSymmetricTensor&lt;SPACE_DIM, SPACE_DIM&gt;(</div>
<div class="line">          <span class="stringliteral">&quot;U&quot;</span>, mat_strain_ptr, mat_stress_ptr, mat_D_ptr));</div>
<div class="line">  <span class="comment">// Internal forces</span></div>
<div class="line">  pip-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_typedef" href="elastic_8cpp.html#a356efe9688cdc0734f085eb47fdab9ae">OpInternalForce</a>(<span class="stringliteral">&quot;U&quot;</span>, mat_stress_ptr,</div>
<div class="line">                          [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Body forces</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">DomainRhsBCs::AddFluxToPipeline&lt;OpDomainRhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpDomainRhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, Sev::inform);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add force boundary condition</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">BoundaryRhsBCs::AddFluxToPipeline&lt;OpBoundaryRhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryRhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, -1, Sev::inform);</div>
<div class="line">  <span class="comment">// Add case for mix type of BCs</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_flux_to_lhs_pipeline_impl.html">BoundaryLhsBCs::AddFluxToPipeline&lt;OpBoundaryLhsBCs&gt;::add</a>(</div>
<div class="line">      pip-&gt;getOpBoundaryLhsPipeline(), <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, <span class="stringliteral">&quot;U&quot;</span>, Sev::verbose);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclass_op_calculate_vector_field_gradient_html"><div class="ttname"><a href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient</a></div></div>
<div class="ttc" id="aelastic_8cpp_html_a356efe9688cdc0734f085eb47fdab9ae"><div class="ttname"><a href="elastic_8cpp.html#a356efe9688cdc0734f085eb47fdab9ae">OpInternalForce</a></div><div class="ttdeci">FormsIntegrators&lt; DomainEleOp &gt;::Assembly&lt; A &gt;::LinearForm&lt; I &gt;::OpGradTimesSymTensor&lt; BASE_DIM, SPACE_DIM, SPACE_DIM &gt; OpInternalForce</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00035">elastic.cpp:36</a></div></div>
<div class="ttc" id="astruct_example_html_ad5aee1b66f4dd44cd4b45f7b4d630c6f"><div class="ttname"><a href="struct_example.html#ad5aee1b66f4dd44cd4b45f7b4d630c6f">Example::addMatBlockOps</a></div><div class="ttdeci">MoFEMErrorCode addMatBlockOps(boost::ptr_deque&lt; ForcesAndSourcesCore::UserDataOperator &gt; &amp;pipeline, std::string field_name, std::string block_name, boost::shared_ptr&lt; MatrixDouble &gt; mat_D_Ptr, Sev sev)</div><div class="ttdef"><b>Definition:</b> <a href="elastic_8cpp_source.html#l00106">elastic.cpp:106</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_add_flux_to_lhs_pipeline_impl_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_add_flux_to_lhs_pipeline_impl.html">MoFEM::AddFluxToLhsPipelineImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="_natural_8hpp_source.html#l00049">Natural.hpp:49</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_add_flux_to_rhs_pipeline_impl.html">MoFEM::AddFluxToRhsPipelineImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="_natural_8hpp_source.html#l00046">Natural.hpp:46</a></div></div>
<div class="ttc" id="astruct_op_k_html"><div class="ttname"><a href="struct_op_k.html">OpK</a></div><div class="ttdef"><b>Definition:</b> <a href="simple__elasticity_8cpp_source.html#l00016">simple_elasticity.cpp:16</a></div></div>
</div><!-- fragment --><p >In case of linear elasticity, after pushing boundary and source term operators (gravity load), we only have to define UDOs for LHS pipeline of the domain. In case of 2D problem we push operators (<a class="el" href="namespace_mo_f_e_m.html#a55f63d6bf940eefe7cf78df38ab5c797">MoFEM::OpCalculateHOJacForFace</a>) that calculate and set the inverse of Jacobian for 2D elements.</p>
<p >The last operator <code><a class="el" href="struct_op_k.html">OpK</a></code> integrates the bilinear form:</p>
<p class="formulaDsp">
\[
\begin{align}
 \mathbf K^e_{ij} = \int_{\Omega^e} \nabla \phi_i \mathbb D \nabla \phi_j \, \mathrm d \Omega
\end{align}
\]
</p>
<p >and subsequently assembles it into global system matrix \( \mathbf K \). Note that once again, a new operator does not have to be defined as <code><a class="el" href="struct_op_k.html">OpK</a></code> is simply an alias to existing operator from <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s repertoire. To that operator we are passing previously defined container that stores elasticity tensor \( \mathbb D \).</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_op_k.html">OpK</a> = FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;PETSC&gt;<a class="code hl_class" href="class_bi_linear_form.html">::BiLinearForm</a>&lt;</div>
<div class="line">    GAUSS&gt;::OpGradSymTensorGrad&lt;1, SPACE_DIM, SPACE_DIM, 0&gt;;</div>
<div class="ttc" id="aclass_bi_linear_form_html"><div class="ttname"><a href="class_bi_linear_form.html">BiLinearForm</a></div></div>
</div><!-- fragment --><p >The utilised <code>OpGradSymTensorGrad</code> form integrator template of Bilinear Form has four parameters: rank of the base, rank of row field, rank of the column field and finally, the increment of elasticity tensor, which in case of homogeneous material can be set to 0.</p>
<p >More info about available Form Integrators can be found in <a class="el" href="user_data_operators_table.html">User data operators table</a>.</p>
<h2><a class="anchor" id="tutorial_elastic_solver_setup"></a>
Solver setup</h2>
<p >With appropriately defined pipelines for assembling the global system of equations \( \mathbf{K} \mathbf{U} = \mathbf{F} \), the next functions <a class="el" href="struct_example.html#a715f389c012e659483ec314add372458" title="[Solve]">Example::solveSystem()</a> sets up PETSc solver and calculates it directly or iteratively based on specified settings.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="struct_set_up_schur.html">SetUpSchur</a> {</div>
<div class="line">  <span class="keyword">static</span> boost::shared_ptr&lt;SetUpSchur&gt;</div>
<div class="line">  <a class="code hl_function" href="struct_set_up_schur.html#a3e073d1191c6086862360ed028127b1f">createSetUpSchur</a>(<a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field);</div>
<div class="line">  <span class="keyword">virtual</span> MoFEMErrorCode <a class="code hl_function" href="struct_set_up_schur.html#ad71a485a37eeb5d74e76898f61a5dcca">setUp</a>(SmartPetscObj&lt;KSP&gt; solver) = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <a class="code hl_function" href="struct_set_up_schur.html#a0a92b8c06f626bcae7cb9bf3628c713e">SetUpSchur</a>() = <span class="keywordflow">default</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_example.html#a715f389c012e659483ec314add372458">Example::solveSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a> = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;Simple&gt;();</div>
<div class="line">  <span class="keyword">auto</span> pip = <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line">  <span class="keyword">auto</span> solver = pip-&gt;createKSP();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(solver);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> dm = <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDM();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> = createDMVector(dm);</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a> = vectorDuplicate(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> set_essential_bc = [&amp;]() {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="comment">// This is low level pushing finite elements (pipelines) to solver</span></div>
<div class="line">    <span class="keyword">auto</span> ksp_ctx_ptr = getDMKspCtx(<a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDM());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> pre_proc_rhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line">    <span class="keyword">auto</span> post_proc_rhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line">    <span class="keyword">auto</span> post_proc_lhs = boost::make_shared&lt;FEMethod&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> get_pre_proc_hook = [&amp;]() {</div>
<div class="line">      <span class="keywordflow">return</span> EssentialPreProc&lt;DisplacementCubitBcData&gt;(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>, pre_proc_rhs,</div>
<div class="line">                                                       {});</div>
<div class="line">    };</div>
<div class="line">    pre_proc_rhs-&gt;preProcessHook = get_pre_proc_hook();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> get_post_proc_hook_rhs = [&amp;]() {</div>
<div class="line">      <span class="keywordflow">return</span> EssentialPostProcRhs&lt;DisplacementCubitBcData&gt;(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>,</div>
<div class="line">                                                           post_proc_rhs, 1.);</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">auto</span> get_post_proc_hook_lhs = [&amp;]() {</div>
<div class="line">      <span class="keywordflow">return</span> EssentialPostProcLhs&lt;DisplacementCubitBcData&gt;(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>,</div>
<div class="line">                                                           post_proc_lhs, 1.);</div>
<div class="line">    };</div>
<div class="line">    post_proc_rhs-&gt;postProcessHook = get_post_proc_hook_rhs();</div>
<div class="line">    post_proc_lhs-&gt;postProcessHook = get_post_proc_hook_lhs();</div>
<div class="line"> </div>
<div class="line">    ksp_ctx_ptr-&gt;getPreProcComputeRhs().push_front(pre_proc_rhs);</div>
<div class="line">    ksp_ctx_ptr-&gt;getPostProcComputeRhs().push_back(post_proc_rhs);</div>
<div class="line">    ksp_ctx_ptr-&gt;getPostProcSetOperators().push_back(post_proc_lhs);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> setup_and_solve = [&amp;]() {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    BOOST_LOG_SCOPED_THREAD_ATTR(<span class="stringliteral">&quot;Timeline&quot;</span>, attrs::timer());</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSetUp&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(solver);</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSetUp &lt;= Done&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSolve&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line">    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;KSPSolve &lt;= Done&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="group__mofem__log__manager.html#ga47d7053307c012af4b78f8a09e21fa83">MOFEM_LOG_CHANNEL</a>(<span class="stringliteral">&quot;TIMER&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="group__mofem__log__manager.html#ga202c2d0258d78f4c0d60ecac64bf2252">MOFEM_LOG_TAG</a>(<span class="stringliteral">&quot;TIMER&quot;</span>, <span class="stringliteral">&quot;timer&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_essential_bc();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a> == AssemblyType::SCHUR) {</div>
<div class="line">    <span class="keyword">auto</span> schur_ptr = <a class="code hl_function" href="struct_set_up_schur.html#a3e073d1191c6086862360ed028127b1f">SetUpSchur::createSetUpSchur</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> schur_ptr-&gt;setUp(solver);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> setup_and_solve();</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> setup_and_solve();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga490784c9685a7e4068b83ca2babc1ba1">DMoFEMMeshToLocalVector</a>(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#a4b4698c46f9a721e09626be4173f6e7a">doEvalField</a>) {</div>
<div class="line">    <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 3) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;FieldEvaluatorInterface&gt;()-&gt;evalFEAtThePoint3D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1e-12, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">          <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName(), <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(),</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(), <span class="keyword">nullptr</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f">MF_EXIST</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;FieldEvaluatorInterface&gt;()-&gt;evalFEAtThePoint2D(</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#abb8f65a996f59c821db3ef8ef9f3ed5a">fieldEvalCoords</a>.data(), 1e-12, <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getProblemName(),</div>
<div class="line">          <a class="code hl_function" href="acoustic_8cpp.html#ad68ed57e17c71816ecfad0ea6746c8d3">simple</a>-&gt;getDomainFEName(), <a class="code hl_variable" href="struct_example.html#afb69524e6d06740ece900405afe10c28">fieldEvalData</a>, <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(),</div>
<div class="line">          <a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>(), <span class="keyword">nullptr</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f">MF_EXIST</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>-&gt;size1()) {</div>
<div class="line">      <span class="keyword">auto</span> t_disp = getFTensor1FromMat&lt;SPACE_DIM&gt;(*<a class="code hl_variable" href="struct_example.html#afacd95aaefb0f7fe70a573e2eec28ae9">vectorFieldPtr</a>);</div>
<div class="line">      <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> == 2)</div>
<div class="line">        <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;FieldEvaluator&quot;</span>, Sev::inform)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;U_X: &quot;</span> &lt;&lt; t_disp(0) &lt;&lt; <span class="stringliteral">&quot; U_Y: &quot;</span> &lt;&lt; t_disp(1);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;FieldEvaluator&quot;</span>, Sev::inform)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;U_X: &quot;</span> &lt;&lt; t_disp(0) &lt;&lt; <span class="stringliteral">&quot; U_Y: &quot;</span> &lt;&lt; t_disp(1)</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; U_Z: &quot;</span> &lt;&lt; t_disp(2);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="_log_manager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(<a class="code hl_variable" href="struct_example.html#ab79afebe5c16553d0c38e3ec022f868f">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>());</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="a_log_manager_8hpp_html_adacc7b9e7c4fa95cc0959ca359f999f5"><div class="ttname"><a href="_log_manager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a></div><div class="ttdeci">#define MOFEM_LOG_SYNCHRONISE(comm)</div><div class="ttdoc">Synchronise &quot;SYNC&quot; channel.</div><div class="ttdef"><b>Definition:</b> <a href="_log_manager_8hpp_source.html#l00345">LogManager.hpp:345</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28"><div class="ttname"><a href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a></div><div class="ttdeci">@ QUIET</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00208">definitions.h:208</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f"><div class="ttname"><a href="definitions_8h.html#a2c740dc34f8edf00c432912eaa5484c1a4f6e3b96dbc5db09c3281b676d448b7f">MF_EXIST</a></div><div class="ttdeci">@ MF_EXIST</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00100">definitions.h:100</a></div></div>
<div class="ttc" id="afree__surface_8cpp_html_a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d"><div class="ttname"><a href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a></div><div class="ttdeci">@ F</div><div class="ttdef"><b>Definition:</b> <a href="free__surface_8cpp_source.html#l00394">free_surface.cpp:394</a></div></div>
<div class="ttc" id="agroup__dm_html_ga490784c9685a7e4068b83ca2babc1ba1"><div class="ttname"><a href="group__dm.html#ga490784c9685a7e4068b83ca2babc1ba1">MoFEM::DMoFEMMeshToLocalVector</a></div><div class="ttdeci">PetscErrorCode DMoFEMMeshToLocalVector(DM dm, Vec l, InsertMode mode, ScatterMode scatter_mode)</div><div class="ttdoc">set local (or ghosted) vector values on mesh for partition only</div><div class="ttdef"><b>Definition:</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00509">DMMoFEM.cpp:509</a></div></div>
<div class="ttc" id="agroup__mofem__log__manager_html_ga202c2d0258d78f4c0d60ecac64bf2252"><div class="ttname"><a href="group__mofem__log__manager.html#ga202c2d0258d78f4c0d60ecac64bf2252">MOFEM_LOG_TAG</a></div><div class="ttdeci">#define MOFEM_LOG_TAG(channel, tag)</div><div class="ttdoc">Tag channel.</div><div class="ttdef"><b>Definition:</b> <a href="_log_manager_8hpp_source.html#l00339">LogManager.hpp:339</a></div></div>
<div class="ttc" id="agroup__mofem__log__manager_html_ga47d7053307c012af4b78f8a09e21fa83"><div class="ttname"><a href="group__mofem__log__manager.html#ga47d7053307c012af4b78f8a09e21fa83">MOFEM_LOG_CHANNEL</a></div><div class="ttdeci">#define MOFEM_LOG_CHANNEL(channel)</div><div class="ttdoc">Set and reset channel.</div><div class="ttdef"><b>Definition:</b> <a href="_log_manager_8hpp_source.html#l00284">LogManager.hpp:284</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_ad8657a5ec76e12f3066fb4b4eb75ace9"><div class="ttname"><a href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a></div><div class="ttdeci">double D</div><div class="ttdef"><b>Definition:</b> <a href="initial__diffusion_8cpp_source.html#l00044">initial_diffusion.cpp:44</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_interface_html_a9b2bc8c1b980f49d31a0b5f7fbe756f5"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_interface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">MoFEM::CoreInterface::get_comm</a></div><div class="ttdeci">virtual MPI_Comm &amp; get_comm() const =0</div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_interface_html_af2224ce77b33637b5cfad66a275a2ffb"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_interface.html#af2224ce77b33637b5cfad66a275a2ffb">MoFEM::CoreInterface::get_comm_rank</a></div><div class="ttdeci">virtual int get_comm_rank() const =0</div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_deprecated_core_interface_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_core_interface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
<div class="ttc" id="astruct_set_up_schur_html"><div class="ttname"><a href="struct_set_up_schur.html">SetUpSchur</a></div><div class="ttdoc">[Push operators to pipeline]</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l00751">plastic.cpp:751</a></div></div>
<div class="ttc" id="astruct_set_up_schur_html_a0a92b8c06f626bcae7cb9bf3628c713e"><div class="ttname"><a href="struct_set_up_schur.html#a0a92b8c06f626bcae7cb9bf3628c713e">SetUpSchur::SetUpSchur</a></div><div class="ttdeci">SetUpSchur()=default</div></div>
<div class="ttc" id="astruct_set_up_schur_html_a3e073d1191c6086862360ed028127b1f"><div class="ttname"><a href="struct_set_up_schur.html#a3e073d1191c6086862360ed028127b1f">SetUpSchur::createSetUpSchur</a></div><div class="ttdeci">static boost::shared_ptr&lt; SetUpSchur &gt; createSetUpSchur(MoFEM::Interface &amp;m_field, SmartPetscObj&lt; DM &gt; sub_dm, SmartPetscObj&lt; IS &gt; field_split_it, SmartPetscObj&lt; AO &gt; ao_map)</div><div class="ttdoc">Create data structure for handling Schur complement.</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l01470">plastic.cpp:1470</a></div></div>
<div class="ttc" id="astruct_set_up_schur_html_ad71a485a37eeb5d74e76898f61a5dcca"><div class="ttname"><a href="struct_set_up_schur.html#ad71a485a37eeb5d74e76898f61a5dcca">SetUpSchur::setUp</a></div><div class="ttdeci">virtual MoFEMErrorCode setUp(TS solver)=0</div></div>
</div><!-- fragment --><p >Note that in case of simple linear problems like elasticity considered therein the above snippet will look very similar. A detailed description of each function can be found e.g. in <a class="el" href="basic_tutorials_poisson_homogeneous.html">SCL-1: Poisson's equation (homogeneous BC)</a>.</p>
<h2><a class="anchor" id="tutorial_elastic_postprocessing"></a>
Postprocessing pipeline</h2>
<p >Finally, once the solver calculations are completed and solution vector is obtained, it is necessary save the data on the visualisation mesh and compute quantities of interest like strains and stresses. In function <a class="el" href="struct_example.html#ad1586d950420195d03d20479b2cedd06" title="[Solve]">Example::outputResults()</a> we will define pipeline to postprocess the results and save the calculated values to the output mesh.</p>
<div class="fragment"></div><!-- fragment --><p >We can reuse LHS domain pipeline, for the purpose of postprocessing. The following line resets (cleans) the operators pushed previously </p><div class="fragment"><div class="line">pipeline_mng-&gt;getDomainLhsFE().reset();</div>
</div><!-- fragment --><p >In the next two lines we create a postprocessig element (object) and use its function to generate a reference mesh. </p><div class="fragment"><div class="line"><span class="keyword">auto</span> post_proc_fe = boost::make_shared&lt;PostProcEle&gt;(mField);</div>
</div><!-- fragment --><p >Next, a series of operators is pushed:</p><ul>
<li><code>OpCalculateHOJacForFace</code> computes and sets the Jacobian in case of 2D elements</li>
<li><code><a class="el" href="class_op_calculate_vector_field_gradient.html">OpCalculateVectorFieldGradient</a></code> computes the gradient of the obtained displacement field \( \nabla \mathbf u^{h}=\sum_{m=0}^{N-1} \nabla \phi_m \bar{\mathbf u}_m \)</li>
<li><code>OpSymmetrizeTensor</code> symmetrises the previously computed gradient to compute small strain tensor \( \boldsymbol \varepsilon = \frac{1}{2} (\nabla \mathbf u^\text{T} + \nabla \mathbf u)  \)</li>
<li><code>OpTensorTimesSymmetricTensor</code> is another form integrator that computes Cauchy stress: \( \boldsymbol \sigma = \mathbb D : \boldsymbol \varepsilon \)</li>
<li>Tutorial::OpPostProcElastic saves the tensors \( \boldsymbol \varepsilon \) and \( \boldsymbol \sigma \) onto the reference mesh using moab tags.</li>
</ul>
<h1><a class="anchor" id="tutorial_elastic_code_run_and_post"></a>
Running code and visualisation</h1>
<p >In order to run the program that we have been discussing in this tutorial, you will do the following steps</p><ul>
<li>First, go to the directory where the binary file named <code>elastic</code> is located. Depending on how you install <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> shown in this page <a class="el" href="installation.html">Installation</a>, going to the directory would be something similar to this<ul>
<li>For user version installation <div class="fragment"><div class="line">cd mofem_install/um_view/tutorials/vec-0/</div>
</div><!-- fragment --></li>
<li>For developer version installation <div class="fragment"><div class="line">cd mofem_install/mofem-cephas/mofem/users_modules/um-build-RelWithDebInfo-abcd1234/tutorials/vec-0</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Second, check the parameters in the <em>param_file.petsc</em>. These are PETSc parameters and you should only use parameters that are needed for a particular solver, in this case KSP solver. Only the following parameters should be uncommented <div class="fragment"><div class="line"><span class="preprocessor">## Linear solver</span></div>
<div class="line">-ksp_type fgmres </div>
<div class="line">-pc_type lu </div>
<div class="line">-pc_factor_mat_solver_type mumps</div>
<div class="line">-ksp_monitor</div>
</div><!-- fragment --></li>
<li>Third, in the terminal, run commands to partition the input mesh and start the analysis <div class="fragment"><div class="line">./elastic_2d -file_name beam_3D.cub -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 2</div>
</div><!-- fragment --> where the mesh of a square plate is partitioned into two parts and then the program is run using two processors (the same number of partitions) with fourth order polynomial of approximation.</li>
</ul>
<p >This will produce <em>out_elastic.h5m</em> file which we can convert using </p><div class="fragment"><div class="line">mbconvert out_elastic.h5m out_elastic_3D.vtk</div>
</div><!-- fragment --><p >The file <em>out_elastic_3D.vtk</em> can be opened in Paraview. Using the filter <code>WarpByScalar</code> allows to visualise the deformation as shown in <a class="el" href="tutorial_elastic_problem.html#figure3_output">Figure 3</a>.</p>
<p >We can also compute 2D case of the beam. In order to do that, change the below variable: </p><div class="fragment"></div><!-- fragment --><p >to the value equal to 2 and compile the code (in your build directory) using <code>make</code> command. You should be able then to compute 2D variant as follows </p><div class="fragment"><div class="line">./elastic_2d -file_name beam_2D.cub -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 2</div>
</div><!-- fragment --><p> and generate vtk file using: </p><div class="fragment"><div class="line">mbconvert out_elastic.h5m out_elastic_2D.vtk</div>
</div><!-- fragment --><p ><a class="anchor" id="figure3_output"></a></p><div class="image">
<img src="beams_2D_3D_case.gif" alt="" width="800px"/>
<div class="caption">
Figure 3: Deformation of cantilever beams for 2D and 3D case. The color map represents displacements U.</div></div>
<p >Note that the beams, both for 2D and 3D cases experience spurious deformation at the free end. This is a known feature of small strain kinematic description. To mitigate this issue, a large strain geometrically nonlinear formulation can be used. The extension of the above tutorial to such nonlinear case can be found in <a class="el" href="tutorial_nonlinear_elastic.html">VEC-2: Nonlinear elastic</a>. We propose there a simple Hencky strain measure that improves the behaviour of the material experiencing large rotations.</p>
<h1><a class="anchor" id="tutorial_elastic_code_source_code"></a>
Plain program</h1>
<p >The full source code of the main program can be accessed below: <a class="el" href="elastic_8cpp.html" title="elastic example">elastic.cpp</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.5
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>