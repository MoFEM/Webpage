<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.5"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: SCL-1: Poisson&#39;s equation (homogeneous BC)</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SCL-1: <a class="el" href="struct_poisson.html">Poisson</a>'s equation (homogeneous BC) </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#basic_tutorials_poisson_homogeneous_introduction">Introduction</a><ul><li class="level2"><a href="#basic_tutorials_poisson_homogeneous_problem">The problem</a></li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_discretisation">Discretisation</a></li>
</ul>
</li>
<li class="level1"><a href="#basic_tutorials_poisson_homogeneous_implementation">Implementation</a><ul><li class="level2"><a href="#basic_tutorials_poisson_homogeneous_udo">User Data Operators</a><ul><li class="level3"><a href="#OpDomainLhsMatrixK">OpDomainLhsMatrixK</a></li>
<li class="level3"><a href="#OpDomainRhsVectorF">OpDomainRhsVectorF</a></li>
</ul>
</li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_class">The Poisson2DHomogeneous class</a><ul><li class="level3"><a href="#basic_tutorials_poisson_homogeneous_constructor">Poisson2DHomogeneous()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_readmesh">readMesh()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_setupproblem">setupProblem()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_bc">boundaryCondition()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_assemble">assembleSystem()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_intergration">setIntegrationRules()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_solve">solveSystem()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_output">outputResults()</a></li>
<li class="level3"><a href="#basic_tutorials_poisson_homogeneous_run_analysis">runProgram()</a></li>
</ul>
</li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_main_function">The main() function</a></li>
</ul>
</li>
<li class="level1"><a href="#basic_tutorials_poisson_homogeneous_result">Results</a><ul><li class="level2"><a href="#basic_tutorials_poisson_homogeneous_run_program">Run the program</a></li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_op">Output</a></li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_discussion">Discussion</a></li>
</ul>
</li>
<li class="level1"><a href="#basic_tutorials_poisson_homogeneous_plain_program">Plain program</a><ul><li class="level2"><a href="#basic_tutorials_poisson_homogeneous_impl_udo">Implementation of User Data Operators (*.hpp)</a></li>
<li class="level2"><a href="#basic_tutorials_poisson_homogeneous_impl_main">Implementation of the main program (*.cpp)</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>Prerequisites of this tutorial include <a class="el" href="basic_tutorials_mesh_generation_2d.html">MSH-1: Create a 2D mesh from Gmsh</a> and <a class="el" href="basic_tutorials_mesh_generation_3d.html">MSH-2: Create a 3D mesh from Gmsh</a> (for the 3D extension implementation)</dd></dl>
<p><br  />
</p>
<dl class="section note"><dt>Note</dt><dd>Intended learning outcome:<ul>
<li>general structure of a program developed using <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></li>
<li>idea of <a href="http://mofem.eng.gla.ac.uk/mofem/html/struct_mo_f_e_m_1_1_simple.html">Simple Interface</a> in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and how to use it</li>
<li>idea of Domain element in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and how to use it</li>
<li>process of implementing User Data Operators (UDOs) to calculate and assemble stiffness matrix and force vector</li>
<li>how to <b>push</b> the developed UDOs to the <em>Pipeline</em></li>
<li>a way to handle homogeneous boundary condition in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></li>
<li>utilisation of tools to convert outputs (MOAB) and visualise them (Paraview)</li>
</ul>
</dd></dl>
<p><br  />
</p>
<dl class="section note"><dt>Note</dt><dd>After finishing this tutorial, if you would like to replicate the program and practice yourself in an existing module or in your own module, you may wish to have a look at <a class="el" href="how_to_add_new_module_and_program.html">How to add a new module and program</a> and <a class="el" href="how_to_compile_program.html">How to compile a program</a>.</dd></dl>
<h1><a class="anchor" id="basic_tutorials_poisson_homogeneous_introduction"></a>
Introduction</h1>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_problem"></a>
The problem</h2>
<p >In this tutorial we will solve a simple <a class="el" href="struct_poisson.html">Poisson</a>'s equation with homogeneous (uniform in space) boundary condition using <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>. The physical example of this equation is that you have a membrane that is fixed at its boundary and it experiences a uniformly distributed force on its surface, then you are asked to estimate the displacement of the membrane. The strong form of the problem as follows</p>
<p class="formulaDsp">
\[
  \begin{align}
-\nabla \cdot \nabla u(\mathbf{x}) &amp;= f \quad {\rm in} \quad {
\Omega}, \\ 
{ u}(\mathbf{x}) &amp;= 0 \quad {\rm on} \quad \partial { \Omega},
  \end{align}
\]
</p>
<p> where \( { \Omega} \) denotes the domain occupied by the body and \( \partial { \Omega} \) is the boundary of the domain. Additionally, \( f \) is the source function and \( {\bf x} \) is the position in 2D or 3D space of a point in the domain.</p>
<p >Let consdier a <a class="el" href="struct_poisson.html">Poisson</a> problem on a rectangle domain with homogenous boundary conditions and source function \( f \), the analytical solution can be found. However, as the first practice with <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, we are solving it numerically using a finite element approach. This is done by subdividing the domain into multiple elements, building piece-wise approximations, and solving a discrete problem.</p>
<p >As you may have already learned from the basic finite element method, in order to approximate a field \( u \) of the problem equation. We need to derive the weak form it. The procedure to achieve it is as follows</p>
<ul>
<li>First, multiplying both sides of the equation by a <em>test</em> function \( \delta u \) and then integrate over the domain \( \Omega \)  <p class="formulaDsp">
\[
  \begin{equation}
-\int_\Omega \delta u(\nabla \cdot \nabla u ) ~d\Omega= \int_\Omega \delta u f ~d\Omega.
  \end{equation}
\]
</p>
</li>
<li>Second, apply the integration by parts on the left-hand side of the equation, we have  <p class="formulaDsp">
\[
  \begin{equation}
  \int_\Omega \nabla \delta u \cdot \nabla u ~d\Omega - \int_{\partial \Omega} \delta u {\bf n} \cdot
  \nabla u ~d\partial \Omega = \int_\Omega \delta u f ~d\Omega.
  \end{equation}
\]
</p>
 It is noted that the test function \( \delta u \) has to satisfy the homogeneous boundary condition, i.e. \( \delta u=0 \) on \( \partial \Omega \). Substituting it to the above equation, we finally obtain the weak form of the problem  <p class="formulaDsp">
\[
  \begin{equation}
\int_\Omega \nabla \delta u \cdot \nabla u ~d\Omega = \int_\Omega \delta u f ~d\Omega, \quad \forall \delta u \in H_{0}^{1}(\Omega),
  \end{equation}
\]
</p>
 where the space for test function \( \delta u \) is \(
  H_{0}^{1}(\Omega):=\left\{v \in H^{1}(\Omega) \mid v=0 \text { on } \partial \Omega\right\} \).</li>
</ul>
<p >We are now solving this equation of the weak form instead of the original equation. This equation is asking for the solution of \( u \) that is true for all test function \( \delta u \). In order to achieve it, we will approximate \( u
\) following a process in finite element called <em>discretisation</em> which will be presented in the next part.</p>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_discretisation"></a>
Discretisation</h2>
<p >As mentioned above, instead of trying to solve the problem analytically, we will approximate \( u \) assuming its solution has the form  </p><p class="formulaDsp">
\[
  \begin{equation}
u \approx u^h = \sum_{j=0}^{N-1} \phi_j \bar{u}_j.
  \end{equation}
\]
</p>
<p> This expression can be interpreted as follows. Find the approximate solution \(
u^h \) of \( u \) where \( u^h \) is calculated by summing the contribution of base function \( \phi_j \) with the <em>coefficient</em> of the contribution is \( \bar{u}_j \).</p>
<p >Sometimes, \( \phi_j \) is also called shape functions and \( \bar{u}_j \) called <em>degrees of freedom (DOFs)</em> of the problem. In the implementation process, which will be discussed later in this tutorial, <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> gives you values of \( \phi_j \) by default (provided that you give it some hints) and you will find the solution of \( u^h \), of course, with the help of <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>.</p>
<p >Keep in mind that, in the weak form, we have another term that also needs to be taken care of, that is the test function \( \delta u \). As we were saying, the weak form has to be satisfied with all test function \( \delta u \) meaning it has to be true with the arbitrary choice of \( \delta u_i=\phi_i \).</p>
<p >Substituting \( u \) and \( \delta u \) into the weak form, we have the discrete form of the problem given by  </p><p class="formulaDsp">
\[
  \begin{equation}
\int_{\Omega^e} \nabla \phi_i \cdot \nabla \left( \sum_j \bar{u}_j \phi_j
\right) ~d{\Omega^e}= \int_{\Omega^e} \phi_i f ~d{\Omega^e}.
  \end{equation}
\]
</p>
<p> Moving \( \bar{u}_j \) outside of the parentheses and rearranging the equation, we have  </p><p class="formulaDsp">
\[
  \begin{equation}
\sum_j \left( \int_{\Omega^e} \nabla \phi_i \cdot \nabla \phi_j ~d{\Omega^e}
\right) \bar{u}_j   = \int_{\Omega^e} \phi_i f ~d{\Omega^e}.
  \end{equation}
\]
</p>
<p >Now, the problem becomes: finding the vector of coefficients (or DOFs) \( {\bf U} \) such that  </p><p class="formulaDsp">
\[
{\bf K u} = {\bf F},
\]
</p>
<p> where \( {\bf K} \) and \( {\bf F} \) are the global stiffness matrix (left hand side) and global force vector (right hand side) calculated over the whole domain, respectively. \( {\bf K} \) and \( {\bf F} \) are obtained by assembling all elements (entity) in the domain, and the components of element stiffness matrix and element force vector are calculated as  </p><p class="formulaDsp">
\[
  \begin{align}
    K_{ij}^e &amp;= \int_{\Omega^e} \nabla \phi_i \cdot \nabla  \phi_j ~d{\Omega^e}, \\
    F_i^e &amp;= \int_{\Omega^e} \phi_i f ~d{\Omega^e}.
  \end{align}
\]
</p>
<p> One thing we can notice here is that the matrix \( {\bf K} \) is symmetric which means there will be opportunity to save time later in the implementation.</p>
<p >We are almost at the place where we can start the implementation, but still, you may ask how computers can handle the integral terms. Of course, we will not ask computers to calculate the integrals directly in an infinite sense, instead it is done using <em>quadrature</em> which is in a finite sense and commonly used in finite element method. In other word, the integrals are approximated by the sum of a set of points on each element along with their weights as follows  </p><p class="formulaDsp">
\[
  \begin{align}
K_{ij}^e &amp;= \int_{\Omega^e} \nabla \phi_i \cdot \nabla \phi_j \approx \sum_q
\nabla \phi_i \left( {\bf x}_q \right) \cdot \nabla \phi_j \left( {\bf x}_q
\right) W_q \left\|\mathbf{J}_{g}^{e}\right\| \label{eqn_stiffness}, \\ 
F_i^e &amp;= \int_{\Omega^e} \phi_i f \approx \sum_q \phi_i \left( {\bf x}_q \right)
f \left( {\bf x}_q \right) W_q \left\|\mathbf{J}_{g}^{e}\right\|,
  \end{align}
\]
</p>
<p> where \( {\bf x}_q \) and \( W_q \) are the location and weight of the quadrature point, respectively. Meanwhile, \( \left\|\mathbf{J}_{g}^{e}\right\|
\) is the determinant of the Jacobian of the transformation of the element \(
e \) from physical coordinates to parent coordinates. For triangular elements, this determinant equals to the area of the element. These equations can be interpreted as follows</p>
<p >The approximated value of the component at row \( i \) and column \( j \) of the element stiffness matrix \( K \) of element \( e \) is calculated by taking the summation over all quadrature points of the multiplication of</p><ul>
<li>the first derivative of the \( i^{\rm th} \) approximation function \( \phi
  \) evaluated at quadrature point \( q \),</li>
<li>the first derivative of the \( j^{\rm th} \) approximation function \( \phi
  \) evaluated at the same quadrature point \( q \), and</li>
<li>the multiplication of the weight of that quadrature point \( q \) and the determinant of the Jacobian.</li>
</ul>
<p >Likewise, the approximated value of the component at row \( i \) of the element force vector \( F \) of element \( e \) is calculated by taking the summation over all quadrature points of the multiplication of</p><ul>
<li>the \( i^{\rm th} \) approximation function \( \phi \) evaluated at quadrature point \( q \),</li>
<li>the body force evaluated at the same quadrature point \( q \), and</li>
<li>the multiplication of the weight of that quadrature point \( q \) and the determinant of the Jacobian.</li>
</ul>
<p >More details on the numerical integration can be found at the tutorial <a class="el" href="integration.html">FUN-1: Integration on finite element mesh</a>.</p>
<p >To this end, we have established a linear system of the primary variable \(
{\bf U} \) through \( {\bf K} \) and \( {\bf F} \). In <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, we will use an iterative solver (<a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/KSP/index.html">KSP</a>) to solve for \( {\bf U} \) and apply steps to postprocess the solution and visualise it.</p>
<h1><a class="anchor" id="basic_tutorials_poisson_homogeneous_implementation"></a>
Implementation</h1>
<p >An immediate question you may have regarding the implementation is how to implement the matrix \( {\bf K} \) and vector \( {\bf F} \). This is done through the implementation of the so-called <b>User Data Operators</b>. UDOs are the essential part of <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and they are present in all finite element problems implemented in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>. UDO is normally called Operator (for short) by <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> developers. Once UDOs are implemented, they will be <em>pushed</em> to the working <b>pipeline</b>.</p>
<p >Here we have introduced <em>two important concepts</em> in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></p><ul>
<li><b>UDOs</b> are responsible for calculation of certain things, e.g. stiffness matrix, force vector, inverse of Jacobian, field values, field gradients, etc., and</li>
<li><b>Pipeline</b> is where you <em>push</em> UDOs to in a certain order, e.g. UDOs for calculating field values and field gradients (nonlinear problem) are pushed before UDOs calculating stiffness matrix and force vector. After being pushed to the Pipeline, those UDOs will be executed sequentially.</li>
</ul>
<p >As a common practice, typically all the implementation of UDOs for a specific problem is put in a <code>*.hpp</code> file. This file will be included in the main <code>*.cpp</code> file which contains all the necessary classes and functions. Detailed explanation of the implementation of UDOs, how you pushed UDOs to Pipeline as well as development of classes/functions are presented below</p>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_udo"></a>
User Data Operators</h2>
<p >As described previously, solving the <a class="el" href="struct_poisson.html">Poisson</a> problem with homogeneous would require the computation and assembling of the matrix \( {\bf K} \) and vector \( {\bf F} \). These essential processes of computation and assembling will be handled by two different UDOs which separately deal with the matrix and vector. They are:</p>
<ol type="1">
<li><a class="el" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k.html">Poisson2DHomogeneousOperators::OpDomainLhsMatrixK</a> is responsible for calculating and assembly of the left-hand-side matrix \( {\bf K} \)</li>
<li><a class="el" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html">Poisson2DHomogeneousOperators::OpDomainRhsVectorF</a> is responsible to calculation and assembly of the right-hand-side vector \( {\bf F} \)</li>
</ol>
<p >Before going into details of the implementation of the two UDOs in <a class="el" href="poisson__2d__homogeneous_8hpp.html">poisson_2d_homogeneous.hpp</a>, let's have a look at the first few lines of code file that includes some libraries for finite element implementation. The code is based on C++ libraries with advanced aliases, and declaration/initialisation. Apart from that, the dimension(2D/3D) of the problem can easily be assihned from the EXECUTABLE_DIMENSION which will discuss later.</p>
<div class="fragment"><div class="line"><span class="comment">// Define name if it has not been defined yet</span></div>
<div class="line"><span class="preprocessor">#ifndef __POISSON2DHOMOGENEOUS_HPP__</span></div>
<div class="line"><span class="preprocessor">#define __POISSON2DHOMOGENEOUS_HPP__</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Include standard library and Header file for basic finite elements</span></div>
<div class="line"><span class="comment">// implementation</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">EntData</a> = EntitiesFieldData::EntData;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> DIM&gt;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps</a> = PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::DomainEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = DomainEle::UserDataOperator;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> =</div>
<div class="line">    FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;PETSC&gt;<a class="code hl_typedef" href="radiation_8cpp.html#a62d290f01cfc65a09faa805099b2e06f">::OpBase</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Namespace that contains necessary UDOs, will be included in the main program</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_poisson2_d_homogeneous_operators.html">Poisson2DHomogeneousOperators</a> {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Declare FTensor index for a problem</span></div>
<div class="line"><a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'i', SPACE_DIM&gt;</a> <a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#a6de501e93282da2d382d3e918cda7d80">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// For simplicity, body source term f has been consider to be constant throughout the domain</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#ae3fc8b5f9de9d17faeb6c6a7488e7ad9">body_source</a> = 5.;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//.. ..Implementation of the UDOs below this point.. ..</span></div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="achild__and__parent_8cpp_html_a80b637c04b8c449d54efa75ab73b67df"><div class="ttname"><a href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a></div><div class="ttdeci">ElementsAndOps&lt; SPACE_DIM &gt;::DomainEle DomainEle</div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00034">child_and_parent.cpp:34</a></div></div>
<div class="ttc" id="aclass_f_tensor_1_1_index_html"><div class="ttname"><a href="class_f_tensor_1_1_index.html">FTensor::Index</a></div><div class="ttdef"><b>Definition:</b> <a href="_index_8hpp_source.html#l00023">Index.hpp:24</a></div></div>
<div class="ttc" id="anamespace_poisson2_d_homogeneous_operators_html"><div class="ttname"><a href="namespace_poisson2_d_homogeneous_operators.html">Poisson2DHomogeneousOperators</a></div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00030">poisson_2d_homogeneous.hpp:30</a></div></div>
<div class="ttc" id="anamespace_poisson2_d_homogeneous_operators_html_a6de501e93282da2d382d3e918cda7d80"><div class="ttname"><a href="namespace_poisson2_d_homogeneous_operators.html#a6de501e93282da2d382d3e918cda7d80">Poisson2DHomogeneousOperators::i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00033">poisson_2d_homogeneous.hpp:33</a></div></div>
<div class="ttc" id="anamespace_poisson2_d_homogeneous_operators_html_ae3fc8b5f9de9d17faeb6c6a7488e7ad9"><div class="ttname"><a href="namespace_poisson2_d_homogeneous_operators.html#ae3fc8b5f9de9d17faeb6c6a7488e7ad9">Poisson2DHomogeneousOperators::body_source</a></div><div class="ttdeci">const double body_source</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00036">poisson_2d_homogeneous.hpp:36</a></div></div>
<div class="ttc" id="aradiation_8cpp_html_a62d290f01cfc65a09faa805099b2e06f"><div class="ttname"><a href="radiation_8cpp.html#a62d290f01cfc65a09faa805099b2e06f">OpBase</a></div><div class="ttdeci">OpBaseImpl&lt; PETSC, EdgeEleOp &gt; OpBase</div><div class="ttdef"><b>Definition:</b> <a href="radiation_8cpp_source.html#l00029">radiation.cpp:29</a></div></div>
<div class="ttc" id="astruct_elements_and_ops_html"><div class="ttname"><a href="struct_elements_and_ops.html">ElementsAndOps</a></div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00018">child_and_parent.cpp:18</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">MoFEM::EntitiesFieldData::EntData</a></div><div class="ttdoc">Data on single entity (This is passed as argument to DataOperator::doWork)</div><div class="ttdef"><b>Definition:</b> <a href="_entities_field_data_8hpp_source.html#l00127">EntitiesFieldData.hpp:127</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_base_impl_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_base_impl.html">MoFEM::OpBaseImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00170">FormsIntegrators.hpp:170</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">MoFEM::VolumeElementForcesAndSourcesCore::UserDataOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="_volume_element_forces_and_sources_core_8hpp_source.html#l00108">VolumeElementForcesAndSourcesCore.hpp:109</a></div></div>
</div><!-- fragment --><p >Next, Users can also learn a general structure of any UDOs implemented in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> to many extend. So, we will look in details how the following two main User Defined Operator(UDO)s of the problem can be implemented.</p>
<ol type="1">
<li><b>OpDomainLhsMatrixK</b> and</li>
<li><b>OpDomainRhsVectorF</b></li>
</ol>
<h3><a class="anchor" id="OpDomainLhsMatrixK"></a>
OpDomainLhsMatrixK</h3>
<p >This UDO is responsible for the calculation and assembly of the left-hand-side matrix \( {\bf K} \)</p>
<p >First, let's look at the structure of this UDO to calculate matrix \(
{\bf K} \).</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>OpDomainLhsMatrixK : <span class="keyword">public</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  OpDomainLhsMatrixK(std::string row_field_name, std::string col_field_name)</div>
<div class="line">      : <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a>(row_field_name, col_field_name,</div>
<div class="line">                            <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a>::OPROWCOL) {}</div>
<div class="line"> </div>
<div class="line">  MoFEMErrorCode <a class="code hl_function" href="struct_mo_f_e_m_1_1_op_base_impl.html#a953383bec3b4f83e563ee6e0af2226c2">iNtegrate</a>(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                           EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//.. ..Implementation of iNtegrate() below this point .. ..</span></div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_base_impl_html_a953383bec3b4f83e563ee6e0af2226c2"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_base_impl.html#a953383bec3b4f83e563ee6e0af2226c2">MoFEM::OpBaseImpl::iNtegrate</a></div><div class="ttdeci">virtual MoFEMErrorCode iNtegrate(EntData &amp;row_data, EntData &amp;col_data)</div><div class="ttdoc">Integrate grad-grad operator.</div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00250">FormsIntegrators.hpp:250</a></div></div>
</div><!-- fragment --><p >We have the class <code>OpDomainLhsMatrixK</code> that is inherited from <code><a class="el" href="class_assembly_domain_ele_op.html">AssemblyDomainEleOp</a></code> which is the alias of the base chain of specialized template FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;PETSC&gt;::OpBase. This operator also accelerate the process of assembling local matrix to global matrix. Here, the forms integrators using the <a class="el" href="class_domain_ele_op.html">DomainEleOp</a> type is a templated parameter to assembly using the PETSc library. Here, the newly created class has two public objects <code>OpDomainLhsMatrixK()</code> and <code>iNtegrate</code> which can be accessed from outside of the class. This follows the concept of <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">data encapsulation</a> to hide values and objects inside the class as much as possible. We will discuss a little more details of those four objects of the class in the followings</p>
<ul>
<li><code>OpDomainLhsMatrixK()</code> <div class="fragment"><div class="line">OpDomainLhsMatrixK(std::string row_field_name, std::string col_field_name)</div>
<div class="line">    : <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a>(row_field_name, col_field_name,</div>
<div class="line">                          <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a>::OPROWCOL) {}</div>
</div><!-- fragment --> This public member function has two input arguments which are the row_field_name and col_field_name carrying the names of the field for row and column, respectively. In general, these two field names can be different.But in this particular case of <a class="el" href="struct_poisson.html">Poisson</a>'s problem with homogeneous boundary condition, we have considered the same field named as "U" for both row and column.In this way, <a class="el" href="struct_mo_f_e_m_1_1_forces_and_sources_core_1_1_user_data_operator.html#ac99de5ec6fa9bad3ccc5c5d60bc48e40a3884917d2b4b602e2579971b6d56878a" title="operator doWork is executed on FE rows &amp;columns">OpFaceEle::OPROWCOL</a> because we assemble stiffness matrix that has data on both row and column. In this case, our matrix \( K \) is symmetric but if we want we could code sYmm = true inside the closing bracket{} to assemble and store data of half of the matrix. However, here we are considering the full matrix.</li>
<li><code>iNtegrate</code> <div class="fragment"><div class="line">MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                         EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Implementation of iNtegrate() below this point</span></div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --> This public member function is the core part of the UDO implementation. It decides how to calculate the local matrix components and how to assemble them to the global matrix. All mathematical derivations that we did in the previous section of this tutorial will be implemented in this function. More discussion on other essential function of it is stating below:</li>
<li><code>locMat</code> <br  />
 This private member object of type MatrixDouble is used to store the results of the calculation of components of element stiffness matrix. This object is made private because only member of the class know how to use it, members from other classes have no access to this private object avoiding unpredictable consequences, i.e. errors.</li>
</ul>
<p >Now we take a closer look on the details of the implementation of the member function <code>iNtegrate()</code>. Full code for this function as follows </p><div class="fragment"><div class="line">MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                           EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_row_dofs = row_data.getIndices().size();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_col_dofs = col_data.getIndices().size();</div>
<div class="line"> </div>
<div class="line">    this-&gt;locMat.resize(nb_row_dofs, nb_col_dofs, <span class="keyword">false</span>);</div>
<div class="line">    this-&gt;locMat.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get element area</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> area = getMeasure();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get number of integration points</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_integration_points = getGaussPts().size2();</div>
<div class="line">    <span class="comment">// get integration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get derivatives of base functions on row</span></div>
<div class="line">    <span class="keyword">auto</span> t_row_diff_base = row_data.getFTensor1DiffN&lt;<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// START THE LOOP OVER INTEGRATION POINTS TO CALCULATE LOCAL MATRIX</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_integration_points; gg++) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_row_dofs; ++rr) {</div>
<div class="line">        <span class="comment">// get derivatives of base functions on column</span></div>
<div class="line">        <span class="keyword">auto</span> t_col_diff_base = col_data.getFTensor1DiffN&lt;<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;(gg, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc != nb_col_dofs; cc++) {</div>
<div class="line">          this-&gt;locMat(rr, cc) += t_row_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * t_col_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">          <span class="comment">// move to the derivatives of the next base functions on column</span></div>
<div class="line">          ++t_col_diff_base;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// move to the derivatives of the next base functions on row</span></div>
<div class="line">        ++t_row_diff_base;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to the weight of the next integration point</span></div>
<div class="line">      ++t_w;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line"> };</div>
<div class="ttc" id="aapprox__sphere_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition:</b> <a href="approx__sphere_8cpp_source.html#l00030">approx_sphere.cpp:30</a></div></div>
<div class="ttc" id="achild__and__parent_8cpp_html_a541ffc988889246e44b233b777828847"><div class="ttname"><a href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a></div><div class="ttdeci">constexpr int SPACE_DIM</div><div class="ttdef"><b>Definition:</b> <a href="child__and__parent_8cpp_source.html#l00016">child_and_parent.cpp:16</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a6c0b52978f1abc88bf8a1ba70b7308e3"><div class="ttname"><a href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a></div><div class="ttdeci">#define MoFEMFunctionBegin</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00346">definitions.h:346</a></div></div>
<div class="ttc" id="adefinitions_8h_html_acb0a46d159695a01bf667313b7788b45"><div class="ttname"><a href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a></div><div class="ttdeci">#define MoFEMFunctionReturn(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00416">definitions.h:416</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
</div><!-- fragment --><p >First, let's discuss the structure of this function</p>
<p >For specific tasks, the data structure is adapted based on the problem's dimension. Such as solving a 2D or 3D <a class="el" href="struct_poisson.html">Poisson</a> problem, the code can utilize different entities types e.g. edges, faces, volumes. For example, the entities or elements are provided accordingly using PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt; which is aliased as ElementsAndOps.The DomainEle::UserDataOperator is used to assemble using the forms integrator <a class="el" href="class_assembly_domain_ele_op.html">AssemblyDomainEleOp</a>. This can be seen in the code, particularly in the struct OpDomainLhsMatrixK. The function's parameters of iNtegrate are row_data and col_data are referencing to objects of type EntitiesFieldData::EntData. These parameters make ready the data related to degrees of freedom, basis function values, and field values for the rows and columns of the operation.</p>
<p >In <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, functions are written with check and error handling using keywords like MoFEMErrorCode, MoFEMFunctionBegin, and <a class="el" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45" title="Last executable line of each PETSc function used for error handling. Replaces return()">MoFEMFunctionReturn(0)</a>. These indicate the execution of functions and the success or failure of the operation. These arguments are used to handle errors like try() or catch() in basic c++ systematically.</p>
<p >Now, moving into the main implementation of <code>iNtegrate()</code> function, we will see information about the number of DOFs on row and column are extracted from the database </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nb_row_dofs = row_data.getIndices().size();</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nb_col_dofs = col_data.getIndices().size();</div>
</div><!-- fragment --><p >Once the program is confident that the data for row and column are all valid, it starts to initialise the local stiffness matrix whose components will be calculated and assembled to the global matrix. </p><div class="fragment"><div class="line">locMat.resize(nb_row_dofs, nb_col_dofs, <span class="keyword">false</span>);</div>
<div class="line">locMat.clear();</div>
</div><!-- fragment --><p >Then you will get the area for 2D or volume for 3D which is needed later when you integrate the function to calculate the stiffness matrix. </p><div class="fragment"><div class="line"><span class="comment">// get element area</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> area = getMeasure();</div>
</div><!-- fragment --><p> It is worth noting that <code>getMeasure()</code> is a generic function and the value you get depends on which entity type you are working with. For example, in this UDO, you are working with face entities (triangles), <code>getMeasure()</code> gives you face area. If you are dealing with edge (for boundary element) or volume entities (for volume domain), you would get edge length or element volume, respectively.</p>
<p >Next, as required for the calculation of stiffness matrix in Eq. (3), we need the number of integration points ( \( q \)) and their weights ( \( W_q \)) which can be done as follows </p><div class="fragment"><div class="line"><span class="comment">// get number of integration points</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nb_integration_points = getGaussPts().size2();</div>
<div class="line"><span class="comment">// get integration weights</span></div>
<div class="line"><span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
</div><!-- fragment --><p> Here <code>getFTensor0IntegrationWeight()</code> is a function of <a class="el" href="struct_mo_f_e_m_1_1_forces_and_sources_core_1_1_user_data_operator.html">MoFEM::ForcesAndSourcesCore::UserDataOperator</a> and it returns a zeroth-order <a class="el" href="namespace_f_tensor.html" title="Tensors class implemented by Walter Landry.">FTensor</a> object (<a href="http://mofem.eng.gla.ac.uk/mofem/html/group__ftensor.html">Tensor template library</a>) that stores value of integration weight. We prefer to use <a class="el" href="namespace_f_tensor.html" title="Tensors class implemented by Walter Landry.">FTensor</a> anywhere we can because it is compact and highly efficient. In <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> implementation, <a class="el" href="namespace_f_tensor.html" title="Tensors class implemented by Walter Landry.">FTensor</a> object is normally named with the prefix <code>t_</code>.</p>
<p >Once the number of Gauss points and their weights are determined, the remaining component to calculate stiffness matrix would include the gradients of the basis function evaluated at the integration (Gauss) point, \( \nabla \phi_i, \nabla
\phi_j \) ,for row and column, respectively, and the loop over all the Gauss points. They are done in the following part of the code </p><div class="fragment"><div class="line"><span class="comment">// get derivatives of base functions on row</span></div>
<div class="line"><span class="keyword">auto</span> t_row_diff_base = row_data.getFTensor1DiffN&lt;2&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// START THE LOOP OVER INTEGRATION POINTS TO CALCULATE LOCAL MATRIX</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_integration_points; gg++) {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_row_dofs; ++rr) {</div>
<div class="line">    <span class="comment">// get derivatives of base functions on column</span></div>
<div class="line">    <span class="keyword">auto</span> t_col_diff_base = col_data.getFTensor1DiffN&lt;2&gt;(gg, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc != nb_col_dofs; cc++) {</div>
<div class="line">      locMat(rr, cc) += t_row_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * t_col_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to the derivatives of the next base functions on column</span></div>
<div class="line">      ++t_col_diff_base;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// move to the derivatives of the next base functions on row</span></div>
<div class="line">    ++t_row_diff_base;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// move to the weight of the next integration point</span></div>
<div class="line">  ++t_w;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here you can see inside the loop over the integration points, we have two other nested loops that loop over the row ( \(i\)) and column ( \(j\)) DOFs of the matrix which is ultimately calculated similarly to the way they are presented in Eq. (11) </p><div class="fragment"><div class="line">locMat(rr, cc) += t_row_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * t_col_diff_base(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
</div><!-- fragment --><p> where <code>a</code> is the intermediate variable of type <code>double</code> and calculated earlier as </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
</div><!-- fragment --><p> where <code>area</code> can be considered as the determinant of the Jacobian of the transformation from the physical (global) coordinate system to the reference (local) coordinate system. See more about the integration and Jacobian at <a class="el" href="integration.html">FUN-1: Integration on finite element mesh</a>.</p>
<p >It should be noticed that at the end of each loop over the row and column DOFs, <code>t_row_diff_base</code> and <code>t_col_diff_base</code> which have the values of the gradients of the basis function are moved/shifted to the next chunk of the memory which stores values of another set of gradients of basis function associated with DOFs. The same technique is applied to move <code>t_w</code> to the weight of the next Gauss point in the memory.</p>
<p ><b>Note:</b> You might have also recognised that in the traditional finite element implementation, you will probably have, at the same place of the code, the structure of the main nested loop like this</p>
<ul>
<li>Loop over all elements<ul>
<li>Loop over all integration points<ul>
<li>Calculation of the local stiffness matrix components and fill them to the global matrix</li>
</ul>
</li>
</ul>
</li>
</ul>
<p >In <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>'s finite element implementation, there are some differences worth noting. While nested loops are still used, the implementation of the User Data Operator (UDO) involves a single loop over integration points. Within this loop, local stiffness matrix components are computed and then assembled into the global matrix. The loop over elements referred to as entities in the context of <a href="http://mofem.eng.gla.ac.uk/mofem/html/hierarchical_approximation_1.html">Hierarchical basis functions</a> Details of how this loop is triggered is presented in <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_solve">solveSystem()</a>.</p>
<p >That concludes the description of the code segment responsible for calculating the components of the element stiffness matrix.</p>
<p ><a class="anchor" id="figure_symmetric_matrix_assembling"></a></p><div class="image">
<img src="symmetric_matrix_assembling.png" alt="" width="350px"/>
<div class="caption">
Figure 1: Symmetric matrix assembling (for a general 3D case).</div></div>
<h3><a class="anchor" id="OpDomainRhsVectorF"></a>
OpDomainRhsVectorF</h3>
<p >In this part, we will talk about the implementation of the second UDO <a class="el" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html">Poisson2DHomogeneousOperators::OpDomainRhsVectorF</a> which is responsible for the calculation and assemble of the right-hand-side force vector \( {\bf F} \)</p>
<p >Similar to what implemented for the \( {\bf K} \) matrix we discussed above, the implementation of the UDO for the \( {\bf F} \) vector has very similar structure with slightly different functions </p><div class="fragment"><div class="line"><span class="keyword">struct </span>OpDomainRhsVectorF : <span class="keyword">public</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  OpDomainRhsVectorF(std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>)</div>
<div class="line">      : <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a>::OPROW) {}</div>
<div class="line"> </div>
<div class="line">  MoFEMErrorCode <a class="code hl_function" href="struct_mo_f_e_m_1_1_op_base_impl.html#a953383bec3b4f83e563ee6e0af2226c2">iNtegrate</a>(EntitiesFieldData::EntData &amp;data) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// .. ..Implementation of iNtegrate() below this point.. ..</span></div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="ttc" id="apoisson__2d__homogeneous_8cpp_html_a3917f3987bad1f4e24b85c9d0ab84a5e"><div class="ttname"><a href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a></div><div class="ttdeci">constexpr auto field_name</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00013">poisson_2d_homogeneous.cpp:13</a></div></div>
</div><!-- fragment --><p> We have the public objects of <code>OpDomainRhsVectorF()</code> and <code>iNtegrate()</code> and private object of <code>locF</code>. Here the name of the main function is changed to <code>OpDomainRhsVectorF</code> to reflect what it does. Additionally, as we are calculating and assembling vector instead of matrix, we need only one input of <code>field_name</code> and we tell <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> that we are doing the operation of row for the vector by specifying <code><a class="el" href="struct_mo_f_e_m_1_1_forces_and_sources_core_1_1_user_data_operator.html#ac99de5ec6fa9bad3ccc5c5d60bc48e40a2d8d202342fada158e521ef00be491e1" title="operator doWork function is executed on FE rows">DomainEleOp::OPROW</a></code>. Similarly for function <code>iNtegrate()</code>, it requires all three groups of the input but only one for each group instead of two as we had for the stiffness matrix.</p>
<p >The implementation of this essential function of <code>iNtegrate()</code> for force vector calculation and assembling also has very similar structure to its matrix UDO counterpart. The code for this function is as follows </p><div class="fragment"><div class="line">  MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dofs = data.getIndices().size();</div>
<div class="line"> </div>
<div class="line">    this-&gt;locF.resize(nb_dofs, <span class="keyword">false</span>);</div>
<div class="line">    this-&gt;locF.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get element area</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> area = getMeasure();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get number of integration points</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_integration_points = getGaussPts().size2();</div>
<div class="line">    <span class="comment">// get integration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get base function</span></div>
<div class="line">    <span class="keyword">auto</span> t_base = data.getFTensor0N();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// START THE LOOP OVER INTEGRATION POINTS TO CALCULATE LOCAL VECTOR</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_integration_points; gg++) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_dofs; rr++) {</div>
<div class="line">        this-&gt;locF[rr] += t_base * body_source * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// move to the next base function</span></div>
<div class="line">        ++t_base;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to the weight of the next integration point</span></div>
<div class="line">      ++t_w;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line">}; </div>
</div><!-- fragment --><p> A part from the input arguments of this function is slightly different from the UDO for stiffness matrix. In this UDO for force vector, we use the base function value to calculate the components of local vector reflecting what is presented in Eq. (4) and only need to loop over row DOFs as follows </p><div class="fragment"><div class="line"><span class="comment">// get base function</span></div>
<div class="line"><span class="keyword">auto</span> t_base = data.getFTensor0N();</div>
</div><!-- fragment --><p> and later using the constant body source (force) that is predefined at the beginning of the <code>*.hpp</code> to calculate the local vector </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_dofs; rr++) {</div>
<div class="line"> this-&gt;locF[rr] += t_base * body_source * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// move to the next base function</span></div>
<div class="line">  ++t_base;</div>
<div class="line">}</div>
</div><!-- fragment --><p >That is all for the implementation of UDOs that are responsible for the calculation and assembling of the LHS matrix \( {\bf K} \) and RHS vector \(
{\bf F} \). Having the essential components implemented, you now may ask how those UDOs are called in the main program. This is done through the process called <em>push operator</em> to the <b>Pipeline</b> and you will find out in more details later in this tutorial, <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_assemble">assembleSystem()</a>.</p>
<p >Next, we will look in detail how the main program, including class and functions, is implemented.</p>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_class"></a>
The Poisson2DHomogeneous class</h2>
<p >This main class <a class="el" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a> contains functions and each of which is responsible for a certain task of a finite element program. Intially, the field name has named as "U" string to recognsie it well. Next the EXECUTABLE_DIMENSION is the considered for the dimension of the mesh. To generalize, the value is assined to the Space dimension of problem. </p><div class="fragment"><div class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a> = <span class="stringliteral">&quot;U&quot;</span>;</div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> = <a class="code hl_define" href="plastic_8cpp.html#a49d2a41e935ccc68adc5a9268619cba1">EXECUTABLE_DIMENSION</a>; </div>
<div class="ttc" id="aplastic_8cpp_html_a49d2a41e935ccc68adc5a9268619cba1"><div class="ttname"><a href="plastic_8cpp.html#a49d2a41e935ccc68adc5a9268619cba1">EXECUTABLE_DIMENSION</a></div><div class="ttdeci">#define EXECUTABLE_DIMENSION</div><div class="ttdef"><b>Definition:</b> <a href="plastic_8cpp_source.html#l00013">plastic.cpp:13</a></div></div>
</div><!-- fragment --><p >The public part of the class includes a constructor and function <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_run_analysis">runProgram()</a> that calls other functions to perform finite element analysis. </p><div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a>(<a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field);</div>
<div class="line">  <span class="comment">// Declaration of the main function to run analysis</span></div>
<div class="line">  MoFEMErrorCode runProgram();</div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_deprecated_core_interface_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_core_interface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a></div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00027">poisson_2d_homogeneous.cpp:27</a></div></div>
</div><!-- fragment --><p> Then there are private functions doing certain tasks and can be recognised by their names </p><div class="fragment"><div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="comment">// Declaration of other main functions called in runProgram()</span></div>
<div class="line">  MoFEMErrorCode readMesh();</div>
<div class="line">  MoFEMErrorCode setupProblem();</div>
<div class="line">  MoFEMErrorCode boundaryCondition();</div>
<div class="line">  MoFEMErrorCode assembleSystem();</div>
<div class="line">  MoFEMErrorCode setIntegrationRules();</div>
<div class="line">  MoFEMErrorCode solveSystem();</div>
<div class="line">  MoFEMErrorCode outputResults();</div>
</div><!-- fragment --><p> It is followed by the declaration of member variables that will be used in one or some of the member functions declared above </p><div class="fragment"><div class="line"><span class="comment">// MoFEM interfaces</span></div>
<div class="line"><a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;mField;</div>
<div class="line">Simple *simpleInterface;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// approximation order</span></div>
<div class="line"><span class="keywordtype">int</span> oRder;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For writhing program in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, we follow some coding practices for code style and naming convention described at <a class="el" href="coding_practice.html">Coding practice</a></dd></dl>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_constructor"></a>
Poisson2DHomogeneous()</h3>
<p >Now is the constructor </p><div class="fragment"><div class="line"><a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a3ef0acad2725308b2ff793c1ef9e279f">Poisson2DHomogeneous::Poisson2DHomogeneous</a>(<a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field)</div>
<div class="line">    :  mField(m_field) {}</div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a3ef0acad2725308b2ff793c1ef9e279f"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a3ef0acad2725308b2ff793c1ef9e279f">Poisson2DHomogeneous::Poisson2DHomogeneous</a></div><div class="ttdeci">Poisson2DHomogeneous(MoFEM::Interface &amp;m_field)</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00052">poisson_2d_homogeneous.cpp:52</a></div></div>
</div><!-- fragment --><p> The constructor specifies</p><ul>
<li><code>mField(m_field)</code>: The <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> instance that is the backbone of the program</li>
</ul>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_readmesh"></a>
readMesh()</h3>
<p >Now the first function that actually does some finite element task is the function responsible for reading input mesh</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">Poisson2DHomogeneous::readMesh</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getOptions();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;loadFile();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00535">definitions.h:535</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_unknown_interface_html_a7ab248ec45fca778800dcd92e5171beb"><div class="ttname"><a href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">MoFEM::UnknownInterface::getInterface</a></div><div class="ttdeci">MoFEMErrorCode getInterface(IFACE *&amp;iface) const</div><div class="ttdoc">Get interface refernce to pointer of interface.</div><div class="ttdef"><b>Definition:</b> <a href="_unknown_interface_8hpp_source.html#l00093">UnknownInterface.hpp:93</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a12cbb4e4766a370eaa234cbf467a50fd"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">Poisson2DHomogeneous::simpleInterface</a></div><div class="ttdeci">Simple * simpleInterface</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00046">poisson_2d_homogeneous.cpp:46</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a9e028995b91cbf0c71da299281b086e5"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">Poisson2DHomogeneous::readMesh</a></div><div class="ttdeci">MoFEMErrorCode readMesh()</div><div class="ttdoc">[Read mesh]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00056">poisson_2d_homogeneous.cpp:56</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_ab8c81bd27da9dbacb94cb5fcb090c97a"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">Poisson2DHomogeneous::mField</a></div><div class="ttdeci">MoFEM::Interface &amp; mField</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00045">poisson_2d_homogeneous.cpp:45</a></div></div>
</div><!-- fragment --><p >Apart from the codes for error handling, the main three lines of code is a standard way to read an input mesh using Simple interface. Interface in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is a set of rules through which program developers use to setup a problem. Simple interface provides simplest but also less flexible way to setup a problem. More on the interfaces can be found at <a class="el" href="lessons_introduction.html#basic_lessons1_interfaces">MoFEM interfaces</a>. Implementation of more advanced interfaces will be presented in later tutorials.</p>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_setupproblem"></a>
setupProblem()</h3>
<p >Next is the function that is responsible for setting up the finite element problem</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">Poisson2DHomogeneous::setupProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;addDomainField(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>,</div>
<div class="line">                                         <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a> = 3;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsGetInt(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-order&quot;</span>, &amp;<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a>, PETSC_NULL);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;setFieldOrder(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;setUp();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a></div><div class="ttdeci">@ AINSWORTH_LEGENDRE_BASE</div><div class="ttdoc">Ainsworth Cole (Legendre) approx. base .</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00061">definitions.h:60</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120"><div class="ttname"><a href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a></div><div class="ttdeci">@ H1</div><div class="ttdoc">continuous field</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00085">definitions.h:85</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a2a5d13478dd5efb6f0c8666390c7793c"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">Poisson2DHomogeneous::setupProblem</a></div><div class="ttdeci">MoFEMErrorCode setupProblem()</div><div class="ttdoc">[Read mesh]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00068">poisson_2d_homogeneous.cpp:68</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a576c2c8e6994b019a561d85bb0012372"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">Poisson2DHomogeneous::oRder</a></div><div class="ttdeci">int oRder</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00049">poisson_2d_homogeneous.cpp:49</a></div></div>
</div><!-- fragment --><p >This function has</p><ul>
<li><code>simpleInterface-&gt;addDomainField</code>: It is important to understand that we need to add the domain field through the <code>simpleInterface</code> only as the field at the boundary is zero (homogeneous) for this particular example hence no need to add the boundary field. The addition of the domain field requires the followings<ul>
<li>Field name ("U"),</li>
<li>Approximation space (<code>H1</code> - scalar space) - function space can also be <code><a class="el" href="plastic_8cpp.html#a982cf43f120ff8978010e078bd49d9a3" title="Hardening.">H(curl)</a></code>, <code><a class="el" href="plastic_8cpp.html#a982cf43f120ff8978010e078bd49d9a3" title="Hardening.">H(div)</a></code>, <code>L2</code> depending on physical properties of the field you are approximating, see more at <a href="http://mofem.eng.gla.ac.uk/mofem/html/definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12">FieldSpace</a></li>
<li>Approximation bases (<code>AINSWORTH_BERNSTEIN_BEZIER_BASE</code>) - base can also be <code>AINSWORTH_LEGENDRE_BASE</code>, <code>AINSWORTH_LOBATTO_BASE</code>, <code>DEMKOWICZ_JACOBI_BASE </code>, see more at <a href="http://mofem.eng.gla.ac.uk/mofem/html/definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5">FieldApproximationBase</a>, and</li>
<li>Number of DOFs per shape function (<code>1</code>) as the current problem is a scalar-field problem. This will be <code>3</code> for vector-field problem.</li>
</ul>
</li>
<li><code>simpleInterface-&gt;setFieldOrder</code>: Set the polynomial order of the approximation of the field</li>
<li><code>simpleInterface-&gt;setUp()</code>: Finally, do the setup of the problem.</li>
</ul>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_bc"></a>
boundaryCondition()</h3>
<p >This function deals the boundary condition and its implementation for the current problem is as follows</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">Poisson2DHomogeneous::boundaryCondition</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;BcManager&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Remove BCs from blockset name &quot;BOUNDARY_CONDITION&quot; or SETU, note that you</span></div>
<div class="line">  <span class="comment">// can use regular expression to put list of blocksets;</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities&lt;BcScalarMeshsetType&lt;BLOCKSET&gt;&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getProblemName(), <span class="stringliteral">&quot;(BOUNDARY_CONDITION|SETU)&quot;</span>,</div>
<div class="line">      std::string(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>), <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a2b629b1579dfd6da6e6ffc9e8dcae6b5"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">Poisson2DHomogeneous::boundaryCondition</a></div><div class="ttdeci">MoFEMErrorCode boundaryCondition()</div><div class="ttdoc">[Setup problem]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00085">poisson_2d_homogeneous.cpp:85</a></div></div>
</div><!-- fragment --><p >To ensure the code reads the boundary conditions, it's essential to generate the mesh that includes the required attributes or values. Specifically, blocks in the mesh must be labelled with the name "BOUNDARY_CONDITION". In other cases where multiple boundary conditions are involved, you should assign distinct names using numbers, such as "BOUNDARY_CONDITION_1", "BOUNDARY_CONDITION_2", "BOUNDARY_CONDITION_3", and so on. This naming scheme helps in distinguishing and applying different boundary conditions to their respective blocks within the mesh.</p>
<p >Though the application procedure is pretty straightforward but the underlying process of applying these boundary conditions is not immediately obvious. Users can jump to the next section without understanding the underlying process of it.</p>
<p >If we consider \( {\bf u} \) as the solution vector such that \( {u} = [u_1, u_2, u_3, u_4, \ldots, u_n] \), we will essentially eliminate the DoFs associated with entities that are part of the "BOUNDARY_CONDITION" blocksets. In this context, let's say the \( \bf{u_0} \) represents the vector after removing the DOF from BC. For example, \( {u_0} = [u_1, u_2, u_3,.. .. u_\text{n-m}, 0 ,0\ldots, 0] \). However, we need to reintroduce these removed DoFs later on to make the solution admissible for the boundary values as well. To accomplish this, we will incorporate an additional vector \( {\bf u^e} \) with the current \( {\bf u_0} \), as in (14).  </p><p class="formulaDsp">
\[
  \begin{equation}
    \bf {Ku}= f 
  \end{equation}
\]
</p>
  <p class="formulaDsp">
\[
  \begin{equation}
    \bf {K(u_0 + u_e)}= f
  \end{equation}
\]
</p>
<p> Here, \( u_e \) is the vector where we will impose those removed degrees of freedom in it. For example,  </p><p class="formulaDsp">
\[
\begin{equation}
{\mathbf { u}_e} = \left[ 
 \begin{array}{cccc}
{0} &amp;
{0} &amp;
{0} &amp;
\ldots &amp;
{u_\text{n-m+1} } &amp;
{u_\text{n} } &amp;
\end{array} \right]
\label{eq:u_e}
\end{equation}
\]
</p>
<p> Here, \( u_\text{n-m+1} \) and \(u_\text{n} \) denotes DOFs the of BOUNDARY_CONDITION Blockset.</p>
<p >This approach will allow us to streamline the procedure and ensure that the removed degrees of freedom are properly reintegrated into the calculations. However, to simplify this cumulative process, we will address rest of the part during the assembling phase in the upcoming sub-section.</p>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_assemble"></a>
assembleSystem()</h3>
<p >This part is about the function that is responsible for the assembling of the system of equations. In between, we will also go through the code for setting the DOFs to the BC.</p>
<p >At the beginning of the section <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_assemble">assembleSystem()</a>, recall the <em>two important concepts</em> in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, namely <b>UDO</b> and <b>Pipeline</b>. While how the implementation of UDOs has been shown in <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_udo">User Data Operators</a>, here you will see how the implemented UDOs are <em>pushed</em> to the <b>Pipeline</b>.</p>
<p >Apart from pushing UDOs to the main program, <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_assemble">assembleSystem()</a> ()function is mainly responsible for setting operators implementing to the pipelines for KSP solver (iterative linear solver provided by PETSc). The full source code for the function is as follows:</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">Poisson2DHomogeneous::assembleSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line"> </div>
<div class="line">  { <span class="comment">// Push operators to the Pipeline that is responsible for calculating LHS</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainLhsPipeline(), {H1});</div>
<div class="line">    pipeline_mng-&gt;getOpDomainLhsPipeline().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpDomainLhsMatrixK(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  { <span class="comment">// Push operators to the Pipeline that is responsible for calculating RHS</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> set_values_to_bc_dofs = [&amp;](<span class="keyword">auto</span> &amp;fe) {</div>
<div class="line">      <span class="keyword">auto</span> get_bc_hook = [&amp;]() {</div>
<div class="line">        EssentialPreProc&lt;TemperatureCubitBcData&gt; hook(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>, fe, {});</div>
<div class="line">        <span class="keywordflow">return</span> hook;</div>
<div class="line">      };</div>
<div class="line">      fe-&gt;preProcessHook = get_bc_hook();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// you can skip that if boundary condition is prescribing zero</span></div>
<div class="line">    <span class="keyword">auto</span> calculate_residual_from_set_values_on_bc = [&amp;](<span class="keyword">auto</span> &amp;pipeline) {</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> =</div>
<div class="line">          PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;::DomainEle;</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = DomainEle::UserDataOperator;</div>
<div class="line">      <span class="keyword">using </span>OpInternal = FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;</div>
<div class="line">          <a class="code hl_enumvalue" href="group__mofem__forms.html#ggabb82cd10e89a1d4d25fa7756360b181ba2243b0abb08ad80d05c47e734f3134bc">PETSC</a>&gt;<a class="code hl_class" href="class_linear_form.html">::LinearForm&lt;GAUSS&gt;::OpGradTimesTensor</a>&lt;1, 1, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> grad_u_vals_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> OpCalculateScalarFieldGradient&lt;SPACE_DIM&gt;(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>,</div>
<div class="line">                                                        grad_u_vals_ptr));</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> OpInternal(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, grad_u_vals_ptr,</div>
<div class="line">                         [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline(), {H1});</div>
<div class="line">    set_values_to_bc_dofs(pipeline_mng-&gt;getDomainRhsFE());</div>
<div class="line">    calculate_residual_from_set_values_on_bc(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline());</div>
<div class="line">    pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpDomainRhsVectorF(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclass_linear_form_html"><div class="ttname"><a href="class_linear_form.html">LinearForm</a></div></div>
<div class="ttc" id="agroup__mofem__forms_html_ggabb82cd10e89a1d4d25fa7756360b181ba2243b0abb08ad80d05c47e734f3134bc"><div class="ttname"><a href="group__mofem__forms.html#ggabb82cd10e89a1d4d25fa7756360b181ba2243b0abb08ad80d05c47e734f3134bc">MoFEM::PETSC</a></div><div class="ttdeci">@ PETSC</div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00104">FormsIntegrators.hpp:104</a></div></div>
<div class="ttc" id="apoisson__2d__homogeneous_8cpp_html_a541ffc988889246e44b233b777828847"><div class="ttname"><a href="poisson__2d__homogeneous_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a></div><div class="ttdeci">constexpr int SPACE_DIM</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00015">poisson_2d_homogeneous.cpp:15</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_ad63f6e734d07ef8564d80b216cd24ad7"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">Poisson2DHomogeneous::assembleSystem</a></div><div class="ttdeci">MoFEMErrorCode assembleSystem()</div><div class="ttdoc">[Boundary condition]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00101">poisson_2d_homogeneous.cpp:101</a></div></div>
</div><!-- fragment --><ul>
<li>First, the pipeline manager (<code>pipeline_mng</code>) that manages two main pipelines which are:<ul>
<li><code>getOpDomainLhsPipeline</code>: responsible for calculations of the left hand side matrix</li>
<li><code>getOpDomainRhsPipeline</code>: responsible for calculations of the right hand side vector <div class="fragment"><div class="line"><span class="keyword">auto</span> pipeline_mng = mField.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Second, pushing the operators to the Pipeline that is responsible for the calculation of the LHS matrix. This should be done in two steps. Initially, the operators to calculate the <em>inverse of the Jacobian</em> of the mapping from reference (parent) space to the physical space is pushed first and then the implemented UDO for stiffness matrix <code>OpDomainLhsMatrixK</code> is pushed to the LhsPipeline. <div class="fragment"><div class="line">{ <span class="comment">// Push operators to the Pipeline that is responsible for calculating LHS</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">      pipeline_mng-&gt;getOpDomainLhsPipeline(), {H1});</div>
<div class="line">  pipeline_mng-&gt;getOpDomainLhsPipeline().push_back(</div>
<div class="line">      <span class="keyword">new</span> OpDomainLhsMatrixK(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">}</div>
</div><!-- fragment --> It is to be noted that the procedure to calculate the inverse of Jacobian with the presence of the gradient of approximation function is needed but it is done automatically and user does not have to manually add codes to push any operators calculating the inverse of Jacobian.</li>
<li>Third, previously in in <code>boundaryCondition()</code>, we modified \( \bf{u} \) and we were waiting to impose the removed DoFs to get the admissible solution. Here, this operation is done by the lamda function 'set_values_to_bc_dofs'.</li>
</ul>
<p >We enforce the following code snippet to set dofs. First we get the reference \( \bf{u}\) for BC. Then using 'get_bc_hook' as preprocessing of object 'fe' we set the boundary condition values to \( \bf{u_e} \). </p><div class="fragment"><div class="line"><span class="keyword">auto</span> set_values_to_bc_dofs = [&amp;](<span class="keyword">auto</span> &amp;fe) {</div>
<div class="line">   <span class="keyword">auto</span> get_bc_hook = [&amp;]() {</div>
<div class="line">     EssentialPreProc&lt;TemperatureCubitBcData&gt; hook(mField, fe, {});</div>
<div class="line">     <span class="keywordflow">return</span> hook;</div>
<div class="line">   };</div>
<div class="line">   fe-&gt;preProcessHook = get_bc_hook();</div>
<div class="line"> };</div>
</div><!-- fragment --><blockquote class="doxtable">
<p >Note:For the current homogenous problem, if we consider zero boundary condition, that endsup with all the values of \( \bf {u_e} \) as zero. So then the remainings from the equation (15) is \( \bf {K u_0} = \bf {f}\). However, in case of non-zero BCs we have to consider \(\bf {K  u_e}\) in the next part. </p>
</blockquote>
<p >So the rest of the code should be organised as follows: </p><div class="fragment"><div class="line"><span class="comment">// you can skip that if boundary condition is prescribing zero</span></div>
<div class="line">    <span class="keyword">auto</span> calculate_residual_from_set_values_on_bc = [&amp;](<span class="keyword">auto</span> &amp;pipeline) {</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> =</div>
<div class="line">          PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;::DomainEle;</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = DomainEle::UserDataOperator;</div>
<div class="line">      <span class="keyword">using </span>OpInternal = FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;</div>
<div class="line">          PETSC&gt;<a class="code hl_class" href="class_linear_form.html">::LinearForm&lt;GAUSS&gt;::OpGradTimesTensor</a>&lt;1, 1, <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> grad_u_vals_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> OpCalculateScalarFieldGradient&lt;SPACE_DIM&gt;(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>,</div>
<div class="line">                                                        grad_u_vals_ptr));</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> OpInternal(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, grad_u_vals_ptr,</div>
<div class="line">                         [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline(), {H1});</div>
<div class="line">    set_values_to_bc_dofs(pipeline_mng-&gt;getDomainRhsFE());</div>
<div class="line">    calculate_residual_from_set_values_on_bc(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline());</div>
<div class="line">    pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpDomainRhsVectorF(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here, the lamda function <code>calculate_residual_from_set_values_on_bc</code> is to get the \(\bf {K{u_e}}\). Inside of it, the <code>OpInternal</code> integrator serves a dual purpose: it undertakes system of equations and assembles the matrices, effectively performing a linear multiplication. Upon pushing OpInternal to the pipeline manager, -1 is passed as it is alongside \( \bf K {u_e} \) as in equation (17).</p>
<p class="formulaDsp">
\[
  \begin{equation}
    \bf {K  u_0} = f - \bf {K u_e}
  \end{equation}
\]
</p>
<p >We do not need derivative of the approximation function to calculate force vector in UDO <code>OpDomainRhsVectorF</code>. Consequently, the operators for recalculating inverse of Jacobian is not needed as well as it is integrated with <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>.</p>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_intergration"></a>
setIntegrationRules()</h3>
<p >This function is responsible for setting the Gauss integration rules and it looks like this</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">Poisson2DHomogeneous::setIntegrationRules</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> rule_lhs = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>) -&gt; <span class="keywordtype">int</span> { <span class="keywordflow">return</span> 2 * (<a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a> - 1); };</div>
<div class="line">  <span class="keyword">auto</span> rule_rhs = [](int, int, <span class="keywordtype">int</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>) -&gt; <span class="keywordtype">int</span> { <span class="keywordflow">return</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>; };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;setDomainLhsIntegrationRule(rule_lhs);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;setDomainRhsIntegrationRule(rule_rhs);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="a_basic_fe_tools_8hpp_html_a9af7d9ad959b4605c5f0bab2f104c2fb"><div class="ttname"><a href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a></div><div class="ttdeci">static Index&lt; 'p', 3 &gt; p</div><div class="ttdef"><b>Definition:</b> <a href="_basic_fe_tools_8hpp_source.html#l00090">BasicFeTools.hpp:90</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_ae5471202284170647f7841ccc91acfa4"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">Poisson2DHomogeneous::setIntegrationRules</a></div><div class="ttdeci">MoFEMErrorCode setIntegrationRules()</div><div class="ttdoc">[Assemble system]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00154">poisson_2d_homogeneous.cpp:154</a></div></div>
</div><!-- fragment --><p >Here \( p \) is the polynomial order of the approximation function. For the LHS matrix, we are calculating the integral of function \(\nabla \phi_i
\cdot \nabla \phi_j\) so the polynomial order of the integral is \( p - 1 \) plus \( p - 1 \) resulting \( 2 * (p - 1)\) as we see in the implementation of the integration rules for the LHS. Similarly, as we calculate the integral of \( \phi_i\) for the RHS, we use \( p \) as the integration rule of the RHS. Having the integration rules, <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> will automatically determine the number of integration (Gauss) points that need to be used for each entity (element). Here you can see <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> allows you to choose different integration rules for different operators.</p>
<h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_solve"></a>
solveSystem()</h3>
<p >Having the computation of LHS and RHS is defined in the previous function. We now can actually solve the system of equations using iterative KSP solver from <a href="https://www.mcs.anl.gov/petsc/">PETSc</a>.</p>
<p >The codes for the function that is responsible for solving the systems of equations look like this</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">Poisson2DHomogeneous::solveSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> ksp_solver = pipeline_mng-&gt;createKSP();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(ksp_solver);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(ksp_solver);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create RHS and solution vectors</span></div>
<div class="line">  <span class="keyword">auto</span> dm = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getDM();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a> = createDMVector(dm);</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> = vectorDuplicate(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Solve the system</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(ksp_solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scatter result data on the mesh</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMMeshToLocalVector(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="afree__surface_8cpp_html_a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d"><div class="ttname"><a href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a></div><div class="ttdeci">@ F</div><div class="ttdef"><b>Definition:</b> <a href="free__surface_8cpp_source.html#l00394">free_surface.cpp:394</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_ad8657a5ec76e12f3066fb4b4eb75ace9"><div class="ttname"><a href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a></div><div class="ttdeci">double D</div><div class="ttdef"><b>Definition:</b> <a href="initial__diffusion_8cpp_source.html#l00044">initial_diffusion.cpp:44</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_adb6e7c2cf0adddd9f3a004c62035478c"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">Poisson2DHomogeneous::solveSystem</a></div><div class="ttdeci">MoFEMErrorCode solveSystem()</div><div class="ttdoc">[Set integration rules]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00169">poisson_2d_homogeneous.cpp:169</a></div></div>
</div><!-- fragment --><p >It starts first with getting the pipeline manager </p><div class="fragment"><div class="line"><span class="keyword">auto</span> pipeline_mng = mField.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
</div><!-- fragment --><p >Then create the KSP solver using wrapped function in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> (<code>pipeline_mng-&gt;createKSP()</code>) and setup the solver using PETSc functions </p><div class="fragment"><div class="line"><span class="keyword">auto</span> ksp_solver = pipeline_mng-&gt;createKSP();</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(ksp_solver);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(ksp_solver);</div>
</div><!-- fragment --><p >Next is getting the Discrete Manager (<code>dm</code>) which is a common object allowing things implemented in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> talk to things implemented in PETSc before initilising the RHS and solution vectors </p><div class="fragment"><div class="line"><span class="comment">// Create RHS and solution vectors</span></div>
<div class="line"><span class="keyword">auto</span> dm = simpleInterface-&gt;getDM();</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a> = createDMVector(dm);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> = vectorDuplicate(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
</div><!-- fragment --><p >At this particular point, Discrete Manager allows the two pipelines (responsible for LHS and RHS) implemented in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> to be used as the input for KSP solver implemented in PETSc. From that, the solution vector \( {\bf U} \) of the system of equations \({\bf KU=F} \) will be obtained when the KSP solver is triggered by this </p><div class="fragment"><div class="line"><span class="comment">// Solve the system</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(ksp_solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
</div><!-- fragment --><p> It is important to note that all the implementation of the UDOs presented in the previous sections was just the definition. All the calculations (all the loops to calculate matrix and vector entries implemented in UDOs) are only triggered when the line of code above calling <code>KSPSolve()</code> function is executed.</p>
<p >Lastly, the results are scattered through DM and ready to be fed to the output mesh in the next step </p><div class="fragment"><div class="line"><span class="comment">// Scatter result data on the mesh</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMMeshToLocalVector(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
</div><!-- fragment --><h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_output"></a>
outputResults()</h3>
<p >This function is solely responsible for the postprocessing of the results writing the calculated field values to the output mesh.</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">Poisson2DHomogeneous::outputResults</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;PipelineManager&gt;();</div>
<div class="line">  pipeline_mng-&gt;getDomainLhsFE().reset();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> post_proc_fe = boost::make_shared&lt;PostProcFaceEle&gt;(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add(</div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector(), {H1});</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> u_ptr = boost::make_shared&lt;VectorDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> grad_u_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">      <span class="keyword">new</span> OpCalculateScalarFieldValues(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, u_ptr));</div>
<div class="line"> </div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">      <span class="keyword">new</span> OpCalculateScalarFieldGradient&lt;SPACE_DIM&gt;(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, grad_u_ptr));</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPPMap</a> = OpPostProcMapInMoab&lt;SPACE_DIM, SPACE_DIM&gt;;</div>
<div class="line"> </div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_typedef" href="photon__diffusion_8cpp.html#ada3f24ae35ae50faea3df2b474ea2f37">OpPPMap</a>(post_proc_fe-&gt;getPostProcMesh(),</div>
<div class="line">                  post_proc_fe-&gt;getMapGaussPts(),</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8971cfcdc550b35bb120e28e72d8c9d5">OpPPMap::DataMapVec</a>{{<span class="stringliteral">&quot;U&quot;</span>, u_ptr}},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{{<span class="stringliteral">&quot;GRAD_U&quot;</span>, grad_u_ptr}},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{}</div>
<div class="line"> </div>
<div class="line">                  )</div>
<div class="line"> </div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  pipeline_mng-&gt;getDomainRhsFE() = post_proc_fe;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;loopFiniteElements();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc_fe-&gt;writeFile(<span class="stringliteral">&quot;out_result.h5m&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="aphoton__diffusion_8cpp_html_ada3f24ae35ae50faea3df2b474ea2f37"><div class="ttname"><a href="photon__diffusion_8cpp.html#ada3f24ae35ae50faea3df2b474ea2f37">OpPPMap</a></div><div class="ttdeci">OpPostProcMapInMoab&lt; SPACE_DIM, SPACE_DIM &gt; OpPPMap</div><div class="ttdef"><b>Definition:</b> <a href="photon__diffusion_8cpp_source.html#l00029">photon_diffusion.cpp:29</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_post_proc_map_in_moab_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">MoFEM::OpPostProcMapInMoab</a></div><div class="ttdoc">Post post-proc data at points from hash maps.</div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00700">PostProcBrokenMeshInMoabBase.hpp:700</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_post_proc_map_in_moab_html_a8971cfcdc550b35bb120e28e72d8c9d5"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8971cfcdc550b35bb120e28e72d8c9d5">MoFEM::OpPostProcMapInMoab::DataMapVec</a></div><div class="ttdeci">std::map&lt; std::string, boost::shared_ptr&lt; VectorDouble &gt; &gt; DataMapVec</div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00702">PostProcBrokenMeshInMoabBase.hpp:702</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_post_proc_map_in_moab_html_a8ace8e81530956d34472cb6e242a36cc"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">MoFEM::OpPostProcMapInMoab::DataMapMat</a></div><div class="ttdeci">std::map&lt; std::string, boost::shared_ptr&lt; MatrixDouble &gt; &gt; DataMapMat</div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00703">PostProcBrokenMeshInMoabBase.hpp:703</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_ad29ba4939bf780119e509b0f0a9cfb33"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">Poisson2DHomogeneous::outputResults</a></div><div class="ttdeci">MoFEMErrorCode outputResults()</div><div class="ttdoc">[Solve system]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00196">poisson_2d_homogeneous.cpp:196</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="basic_tutorials_poisson_homogeneous_run_analysis"></a>
runProgram()</h3>
<p >Finally, having all the necessary tasks implemented in the corresponding functions, we can now put them together in the last function of the main class. This function is responsible for the calling sequence which is similar to most of other finite element programs</p>
<div class="fragment"><div class="line">MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a7e63fa18b0338d5088137d665cefb1bc">Poisson2DHomogeneous::runProgram</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">readMesh</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">setupProblem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">boundaryCondition</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">setIntegrationRules</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">assembleSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">solveSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">outputResults</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_html_a7e63fa18b0338d5088137d665cefb1bc"><div class="ttname"><a href="struct_poisson2_d_homogeneous.html#a7e63fa18b0338d5088137d665cefb1bc">Poisson2DHomogeneous::runProgram</a></div><div class="ttdeci">MoFEMErrorCode runProgram()</div><div class="ttdoc">[Output results]</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00242">poisson_2d_homogeneous.cpp:242</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_main_function"></a>
The main() function</h2>
<p >This <code><a class="el" href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> function does not do much job apart from creating the top-level class and call the function to trigger the analysis</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialisation of MoFEM/PETSc and MOAB data structures</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="_default_params_8hpp.html#a3538d3053f6520cc492dbbc38480d626">param_file</a>[] = <span class="stringliteral">&quot;param_file.petsc&quot;</span>;</div>
<div class="line">  <a class="code hl_function" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::Core::Initialize</a>(&amp;argc, &amp;argv, <a class="code hl_variable" href="_default_params_8hpp.html#a3538d3053f6520cc492dbbc38480d626">param_file</a>, <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Error handling</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Register MoFEM discrete manager in PETSc</span></div>
<div class="line">    DMType dm_name = <span class="stringliteral">&quot;DMMOFEM&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMRegister_MoFEM(dm_name);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create MOAB instance</span></div>
<div class="line">    moab::Core mb_instance;              <span class="comment">// mesh database</span></div>
<div class="line">    moab::Interface &amp;moab = mb_instance; <span class="comment">// mesh database interface</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create MoFEM instance</span></div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html">MoFEM::Core</a> core(moab);           <span class="comment">// finite element database</span></div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field = core; <span class="comment">// finite element interface</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the main analysis</span></div>
<div class="line">    <a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a> poisson_problem(m_field);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> poisson_problem.runProgram();</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a1e74d797bf522e2b291419cddab27835">CATCH_ERRORS</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Finish work: cleaning memory, getting statistics, etc.</span></div>
<div class="line">  <a class="code hl_function" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#aa5abe3b5d998e2dc50e4ef6916915eb1">MoFEM::Core::Finalize</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="a_default_params_8hpp_html_a3538d3053f6520cc492dbbc38480d626"><div class="ttname"><a href="_default_params_8hpp.html#a3538d3053f6520cc492dbbc38480d626">param_file</a></div><div class="ttdeci">std::string param_file</div><div class="ttdef"><b>Definition:</b> <a href="_default_params_8hpp_source.html#l00113">DefaultParams.hpp:113</a></div></div>
<div class="ttc" id="aactivate__deactivate__dofs_8cpp_html_a29680e68c64040f4884f60691a193226"><div class="ttname"><a href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a></div><div class="ttdeci">static char help[]</div><div class="ttdef"><b>Definition:</b> <a href="activate__deactivate__dofs_8cpp_source.html#l00013">activate_deactivate_dofs.cpp:13</a></div></div>
<div class="ttc" id="aadol-c__atom_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="adol-c__atom_8cpp_source.html#l00046">adol-c_atom.cpp:46</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a1e74d797bf522e2b291419cddab27835"><div class="ttname"><a href="definitions_8h.html#a1e74d797bf522e2b291419cddab27835">CATCH_ERRORS</a></div><div class="ttdeci">#define CATCH_ERRORS</div><div class="ttdoc">Catch errors.</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00372">definitions.h:372</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_tmp_3_010_01_4_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html">MoFEM::CoreTmp&lt; 0 &gt;</a></div><div class="ttdoc">Core (interface) class.</div><div class="ttdef"><b>Definition:</b> <a href="_core_8hpp_source.html#l00082">Core.hpp:82</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_tmp_3_010_01_4_html_a137f1f2092d00ef0c1ec679db94b8cb0"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::CoreTmp&lt; 0 &gt;::Initialize</a></div><div class="ttdeci">static MoFEMErrorCode Initialize(int *argc, char ***args, const char file[], const char help[])</div><div class="ttdoc">Initializes the MoFEM database PETSc, MOAB and MPI.</div><div class="ttdef"><b>Definition:</b> <a href="_core_8cpp_source.html#l00072">Core.cpp:72</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_tmp_3_010_01_4_html_aa5abe3b5d998e2dc50e4ef6916915eb1"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#aa5abe3b5d998e2dc50e4ef6916915eb1">MoFEM::CoreTmp&lt; 0 &gt;::Finalize</a></div><div class="ttdeci">static MoFEMErrorCode Finalize()</div><div class="ttdoc">Checks for options to be called at the conclusion of the program.</div><div class="ttdef"><b>Definition:</b> <a href="_core_8cpp_source.html#l00112">Core.cpp:112</a></div></div>
</div><!-- fragment --><p >So you can see, at the beginning, it creates the Discrete Managers that enable information flows between <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> (finite element implementation), MOAB (element topology management), and PETSc (algebraic solvers). After that, it creates variable <code>poisson_problem</code> of type/class <code><a class="el" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a></code> which is previously defined and then run the analysis by triggering the public function runProgram(). </p><div class="fragment"><div class="line"><span class="comment">// Run the main analysis</span></div>
<div class="line"><a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a> poisson_problem(m_field);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> poisson_problem.runProgram();</div>
</div><!-- fragment --><h1><a class="anchor" id="basic_tutorials_poisson_homogeneous_result"></a>
Results</h1>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_run_program"></a>
Run the program</h2>
<p >In order to run the program that we have been discussing in this tutorial, you will do the following steps</p><ul>
<li>First, go to the directory where the binary file <code>poisson_2d_homogeneous</code> is located. Depending on how you install <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> shown in this page <a class="el" href="installation.html">Installation</a>, going to the directory would be something similar to this<ul>
<li>For user version installation <div class="fragment"><div class="line">cd mofem_install/um_view/tutorials/scl-1/</div>
</div><!-- fragment --></li>
<li>For developer version installation <div class="fragment"><div class="line">cd mofem_install/mofem-cephas/mofem/users_modules/um-build-RelWithDebInfo-abcd1234/tutorials/scl-1</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Second, check the parameters in the param_file.petsc. These are PETSc parameters and you should only use parameters that are needed for a particular solver, in this case KSP solver. Only the following parameters should be uncommented <div class="fragment"><div class="line"><span class="preprocessor">## Linear solver</span></div>
<div class="line">-ksp_type fgmres </div>
<div class="line">-pc_type lu </div>
<div class="line">-pc_factor_mat_solver_type mumps</div>
<div class="line">-ksp_monitor</div>
</div><!-- fragment --></li>
<li>Third, in the terminal, run commands to partition the input mesh and start the analysis <div class="fragment"><div class="line">mofem_part -my_file square.h5m -output_file square_2parts.h5m -my_nparts 2 -<a class="code hl_variable" href="elec__phys__2_d_8cpp.html#afe4f94e033c0d1c57d407b4338a64b33">dim</a> 2 -adj_dim 1</div>
<div class="line">mpirun -np 2 ./poisson_2d_homogeneous -file_name square_2parts.h5m -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 4</div>
<div class="ttc" id="adg__projection_8cpp_html_ad7eceded84ace5678d9df3e44f47d475"><div class="ttname"><a href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a></div><div class="ttdeci">constexpr int order</div><div class="ttdef"><b>Definition:</b> <a href="dg__projection_8cpp_source.html#l00018">dg_projection.cpp:18</a></div></div>
<div class="ttc" id="aelec__phys__2_d_8cpp_html_afe4f94e033c0d1c57d407b4338a64b33"><div class="ttname"><a href="elec__phys__2_d_8cpp.html#afe4f94e033c0d1c57d407b4338a64b33">dim</a></div><div class="ttdeci">const int dim</div><div class="ttdef"><b>Definition:</b> <a href="elec__phys__2_d_8cpp_source.html#l00012">elec_phys_2D.cpp:12</a></div></div>
</div><!-- fragment --> where the mesh of a square plate is partitioned into two parts and then the program is run using two processors (the same number of partitions) with fourth order polynomial of approximation.</li>
</ul>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_op"></a>
Output</h2>
<p >Once the analaysis is complete, you see all output messages printed to the terminal</p><ul>
<li>Version of <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> used to run the analysis <div class="fragment"><div class="line"><a class="code hl_namespace" href="namespace_mo_f_e_m.html">MoFEM</a> version 0.11.0 (MOAB 5.2.1 Petsc Release Version 3.11.4, Sep, 28, 2019 )</div>
<div class="line">git commit <span class="keywordtype">id</span> 0ac8895b15c4ad41ea5e7077c4d011f7efb50f13</div>
<div class="ttc" id="anamespace_mo_f_e_m_html"><div class="ttname"><a href="namespace_mo_f_e_m.html">MoFEM</a></div><div class="ttdoc">implementation of Data Operators for Forces and Sources</div><div class="ttdef"><b>Definition:</b> <a href="_common_8hpp_source.html#l00010">Common.hpp:10</a></div></div>
</div><!-- fragment --></li>
<li>Meshset and entity blocks defined in the input mesh <div class="fragment"><div class="line">read cubit meshset 12682136550675316738 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45">UNKNOWNNAME</a> msId 1 name square</div>
<div class="line">read cubit meshset 12682136550675316739 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45">UNKNOWNNAME</a> msId 2 name boundary                       </div>
<div class="line">read cubit meshset 12682136550675316740 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45">UNKNOWNNAME</a> msId 3 name <a class="code hl_namespace" href="namespacesurface.html">surface</a>                        </div>
<div class="line">read cubit meshset 12682136550675316741 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e">MAT_ELASTICSET</a> msId 100 name MAT_ELASTIC</div>
<div class="line">read cubit meshset 12682136550675316742 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45">UNKNOWNNAME</a> msId 110 name BOUNDARY_CONDITION</div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e">MAT_ELASTICSET</a></div><div class="ttdeci">@ MAT_ELASTICSET</div><div class="ttdoc">block name is &quot;MAT_ELASTIC&quot;</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00159">definitions.h:159</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca89bb943f8f004923f508f5223b144e45">UNKNOWNNAME</a></div><div class="ttdeci">@ UNKNOWNNAME</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00158">definitions.h:158</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a></div><div class="ttdeci">@ BLOCKSET</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00148">definitions.h:148</a></div></div>
<div class="ttc" id="anamespacesurface_html"><div class="ttname"><a href="namespacesurface.html">surface</a></div><div class="ttdef"><b>Definition:</b> <a href="surface_8py_source.html#l00001">surface.py:1</a></div></div>
</div><!-- fragment --></li>
<li>Domain field name, approximation space and bases, as well as rank (1 for scalar problem) as implemented in <a class="el" href="basic_tutorials_poisson_homogeneous.html#basic_tutorials_poisson_homogeneous_setupproblem">setupProblem()</a> <div class="fragment"><div class="line">Add field U field_id 1 space <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a> approximation base <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5afd8fcce3bafc9c764ded9e392f2996c5">AINSWORTH_BERNSTEIN_BEZIER_BASE</a> rank 1 meshset 12682136550675316745</div>
<div class="line">Add finite element dFE</div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5afd8fcce3bafc9c764ded9e392f2996c5"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5afd8fcce3bafc9c764ded9e392f2996c5">AINSWORTH_BERNSTEIN_BEZIER_BASE</a></div><div class="ttdeci">@ AINSWORTH_BERNSTEIN_BEZIER_BASE</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00065">definitions.h:64</a></div></div>
</div><!-- fragment --></li>
<li>General information about the problem including removing DOFs associated with the boundary <div class="fragment"><div class="line">Add problem SimpleProblem</div>
<div class="line">Number of dofs 1687</div>
<div class="line">Number of dofs 1659</div>
<div class="line">Finite element dFE added. Nb. of elements added 205</div>
<div class="line">Finite element dFE added. Nb. of elements added 201</div>
<div class="line">Number of adjacencies 1435</div>
<div class="line">SimpleProblem Nb. local dof 1687 by 1687 nb global dofs 3289 by 3289</div>
<div class="line">SimpleProblem Nb. local dof 1602 by 1602 nb global dofs 3289 by 3289</div>
<div class="line"> FEs ghost dofs on problem SimpleProblem Nb. ghost dof 0 by 0 Nb. local dof 1687 by 1687</div>
<div class="line"> FEs ghost dofs on problem SimpleProblem Nb. ghost dof 57 by 57 Nb. local dof 1602 by 1602</div>
<div class="line">removed ents on rank 0 from problem SimpleProblem dofs [ 1650 / 1650  (before 3289 / 3289) local, 0 / 0 (before 0 / 0) ghost, 3209 / 3209 (before 1687 / 1687) global]</div>
<div class="line">removed ents on rank 1 from problem SimpleProblem dofs [ 1559 / 1559  (before 3289 / 3289) local, 55 / 55 (before 57 / 57) ghost, 3209 / 3209 (before 1602 / 1602) global]</div>
</div><!-- fragment --></li>
<li>Convergence of the KSP iterative solver from PETSC. As shown, it is converged is one step which is expected for this simple linear problem. <div class="fragment"><div class="line">0 KSP Residual norm 1.057541430518e-01 </div>
<div class="line">1 KSP Residual norm 2.720205258196e-15 </div>
</div><!-- fragment --></li>
</ul>
<p >Then, you also see in the directory where you run the analysis, it now has the newly created output file, namely <code>out_result.h5m</code>. The output can be visualised in a visualisation software. If you would like to open the output in the free software of <a href="https://www.paraview.org">Paraview</a>, you would need to convert the input file to <code>*.vtk</code> format by running the following command line in your terminal </p><div class="fragment"><div class="line">mbconvert out_result.h5m out_result.vtk</div>
</div><!-- fragment --><p> Then open it in Paraview and use the filter <code>WarpByScalar</code>, you will be able to see the deformation as below</p>
<p ><a class="anchor" id="figure_poisson_homogeneous"></a></p><div class="image">
<img src="poisson_homogeneous.png" alt="" width="900px"/>
<div class="caption">
Figure 2: Poisson homogeneous visualisation.</div></div>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_discussion"></a>
Discussion</h2>
<p >As mentioned at the beginning of this tutorial, this <a class="el" href="struct_poisson.html">Poisson</a> equation with homogeneous boundary condition helps to predict the deformation of a membrane that is fixed at the boundary bearing an uniformly distributed force on its surface. In this case, the force \( f=5.0\) is hardcoded in the code.</p>
<p >You can test yourself how the increase/decrease in approximation order affects the number of DOFs and the analysis time. Also, you can do the same investigation but by changing the mesh density.</p>
<p >Regarding the implementation in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, it is important that you get the concept of developing/using <b>UDOs</b> to evaluate the matrices and vectors and then push them, in a certain order, to the <b>Pipelines</b> where calculations are done sequentially. These concepts will apply to all of the programs implemented in <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>.</p>
<p >You can find the complete code to solve 3D version of the <a class="el" href="struct_poisson.html">Poisson</a> problem with homogeneous boundary condition, using the same source code by setting variable EXECUTABLE_DIMENSION=3, see CMakeList.txt file in <code>mofem_install/um_view/tutorials/scl-1/</code> </p><div class="fragment"><div class="line">tutorials_build_and_install(</div>
<div class="line">  poisson_3d_homogeneous ${CMAKE_CURRENT_SOURCE_DIR}/poisson_2d_homogeneous.cpp)</div>
<div class="line">set_target_properties(</div>
<div class="line">  poisson_3d_homogeneous PROPERTIES COMPILE_FLAGS </div>
<div class="line">  <span class="stringliteral">&quot;-DEXECUTABLE_DIMENSION=3&quot;</span>)</div>
</div><!-- fragment --><p >To run the analysis, you will follow very similar procedure as for the 2D case using the same <code>param_file.petsc</code> file with slight changes in the command lines </p><div class="fragment"><div class="line">mofem_part -my_file cube.h5m -output_file cube_2parts.h5m -my_nparts 2 -<a class="code hl_variable" href="elec__phys__2_d_8cpp.html#afe4f94e033c0d1c57d407b4338a64b33">dim</a> 3 -adj_dim 1</div>
<div class="line">mpirun -np 2 ./poisson_3d_homogeneous -file_name cube_2parts.h5m -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 4 -log_quiet</div>
</div><!-- fragment --><h1><a class="anchor" id="basic_tutorials_poisson_homogeneous_plain_program"></a>
Plain program</h1>
<p >The plain program for both the implementation of the UDOs (<code>*</code>.hpp) and the main program (<code>*</code>.cpp) are as follows</p>
<h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_impl_udo"></a>
Implementation of User Data Operators (*.hpp)</h2>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \file poisson_2d_homogeneous.hpp</span></div>
<div class="line"><span class="comment"> * \example poisson_2d_homogeneous.hpp</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Solution of poisson equation. Direct implementation of User Data Operators</span></div>
<div class="line"><span class="comment"> * for teaching proposes.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * \note In practical application we suggest use form integrators to generalise</span></div>
<div class="line"><span class="comment"> * and simplify code. However, here we like to expose user to ways how to</span></div>
<div class="line"><span class="comment"> * implement data operator from scratch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define name if it has not been defined yet</span></div>
<div class="line"><span class="preprocessor">#ifndef __POISSON_2D_HOMOGENEOUS_HPP__</span></div>
<div class="line"><span class="preprocessor">#define __POISSON_2D_HOMOGENEOUS_HPP__</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use of alias for some specific functions</span></div>
<div class="line"><span class="comment">// We are solving Poisson&#39;s equation in 2D so Face element is used</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_entities_field_data_1_1_ent_data.html">EntData</a> = EntitiesFieldData::EntData;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> DIM&gt;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps</a> = PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> = <a class="code hl_struct" href="struct_elements_and_ops.html">ElementsAndOps&lt;SPACE_DIM&gt;::DomainEle</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = DomainEle::UserDataOperator;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> =</div>
<div class="line">    FormsIntegrators&lt;DomainEleOp&gt;::Assembly&lt;PETSC&gt;<a class="code hl_typedef" href="radiation_8cpp.html#a62d290f01cfc65a09faa805099b2e06f">::OpBase</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Namespace that contains necessary UDOs, will be included in the main program</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_poisson2_d_homogeneous_operators.html">Poisson2DHomogeneousOperators</a> {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Declare FTensor index for 2D problem</span></div>
<div class="line"><a class="code hl_class" href="class_f_tensor_1_1_index.html">FTensor::Index&lt;'i', SPACE_DIM&gt;</a> <a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#a6de501e93282da2d382d3e918cda7d80">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// For simplicity, source term f will be constant throughout the domain</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#ae3fc8b5f9de9d17faeb6c6a7488e7ad9">body_source</a> = 5.;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>OpDomainLhsMatrixK : <span class="keyword">public</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  OpDomainLhsMatrixK(std::string row_field_name, std::string col_field_name)</div>
<div class="line">      : <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a>(row_field_name, col_field_name,</div>
<div class="line">                            <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a>::OPROWCOL) {}</div>
<div class="line"> </div>
<div class="line">  MoFEMErrorCode <a class="code hl_function" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k.html#a24ba67b685608659b085ea5f9417540f">iNtegrate</a>(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                           EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_row_dofs = row_data.getIndices().size();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_col_dofs = col_data.getIndices().size();</div>
<div class="line"> </div>
<div class="line">    this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#aa09421326d490a4e1d04a10b0f0a0311">locMat</a>.resize(nb_row_dofs, nb_col_dofs, <span class="keyword">false</span>);</div>
<div class="line">    this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#aa09421326d490a4e1d04a10b0f0a0311">locMat</a>.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get element area</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> area = getMeasure();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get number of integration points</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_integration_points = getGaussPts().size2();</div>
<div class="line">    <span class="comment">// get integration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get derivatives of base functions on row</span></div>
<div class="line">    <span class="keyword">auto</span> t_row_diff_base = row_data.getFTensor1DiffN&lt;<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// START THE LOOP OVER INTEGRATION POINTS TO CALCULATE LOCAL MATRIX</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_integration_points; gg++) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_row_dofs; ++rr) {</div>
<div class="line">        <span class="comment">// get derivatives of base functions on column</span></div>
<div class="line">        <span class="keyword">auto</span> t_col_diff_base = col_data.getFTensor1DiffN&lt;<a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;(gg, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc != nb_col_dofs; cc++) {</div>
<div class="line">          this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#aa09421326d490a4e1d04a10b0f0a0311">locMat</a>(rr, cc) += t_row_diff_base(<a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#a6de501e93282da2d382d3e918cda7d80">i</a>) * t_col_diff_base(<a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#a6de501e93282da2d382d3e918cda7d80">i</a>) * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">          <span class="comment">// move to the derivatives of the next base functions on column</span></div>
<div class="line">          ++t_col_diff_base;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// move to the derivatives of the next base functions on row</span></div>
<div class="line">        ++t_row_diff_base;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to the weight of the next integration point</span></div>
<div class="line">      ++t_w;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>OpDomainRhsVectorF : <span class="keyword">public</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_function" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html#acf70944d45387ce8d38c4339de4ff8c7">OpDomainRhsVectorF</a>(std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>)</div>
<div class="line">      : <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_base_impl.html">AssemblyDomainEleOp</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a>::OPROW) {}</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html#a89586936da8f6918e006ec3a176f66d4">iNtegrate</a>(EntitiesFieldData::EntData &amp;data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dofs = data.getIndices().size();</div>
<div class="line"> </div>
<div class="line">    this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#a097ca344995d4a64b08a13c5fc2dbcf8">locF</a>.resize(nb_dofs, <span class="keyword">false</span>);</div>
<div class="line">    this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#a097ca344995d4a64b08a13c5fc2dbcf8">locF</a>.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get element area</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> area = getMeasure();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get number of integration points</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_integration_points = getGaussPts().size2();</div>
<div class="line">    <span class="comment">// get integration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get base function</span></div>
<div class="line">    <span class="keyword">auto</span> t_base = data.getFTensor0N();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// START THE LOOP OVER INTEGRATION POINTS TO CALCULATE LOCAL VECTOR</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_integration_points; gg++) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = t_w * area;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_dofs; rr++) {</div>
<div class="line">        this-&gt;<a class="code hl_variable" href="struct_mo_f_e_m_1_1_op_base_impl.html#a097ca344995d4a64b08a13c5fc2dbcf8">locF</a>[rr] += t_base * <a class="code hl_variable" href="namespace_poisson2_d_homogeneous_operators.html#ae3fc8b5f9de9d17faeb6c6a7488e7ad9">body_source</a> * <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// move to the next base function</span></div>
<div class="line">        ++t_base;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to the weight of the next integration point</span></div>
<div class="line">      ++t_w;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// namespace Poisson2DHomogeneousOperators</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">//__POISSON_2D_HOMOGENEOUS_HPP__</span></div>
<div class="ttc" id="anamespace_mo_f_e_m_1_1_exceptions_html_a8fb6351034eac301fc47fdf2748c1b45"><div class="ttname"><a href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEM::Exceptions::MoFEMErrorCode</a></div><div class="ttdeci">PetscErrorCode MoFEMErrorCode</div><div class="ttdoc">MoFEM/PETSc error code.</div><div class="ttdef"><b>Definition:</b> <a href="_exceptions_8hpp_source.html#l00056">Exceptions.hpp:56</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_base_impl_html_a097ca344995d4a64b08a13c5fc2dbcf8"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_base_impl.html#a097ca344995d4a64b08a13c5fc2dbcf8">MoFEM::OpBaseImpl::locF</a></div><div class="ttdeci">VectorDouble locF</div><div class="ttdoc">local entity vector</div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00242">FormsIntegrators.hpp:242</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_base_impl_html_aa09421326d490a4e1d04a10b0f0a0311"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_base_impl.html#aa09421326d490a4e1d04a10b0f0a0311">MoFEM::OpBaseImpl::locMat</a></div><div class="ttdeci">MatrixDouble locMat</div><div class="ttdoc">local entity block matrix</div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00240">FormsIntegrators.hpp:240</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k_html_a24ba67b685608659b085ea5f9417540f"><div class="ttname"><a href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k.html#a24ba67b685608659b085ea5f9417540f">Poisson2DHomogeneousOperators::OpDomainLhsMatrixK::iNtegrate</a></div><div class="ttdeci">MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;row_data, EntitiesFieldData::EntData &amp;col_data)</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00044">poisson_2d_homogeneous.hpp:44</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f_html_a89586936da8f6918e006ec3a176f66d4"><div class="ttname"><a href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html#a89586936da8f6918e006ec3a176f66d4">Poisson2DHomogeneousOperators::OpDomainRhsVectorF::iNtegrate</a></div><div class="ttdeci">MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;data)</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00097">poisson_2d_homogeneous.hpp:97</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f_html_acf70944d45387ce8d38c4339de4ff8c7"><div class="ttname"><a href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html#acf70944d45387ce8d38c4339de4ff8c7">Poisson2DHomogeneousOperators::OpDomainRhsVectorF::OpDomainRhsVectorF</a></div><div class="ttdeci">OpDomainRhsVectorF(std::string field_name)</div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00094">poisson_2d_homogeneous.hpp:94</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="basic_tutorials_poisson_homogeneous_impl_main"></a>
Implementation of the main program (*.cpp)</h2>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \file poisson_2d_homogeneous.cpp</span></div>
<div class="line"><span class="comment"> * \example poisson_2d_homogeneous.cpp</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Solution of poisson equation. Direct implementation of User Data Operators</span></div>
<div class="line"><span class="comment"> * for teaching proposes.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * \note In practical application we suggest use form integrators to generalise</span></div>
<div class="line"><span class="comment"> * and simplify code. However, here we like to expose user to ways how to</span></div>
<div class="line"><span class="comment"> * implement data operator from scratch.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a> = <span class="stringliteral">&quot;U&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="child__and__parent_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a> =</div>
<div class="line">    <a class="code hl_define" href="plastic_8cpp.html#a49d2a41e935ccc68adc5a9268619cba1">EXECUTABLE_DIMENSION</a>; <span class="comment">//&lt; Space dimension of problem, mesh</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson__2d__homogeneous_8hpp.html">poisson_2d_homogeneous.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_mo_f_e_m.html">MoFEM</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_poisson2_d_homogeneous_operators.html">Poisson2DHomogeneousOperators</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab_3_01_face_element_forces_and_sources_core_01_4.html">PostProcFaceEle</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab.html">PostProcBrokenMeshInMoab&lt;DomainEle&gt;</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>[] = <span class="stringliteral">&quot;...\n\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a>(<a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Declaration of the main function to run analysis</span></div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a7e63fa18b0338d5088137d665cefb1bc">runProgram</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="comment">// Declaration of other main functions called in runProgram()</span></div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">readMesh</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">setupProblem</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">boundaryCondition</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">assembleSystem</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">setIntegrationRules</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">solveSystem</a>();</div>
<div class="line">  <a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">outputResults</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// MoFEM interfaces</span></div>
<div class="line">  <a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>;</div>
<div class="line">  <a class="code hl_struct" href="struct_mo_f_e_m_1_1_simple.html">Simple</a> *<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Field name and approximation order</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a3ef0acad2725308b2ff793c1ef9e279f">Poisson2DHomogeneous::Poisson2DHomogeneous</a>(<a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field)</div>
<div class="line">    : mField(m_field) {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Read mesh]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">Poisson2DHomogeneous::readMesh</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getOptions();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;loadFile();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Read mesh]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Setup problem]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">Poisson2DHomogeneous::setupProblem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;addDomainField(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>,</div>
<div class="line">                                         <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a> = 3;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespace_mo_f_e_m.html#a2d7af8e1af9a42f3180d8cc96f8f8c06">PetscOptionsGetInt</a>(PETSC_NULL, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;-order&quot;</span>, &amp;<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a>, PETSC_NULL);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;setFieldOrder(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a576c2c8e6994b019a561d85bb0012372">oRder</a>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;setUp();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Setup problem]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Boundary condition]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">Poisson2DHomogeneous::boundaryCondition</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> bc_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_bc_manager.html">BcManager</a>&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Remove BCs from blockset name &quot;BOUNDARY_CONDITION&quot; or SETU, note that you</span></div>
<div class="line">  <span class="comment">// can use regular expression to put list of blocksets;</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bc_mng-&gt;removeBlockDOFsOnEntities&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_bc_scalar_meshset_type.html">BcScalarMeshsetType&lt;BLOCKSET&gt;</a>&gt;(</div>
<div class="line">      <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getProblemName(), <span class="stringliteral">&quot;(BOUNDARY_CONDITION|SETU)&quot;</span>,</div>
<div class="line">      std::string(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>), <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Boundary condition]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Assemble system]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">Poisson2DHomogeneous::assembleSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line"> </div>
<div class="line">  { <span class="comment">// Push operators to the Pipeline that is responsible for calculating LHS</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainLhsPipeline(), {H1});</div>
<div class="line">    pipeline_mng-&gt;getOpDomainLhsPipeline().push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k.html">OpDomainLhsMatrixK</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  { <span class="comment">// Push operators to the Pipeline that is responsible for calculating RHS</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> set_values_to_bc_dofs = [&amp;](<span class="keyword">auto</span> &amp;fe) {</div>
<div class="line">      <span class="keyword">auto</span> get_bc_hook = [&amp;]() {</div>
<div class="line">        <a class="code hl_struct" href="struct_mo_f_e_m_1_1_essential_pre_proc.html">EssentialPreProc&lt;TemperatureCubitBcData&gt;</a> hook(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>, fe, {});</div>
<div class="line">        <span class="keywordflow">return</span> hook;</div>
<div class="line">      };</div>
<div class="line">      fe-&gt;preProcessHook = get_bc_hook();</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// you can skip that if boundary condition is prescribing zero</span></div>
<div class="line">    <span class="keyword">auto</span> calculate_residual_from_set_values_on_bc = [&amp;](<span class="keyword">auto</span> &amp;pipeline) {</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_typedef" href="child__and__parent_8cpp.html#a80b637c04b8c449d54efa75ab73b67df">DomainEle</a> =</div>
<div class="line">          <a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager_1_1_elements_and_ops_by_dim.html">PipelineManager::ElementsAndOpsByDim&lt;SPACE_DIM&gt;::DomainEle</a>;</div>
<div class="line">      <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEleOp</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_volume_element_forces_and_sources_core_1_1_user_data_operator.html">DomainEle::UserDataOperator</a>;</div>
<div class="line">      <span class="keyword">using </span>OpInternal = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_forms_integrators_1_1_assembly.html">FormsIntegrators&lt;DomainEleOp&gt;::Assembly</a>&lt;</div>
<div class="line">          <a class="code hl_enumvalue" href="group__mofem__forms.html#ggabb82cd10e89a1d4d25fa7756360b181ba2243b0abb08ad80d05c47e734f3134bc">PETSC</a>&gt;<a class="code hl_class" href="class_linear_form.html">::LinearForm&lt;GAUSS&gt;::OpGradTimesTensor</a>&lt;1, 1, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a541ffc988889246e44b233b777828847">SPACE_DIM</a>&gt;;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> grad_u_vals_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_scalar_field_gradient.html">OpCalculateScalarFieldGradient&lt;SPACE_DIM&gt;</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>,</div>
<div class="line">                                                        grad_u_vals_ptr));</div>
<div class="line">      pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">          <span class="keyword">new</span> OpInternal(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, grad_u_vals_ptr,</div>
<div class="line">                         [](<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) <span class="keyword">constexpr</span> { <span class="keywordflow">return</span> -1; }));</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline(), {H1});</div>
<div class="line">    set_values_to_bc_dofs(pipeline_mng-&gt;getDomainRhsFE());</div>
<div class="line">    calculate_residual_from_set_values_on_bc(</div>
<div class="line">        pipeline_mng-&gt;getOpDomainRhsPipeline());</div>
<div class="line">    pipeline_mng-&gt;getOpDomainRhsPipeline().push_back(</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_struct" href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html">OpDomainRhsVectorF</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Assemble system]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Set integration rules]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">Poisson2DHomogeneous::setIntegrationRules</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> rule_lhs = [](<a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>) -&gt; <span class="keywordtype">int</span> { <span class="keywordflow">return</span> 2 * (<a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a> - 1); };</div>
<div class="line">  <span class="keyword">auto</span> rule_rhs = [](<a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>) -&gt; <span class="keywordtype">int</span> { <span class="keywordflow">return</span> <a class="code hl_variable" href="_basic_fe_tools_8hpp.html#a9af7d9ad959b4605c5f0bab2f104c2fb">p</a>; };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;setDomainLhsIntegrationRule(rule_lhs);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;setDomainRhsIntegrationRule(rule_rhs);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Set integration rules]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Solve system]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">Poisson2DHomogeneous::solveSystem</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> ksp_solver = pipeline_mng-&gt;<a class="code hl_function" href="group__mofem__basic__interface.html#gaa983d7ca3e82c5a0711991a730bfbcbb">createKSP</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(ksp_solver);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(ksp_solver);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create RHS and solution vectors</span></div>
<div class="line">  <span class="keyword">auto</span> dm = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#a12cbb4e4766a370eaa234cbf467a50fd">simpleInterface</a>-&gt;getDM();</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a> = <a class="code hl_function" href="group__dm.html#gac26499a0d7716b8a666c872f0e900254">createDMVector</a>(dm);</div>
<div class="line">  <span class="keyword">auto</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> = <a class="code hl_function" href="namespace_mo_f_e_m.html#a681e912e2d0043503d2da810dc186d73">vectorDuplicate</a>(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Solve the system</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(ksp_solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Scatter result data on the mesh</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga490784c9685a7e4068b83ca2babc1ba1">DMoFEMMeshToLocalVector</a>(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Solve system]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Output results]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">Poisson2DHomogeneous::outputResults</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pipeline_mng = <a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;<a class="code hl_struct" href="struct_mo_f_e_m_1_1_pipeline_manager.html">PipelineManager</a>&gt;();</div>
<div class="line">  pipeline_mng-&gt;<a class="code hl_function" href="struct_mo_f_e_m_1_1_pipeline_manager.html#a4daac802fcdd9c31639d1c1d4a2a608f">getDomainLhsFE</a>().reset();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> post_proc_fe = boost::make_shared&lt;PostProcFaceEle&gt;(<a class="code hl_variable" href="struct_poisson2_d_homogeneous.html#ab8c81bd27da9dbacb94cb5fcb090c97a">mField</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_add_h_o_ops.html">AddHOOps&lt;SPACE_DIM, SPACE_DIM, SPACE_DIM&gt;::add</a>(</div>
<div class="line">    post_proc_fe-&gt;getOpPtrVector(), {H1});</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> u_ptr = boost::make_shared&lt;VectorDouble&gt;();</div>
<div class="line">  <span class="keyword">auto</span> grad_u_ptr = boost::make_shared&lt;MatrixDouble&gt;();</div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_scalar_field_values.html">OpCalculateScalarFieldValues</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, u_ptr));</div>
<div class="line"> </div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_calculate_scalar_field_gradient.html">OpCalculateScalarFieldGradient&lt;SPACE_DIM&gt;</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, grad_u_ptr));</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span><a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPPMap</a> = <a class="code hl_struct" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html">OpPostProcMapInMoab&lt;SPACE_DIM, SPACE_DIM&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  post_proc_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">new</span> <a class="code hl_typedef" href="photon__diffusion_8cpp.html#ada3f24ae35ae50faea3df2b474ea2f37">OpPPMap</a>(post_proc_fe-&gt;getPostProcMesh(),</div>
<div class="line">                  post_proc_fe-&gt;getMapGaussPts(),</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8971cfcdc550b35bb120e28e72d8c9d5">OpPPMap::DataMapVec</a>{{<span class="stringliteral">&quot;U&quot;</span>, u_ptr}},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{{<span class="stringliteral">&quot;GRAD_U&quot;</span>, grad_u_ptr}},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{},</div>
<div class="line"> </div>
<div class="line">                  <a class="code hl_typedef" href="struct_mo_f_e_m_1_1_op_post_proc_map_in_moab.html#a8ace8e81530956d34472cb6e242a36cc">OpPPMap::DataMapMat</a>{}</div>
<div class="line"> </div>
<div class="line">                  )</div>
<div class="line"> </div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  pipeline_mng-&gt;getDomainRhsFE() = post_proc_fe;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> pipeline_mng-&gt;loopFiniteElements();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc_fe-&gt;writeFile(<span class="stringliteral">&quot;out_result.h5m&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Output results]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Run program]</span></div>
<div class="line"><span class="comment"></span><a class="code hl_typedef" href="namespace_mo_f_e_m_1_1_exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a7e63fa18b0338d5088137d665cefb1bc">Poisson2DHomogeneous::runProgram</a>() {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a9e028995b91cbf0c71da299281b086e5">readMesh</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2a5d13478dd5efb6f0c8666390c7793c">setupProblem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#a2b629b1579dfd6da6e6ffc9e8dcae6b5">boundaryCondition</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ae5471202284170647f7841ccc91acfa4">setIntegrationRules</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad63f6e734d07ef8564d80b216cd24ad7">assembleSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#adb6e7c2cf0adddd9f3a004c62035478c">solveSystem</a>();</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_poisson2_d_homogeneous.html#ad29ba4939bf780119e509b0f0a9cfb33">outputResults</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}<span class="comment"></span></div>
<div class="line"><span class="comment">//! [Run program]</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">//! [Main]</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">int</span> <a class="code hl_function" href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialisation of MoFEM/PETSc and MOAB data structures</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="_default_params_8hpp.html#a3538d3053f6520cc492dbbc38480d626">param_file</a>[] = <span class="stringliteral">&quot;param_file.petsc&quot;</span>;</div>
<div class="line">  <a class="code hl_function" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::Core::Initialize</a>(&amp;argc, &amp;argv, <a class="code hl_variable" href="_default_params_8hpp.html#a3538d3053f6520cc492dbbc38480d626">param_file</a>, <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Error handling</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Register MoFEM discrete manager in PETSc</span></div>
<div class="line">    DMType dm_name = <span class="stringliteral">&quot;DMMOFEM&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga899ec9d1ad35488bbe4273731f6d5c90">DMRegister_MoFEM</a>(dm_name);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create MOAB instance</span></div>
<div class="line">    moab::Core mb_instance;              <span class="comment">// mesh database</span></div>
<div class="line">    moab::Interface &amp;moab = mb_instance; <span class="comment">// mesh database interface</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create MoFEM instance</span></div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html">MoFEM::Core</a> core(moab);           <span class="comment">// finite element database</span></div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field = core; <span class="comment">// finite element interface</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the main analysis</span></div>
<div class="line">    <a class="code hl_struct" href="struct_poisson2_d_homogeneous.html">Poisson2DHomogeneous</a> poisson_problem(m_field);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> poisson_problem.runProgram();</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a1e74d797bf522e2b291419cddab27835">CATCH_ERRORS</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Finish work: cleaning memory, getting statistics, etc.</span></div>
<div class="line">  <a class="code hl_function" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#aa5abe3b5d998e2dc50e4ef6916915eb1">MoFEM::Core::Finalize</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//! [Main]</span></div>
<div class="ttc" id="agroup__dm_html_ga490784c9685a7e4068b83ca2babc1ba1"><div class="ttname"><a href="group__dm.html#ga490784c9685a7e4068b83ca2babc1ba1">MoFEM::DMoFEMMeshToLocalVector</a></div><div class="ttdeci">PetscErrorCode DMoFEMMeshToLocalVector(DM dm, Vec l, InsertMode mode, ScatterMode scatter_mode)</div><div class="ttdoc">set local (or ghosted) vector values on mesh for partition only</div><div class="ttdef"><b>Definition:</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00509">DMMoFEM.cpp:509</a></div></div>
<div class="ttc" id="agroup__dm_html_ga899ec9d1ad35488bbe4273731f6d5c90"><div class="ttname"><a href="group__dm.html#ga899ec9d1ad35488bbe4273731f6d5c90">MoFEM::DMRegister_MoFEM</a></div><div class="ttdeci">PetscErrorCode DMRegister_MoFEM(const char sname[])</div><div class="ttdoc">Register MoFEM problem.</div><div class="ttdef"><b>Definition:</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00047">DMMoFEM.cpp:47</a></div></div>
<div class="ttc" id="agroup__dm_html_gac26499a0d7716b8a666c872f0e900254"><div class="ttname"><a href="group__dm.html#gac26499a0d7716b8a666c872f0e900254">MoFEM::createDMVector</a></div><div class="ttdeci">auto createDMVector(DM dm)</div><div class="ttdoc">Get smart vector from DM.</div><div class="ttdef"><b>Definition:</b> <a href="_d_m_mo_f_e_m_8hpp_source.html#l01003">DMMoFEM.hpp:1003</a></div></div>
<div class="ttc" id="agroup__mofem__basic__interface_html_gaa983d7ca3e82c5a0711991a730bfbcbb"><div class="ttname"><a href="group__mofem__basic__interface.html#gaa983d7ca3e82c5a0711991a730bfbcbb">MoFEM::PipelineManager::createKSP</a></div><div class="ttdeci">SmartPetscObj&lt; KSP &gt; createKSP(SmartPetscObj&lt; DM &gt; dm=nullptr)</div><div class="ttdoc">Create KSP (linear) solver.</div><div class="ttdef"><b>Definition:</b> <a href="_pipeline_manager_8cpp_source.html#l00049">PipelineManager.cpp:49</a></div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_a2d7af8e1af9a42f3180d8cc96f8f8c06"><div class="ttname"><a href="namespace_mo_f_e_m.html#a2d7af8e1af9a42f3180d8cc96f8f8c06">MoFEM::PetscOptionsGetInt</a></div><div class="ttdeci">PetscErrorCode PetscOptionsGetInt(PetscOptions *, const char pre[], const char name[], PetscInt *ivalue, PetscBool *set)</div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_petsc_8hpp_source.html#l00142">DeprecatedPetsc.hpp:142</a></div></div>
<div class="ttc" id="anamespace_mo_f_e_m_html_a681e912e2d0043503d2da810dc186d73"><div class="ttname"><a href="namespace_mo_f_e_m.html#a681e912e2d0043503d2da810dc186d73">MoFEM::vectorDuplicate</a></div><div class="ttdeci">SmartPetscObj&lt; Vec &gt; vectorDuplicate(Vec vec)</div><div class="ttdoc">Create duplicate vector of smart vector.</div><div class="ttdef"><b>Definition:</b> <a href="_petsc_smart_obj_8hpp_source.html#l00217">PetscSmartObj.hpp:217</a></div></div>
<div class="ttc" id="anamespaceconvert_html_a4db4d50b047acc94e54fdf4df9f3077c"><div class="ttname"><a href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">convert.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l00064">convert.py:64</a></div></div>
<div class="ttc" id="apoisson__2d__homogeneous_8hpp_html"><div class="ttname"><a href="poisson__2d__homogeneous_8hpp.html">poisson_2d_homogeneous.hpp</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_add_h_o_ops_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_add_h_o_ops.html">MoFEM::AddHOOps</a></div><div class="ttdoc">Add operators pushing bases from local to physical configuration.</div><div class="ttdef"><b>Definition:</b> <a href="_h_o_data_operators_8hpp_source.html#l00503">HODataOperators.hpp:503</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_bc_manager_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_bc_manager.html">MoFEM::BcManager</a></div><div class="ttdoc">Simple interface for fast problem set-up.</div><div class="ttdef"><b>Definition:</b> <a href="_bc_manager_8hpp_source.html#l00025">BcManager.hpp:25</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_bc_scalar_meshset_type_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_bc_scalar_meshset_type.html">MoFEM::BcScalarMeshsetType</a></div><div class="ttdef"><b>Definition:</b> <a href="_bc_manager_8hpp_source.html#l00015">BcManager.hpp:15</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_essential_pre_proc_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_essential_pre_proc.html">MoFEM::EssentialPreProc</a></div><div class="ttdoc">Class (Function) to enforce essential constrains.</div><div class="ttdef"><b>Definition:</b> <a href="_essential_8hpp_source.html#l00039">Essential.hpp:39</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_forms_integrators_1_1_assembly_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_forms_integrators_1_1_assembly.html">MoFEM::FormsIntegrators::Assembly</a></div><div class="ttdoc">Assembly methods.</div><div class="ttdef"><b>Definition:</b> <a href="_forms_integrators_8hpp_source.html#l00296">FormsIntegrators.hpp:296</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_calculate_scalar_field_gradient_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_calculate_scalar_field_gradient.html">MoFEM::OpCalculateScalarFieldGradient</a></div><div class="ttdoc">Get field gradients at integration pts for scalar filed rank 0, i.e. vector field.</div><div class="ttdef"><b>Definition:</b> <a href="_user_data_operators_8hpp_source.html#l01296">UserDataOperators.hpp:1298</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_op_calculate_scalar_field_values_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_op_calculate_scalar_field_values.html">MoFEM::OpCalculateScalarFieldValues</a></div><div class="ttdoc">Get value at integration points for scalar field.</div><div class="ttdef"><b>Definition:</b> <a href="_user_data_operators_8hpp_source.html#l00082">UserDataOperators.hpp:83</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_pipeline_manager_1_1_elements_and_ops_by_dim_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_pipeline_manager_1_1_elements_and_ops_by_dim.html">MoFEM::PipelineManager::ElementsAndOpsByDim</a></div><div class="ttdef"><b>Definition:</b> <a href="_pipeline_manager_8hpp_source.html#l00038">PipelineManager.hpp:38</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_pipeline_manager_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_pipeline_manager.html">MoFEM::PipelineManager</a></div><div class="ttdoc">PipelineManager interface.</div><div class="ttdef"><b>Definition:</b> <a href="_pipeline_manager_8hpp_source.html#l00024">PipelineManager.hpp:24</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_pipeline_manager_html_a4daac802fcdd9c31639d1c1d4a2a608f"><div class="ttname"><a href="struct_mo_f_e_m_1_1_pipeline_manager.html#a4daac802fcdd9c31639d1c1d4a2a608f">MoFEM::PipelineManager::getDomainLhsFE</a></div><div class="ttdeci">boost::shared_ptr&lt; FEMethod &gt; &amp; getDomainLhsFE()</div><div class="ttdef"><b>Definition:</b> <a href="_pipeline_manager_8hpp_source.html#l00401">PipelineManager.hpp:401</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab_3_01_face_element_forces_and_sources_core_01_4_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab_3_01_face_element_forces_and_sources_core_01_4.html">MoFEM::PostProcBrokenMeshInMoab&lt; FaceElementForcesAndSourcesCore &gt;</a></div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00679">PostProcBrokenMeshInMoabBase.hpp:680</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_post_proc_broken_mesh_in_moab.html">MoFEM::PostProcBrokenMeshInMoab</a></div><div class="ttdef"><b>Definition:</b> <a href="_post_proc_broken_mesh_in_moab_base_8hpp_source.html#l00669">PostProcBrokenMeshInMoabBase.hpp:669</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_simple_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_simple.html">MoFEM::Simple</a></div><div class="ttdoc">Simple interface for fast problem set-up.</div><div class="ttdef"><b>Definition:</b> <a href="_simple_8hpp_source.html#l00027">Simple.hpp:27</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k_html"><div class="ttname"><a href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_lhs_matrix_k.html">Poisson2DHomogeneousOperators::OpDomainLhsMatrixK</a></div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00038">poisson_2d_homogeneous.hpp:38</a></div></div>
<div class="ttc" id="astruct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f_html"><div class="ttname"><a href="struct_poisson2_d_homogeneous_operators_1_1_op_domain_rhs_vector_f.html">Poisson2DHomogeneousOperators::OpDomainRhsVectorF</a></div><div class="ttdef"><b>Definition:</b> <a href="poisson__2d__homogeneous_8hpp_source.html#l00092">poisson_2d_homogeneous.hpp:92</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.5
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>