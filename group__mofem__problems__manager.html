<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: ProblemsManager</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
  <script>
    window.MathJax = {
      tex: {
        tags: 'all', // Enables equation numbering
      },
      loader: {
        load: ['[tex]/boldsymbol']
      }
    };
  </script>
  <script type="text/javascript " src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ProblemsManager<div class="ingroups"><a class="el" href="group__mofem.html">MoFEM</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Adding and managing problems.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for ProblemsManager:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__mofem__problems__manager.svg" width="270" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:ProblemsManager_8cpp" id="r_ProblemsManager_8cpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ProblemsManager_8cpp.html">ProblemsManager.cpp</a></td></tr>
<tr class="memdesc:ProblemsManager_8cpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Managing complexities for problem. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ProblemsManager_8hpp" id="r_ProblemsManager_8hpp"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ProblemsManager_8hpp.html">ProblemsManager.hpp</a></td></tr>
<tr class="memdesc:ProblemsManager_8hpp"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface managing problems. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structMoFEM_1_1ProblemsManager.html">MoFEM::ProblemsManager</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structMoFEM_1_1Problem.html" title="keeps basic data about problem">Problem</a> manager is used to build and partition problems.  <a href="structMoFEM_1_1ProblemsManager.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga9a750159b072bbc8107d5626fc1bc42b" id="r_ga9a750159b072bbc8107d5626fc1bc42b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="definitions_8h.html#ac1e8a42306d8e67cb94ca31c3956ee78">DEPRECATED</a> <a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga9a750159b072bbc8107d5626fc1bc42b">MoFEM::ProblemsManager::partitionMesh</a> (const <a class="el" href="classRange.html">Range</a> &amp;ents, const int dim, const int adj_dim, const int n_parts, Tag *th_vertex_weights=nullptr, Tag *th_edge_weights=nullptr, Tag *th_part_weights=nullptr, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>, const <a class="el" href="classbool.html">bool</a> <a class="el" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>=false)</td></tr>
<tr class="memdesc:ga9a750159b072bbc8107d5626fc1bc42b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set partition tag to each finite element in the problem.  <br /></td></tr>
<tr class="separator:ga9a750159b072bbc8107d5626fc1bc42b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga98070af58a9cd97f9202c6488698ba96" id="r_ga98070af58a9cd97f9202c6488698ba96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga98070af58a9cd97f9202c6488698ba96">MoFEM::ProblemsManager::buildProblem</a> (const std::string name, const <a class="el" href="classbool.html">bool</a> square_matrix, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:ga98070af58a9cd97f9202c6488698ba96"><td class="mdescLeft">&#160;</td><td class="mdescRight">build problem data structures  <br /></td></tr>
<tr class="separator:ga98070af58a9cd97f9202c6488698ba96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad7902c9b0fa2d8d492bebfd40841f9c5" id="r_gad7902c9b0fa2d8d492bebfd40841f9c5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gad7902c9b0fa2d8d492bebfd40841f9c5">MoFEM::ProblemsManager::buildProblem</a> (<a class="el" href="structMoFEM_1_1Problem.html">Problem</a> *problem_ptr, const <a class="el" href="classbool.html">bool</a> square_matrix, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gad7902c9b0fa2d8d492bebfd40841f9c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">build problem data structures  <br /></td></tr>
<tr class="separator:gad7902c9b0fa2d8d492bebfd40841f9c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0eed1a1aa1677044038c562cdd1aeb0f" id="r_ga0eed1a1aa1677044038c562cdd1aeb0f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga0eed1a1aa1677044038c562cdd1aeb0f">MoFEM::ProblemsManager::buildProblemOnDistributedMesh</a> (const std::string name, const <a class="el" href="classbool.html">bool</a> square_matrix, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:ga0eed1a1aa1677044038c562cdd1aeb0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">build problem data structures, assuming that mesh is distributed (collective)  <br /></td></tr>
<tr class="separator:ga0eed1a1aa1677044038c562cdd1aeb0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafa370e562ce3763f7dee4228a0e107ae" id="r_gafa370e562ce3763f7dee4228a0e107ae"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gafa370e562ce3763f7dee4228a0e107ae">MoFEM::ProblemsManager::buildProblemOnDistributedMesh</a> (<a class="el" href="structMoFEM_1_1Problem.html">Problem</a> *problem_ptr, const <a class="el" href="classbool.html">bool</a> square_matrix=true, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gafa370e562ce3763f7dee4228a0e107ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">build problem data structures, assuming that mesh is distributed (collective)  <br /></td></tr>
<tr class="separator:gafa370e562ce3763f7dee4228a0e107ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9c86df8247b9fda02508dd26018fff8c" id="r_ga9c86df8247b9fda02508dd26018fff8c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga9c86df8247b9fda02508dd26018fff8c">MoFEM::ProblemsManager::buildSubProblem</a> (const std::string out_name, const std::vector&lt; std::string &gt; &amp;fields_row, const std::vector&lt; std::string &gt; &amp;fields_col, const std::string main_problem, const <a class="el" href="classbool.html">bool</a> square_matrix=true, const map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classRange.html">Range</a> &gt; &gt; *entityMapRow=nullptr, const map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classRange.html">Range</a> &gt; &gt; *entityMapCol=nullptr, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:ga9c86df8247b9fda02508dd26018fff8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">build sub problem  <br /></td></tr>
<tr class="separator:ga9c86df8247b9fda02508dd26018fff8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5d99f738b2a9f3c0c13ffbafdb52c6b9" id="r_ga5d99f738b2a9f3c0c13ffbafdb52c6b9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga5d99f738b2a9f3c0c13ffbafdb52c6b9">MoFEM::ProblemsManager::buildComposedProblem</a> (const std::string out_name, const std::vector&lt; std::string &gt; add_row_problems, const std::vector&lt; std::string &gt; add_col_problems, const <a class="el" href="classbool.html">bool</a> square_matrix=true, int verb=1)</td></tr>
<tr class="memdesc:ga5d99f738b2a9f3c0c13ffbafdb52c6b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">build composite problem  <br /></td></tr>
<tr class="separator:ga5d99f738b2a9f3c0c13ffbafdb52c6b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabb6e6723b26106294b1068f819538fd1" id="r_gabb6e6723b26106294b1068f819538fd1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gabb6e6723b26106294b1068f819538fd1">MoFEM::ProblemsManager::inheritPartition</a> (const std::string name, const std::string problem_for_rows, <a class="el" href="classbool.html">bool</a> copy_rows, const std::string problem_for_cols, <a class="el" href="classbool.html">bool</a> copy_cols, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gabb6e6723b26106294b1068f819538fd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">build indexing and partition problem inheriting indexing and partitioning from two other problems  <br /></td></tr>
<tr class="separator:gabb6e6723b26106294b1068f819538fd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5c3f0609c8e08c883e20f7aac6427ae0" id="r_ga5c3f0609c8e08c883e20f7aac6427ae0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga5c3f0609c8e08c883e20f7aac6427ae0">MoFEM::ProblemsManager::partitionSimpleProblem</a> (const std::string name, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:ga5c3f0609c8e08c883e20f7aac6427ae0"><td class="mdescLeft">&#160;</td><td class="mdescRight">partition problem dofs  <br /></td></tr>
<tr class="separator:ga5c3f0609c8e08c883e20f7aac6427ae0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa0e280c88443b6240bf3255c0dce0ef2" id="r_gaa0e280c88443b6240bf3255c0dce0ef2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gaa0e280c88443b6240bf3255c0dce0ef2">MoFEM::ProblemsManager::partitionProblem</a> (const std::string name, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gaa0e280c88443b6240bf3255c0dce0ef2"><td class="mdescLeft">&#160;</td><td class="mdescRight">partition problem dofs (collective)  <br /></td></tr>
<tr class="separator:gaa0e280c88443b6240bf3255c0dce0ef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabfd48a196686d30eeacb978b81d1a656" id="r_gabfd48a196686d30eeacb978b81d1a656"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gabfd48a196686d30eeacb978b81d1a656">MoFEM::ProblemsManager::partitionFiniteElements</a> (const std::string name, <a class="el" href="classbool.html">bool</a> part_from_moab=false, int low_proc=-1, int hi_proc=-1, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gabfd48a196686d30eeacb978b81d1a656"><td class="mdescLeft">&#160;</td><td class="mdescRight">partition finite elements  <br /></td></tr>
<tr class="separator:gabfd48a196686d30eeacb978b81d1a656"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga20ecb1883ad47d08f22a66d871a48114" id="r_ga20ecb1883ad47d08f22a66d871a48114"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga20ecb1883ad47d08f22a66d871a48114">MoFEM::ProblemsManager::partitionGhostDofs</a> (const std::string name, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:ga20ecb1883ad47d08f22a66d871a48114"><td class="mdescLeft">&#160;</td><td class="mdescRight">determine ghost nodes  <br /></td></tr>
<tr class="separator:ga20ecb1883ad47d08f22a66d871a48114"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaecef402c77353798047ed8dc9c77747" id="r_gaaecef402c77353798047ed8dc9c77747"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gaaecef402c77353798047ed8dc9c77747">MoFEM::ProblemsManager::partitionGhostDofsOnDistributedMesh</a> (const std::string name, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>)</td></tr>
<tr class="memdesc:gaaecef402c77353798047ed8dc9c77747"><td class="mdescLeft">&#160;</td><td class="mdescRight">determine ghost nodes on distributed meshes  <br /></td></tr>
<tr class="separator:gaaecef402c77353798047ed8dc9c77747"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab994c93ba6c9ede9e253730b6f90f4da" id="r_gab994c93ba6c9ede9e253730b6f90f4da"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gab994c93ba6c9ede9e253730b6f90f4da">MoFEM::ProblemsManager::getFEMeshset</a> (const std::string prb_name, const std::string &amp;fe_name, EntityHandle *meshset) const</td></tr>
<tr class="memdesc:gab994c93ba6c9ede9e253730b6f90f4da"><td class="mdescLeft">&#160;</td><td class="mdescRight">create add entities of finite element in the problem  <br /></td></tr>
<tr class="separator:gab994c93ba6c9ede9e253730b6f90f4da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab726d4935d2706f51bade5ccd5cf40a6" id="r_gab726d4935d2706f51bade5ccd5cf40a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gab726d4935d2706f51bade5ccd5cf40a6">MoFEM::ProblemsManager::getProblemElementsLayout</a> (const std::string name, const std::string &amp;fe_name, PetscLayout *layout) const</td></tr>
<tr class="memdesc:gab726d4935d2706f51bade5ccd5cf40a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get layout of elements in the problem.  <br /></td></tr>
<tr class="separator:gab726d4935d2706f51bade5ccd5cf40a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf0db6004cade0e29bef97f933834b61e" id="r_gaf0db6004cade0e29bef97f933834b61e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gaf0db6004cade0e29bef97f933834b61e">MoFEM::ProblemsManager::removeDofsOnEntities</a> (const std::string problem_name, const std::string <a class="el" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, const <a class="el" href="classRange.html">Range</a> ents, const int lo_coeff=0, const int hi_coeff=<a class="el" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a>, const int lo_order=0, const int hi_order=100, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>, const <a class="el" href="classbool.html">bool</a> <a class="el" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>=false)</td></tr>
<tr class="memdesc:gaf0db6004cade0e29bef97f933834b61e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove DOFs from problem.  <br /></td></tr>
<tr class="separator:gaf0db6004cade0e29bef97f933834b61e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55e6d0b8908997abbb5be6373306c3f9" id="r_ga55e6d0b8908997abbb5be6373306c3f9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#ga55e6d0b8908997abbb5be6373306c3f9">MoFEM::ProblemsManager::removeDofsOnEntities</a> (const std::string problem_name, const std::string <a class="el" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, const <a class="el" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> bit_ref_level, const <a class="el" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> bit_ref_mask, <a class="el" href="classRange.html">Range</a> *ents_ptr=nullptr, const int lo_coeff=0, const int hi_coeff=<a class="el" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a>, const int lo_order=0, const int hi_order=100, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>, const <a class="el" href="classbool.html">bool</a> <a class="el" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>=false)</td></tr>
<tr class="memdesc:ga55e6d0b8908997abbb5be6373306c3f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove DOFs from problem by bit ref level.  <br /></td></tr>
<tr class="separator:ga55e6d0b8908997abbb5be6373306c3f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Read load and boradcoast</h2></td></tr>
<tr><td class="ititle" colspan="2"><p>@ </p>
</td></tr>
<tr class="memitem:gab37ad8b4ac4ef77413435ae826d76ca7" id="r_gab37ad8b4ac4ef77413435ae826d76ca7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mofem__problems__manager.html#gab37ad8b4ac4ef77413435ae826d76ca7">MoFEM::CommInterface::partitionMesh</a> (const <a class="el" href="classRange.html">Range</a> &amp;ents, const int dim, const int adj_dim, const int n_parts, Tag *th_vertex_weights=nullptr, Tag *th_edge_weights=nullptr, Tag *th_part_weights=nullptr, int verb=<a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>, const <a class="el" href="classbool.html">bool</a> <a class="el" href="structMoFEM_1_1CommInterface.html#a6a735cf8281a4ca5b86bb95cdf1cb160">debug</a>=false)</td></tr>
<tr class="memdesc:gab37ad8b4ac4ef77413435ae826d76ca7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set partition tag to each finite element in the problem.  <br /></td></tr>
<tr class="separator:gab37ad8b4ac4ef77413435ae826d76ca7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Adding and managing problems. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga5d99f738b2a9f3c0c13ffbafdb52c6b9" name="ga5d99f738b2a9f3c0c13ffbafdb52c6b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5d99f738b2a9f3c0c13ffbafdb52c6b9">&#9670;&#160;</a></span>buildComposedProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildComposedProblem </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>out_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt;&#160;</td>
          <td class="paramname"><em>add_row_problems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt;&#160;</td>
          <td class="paramname"><em>add_col_problems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build composite problem </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out_name</td><td>name of build problem </td></tr>
    <tr><td class="paramname">add_row_problems</td><td>vector of add row problems </td></tr>
    <tr><td class="paramname">add_col_problems</td><td>vector of add col problems </td></tr>
    <tr><td class="paramname">square_matrix</td><td>true if structurally squared matrix </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l01246">1246</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1249</span>              {</div>
<div class="line"><span class="lineno"> 1250</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2">Core::BUILD_FIELD</a>))</div>
<div class="line"><span class="lineno"> 1251</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1252</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a">Core::BUILD_FE</a>))</div>
<div class="line"><span class="lineno"> 1253</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1254</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c">Core::BUILD_ADJ</a>))</div>
<div class="line"><span class="lineno"> 1255</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1256</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 1257</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 1258</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1259</span> </div>
<div class="line"><span class="lineno"> 1260</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__problems.html#ga97e18d7ea29369f0572f4c6cd3e3eeb5">clear_problem</a>(out_name);</div>
<div class="line"><span class="lineno"> 1261</span>  <span class="comment">// get reference to all problems</span></div>
<div class="line"><span class="lineno"> 1262</span>  <span class="keyword">typedef</span> Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type ProblemByName;</div>
<div class="line"><span class="lineno"> 1263</span>  ProblemByName &amp;problems_by_name =</div>
<div class="line"><span class="lineno"> 1264</span>      <span class="keyword">const_cast&lt;</span>ProblemByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1265</span> </div>
<div class="line"><span class="lineno"> 1266</span>  <span class="comment">// Get iterators to out problem, i.e. build problem</span></div>
<div class="line"><span class="lineno"> 1267</span>  ProblemByName::iterator out_problem_it = problems_by_name.find(out_name);</div>
<div class="line"><span class="lineno"> 1268</span>  <span class="keywordflow">if</span> (out_problem_it == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1269</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1270</span>             <span class="stringliteral">&quot;problem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1271</span>             out_name.c_str());</div>
<div class="line"><span class="lineno"> 1272</span>  }</div>
<div class="line"><span class="lineno"> 1273</span>  <span class="comment">// Make data structure for composed-problem data</span></div>
<div class="line"><span class="lineno"> 1274</span>  out_problem_it-&gt;composedProblemsData =</div>
<div class="line"><span class="lineno"> 1275</span>      boost::make_shared&lt;ComposedProblemsData&gt;();</div>
<div class="line"><span class="lineno"> 1276</span>  boost::shared_ptr&lt;ComposedProblemsData&gt; cmp_prb_data =</div>
<div class="line"><span class="lineno"> 1277</span>      out_problem_it-&gt;getComposedProblemsData();</div>
<div class="line"><span class="lineno"> 1278</span> </div>
<div class="line"><span class="lineno"> 1279</span>  <span class="keyword">const</span> std::vector&lt;std::string&gt; *add_prb[] = {&amp;add_row_problems,</div>
<div class="line"><span class="lineno"> 1280</span>                                               &amp;add_col_problems};</div>
<div class="line"><span class="lineno"> 1281</span>  std::vector&lt;const Problem *&gt; *add_prb_ptr[] = {&amp;cmp_prb_data-&gt;rowProblemsAdd,</div>
<div class="line"><span class="lineno"> 1282</span>                                                 &amp;cmp_prb_data-&gt;colProblemsAdd};</div>
<div class="line"><span class="lineno"> 1283</span>  std::vector&lt;SmartPetscObj&lt;IS&gt;&gt; *add_prb_is[] = {&amp;cmp_prb_data-&gt;rowIs,</div>
<div class="line"><span class="lineno"> 1284</span>                                                  &amp;cmp_prb_data-&gt;colIs};</div>
<div class="line"><span class="lineno"> 1285</span> </div>
<div class="line"><span class="lineno"> 1286</span>  <span class="comment">// Get local indices counter</span></div>
<div class="line"><span class="lineno"> 1287</span>  <span class="keywordtype">int</span> *nb_local_dofs[] = {&amp;out_problem_it-&gt;nbLocDofsRow,</div>
<div class="line"><span class="lineno"> 1288</span>                          &amp;out_problem_it-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 1289</span>  <span class="comment">// Get global indices counter</span></div>
<div class="line"><span class="lineno"> 1290</span>  <span class="keywordtype">int</span> *nb_dofs[] = {&amp;out_problem_it-&gt;nbDofsRow, &amp;out_problem_it-&gt;nbDofsCol};</div>
<div class="line"><span class="lineno"> 1291</span> </div>
<div class="line"><span class="lineno"> 1292</span>  <span class="comment">// Set number of ghost nodes to zero</span></div>
<div class="line"><span class="lineno"> 1293</span>  {</div>
<div class="line"><span class="lineno"> 1294</span>    out_problem_it-&gt;nbDofsRow = 0;</div>
<div class="line"><span class="lineno"> 1295</span>    out_problem_it-&gt;nbDofsCol = 0;</div>
<div class="line"><span class="lineno"> 1296</span>    out_problem_it-&gt;nbLocDofsRow = 0;</div>
<div class="line"><span class="lineno"> 1297</span>    out_problem_it-&gt;nbLocDofsCol = 0;</div>
<div class="line"><span class="lineno"> 1298</span>    out_problem_it-&gt;nbGhostDofsRow = 0;</div>
<div class="line"><span class="lineno"> 1299</span>    out_problem_it-&gt;nbGhostDofsCol = 0;</div>
<div class="line"><span class="lineno"> 1300</span>  }</div>
<div class="line"><span class="lineno"> 1301</span>  <span class="keywordtype">int</span> nb_dofs_reserve[] = {0, 0};</div>
<div class="line"><span class="lineno"> 1302</span> </div>
<div class="line"><span class="lineno"> 1303</span>  <span class="comment">// Loop over rows and columns in the main problem and sub-problems</span></div>
<div class="line"><span class="lineno"> 1304</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ss++) {</div>
<div class="line"><span class="lineno"> 1305</span>    add_prb_ptr[ss]-&gt;reserve(add_prb[ss]-&gt;size());</div>
<div class="line"><span class="lineno"> 1306</span>    add_prb_is[ss]-&gt;reserve(add_prb[ss]-&gt;size());</div>
<div class="line"><span class="lineno"> 1307</span>    <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator vit = add_prb[ss]-&gt;begin();</div>
<div class="line"><span class="lineno"> 1308</span>         vit != add_prb[ss]-&gt;end(); vit++) {</div>
<div class="line"><span class="lineno"> 1309</span>      ProblemByName::iterator prb_it = problems_by_name.find(*vit);</div>
<div class="line"><span class="lineno"> 1310</span>      <span class="keywordflow">if</span> (prb_it == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1311</span>        SETERRQ(</div>
<div class="line"><span class="lineno"> 1312</span>            PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1313</span>            <span class="stringliteral">&quot;problem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1314</span>            vit-&gt;c_str());</div>
<div class="line"><span class="lineno"> 1315</span>      }</div>
<div class="line"><span class="lineno"> 1316</span>      add_prb_ptr[ss]-&gt;push_back(&amp;*prb_it);</div>
<div class="line"><span class="lineno"> 1317</span>      <span class="comment">// set number of dofs on rows and columns</span></div>
<div class="line"><span class="lineno"> 1318</span>      <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno"> 1319</span>        <span class="comment">// row</span></div>
<div class="line"><span class="lineno"> 1320</span>        *nb_dofs[ss] += add_prb_ptr[ss]-&gt;back()-&gt;getNbDofsRow();</div>
<div class="line"><span class="lineno"> 1321</span>        *nb_local_dofs[ss] += add_prb_ptr[ss]-&gt;back()-&gt;getNbLocalDofsRow();</div>
<div class="line"><span class="lineno"> 1322</span>        nb_dofs_reserve[ss] +=</div>
<div class="line"><span class="lineno"> 1323</span>            add_prb_ptr[ss]-&gt;back()-&gt;numeredRowDofsPtr-&gt;size();</div>
<div class="line"><span class="lineno"> 1324</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1325</span>        <span class="comment">// column</span></div>
<div class="line"><span class="lineno"> 1326</span>        *nb_dofs[ss] += add_prb_ptr[ss]-&gt;back()-&gt;getNbDofsCol();</div>
<div class="line"><span class="lineno"> 1327</span>        *nb_local_dofs[ss] += add_prb_ptr[ss]-&gt;back()-&gt;getNbLocalDofsCol();</div>
<div class="line"><span class="lineno"> 1328</span>        nb_dofs_reserve[ss] +=</div>
<div class="line"><span class="lineno"> 1329</span>            add_prb_ptr[ss]-&gt;back()-&gt;numeredColDofsPtr-&gt;size();</div>
<div class="line"><span class="lineno"> 1330</span>      }</div>
<div class="line"><span class="lineno"> 1331</span>    }</div>
<div class="line"><span class="lineno"> 1332</span>  }</div>
<div class="line"><span class="lineno"> 1333</span>  <span class="comment">// if squre problem, rows and columns are the same</span></div>
<div class="line"><span class="lineno"> 1334</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1335</span>    add_prb_ptr[1]-&gt;reserve(add_prb_ptr[0]-&gt;size());</div>
<div class="line"><span class="lineno"> 1336</span>    add_prb_is[1]-&gt;reserve(add_prb_ptr[0]-&gt;size());</div>
<div class="line"><span class="lineno"> 1337</span>    out_problem_it-&gt;numeredColDofsPtr = out_problem_it-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno"> 1338</span>    *nb_dofs[1] = *nb_dofs[0];</div>
<div class="line"><span class="lineno"> 1339</span>    *nb_local_dofs[1] = *nb_local_dofs[0];</div>
<div class="line"><span class="lineno"> 1340</span>  }</div>
<div class="line"><span class="lineno"> 1341</span> </div>
<div class="line"><span class="lineno"> 1342</span>  <span class="comment">// reserve memory for dofs</span></div>
<div class="line"><span class="lineno"> 1343</span>  boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt; dofs_array[2];</div>
<div class="line"><span class="lineno"> 1344</span>  <span class="comment">// Reserve memory</span></div>
<div class="line"><span class="lineno"> 1345</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ss++) {</div>
<div class="line"><span class="lineno"> 1346</span>    dofs_array[ss] = boost::make_shared&lt;std::vector&lt;NumeredDofEntity&gt;&gt;();</div>
<div class="line"><span class="lineno"> 1347</span>    dofs_array[ss]-&gt;reserve(nb_dofs_reserve[ss]);</div>
<div class="line"><span class="lineno"> 1348</span>    <span class="keywordflow">if</span> (!ss)</div>
<div class="line"><span class="lineno"> 1349</span>      out_problem_it-&gt;getRowDofsSequence()-&gt;emplace_back(dofs_array[ss]);</div>
<div class="line"><span class="lineno"> 1350</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1351</span>      out_problem_it-&gt;getColDofsSequence()-&gt;emplace_back(dofs_array[ss]);</div>
<div class="line"><span class="lineno"> 1352</span>  }</div>
<div class="line"><span class="lineno"> 1353</span> </div>
<div class="line"><span class="lineno"> 1354</span>  <span class="comment">// Push back DOFs</span></div>
<div class="line"><span class="lineno"> 1355</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ss++) {</div>
<div class="line"><span class="lineno"> 1356</span>    NumeredDofEntity_multiIndex::index&lt;PetscGlobalIdx_mi_tag&gt;::type::iterator</div>
<div class="line"><span class="lineno"> 1357</span>        dit,</div>
<div class="line"><span class="lineno"> 1358</span>        hi_dit;</div>
<div class="line"><span class="lineno"> 1359</span>    <span class="keywordtype">int</span> shift_glob = 0;</div>
<div class="line"><span class="lineno"> 1360</span>    <span class="keywordtype">int</span> shift_loc = 0;</div>
<div class="line"><span class="lineno"> 1361</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pp = 0; pp != add_prb_ptr[ss]-&gt;size(); pp++) {</div>
<div class="line"><span class="lineno"> 1362</span>      PetscInt *dofs_out_idx_ptr;</div>
<div class="line"><span class="lineno"> 1363</span>      <span class="keywordtype">int</span> nb_local_dofs = (*add_prb_ptr[ss])[pp]-&gt;getNbLocalDofsRow();</div>
<div class="line"><span class="lineno"> 1364</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc(nb_local_dofs * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), &amp;dofs_out_idx_ptr);</div>
<div class="line"><span class="lineno"> 1365</span>      <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno"> 1366</span>        dit = (*add_prb_ptr[ss])[pp]</div>
<div class="line"><span class="lineno"> 1367</span>                  -&gt;numeredRowDofsPtr-&gt;get&lt;PetscGlobalIdx_mi_tag&gt;()</div>
<div class="line"><span class="lineno"> 1368</span>                  .begin();</div>
<div class="line"><span class="lineno"> 1369</span>        hi_dit = (*add_prb_ptr[ss])[pp]</div>
<div class="line"><span class="lineno"> 1370</span>                     -&gt;numeredRowDofsPtr-&gt;get&lt;PetscGlobalIdx_mi_tag&gt;()</div>
<div class="line"><span class="lineno"> 1371</span>                     .end();</div>
<div class="line"><span class="lineno"> 1372</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1373</span>        dit = (*add_prb_ptr[ss])[pp]</div>
<div class="line"><span class="lineno"> 1374</span>                  -&gt;numeredColDofsPtr-&gt;get&lt;PetscGlobalIdx_mi_tag&gt;()</div>
<div class="line"><span class="lineno"> 1375</span>                  .begin();</div>
<div class="line"><span class="lineno"> 1376</span>        hi_dit = (*add_prb_ptr[ss])[pp]</div>
<div class="line"><span class="lineno"> 1377</span>                     -&gt;numeredColDofsPtr-&gt;get&lt;PetscGlobalIdx_mi_tag&gt;()</div>
<div class="line"><span class="lineno"> 1378</span>                     .end();</div>
<div class="line"><span class="lineno"> 1379</span>      }</div>
<div class="line"><span class="lineno"> 1380</span>      <span class="keywordtype">int</span> is_nb = 0;</div>
<div class="line"><span class="lineno"> 1381</span>      <span class="keywordflow">for</span> (; dit != hi_dit; dit++) {</div>
<div class="line"><span class="lineno"> 1382</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_bit = out_problem_it-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno"> 1383</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_mask = out_problem_it-&gt;getBitRefLevelMask();</div>
<div class="line"><span class="lineno"> 1384</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;dof_bit = dit-&gt;get()-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno"> 1385</span>        <span class="keywordflow">if</span> ((dof_bit &amp; prb_bit).none() || ((dof_bit &amp; prb_mask) != dof_bit))</div>
<div class="line"><span class="lineno"> 1386</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1387</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> rank = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>();</div>
<div class="line"><span class="lineno"> 1388</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> part = dit-&gt;get()-&gt;getPart();</div>
<div class="line"><span class="lineno"> 1389</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> glob_idx = shift_glob + dit-&gt;get()-&gt;getPetscGlobalDofIdx();</div>
<div class="line"><span class="lineno"> 1390</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> loc_idx =</div>
<div class="line"><span class="lineno"> 1391</span>            (part == rank) ? (shift_loc + dit-&gt;get()-&gt;getPetscLocalDofIdx())</div>
<div class="line"><span class="lineno"> 1392</span>                           : -1;</div>
<div class="line"><span class="lineno"> 1393</span>        dofs_array[ss]-&gt;emplace_back(dit-&gt;get()-&gt;getDofEntityPtr(), glob_idx,</div>
<div class="line"><span class="lineno"> 1394</span>                                     glob_idx, loc_idx, part);</div>
<div class="line"><span class="lineno"> 1395</span>        <span class="keywordflow">if</span> (part == rank) {</div>
<div class="line"><span class="lineno"> 1396</span>          dofs_out_idx_ptr[is_nb++] = glob_idx;</div>
<div class="line"><span class="lineno"> 1397</span>        }</div>
<div class="line"><span class="lineno"> 1398</span>      }</div>
<div class="line"><span class="lineno"> 1399</span>      <span class="keywordflow">if</span> (is_nb &gt; nb_local_dofs) {</div>
<div class="line"><span class="lineno"> 1400</span>        SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1401</span>                <span class="stringliteral">&quot;Data inconsistency&quot;</span>);</div>
<div class="line"><span class="lineno"> 1402</span>      }</div>
<div class="line"><span class="lineno"> 1403</span>      IS is;</div>
<div class="line"><span class="lineno"> 1404</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISCreateGeneral(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), is_nb, dofs_out_idx_ptr,</div>
<div class="line"><span class="lineno"> 1405</span>                             PETSC_OWN_POINTER, &amp;is);</div>
<div class="line"><span class="lineno"> 1406</span>      <span class="keyword">auto</span> smart_is = SmartPetscObj&lt;IS&gt;(is);</div>
<div class="line"><span class="lineno"> 1407</span>      (*add_prb_is[ss]).push_back(smart_is);</div>
<div class="line"><span class="lineno"> 1408</span>      <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno"> 1409</span>        shift_glob += (*add_prb_ptr[ss])[pp]-&gt;getNbDofsRow();</div>
<div class="line"><span class="lineno"> 1410</span>        shift_loc += (*add_prb_ptr[ss])[pp]-&gt;getNbLocalDofsRow();</div>
<div class="line"><span class="lineno"> 1411</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1412</span>        shift_glob += (*add_prb_ptr[ss])[pp]-&gt;getNbDofsCol();</div>
<div class="line"><span class="lineno"> 1413</span>        shift_loc += (*add_prb_ptr[ss])[pp]-&gt;getNbLocalDofsCol();</div>
<div class="line"><span class="lineno"> 1414</span>      }</div>
<div class="line"><span class="lineno"> 1415</span>      <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1416</span>        (*add_prb_ptr[1]).push_back((*add_prb_ptr[0])[pp]);</div>
<div class="line"><span class="lineno"> 1417</span>        (*add_prb_is[1]).push_back(smart_is);</div>
<div class="line"><span class="lineno"> 1418</span>      }</div>
<div class="line"><span class="lineno"> 1419</span>    }</div>
<div class="line"><span class="lineno"> 1420</span>  }</div>
<div class="line"><span class="lineno"> 1421</span> </div>
<div class="line"><span class="lineno"> 1422</span>  <span class="keywordflow">if</span> ((*add_prb_is[1]).size() != (*add_prb_is[0]).size()) {</div>
<div class="line"><span class="lineno"> 1423</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;Data inconsistency&quot;</span>);</div>
<div class="line"><span class="lineno"> 1424</span>  }</div>
<div class="line"><span class="lineno"> 1425</span> </div>
<div class="line"><span class="lineno"> 1426</span>  <span class="comment">// Insert DOFs to problem multi-index</span></div>
<div class="line"><span class="lineno"> 1427</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ss++) {</div>
<div class="line"><span class="lineno"> 1428</span>    <span class="keyword">auto</span> hint = (ss == 0) ? out_problem_it-&gt;numeredRowDofsPtr-&gt;end()</div>
<div class="line"><span class="lineno"> 1429</span>                          : out_problem_it-&gt;numeredColDofsPtr-&gt;end();</div>
<div class="line"><span class="lineno"> 1430</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a> : *dofs_array[ss])</div>
<div class="line"><span class="lineno"> 1431</span>      hint = (ss == 0) ? out_problem_it-&gt;numeredRowDofsPtr-&gt;emplace_hint(</div>
<div class="line"><span class="lineno"> 1432</span>                             hint, dofs_array[ss], &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>)</div>
<div class="line"><span class="lineno"> 1433</span>                       : out_problem_it-&gt;numeredColDofsPtr-&gt;emplace_hint(</div>
<div class="line"><span class="lineno"> 1434</span>                             hint, dofs_array[ss], &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>);</div>
<div class="line"><span class="lineno"> 1435</span>  }</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>  <span class="comment">// Compress DOFs</span></div>
<div class="line"><span class="lineno"> 1438</span>  *nb_dofs[0] = 0;</div>
<div class="line"><span class="lineno"> 1439</span>  *nb_dofs[1] = 0;</div>
<div class="line"><span class="lineno"> 1440</span>  *nb_local_dofs[0] = 0;</div>
<div class="line"><span class="lineno"> 1441</span>  *nb_local_dofs[1] = 0;</div>
<div class="line"><span class="lineno"> 1442</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ss++) {</div>
<div class="line"><span class="lineno"> 1443</span> </div>
<div class="line"><span class="lineno"> 1444</span>    boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; dofs_ptr;</div>
<div class="line"><span class="lineno"> 1445</span>    <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno"> 1446</span>      dofs_ptr = out_problem_it-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno"> 1447</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1448</span>      dofs_ptr = out_problem_it-&gt;numeredColDofsPtr;</div>
<div class="line"><span class="lineno"> 1449</span>    }</div>
<div class="line"><span class="lineno"> 1450</span>    NumeredDofEntityByUId::iterator dit, hi_dit;</div>
<div class="line"><span class="lineno"> 1451</span>    dit = dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().begin();</div>
<div class="line"><span class="lineno"> 1452</span>    hi_dit = dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().end();</div>
<div class="line"><span class="lineno"> 1453</span>    std::vector&lt;int&gt; idx;</div>
<div class="line"><span class="lineno"> 1454</span>    idx.reserve(std::distance(dit, hi_dit));</div>
<div class="line"><span class="lineno"> 1455</span>    <span class="comment">// set dofs in order entity and dof number on entity</span></div>
<div class="line"><span class="lineno"> 1456</span>    <span class="keywordflow">for</span> (; dit != hi_dit; dit++) {</div>
<div class="line"><span class="lineno"> 1457</span>      <span class="keywordflow">if</span> (dit-&gt;get()-&gt;getPart() == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1458</span>        <span class="keywordtype">bool</span> success = dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().modify(</div>
<div class="line"><span class="lineno"> 1459</span>            dit, NumeredDofEntity_local_idx_change((*nb_local_dofs[ss])++));</div>
<div class="line"><span class="lineno"> 1460</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1461</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1462</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1463</span>        }</div>
<div class="line"><span class="lineno"> 1464</span>        idx.push_back(dit-&gt;get()-&gt;getPetscGlobalDofIdx());</div>
<div class="line"><span class="lineno"> 1465</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1466</span>        <span class="keywordflow">if</span> (dit-&gt;get()-&gt;getPetscLocalDofIdx() != -1) {</div>
<div class="line"><span class="lineno"> 1467</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1468</span>                  <span class="stringliteral">&quot;local index should be negative&quot;</span>);</div>
<div class="line"><span class="lineno"> 1469</span>        }</div>
<div class="line"><span class="lineno"> 1470</span>      }</div>
<div class="line"><span class="lineno"> 1471</span>    }</div>
<div class="line"><span class="lineno"> 1472</span>    <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1473</span>      *nb_local_dofs[1] = *nb_local_dofs[0];</div>
<div class="line"><span class="lineno"> 1474</span>    }</div>
<div class="line"><span class="lineno"> 1475</span> </div>
<div class="line"><span class="lineno"> 1476</span>    <span class="comment">// set new dofs mapping</span></div>
<div class="line"><span class="lineno"> 1477</span>    IS is;</div>
<div class="line"><span class="lineno"> 1478</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISCreateGeneral(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), idx.size(), &amp;*idx.begin(),</div>
<div class="line"><span class="lineno"> 1479</span>                           PETSC_USE_POINTER, &amp;is);</div>
<div class="line"><span class="lineno"> 1480</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetSize(is, nb_dofs[ss]);</div>
<div class="line"><span class="lineno"> 1481</span>    <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1482</span>      *nb_dofs[1] = *nb_dofs[0];</div>
<div class="line"><span class="lineno"> 1483</span>    }</div>
<div class="line"><span class="lineno"> 1484</span> </div>
<div class="line"><span class="lineno"> 1485</span>    AO ao;</div>
<div class="line"><span class="lineno"> 1486</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOCreateMappingIS(is, PETSC_NULLPTR, &amp;ao);</div>
<div class="line"><span class="lineno"> 1487</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pp = 0; pp != (*add_prb_is[ss]).size(); pp++)</div>
<div class="line"><span class="lineno"> 1488</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOApplicationToPetscIS(ao, (*add_prb_is[ss])[pp]);</div>
<div class="line"><span class="lineno"> 1489</span> </div>
<div class="line"><span class="lineno"> 1490</span>    <span class="comment">// Set DOFs numeration</span></div>
<div class="line"><span class="lineno"> 1491</span>    {</div>
<div class="line"><span class="lineno"> 1492</span>      std::vector&lt;int&gt; idx_new;</div>
<div class="line"><span class="lineno"> 1493</span>      idx_new.reserve(dofs_ptr-&gt;size());</div>
<div class="line"><span class="lineno"> 1494</span>      <span class="keywordflow">for</span> (NumeredDofEntityByUId::iterator dit =</div>
<div class="line"><span class="lineno"> 1495</span>               dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().begin();</div>
<div class="line"><span class="lineno"> 1496</span>           dit != dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().end(); dit++) {</div>
<div class="line"><span class="lineno"> 1497</span>        idx_new.push_back(dit-&gt;get()-&gt;getPetscGlobalDofIdx());</div>
<div class="line"><span class="lineno"> 1498</span>      }</div>
<div class="line"><span class="lineno"> 1499</span>      <span class="comment">// set new global dofs numeration</span></div>
<div class="line"><span class="lineno"> 1500</span>      IS is_new;</div>
<div class="line"><span class="lineno"> 1501</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISCreateGeneral(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), idx_new.size(),</div>
<div class="line"><span class="lineno"> 1502</span>                             &amp;*idx_new.begin(), PETSC_USE_POINTER, &amp;is_new);</div>
<div class="line"><span class="lineno"> 1503</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOApplicationToPetscIS(ao, is_new);</div>
<div class="line"><span class="lineno"> 1504</span>      <span class="comment">// set global indices to multi-index</span></div>
<div class="line"><span class="lineno"> 1505</span>      std::vector&lt;int&gt;::iterator vit = idx_new.begin();</div>
<div class="line"><span class="lineno"> 1506</span>      <span class="keywordflow">for</span> (NumeredDofEntityByUId::iterator dit =</div>
<div class="line"><span class="lineno"> 1507</span>               dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().begin();</div>
<div class="line"><span class="lineno"> 1508</span>           dit != dofs_ptr-&gt;get&lt;Unique_mi_tag&gt;().end(); dit++) {</div>
<div class="line"><span class="lineno"> 1509</span>        <span class="keywordtype">bool</span> success =</div>
<div class="line"><span class="lineno"> 1510</span>            dofs_ptr-&gt;modify(dit, NumeredDofEntity_part_and_glob_idx_change(</div>
<div class="line"><span class="lineno"> 1511</span>                                      dit-&gt;get()-&gt;getPart(), *(vit++)));</div>
<div class="line"><span class="lineno"> 1512</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1513</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1514</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1515</span>        }</div>
<div class="line"><span class="lineno"> 1516</span>      }</div>
<div class="line"><span class="lineno"> 1517</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_new);</div>
<div class="line"><span class="lineno"> 1518</span>    }</div>
<div class="line"><span class="lineno"> 1519</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is);</div>
<div class="line"><span class="lineno"> 1520</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AODestroy(&amp;ao);</div>
<div class="line"><span class="lineno"> 1521</span>  }</div>
<div class="line"><span class="lineno"> 1522</span> </div>
<div class="line"><span class="lineno"> 1523</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(&amp;*out_problem_it, verb);</div>
<div class="line"><span class="lineno"> 1524</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#ae1931e8cb3ddacb79ed9f2dafb15b82d">debugPartitionedProblem</a>(&amp;*out_problem_it, verb);</div>
<div class="line"><span class="lineno"> 1525</span> </div>
<div class="line"><span class="lineno"> 1526</span>  <span class="comment">// Inidcate that porble has been build</span></div>
<div class="line"><span class="lineno"> 1527</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>;</div>
<div class="line"><span class="lineno"> 1528</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>;</div>
<div class="line"><span class="lineno"> 1529</span> </div>
<div class="line"><span class="lineno"> 1530</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1531</span>}</div>
<div class="ttc" id="aProblemsManager_8cpp_html_a7b48fee6ededa6018fb84bef11790d4f"><div class="ttname"><a href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a></div><div class="ttdeci">#define ProblemManagerFunctionBegin</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l00008">ProblemsManager.cpp:8</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a></div><div class="ttdeci">@ MOFEM_OPERATION_UNSUCCESSFUL</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00034">definitions.h:34</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a></div><div class="ttdeci">@ MOFEM_DATA_INCONSISTENCY</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00031">definitions.h:31</a></div></div>
<div class="ttc" id="adefinitions_8h_html_acb0a46d159695a01bf667313b7788b45"><div class="ttname"><a href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a></div><div class="ttdeci">#define MoFEMFunctionReturn(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00432">definitions.h:432</a></div></div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00551">definitions.h:551</a></div></div>
<div class="ttc" id="agroup__mofem__access_html_gaad7cab6ce659fc4b4b74269228b739ae"><div class="ttname"><a href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">MoFEM::CoreInterface::get_problems</a></div><div class="ttdeci">virtual const Problem_multiIndex * get_problems() const =0</div><div class="ttdoc">Get the problems object.</div></div>
<div class="ttc" id="agroup__mofem__problems_html_ga97e18d7ea29369f0572f4c6cd3e3eeb5"><div class="ttname"><a href="group__mofem__problems.html#ga97e18d7ea29369f0572f4c6cd3e3eeb5">MoFEM::CoreInterface::clear_problem</a></div><div class="ttdeci">virtual MoFEMErrorCode clear_problem(const std::string name, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">clear problem</div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_af16c6805bd7f1a6a9acfe503216a5555"><div class="ttname"><a href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a></div><div class="ttdeci">const double v</div><div class="ttdoc">phase velocity of light in medium (cm/ns)</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00040">initial_diffusion.cpp:40</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Types_html_aa9495b406c5326b7bca937846ec421c5"><div class="ttname"><a href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">MoFEM::Types::BitRefLevel</a></div><div class="ttdeci">std::bitset&lt; BITREFLEVEL_SIZE &gt; BitRefLevel</div><div class="ttdoc">Bit structure attached to each entity identifying to what mesh entity is attached.</div><div class="ttdef"><b>Definition</b> <a href="Types_8hpp_source.html#l00040">Types.hpp:40</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_a9b2bc8c1b980f49d31a0b5f7fbe756f5"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">MoFEM::CoreInterface::get_comm</a></div><div class="ttdeci">virtual MPI_Comm &amp; get_comm() const =0</div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_af2224ce77b33637b5cfad66a275a2ffb"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">MoFEM::CoreInterface::get_comm_rank</a></div><div class="ttdeci">virtual int get_comm_rank() const =0</div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_a3e25c681e21c731b027a97acdd89cf62"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">MoFEM::CoreTmp&lt; 0 &gt;::getBuildMoFEM</a></div><div class="ttdeci">int &amp; getBuildMoFEM() const</div><div class="ttdoc">Get flags/semaphores for different stages.</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00225">Core.hpp:225</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a">MoFEM::CoreTmp&lt; 0 &gt;::BUILD_FE</a></div><div class="ttdeci">@ BUILD_FE</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00213">Core.hpp:213</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">MoFEM::CoreTmp&lt; 0 &gt;::PARTITION_PROBLEM</a></div><div class="ttdeci">@ PARTITION_PROBLEM</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00216">Core.hpp:216</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2">MoFEM::CoreTmp&lt; 0 &gt;::BUILD_FIELD</a></div><div class="ttdeci">@ BUILD_FIELD</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00212">Core.hpp:212</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">MoFEM::CoreTmp&lt; 0 &gt;::BUILD_PROBLEM</a></div><div class="ttdeci">@ BUILD_PROBLEM</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00215">Core.hpp:215</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c">MoFEM::CoreTmp&lt; 0 &gt;::BUILD_ADJ</a></div><div class="ttdeci">@ BUILD_ADJ</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00214">Core.hpp:214</a></div></div>
<div class="ttc" id="astructMoFEM_1_1DeprecatedCoreInterface_html"><div class="ttname"><a href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition</b> <a href="DeprecatedCoreInterface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_a22e7fc80dfe26f76571f97b47c1b624b"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">MoFEM::ProblemsManager::printPartitionedProblem</a></div><div class="ttdeci">MoFEMErrorCode printPartitionedProblem(const Problem *problem_ptr, int verb=VERBOSE)</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l02061">ProblemsManager.cpp:2061</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_ab753c3a0d74f180acd6380b6fd0b4d35"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">MoFEM::ProblemsManager::cOre</a></div><div class="ttdeci">MoFEM::Core &amp; cOre</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8hpp_source.html#l00026">ProblemsManager.hpp:26</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_ae1931e8cb3ddacb79ed9f2dafb15b82d"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#ae1931e8cb3ddacb79ed9f2dafb15b82d">MoFEM::ProblemsManager::debugPartitionedProblem</a></div><div class="ttdeci">MoFEMErrorCode debugPartitionedProblem(const Problem *problem_ptr, int verb=VERBOSE)</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l02080">ProblemsManager.cpp:2080</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga98070af58a9cd97f9202c6488698ba96" name="ga98070af58a9cd97f9202c6488698ba96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga98070af58a9cd97f9202c6488698ba96">&#9670;&#160;</a></span>buildProblem() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildProblem </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build problem data structures </p>
<dl class="section note"><dt>Note</dt><dd>If square_matrix is set to true, that indicate that problem is structurally symmetric, i.e. rows and columns have the same dofs and are indexed in the same way.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
    <tr><td class="paramname">square_matrix</td><td>structurally symmetric problem </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error code </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="build_problems_8cpp-example.html#a29">build_problems.cpp</a>, <a class="el" href="continuity_check_on_contact_prism_side_ele_8cpp-example.html#a42">continuity_check_on_contact_prism_side_ele.cpp</a>, <a class="el" href="continuity_check_on_skeleton_3d_8cpp-example.html#a32">continuity_check_on_skeleton_3d.cpp</a>, <a class="el" href="forces_and_sources_testing_edge_element_8cpp-example.html#a36">forces_and_sources_testing_edge_element.cpp</a>, <a class="el" href="forces_and_sources_testing_flat_prism_element_8cpp-example.html#a40">forces_and_sources_testing_flat_prism_element.cpp</a>, <a class="el" href="hcurl_divergence_operator_2d_8cpp-example.html#a60">hcurl_divergence_operator_2d.cpp</a>, <a class="el" href="mesh_insert_interface_atom_8cpp-example.html#a38">mesh_insert_interface_atom.cpp</a>, <a class="el" href="prism_elements_from_surface_8cpp-example.html#a93">prism_elements_from_surface.cpp</a>, <a class="el" href="prism_polynomial_approximation_8cpp-example.html#a57">prism_polynomial_approximation.cpp</a>, <a class="el" href="quad_polynomial_approximation_8cpp-example.html#a54">quad_polynomial_approximation.cpp</a>, and <a class="el" href="remove_entities_from_problem_not_partitioned_8cpp-example.html#a31">remove_entities_from_problem_not_partitioned.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00086">86</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   88</span>                                                       {</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno">   91</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 0)))</div>
<div class="line"><span class="lineno">   93</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno">   94</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 1)))</div>
<div class="line"><span class="lineno">   95</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno">   96</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 2)))</div>
<div class="line"><span class="lineno">   97</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno">   98</span>  <span class="keyword">const</span> Problem *problem_ptr;</div>
<div class="line"><span class="lineno">   99</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">get_problem</a>(name, &amp;problem_ptr);</div>
<div class="line"><span class="lineno">  100</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__mofem__problems__manager.html#ga98070af58a9cd97f9202c6488698ba96">buildProblem</a>(<span class="keyword">const_cast&lt;</span>Problem *<span class="keyword">&gt;</span>(problem_ptr), square_matrix, verb);</div>
<div class="line"><span class="lineno">  101</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= 1 &lt;&lt; 3; <span class="comment">// It is assumed that user who uses this</span></div>
<div class="line"><span class="lineno">  102</span>                                  <span class="comment">// function knows what he is doing</span></div>
<div class="line"><span class="lineno">  103</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno">  104</span>}</div>
<div class="ttc" id="agroup__mofem__access_html_ga311e33eaba451897a151813e8ea6fae4"><div class="ttname"><a href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">MoFEM::CoreInterface::get_problem</a></div><div class="ttdeci">virtual const Problem * get_problem(const std::string problem_name) const =0</div><div class="ttdoc">Get the problem object.</div></div>
<div class="ttc" id="agroup__mofem__problems__manager_html_ga98070af58a9cd97f9202c6488698ba96"><div class="ttname"><a href="group__mofem__problems__manager.html#ga98070af58a9cd97f9202c6488698ba96">MoFEM::ProblemsManager::buildProblem</a></div><div class="ttdeci">MoFEMErrorCode buildProblem(const std::string name, const bool square_matrix, int verb=VERBOSE)</div><div class="ttdoc">build problem data structures</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l00086">ProblemsManager.cpp:86</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gad7902c9b0fa2d8d492bebfd40841f9c5" name="gad7902c9b0fa2d8d492bebfd40841f9c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad7902c9b0fa2d8d492bebfd40841f9c5">&#9670;&#160;</a></span>buildProblem() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildProblem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMoFEM_1_1Problem.html">Problem</a> *&#160;</td>
          <td class="paramname"><em>problem_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build problem data structures </p>
<dl class="section note"><dt>Note</dt><dd>If square_matrix is set to true, that indicate that problem is structurally symmetric, i.e. rows and columns have the same dofs and are indexed in the same way.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">problem</td><td>pointer </td></tr>
    <tr><td class="paramname">square_matrix</td><td>structurally symmetric problem </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00106">106</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  108</span>                                                       {</div>
<div class="line"><span class="lineno">  109</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno">  110</span>  <span class="keyword">auto</span> dofs_field_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga7fc3e2d994adf8ef767f674ee3d76493">get_dofs</a>();</div>
<div class="line"><span class="lineno">  111</span>  <span class="keyword">auto</span> ents_field_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga33e7aeb086f44048bde7151fd8634ab2">get_field_ents</a>();</div>
<div class="line"><span class="lineno">  112</span>  <span class="keyword">auto</span> adjacencies_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga3a98e531acd5841b846d71891e4945e5">get_ents_elements_adjacency</a>();</div>
<div class="line"><span class="lineno">  113</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno">  114</span>  PetscLogEventBegin(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a56028dc495690ec5e028feb66809ccde">MOFEM_EVENT_ProblemsManager</a>, 0, 0, 0, 0);</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>  <span class="comment">// Note: Only allowed changes on problem_ptr structure which not influence</span></div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// multi-index.</span></div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>  <span class="keywordflow">if</span> (problem_ptr-&gt;getBitRefLevel().none()) {</div>
<div class="line"><span class="lineno">  120</span>    SETERRQ(PETSC_COMM_SELF, 1, <span class="stringliteral">&quot;problem &lt;%s&gt; refinement level not set&quot;</span>,</div>
<div class="line"><span class="lineno">  121</span>             problem_ptr-&gt;getName().c_str());</div>
<div class="line"><span class="lineno">  122</span>  }</div>
<div class="line"><span class="lineno">  123</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__problems.html#ga97e18d7ea29369f0572f4c6cd3e3eeb5">clear_problem</a>(problem_ptr-&gt;getName());</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>  <span class="comment">// zero finite elements</span></div>
<div class="line"><span class="lineno">  126</span>  problem_ptr-&gt;numeredFiniteElementsPtr-&gt;clear();</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>  <a class="code hl_typedef" href="group__dof__multi__indices.html#ga21e1e304d4db4069d36ac96861c1472c">DofEntity_multiIndex_active_view</a> dofs_rows, dofs_cols;</div>
<div class="line"><span class="lineno">  129</span>  <span class="keyword">auto</span> make_rows_and_cols_view = [&amp;](<span class="keyword">auto</span> &amp;dofs_rows, <span class="keyword">auto</span> &amp;dofs_cols) {</div>
<div class="line"><span class="lineno">  130</span>    <a class="code hl_define" href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a>;</div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = ents_field_ptr-&gt;begin(); it != ents_field_ptr-&gt;end(); ++it) {</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>      <span class="keyword">const</span> <span class="keyword">auto</span> uid = (*it)-&gt;getLocalUniqueId();</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>      <span class="keyword">auto</span> <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a> = adjacencies_ptr-&gt;get&lt;Unique_mi_tag&gt;().equal_range(uid);</div>
<div class="line"><span class="lineno">  136</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> lo = <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first; lo != <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.second; ++lo) {</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>        <span class="keywordflow">if</span> ((lo-&gt;getBitFEId() &amp; problem_ptr-&gt;getBitFEId()).any()) {</div>
<div class="line"><span class="lineno">  139</span>          std::array&lt;bool, 2&gt; row_col = {<span class="keyword">false</span>, <span class="keyword">false</span>};</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_bit = problem_ptr-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno">  142</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_mask = problem_ptr-&gt;getBitRefLevelMask();</div>
<div class="line"><span class="lineno">  143</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;fe_bit = lo-&gt;entFePtr-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span>          <span class="comment">// if entity is not problem refinement level</span></div>
<div class="line"><span class="lineno">  146</span>          <span class="keywordflow">if</span> ((fe_bit &amp; prb_mask) != fe_bit)</div>
<div class="line"><span class="lineno">  147</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  148</span>          <span class="keywordflow">if</span> ((fe_bit &amp; prb_bit).none())</div>
<div class="line"><span class="lineno">  149</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>          <span class="keyword">auto</span> add_to_view = [&amp;](<span class="keyword">auto</span> &amp;nb_dofs, <span class="keyword">auto</span> &amp;view, <span class="keyword">auto</span> rc) {</div>
<div class="line"><span class="lineno">  152</span>            <span class="keyword">auto</span> dit = nb_dofs-&gt;lower_bound(uid);</div>
<div class="line"><span class="lineno">  153</span>            <span class="keyword">decltype</span>(dit) hi_dit;</div>
<div class="line"><span class="lineno">  154</span>            <span class="keywordflow">if</span> (dit != nb_dofs-&gt;end()) {</div>
<div class="line"><span class="lineno">  155</span>              hi_dit = nb_dofs-&gt;upper_bound(</div>
<div class="line"><span class="lineno">  156</span>                  uid | <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a6e2e24dfdf43940a5a3d7c72a975b289">UId</a><span class="keyword">&gt;</span>(<a class="code hl_define" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a> - 1));</div>
<div class="line"><span class="lineno">  157</span>              view.insert(dit, hi_dit);</div>
<div class="line"><span class="lineno">  158</span>              row_col[rc] = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  159</span>            }</div>
<div class="line"><span class="lineno">  160</span>          };</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>          <span class="keywordflow">if</span> ((lo-&gt;entFePtr-&gt;getBitFieldIdRow() &amp; (*it)-&gt;getId()).any())</div>
<div class="line"><span class="lineno">  163</span>            add_to_view(dofs_field_ptr, dofs_rows, <a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>);</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>          <span class="keywordflow">if</span> (!square_matrix)</div>
<div class="line"><span class="lineno">  166</span>            <span class="keywordflow">if</span> ((lo-&gt;entFePtr-&gt;getBitFieldIdCol() &amp; (*it)-&gt;getId()).any())</div>
<div class="line"><span class="lineno">  167</span>              add_to_view(dofs_field_ptr, dofs_cols, <a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda">COL</a>);</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>          <span class="keywordflow">if</span> (square_matrix &amp;&amp; row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>])</div>
<div class="line"><span class="lineno">  170</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  171</span>          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>] &amp;&amp; row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda">COL</a>])</div>
<div class="line"><span class="lineno">  172</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  173</span>        }</div>
<div class="line"><span class="lineno">  174</span>      }</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span>    <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"><span class="lineno">  177</span>  };</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> make_rows_and_cols_view(dofs_rows, dofs_cols);</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">// Add row dofs to problem</span></div>
<div class="line"><span class="lineno">  182</span>  {</div>
<div class="line"><span class="lineno">  183</span>    <span class="comment">// zero rows</span></div>
<div class="line"><span class="lineno">  184</span>    problem_ptr-&gt;nbDofsRow = 0;</div>
<div class="line"><span class="lineno">  185</span>    problem_ptr-&gt;nbLocDofsRow = 0;</div>
<div class="line"><span class="lineno">  186</span>    problem_ptr-&gt;nbGhostDofsRow = 0;</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>    <span class="comment">// add dofs for rows</span></div>
<div class="line"><span class="lineno">  189</span>    DofEntity_multiIndex_active_view::nth_index&lt;0&gt;::type::iterator miit,</div>
<div class="line"><span class="lineno">  190</span>        hi_miit;</div>
<div class="line"><span class="lineno">  191</span>    hi_miit = dofs_rows.get&lt;0&gt;().end();</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="keywordtype">int</span> count_dofs = dofs_rows.get&lt;1&gt;().count(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  194</span>    boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt; dofs_array =</div>
<div class="line"><span class="lineno">  195</span>        boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt;(</div>
<div class="line"><span class="lineno">  196</span>            <span class="keyword">new</span> std::vector&lt;NumeredDofEntity&gt;());</div>
<div class="line"><span class="lineno">  197</span>    problem_ptr-&gt;getRowDofsSequence()-&gt;push_back(dofs_array);</div>
<div class="line"><span class="lineno">  198</span>    dofs_array-&gt;reserve(count_dofs);</div>
<div class="line"><span class="lineno">  199</span>    miit = dofs_rows.get&lt;0&gt;().begin();</div>
<div class="line"><span class="lineno">  200</span>    <span class="keywordflow">for</span> (; miit != hi_miit; miit++) {</div>
<div class="line"><span class="lineno">  201</span>      <span class="keywordflow">if</span> ((*miit)-&gt;getActive()) {</div>
<div class="line"><span class="lineno">  202</span>        dofs_array-&gt;emplace_back(*miit);</div>
<div class="line"><span class="lineno">  203</span>        dofs_array-&gt;back().dofIdx = (problem_ptr-&gt;nbDofsRow)++;</div>
<div class="line"><span class="lineno">  204</span>      }</div>
<div class="line"><span class="lineno">  205</span>    }</div>
<div class="line"><span class="lineno">  206</span>    <span class="keyword">auto</span> hint = problem_ptr-&gt;numeredRowDofsPtr-&gt;end();</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a> : *dofs_array) {</div>
<div class="line"><span class="lineno">  208</span>      hint = problem_ptr-&gt;numeredRowDofsPtr-&gt;emplace_hint(hint, dofs_array, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>);</div>
<div class="line"><span class="lineno">  209</span>    }</div>
<div class="line"><span class="lineno">  210</span>  }</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>  <span class="comment">// Add col dofs to problem</span></div>
<div class="line"><span class="lineno">  213</span>  <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno">  214</span>    <span class="comment">// zero cols</span></div>
<div class="line"><span class="lineno">  215</span>    problem_ptr-&gt;nbDofsCol = 0;</div>
<div class="line"><span class="lineno">  216</span>    problem_ptr-&gt;nbLocDofsCol = 0;</div>
<div class="line"><span class="lineno">  217</span>    problem_ptr-&gt;nbGhostDofsCol = 0;</div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>    <span class="comment">// add dofs for cols</span></div>
<div class="line"><span class="lineno">  220</span>    DofEntity_multiIndex_active_view::nth_index&lt;0&gt;::type::iterator miit,</div>
<div class="line"><span class="lineno">  221</span>        hi_miit;</div>
<div class="line"><span class="lineno">  222</span>    hi_miit = dofs_cols.get&lt;0&gt;().end();</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>    <span class="keywordtype">int</span> count_dofs = 0;</div>
<div class="line"><span class="lineno">  225</span>    miit = dofs_cols.get&lt;0&gt;().begin();</div>
<div class="line"><span class="lineno">  226</span>    <span class="keywordflow">for</span> (; miit != hi_miit; miit++) {</div>
<div class="line"><span class="lineno">  227</span>      <span class="keywordflow">if</span> (!(*miit)-&gt;getActive()) {</div>
<div class="line"><span class="lineno">  228</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  229</span>      }</div>
<div class="line"><span class="lineno">  230</span>      count_dofs++;</div>
<div class="line"><span class="lineno">  231</span>    }</div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>    boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt; dofs_array =</div>
<div class="line"><span class="lineno">  234</span>        boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt;(</div>
<div class="line"><span class="lineno">  235</span>            <span class="keyword">new</span> std::vector&lt;NumeredDofEntity&gt;());</div>
<div class="line"><span class="lineno">  236</span>    problem_ptr-&gt;getColDofsSequence()-&gt;push_back(dofs_array);</div>
<div class="line"><span class="lineno">  237</span>    dofs_array-&gt;reserve(count_dofs);</div>
<div class="line"><span class="lineno">  238</span>    miit = dofs_cols.get&lt;0&gt;().begin();</div>
<div class="line"><span class="lineno">  239</span>    <span class="keywordflow">for</span> (; miit != hi_miit; miit++) {</div>
<div class="line"><span class="lineno">  240</span>      <span class="keywordflow">if</span> (!(*miit)-&gt;getActive()) {</div>
<div class="line"><span class="lineno">  241</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  242</span>      }</div>
<div class="line"><span class="lineno">  243</span>      dofs_array-&gt;emplace_back(*miit);</div>
<div class="line"><span class="lineno">  244</span>      dofs_array-&gt;back().dofIdx = problem_ptr-&gt;nbDofsCol++;</div>
<div class="line"><span class="lineno">  245</span>    }</div>
<div class="line"><span class="lineno">  246</span>    <span class="keyword">auto</span> hint = problem_ptr-&gt;numeredColDofsPtr-&gt;end();</div>
<div class="line"><span class="lineno">  247</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a> : *dofs_array) {</div>
<div class="line"><span class="lineno">  248</span>      hint = problem_ptr-&gt;numeredColDofsPtr-&gt;emplace_hint(hint, dofs_array, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>);</div>
<div class="line"><span class="lineno">  249</span>    }</div>
<div class="line"><span class="lineno">  250</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  251</span>    problem_ptr-&gt;numeredColDofsPtr = problem_ptr-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno">  252</span>    problem_ptr-&gt;nbLocDofsCol = problem_ptr-&gt;nbLocDofsRow;</div>
<div class="line"><span class="lineno">  253</span>    problem_ptr-&gt;nbDofsCol = problem_ptr-&gt;nbDofsRow;</div>
<div class="line"><span class="lineno">  254</span>  }</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>  <span class="comment">// job done, some debugging and postprocessing</span></div>
<div class="line"><span class="lineno">  257</span>  <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>) {</div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::verbose)</div>
<div class="line"><span class="lineno">  259</span>        &lt;&lt; problem_ptr-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; Nb. local dofs &quot;</span></div>
<div class="line"><span class="lineno">  260</span>        &lt;&lt; problem_ptr-&gt;numeredRowDofsPtr-&gt;size() &lt;&lt; <span class="stringliteral">&quot; by &quot;</span></div>
<div class="line"><span class="lineno">  261</span>        &lt;&lt; problem_ptr-&gt;numeredColDofsPtr-&gt;size();</div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_define" href="LogManager_8hpp.html#a3b22f6000e678d07d69a2c790177a352">MOFEM_LOG_SEVERITY_SYNC</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), Sev::verbose);</div>
<div class="line"><span class="lineno">  263</span>  }</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>  <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2caa4fc5b9204f57a31e594e32c02d071e9">NOISY</a>) {</div>
<div class="line"><span class="lineno">  266</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::noisy)</div>
<div class="line"><span class="lineno">  267</span>        &lt;&lt; <span class="stringliteral">&quot;FEs row dofs &quot;</span> &lt;&lt; *problem_ptr &lt;&lt; <span class="stringliteral">&quot; Nb. row dof &quot;</span></div>
<div class="line"><span class="lineno">  268</span>        &lt;&lt; problem_ptr-&gt;getNbDofsRow();</div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;miit : *problem_ptr-&gt;numeredRowDofsPtr)</div>
<div class="line"><span class="lineno">  270</span>      <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, <a class="code hl_typedef" href="namespaceMoFEM.html#ab4d38dd36deb3c8334737f3526dfbf35">Sev</a>::noisy) &lt;&lt; *miit;</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::noisy)</div>
<div class="line"><span class="lineno">  273</span>        &lt;&lt; <span class="stringliteral">&quot;FEs col dofs &quot;</span> &lt;&lt; *problem_ptr &lt;&lt; <span class="stringliteral">&quot; Nb. col dof &quot;</span></div>
<div class="line"><span class="lineno">  274</span>        &lt;&lt; problem_ptr-&gt;getNbDofsCol();</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;miit : *problem_ptr-&gt;numeredColDofsPtr)</div>
<div class="line"><span class="lineno">  276</span>      <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, <a class="code hl_typedef" href="namespaceMoFEM.html#ab4d38dd36deb3c8334737f3526dfbf35">Sev</a>::noisy) &lt;&lt; *miit;</div>
<div class="line"><span class="lineno">  277</span>    <a class="code hl_define" href="LogManager_8hpp.html#a3b22f6000e678d07d69a2c790177a352">MOFEM_LOG_SEVERITY_SYNC</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), Sev::noisy);</div>
<div class="line"><span class="lineno">  278</span>  }</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>; <span class="comment">// It is assumed that user who</span></div>
<div class="line"><span class="lineno">  281</span>                                               <span class="comment">// uses this function knows</span></div>
<div class="line"><span class="lineno">  282</span>                                               <span class="comment">// what he is doing</span></div>
<div class="line"><span class="lineno">  283</span> </div>
<div class="line"><span class="lineno">  284</span>  PetscLogEventEnd(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a56028dc495690ec5e028feb66809ccde">MOFEM_EVENT_ProblemsManager</a>, 0, 0, 0, 0);</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno">  287</span>}</div>
<div class="ttc" id="aLogManager_8hpp_html_a3b22f6000e678d07d69a2c790177a352"><div class="ttname"><a href="LogManager_8hpp.html#a3b22f6000e678d07d69a2c790177a352">MOFEM_LOG_SEVERITY_SYNC</a></div><div class="ttdeci">#define MOFEM_LOG_SEVERITY_SYNC(comm, severity)</div><div class="ttdoc">Synchronise &quot;SYNC&quot; on curtain severity level.</div><div class="ttdef"><b>Definition</b> <a href="LogManager_8hpp_source.html#l00360">LogManager.hpp:360</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a018e38d630e7ebef4cfa48ab69889f2caa4fc5b9204f57a31e594e32c02d071e9"><div class="ttname"><a href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2caa4fc5b9204f57a31e594e32c02d071e9">NOISY</a></div><div class="ttdeci">@ NOISY</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00224">definitions.h:224</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601"><div class="ttname"><a href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></div><div class="ttdeci">@ VERBOSE</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00222">definitions.h:222</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda"><div class="ttname"><a href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda">COL</a></div><div class="ttdeci">@ COL</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00136">definitions.h:136</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0"><div class="ttname"><a href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a></div><div class="ttdeci">@ ROW</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00136">definitions.h:136</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2d9985594995d39619ace246858c70b5"><div class="ttname"><a href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a></div><div class="ttdeci">#define MAX_DOFS_ON_ENTITY</div><div class="ttdoc">Maximal number of DOFs on entity.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00249">definitions.h:249</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a59cd650c2f6d3e0dc1ad1c29821e8692"><div class="ttname"><a href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a></div><div class="ttdeci">#define MoFEMFunctionReturnHot(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00463">definitions.h:463</a></div></div>
<div class="ttc" id="adefinitions_8h_html_aee32377dce975c9a64ed73bd3a003404"><div class="ttname"><a href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a></div><div class="ttdeci">#define MoFEMFunctionBeginHot</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00456">definitions.h:456</a></div></div>
<div class="ttc" id="agroup__dof__multi__indices_html_ga21e1e304d4db4069d36ac96861c1472c"><div class="ttname"><a href="group__dof__multi__indices.html#ga21e1e304d4db4069d36ac96861c1472c">MoFEM::DofEntity_multiIndex_active_view</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; DofEntity &gt;, indexed_by&lt; ordered_unique&lt; const_mem_fun&lt; DofEntity, UId, &amp;DofEntity::getLocalUniqueId &gt; &gt;, ordered_non_unique&lt; const_mem_fun&lt; DofEntity, char, &amp;DofEntity::getActive &gt; &gt; &gt; &gt; DofEntity_multiIndex_active_view</div><div class="ttdoc">multi-index view on DofEntity activity</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00370">DofsMultiIndices.hpp:370</a></div></div>
<div class="ttc" id="agroup__mofem__access_html_ga33e7aeb086f44048bde7151fd8634ab2"><div class="ttname"><a href="group__mofem__access.html#ga33e7aeb086f44048bde7151fd8634ab2">MoFEM::CoreInterface::get_field_ents</a></div><div class="ttdeci">virtual const FieldEntity_multiIndex * get_field_ents() const =0</div><div class="ttdoc">Get the field ents object.</div></div>
<div class="ttc" id="agroup__mofem__access_html_ga3a98e531acd5841b846d71891e4945e5"><div class="ttname"><a href="group__mofem__access.html#ga3a98e531acd5841b846d71891e4945e5">MoFEM::CoreInterface::get_ents_elements_adjacency</a></div><div class="ttdeci">virtual MoFEMErrorCode get_ents_elements_adjacency(const FieldEntityEntFiniteElementAdjacencyMap_multiIndex **dofs_elements_adjacency) const =0</div><div class="ttdoc">Get the dofs elements adjacency object.</div></div>
<div class="ttc" id="agroup__mofem__access_html_ga7fc3e2d994adf8ef767f674ee3d76493"><div class="ttname"><a href="group__mofem__access.html#ga7fc3e2d994adf8ef767f674ee3d76493">MoFEM::CoreInterface::get_dofs</a></div><div class="ttdeci">virtual const DofEntity_multiIndex * get_dofs() const =0</div><div class="ttdoc">Get the dofs object.</div></div>
<div class="ttc" id="agroup__mofem__log__manager_html_ga19fe81dc9081ceb92ced847e619ca654"><div class="ttname"><a href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a></div><div class="ttdeci">#define MOFEM_LOG(channel, severity)</div><div class="ttdoc">Log.</div><div class="ttdef"><b>Definition</b> <a href="LogManager_8hpp_source.html#l00316">LogManager.hpp:316</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Types_html_a6e2e24dfdf43940a5a3d7c72a975b289"><div class="ttname"><a href="namespaceMoFEM_1_1Types.html#a6e2e24dfdf43940a5a3d7c72a975b289">MoFEM::Types::UId</a></div><div class="ttdeci">uint128_t UId</div><div class="ttdoc">Unique Id.</div><div class="ttdef"><b>Definition</b> <a href="Types_8hpp_source.html#l00031">Types.hpp:31</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_ab4d38dd36deb3c8334737f3526dfbf35"><div class="ttname"><a href="namespaceMoFEM.html#ab4d38dd36deb3c8334737f3526dfbf35">MoFEM::Sev</a></div><div class="ttdeci">MoFEM::LogManager::SeverityLevel Sev</div><div class="ttdef"><b>Definition</b> <a href="CoreTemplates_8hpp_source.html#l00017">CoreTemplates.hpp:17</a></div></div>
<div class="ttc" id="anamespacesdf_html_a2f1f399a483aed931a5a8ac3b98f49ba"><div class="ttname"><a href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">sdf.r</a></div><div class="ttdeci">int r</div><div class="ttdef"><b>Definition</b> <a href="jupyter_2skel_2ukacm__autumn__school_2multifield__plasticity_2sdf_8py_source.html#l00008">sdf.py:8</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_a56028dc495690ec5e028feb66809ccde"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#a56028dc495690ec5e028feb66809ccde">MoFEM::ProblemsManager::MOFEM_EVENT_ProblemsManager</a></div><div class="ttdeci">PetscLogEvent MOFEM_EVENT_ProblemsManager</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8hpp_source.html#l00495">ProblemsManager.hpp:495</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga0eed1a1aa1677044038c562cdd1aeb0f" name="ga0eed1a1aa1677044038c562cdd1aeb0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0eed1a1aa1677044038c562cdd1aeb0f">&#9670;&#160;</a></span>buildProblemOnDistributedMesh() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildProblemOnDistributedMesh </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build problem data structures, assuming that mesh is distributed (collective) </p>
<p>Mesh is distributed, that means that each processor keeps only own part of the mesh and shared entities.</p>
<p>Collective - need to be run on all processors in communicator, i.e. each function has to call this function. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="remove_entities_from_problem_8cpp-example.html#a31">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00289">289</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  290</span>                                                              {</div>
<div class="line"><span class="lineno">  291</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno">  292</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>  <span class="keywordflow">if</span> (!((<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>()) &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2">Core::BUILD_FIELD</a>))</div>
<div class="line"><span class="lineno">  295</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno">  296</span>  <span class="keywordflow">if</span> (!((<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>()) &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a">Core::BUILD_FE</a>))</div>
<div class="line"><span class="lineno">  297</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordflow">if</span> (!((<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>()) &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c">Core::BUILD_ADJ</a>))</div>
<div class="line"><span class="lineno">  299</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>  <span class="keyword">const</span> Problem *problem_ptr;</div>
<div class="line"><span class="lineno">  302</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">get_problem</a>(name, &amp;problem_ptr);</div>
<div class="line"><span class="lineno">  303</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__mofem__problems__manager.html#ga0eed1a1aa1677044038c562cdd1aeb0f">buildProblemOnDistributedMesh</a>(<span class="keyword">const_cast&lt;</span>Problem *<span class="keyword">&gt;</span>(problem_ptr),</div>
<div class="line"><span class="lineno">  304</span>                                       square_matrix, verb);</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>;</div>
<div class="line"><span class="lineno">  307</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>;</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno">  310</span>}</div>
<div class="ttc" id="agroup__mofem__problems__manager_html_ga0eed1a1aa1677044038c562cdd1aeb0f"><div class="ttname"><a href="group__mofem__problems__manager.html#ga0eed1a1aa1677044038c562cdd1aeb0f">MoFEM::ProblemsManager::buildProblemOnDistributedMesh</a></div><div class="ttdeci">MoFEMErrorCode buildProblemOnDistributedMesh(const std::string name, const bool square_matrix, int verb=VERBOSE)</div><div class="ttdoc">build problem data structures, assuming that mesh is distributed (collective)</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l00289">ProblemsManager.cpp:289</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gafa370e562ce3763f7dee4228a0e107ae" name="gafa370e562ce3763f7dee4228a0e107ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafa370e562ce3763f7dee4228a0e107ae">&#9670;&#160;</a></span>buildProblemOnDistributedMesh() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildProblemOnDistributedMesh </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMoFEM_1_1Problem.html">Problem</a> *&#160;</td>
          <td class="paramname"><em>problem_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build problem data structures, assuming that mesh is distributed (collective) </p>
<p>Mesh is distributed, that means that each processor keeps only own part of the mesh and shared entities.</p>
<p>Collective - need to be run on all processors in communicator, i.e. each function has to call this function. </p>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00312">312</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  313</span>                                                              {</div>
<div class="line"><span class="lineno">  314</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno">  315</span>  <span class="keyword">auto</span> fields_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gad8c14651264988002ca4423aaae10599">get_fields</a>();</div>
<div class="line"><span class="lineno">  316</span>  <span class="keyword">auto</span> fe_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga3da3ee1182ff3eee599ba61513325271">get_finite_elements</a>();</div>
<div class="line"><span class="lineno">  317</span>  <span class="keyword">auto</span> dofs_field_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga7fc3e2d994adf8ef767f674ee3d76493">get_dofs</a>();</div>
<div class="line"><span class="lineno">  318</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno">  319</span>  PetscLogEventBegin(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a56028dc495690ec5e028feb66809ccde">MOFEM_EVENT_ProblemsManager</a>, 0, 0, 0, 0);</div>
<div class="line"><span class="lineno">  320</span> </div>
<div class="line"><span class="lineno">  321</span>  <span class="comment">// clear data structures</span></div>
<div class="line"><span class="lineno">  322</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__problems.html#ga97e18d7ea29369f0572f4c6cd3e3eeb5">clear_problem</a>(problem_ptr-&gt;getName());</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#afee5bf9ff21af9d37bdd1ed5f994bef2">getOptions</a>();</div>
<div class="line"><span class="lineno">  325</span> </div>
<div class="line"><span class="lineno">  326</span>  <span class="keywordflow">if</span> (problem_ptr-&gt;getBitRefLevel().none())</div>
<div class="line"><span class="lineno">  327</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873">MOFEM_NOT_FOUND</a>,</div>
<div class="line"><span class="lineno">  328</span>             <span class="stringliteral">&quot;problem &lt;%s&gt; refinement level not set&quot;</span>,</div>
<div class="line"><span class="lineno">  329</span>             problem_ptr-&gt;getName().c_str());</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>  <span class="keywordtype">int</span> loop_size = 2;</div>
<div class="line"><span class="lineno">  332</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno">  333</span>    loop_size = 1;</div>
<div class="line"><span class="lineno">  334</span>    problem_ptr-&gt;numeredColDofsPtr = problem_ptr-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno">  335</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (problem_ptr-&gt;numeredColDofsPtr == problem_ptr-&gt;numeredRowDofsPtr) {</div>
<div class="line"><span class="lineno">  336</span>    problem_ptr-&gt;numeredColDofsPtr =</div>
<div class="line"><span class="lineno">  337</span>        boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt;(</div>
<div class="line"><span class="lineno">  338</span>            <span class="keyword">new</span> <a class="code hl_typedef" href="group__dof__multi__indices.html#ga5688631bd2bcf927612519092e127d36">NumeredDofEntity_multiIndex</a>());</div>
<div class="line"><span class="lineno">  339</span>  }</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_bit = problem_ptr-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno">  342</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;prb_mask = problem_ptr-&gt;getBitRefLevelMask();</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>  <span class="comment">// // get rows and cols dofs view based on data on elements</span></div>
<div class="line"><span class="lineno">  345</span>  <a class="code hl_typedef" href="group__dof__multi__indices.html#ga21e1e304d4db4069d36ac96861c1472c">DofEntity_multiIndex_active_view</a> dofs_rows, dofs_cols;</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>  <span class="comment">// Add DOFs to problem by visiting all elements and adding DOFs from</span></div>
<div class="line"><span class="lineno">  348</span>  <span class="comment">// elements to the problem</span></div>
<div class="line"><span class="lineno">  349</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a91d4ed9ef01690296073b191cb69e85c">buildProblemFromFields</a> == PETSC_FALSE) {</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>    <span class="keyword">auto</span> make_rows_and_cols_view = [&amp;](<span class="keyword">auto</span> &amp;dofs_rows, <span class="keyword">auto</span> &amp;dofs_cols) {</div>
<div class="line"><span class="lineno">  352</span>      <span class="keyword">auto</span> ents_field_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga33e7aeb086f44048bde7151fd8634ab2">get_field_ents</a>();</div>
<div class="line"><span class="lineno">  353</span>      <span class="keyword">auto</span> adjacencies_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga3a98e531acd5841b846d71891e4945e5">get_ents_elements_adjacency</a>();</div>
<div class="line"><span class="lineno">  354</span>      <a class="code hl_define" href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a>;</div>
<div class="line"><span class="lineno">  355</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = ents_field_ptr-&gt;begin(); it != ents_field_ptr-&gt;end();</div>
<div class="line"><span class="lineno">  356</span>           ++it) {</div>
<div class="line"><span class="lineno">  357</span> </div>
<div class="line"><span class="lineno">  358</span>        <span class="keyword">const</span> <span class="keyword">auto</span> uid = (*it)-&gt;getLocalUniqueId();</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>        <span class="keyword">auto</span> <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a> = adjacencies_ptr-&gt;get&lt;Unique_mi_tag&gt;().equal_range(uid);</div>
<div class="line"><span class="lineno">  361</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> lo = <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first; lo != <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.second; ++lo) {</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>          <span class="keywordflow">if</span> ((lo-&gt;getBitFEId() &amp; problem_ptr-&gt;getBitFEId()).any()) {</div>
<div class="line"><span class="lineno">  364</span>            std::array&lt;bool, 2&gt; row_col = {<span class="keyword">false</span>, <span class="keyword">false</span>};</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a> &amp;fe_bit = lo-&gt;entFePtr-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>            <span class="comment">// if entity is not problem refinement level</span></div>
<div class="line"><span class="lineno">  369</span>            <span class="keywordflow">if</span> ((fe_bit &amp; prb_bit).any() &amp;&amp; (fe_bit &amp; prb_mask) == fe_bit) {</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>              <span class="keyword">auto</span> add_to_view = [&amp;](<span class="keyword">auto</span> dofs, <span class="keyword">auto</span> &amp;view, <span class="keyword">auto</span> rc) {</div>
<div class="line"><span class="lineno">  372</span>                <span class="keyword">auto</span> dit = dofs-&gt;lower_bound(uid);</div>
<div class="line"><span class="lineno">  373</span>                <span class="keyword">decltype</span>(dit) hi_dit;</div>
<div class="line"><span class="lineno">  374</span>                <span class="keywordflow">if</span> (dit != dofs-&gt;end()) {</div>
<div class="line"><span class="lineno">  375</span>                  hi_dit = dofs-&gt;upper_bound(</div>
<div class="line"><span class="lineno">  376</span>                      uid | <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a6e2e24dfdf43940a5a3d7c72a975b289">UId</a><span class="keyword">&gt;</span>(<a class="code hl_define" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a> - 1));</div>
<div class="line"><span class="lineno">  377</span>                  view.insert(dit, hi_dit);</div>
<div class="line"><span class="lineno">  378</span>                  row_col[rc] = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  379</span>                }</div>
<div class="line"><span class="lineno">  380</span>              };</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>              <span class="keywordflow">if</span> ((lo-&gt;entFePtr-&gt;getBitFieldIdRow() &amp; (*it)-&gt;getId()).any())</div>
<div class="line"><span class="lineno">  383</span>                add_to_view(dofs_field_ptr, dofs_rows, <a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>);</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>              <span class="keywordflow">if</span> (!square_matrix)</div>
<div class="line"><span class="lineno">  386</span>                <span class="keywordflow">if</span> ((lo-&gt;entFePtr-&gt;getBitFieldIdCol() &amp; (*it)-&gt;getId()).any())</div>
<div class="line"><span class="lineno">  387</span>                  add_to_view(dofs_field_ptr, dofs_cols, <a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda">COL</a>);</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>              <span class="keywordflow">if</span> (square_matrix &amp;&amp; row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>])</div>
<div class="line"><span class="lineno">  390</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  391</span>              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dbabf470e461303b909bf0dc58084ebafa0">ROW</a>] &amp;&amp; row_col[<a class="code hl_enumvalue" href="definitions_8h.html#a194bf71b1f5ddbc56eef764d19ea69dba3e66f07732b51f2cb52e13d598f8abda">COL</a>])</div>
<div class="line"><span class="lineno">  392</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  393</span>            }</div>
<div class="line"><span class="lineno">  394</span>          }</div>
<div class="line"><span class="lineno">  395</span>        }</div>
<div class="line"><span class="lineno">  396</span>      }</div>
<div class="line"><span class="lineno">  397</span>      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"><span class="lineno">  398</span>    };</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> make_rows_and_cols_view(dofs_rows, dofs_cols);</div>
<div class="line"><span class="lineno">  401</span>  }</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>  <span class="comment">// Add DOFS to the problem by searching all the filedes, and adding to</span></div>
<div class="line"><span class="lineno">  404</span>  <span class="comment">// problem owned or shared DOFs</span></div>
<div class="line"><span class="lineno">  405</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a91d4ed9ef01690296073b191cb69e85c">buildProblemFromFields</a> == PETSC_TRUE) {</div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">// Get fields IDs on elements</span></div>
<div class="line"><span class="lineno">  407</span>    <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a5d134560d22ac9eebf058d8be240cf06">BitFieldId</a> fields_ids_row, fields_ids_col;</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fit = fe_ptr-&gt;begin(); fit != fe_ptr-&gt;end(); fit++) {</div>
<div class="line"><span class="lineno">  409</span>      <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; problem_ptr-&gt;getBitFEId()).any()) {</div>
<div class="line"><span class="lineno">  410</span>        fields_ids_row |= fit-&gt;get()-&gt;getBitFieldIdRow();</div>
<div class="line"><span class="lineno">  411</span>        fields_ids_col |= fit-&gt;get()-&gt;getBitFieldIdCol();</div>
<div class="line"><span class="lineno">  412</span>      }</div>
<div class="line"><span class="lineno">  413</span>    }</div>
<div class="line"><span class="lineno">  414</span>    <span class="comment">// Get fields DOFs</span></div>
<div class="line"><span class="lineno">  415</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fit = fields_ptr-&gt;begin(); fit != fields_ptr-&gt;end(); fit++) {</div>
<div class="line"><span class="lineno">  416</span>      <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; (fields_ids_row | fields_ids_col)).any()) {</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>        <span class="keyword">auto</span> dit = dofs_field_ptr-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(</div>
<div class="line"><span class="lineno">  419</span>            <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a58d767a919831ecbb8b3b72faad3e9fa">FieldEntity::getLoBitNumberUId</a>((*fit)-&gt;getBitNumber()));</div>
<div class="line"><span class="lineno">  420</span>        <span class="keyword">auto</span> hi_dit = dofs_field_ptr-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno">  421</span>            <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a07b8c0660cbaa149aa8950f05eb618fa">FieldEntity::getHiBitNumberUId</a>((*fit)-&gt;getBitNumber()));</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>        <span class="keywordflow">for</span> (; dit != hi_dit; dit++) {</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>          <span class="keyword">const</span> <span class="keywordtype">int</span> owner_proc = dit-&gt;get()-&gt;getOwnerProc();</div>
<div class="line"><span class="lineno">  426</span>          <span class="keywordflow">if</span> (owner_proc != m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno">  427</span>            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pstatus = dit-&gt;get()-&gt;getPStatus();</div>
<div class="line"><span class="lineno">  428</span>            <span class="keywordflow">if</span> (pstatus == 0) {</div>
<div class="line"><span class="lineno">  429</span>              <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  430</span>            }</div>
<div class="line"><span class="lineno">  431</span>          }</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>          <span class="keyword">const</span> <span class="keyword">auto</span> &amp;dof_bit = (*dit)-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno">  434</span>          <span class="comment">// if entity is not problem refinement level</span></div>
<div class="line"><span class="lineno">  435</span>          <span class="keywordflow">if</span> ((dof_bit &amp; prb_bit).any() &amp;&amp; (dof_bit &amp; prb_mask) == dof_bit) {</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>            <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; fields_ids_row).any()) {</div>
<div class="line"><span class="lineno">  438</span>              dofs_rows.insert(*dit);</div>
<div class="line"><span class="lineno">  439</span>            }</div>
<div class="line"><span class="lineno">  440</span>            <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno">  441</span>              <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; fields_ids_col).any()) {</div>
<div class="line"><span class="lineno">  442</span>                dofs_cols.insert(*dit);</div>
<div class="line"><span class="lineno">  443</span>              }</div>
<div class="line"><span class="lineno">  444</span>            }</div>
<div class="line"><span class="lineno">  445</span>          }</div>
<div class="line"><span class="lineno">  446</span>        }</div>
<div class="line"><span class="lineno">  447</span>      }</div>
<div class="line"><span class="lineno">  448</span>    }</div>
<div class="line"><span class="lineno">  449</span>  }</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ac9b1d4c2a30de1cae19355a37cb45948">synchroniseProblemEntities</a>) {</div>
<div class="line"><span class="lineno">  452</span>    <span class="comment">// Get fields IDs on elements</span></div>
<div class="line"><span class="lineno">  453</span>    <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a5d134560d22ac9eebf058d8be240cf06">BitFieldId</a> fields_ids_row, fields_ids_col;</div>
<div class="line"><span class="lineno">  454</span>    <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a5d134560d22ac9eebf058d8be240cf06">BitFieldId</a> *fields_ids[2] = {&amp;fields_ids_row, &amp;fields_ids_col};</div>
<div class="line"><span class="lineno">  455</span>    <span class="keywordflow">for</span> (FiniteElement_multiIndex::iterator fit = fe_ptr-&gt;begin();</div>
<div class="line"><span class="lineno">  456</span>         fit != fe_ptr-&gt;end(); fit++) {</div>
<div class="line"><span class="lineno">  457</span>      <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; problem_ptr-&gt;getBitFEId()).any()) {</div>
<div class="line"><span class="lineno">  458</span>        fields_ids_row |= fit-&gt;get()-&gt;getBitFieldIdRow();</div>
<div class="line"><span class="lineno">  459</span>        fields_ids_col |= fit-&gt;get()-&gt;getBitFieldIdCol();</div>
<div class="line"><span class="lineno">  460</span>      }</div>
<div class="line"><span class="lineno">  461</span>    }</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>    <a class="code hl_typedef" href="group__dof__multi__indices.html#ga21e1e304d4db4069d36ac96861c1472c">DofEntity_multiIndex_active_view</a> *dofs_ptr[] = {&amp;dofs_rows, &amp;dofs_cols};</div>
<div class="line"><span class="lineno">  464</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != ((square_matrix) ? 1 : 2); ++ss) {</div>
<div class="line"><span class="lineno">  465</span>      DofEntity_multiIndex_active_view::nth_index&lt;1&gt;::type::iterator miit,</div>
<div class="line"><span class="lineno">  466</span>          hi_miit;</div>
<div class="line"><span class="lineno">  467</span>      miit = dofs_ptr[ss]-&gt;get&lt;1&gt;().lower_bound(1);</div>
<div class="line"><span class="lineno">  468</span>      hi_miit = dofs_ptr[ss]-&gt;get&lt;1&gt;().upper_bound(1);</div>
<div class="line"><span class="lineno">  469</span>      <a class="code hl_class" href="classRange.html">Range</a> ents_to_synchronise;</div>
<div class="line"><span class="lineno">  470</span>      <span class="keywordflow">for</span> (; miit != hi_miit; ++miit) {</div>
<div class="line"><span class="lineno">  471</span>        <span class="keywordflow">if</span> (miit-&gt;get()-&gt;getEntDofIdx() != 0)</div>
<div class="line"><span class="lineno">  472</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  473</span>        ents_to_synchronise.insert(miit-&gt;get()-&gt;getEnt());</div>
<div class="line"><span class="lineno">  474</span>      }</div>
<div class="line"><span class="lineno">  475</span>      <a class="code hl_class" href="classRange.html">Range</a> tmp_ents = ents_to_synchronise;</div>
<div class="line"><span class="lineno">  476</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;CommInterface&gt;()-&gt;synchroniseEntities(</div>
<div class="line"><span class="lineno">  477</span>          ents_to_synchronise, <span class="keyword">nullptr</span>, verb);</div>
<div class="line"><span class="lineno">  478</span>      ents_to_synchronise = subtract(ents_to_synchronise, tmp_ents);</div>
<div class="line"><span class="lineno">  479</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> fit = fields_ptr-&gt;begin(); fit != fields_ptr-&gt;end(); fit++) {</div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">if</span> ((fit-&gt;get()-&gt;getId() &amp; *fields_ids[ss]).any()) {</div>
<div class="line"><span class="lineno">  481</span>          <span class="keyword">const</span> <span class="keyword">auto</span> bit_number = (*fit)-&gt;getBitNumber();</div>
<div class="line"><span class="lineno">  482</span>          <span class="keywordflow">for</span> (Range::pair_iterator pit = ents_to_synchronise.pair_begin();</div>
<div class="line"><span class="lineno">  483</span>               pit != ents_to_synchronise.pair_end(); ++pit) {</div>
<div class="line"><span class="lineno">  484</span>            <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variable" href="namespaceHenckyOps.html#a990086ab6bdc667b830a40f0ffb74aa3">f</a> = pit-&gt;first;</div>
<div class="line"><span class="lineno">  485</span>            <span class="keyword">const</span> <span class="keyword">auto</span> s = pit-&gt;second;</div>
<div class="line"><span class="lineno">  486</span>            <span class="keyword">const</span> <span class="keyword">auto</span> lo_uid =</div>
<div class="line"><span class="lineno">  487</span>                <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a39602b28e32049441386fffae194f258">FieldEntity::getLocalUniqueIdCalculate</a>(bit_number, f);</div>
<div class="line"><span class="lineno">  488</span>            <span class="keyword">const</span> <span class="keyword">auto</span> hi_uid =</div>
<div class="line"><span class="lineno">  489</span>                <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a39602b28e32049441386fffae194f258">FieldEntity::getLocalUniqueIdCalculate</a>(bit_number, s);</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>            <span class="keyword">auto</span> dit = dofs_field_ptr-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(lo_uid);</div>
<div class="line"><span class="lineno">  492</span>            <span class="keyword">auto</span> hi_dit =</div>
<div class="line"><span class="lineno">  493</span>                dofs_field_ptr-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(hi_uid);</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>            dofs_ptr[ss]-&gt;insert(dit, hi_dit);</div>
<div class="line"><span class="lineno">  496</span>          }</div>
<div class="line"><span class="lineno">  497</span>        }</div>
<div class="line"><span class="lineno">  498</span>      }</div>
<div class="line"><span class="lineno">  499</span>    }</div>
<div class="line"><span class="lineno">  500</span>  }</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>  <span class="comment">// add dofs for rows and cols and set ownership</span></div>
<div class="line"><span class="lineno">  503</span>  <a class="code hl_typedef" href="group__dof__multi__indices.html#ga21e1e304d4db4069d36ac96861c1472c">DofEntity_multiIndex_active_view</a> *dofs_ptr[] = {&amp;dofs_rows, &amp;dofs_cols};</div>
<div class="line"><span class="lineno">  504</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; numered_dofs_ptr[] = {</div>
<div class="line"><span class="lineno">  505</span>      problem_ptr-&gt;numeredRowDofsPtr, problem_ptr-&gt;numeredColDofsPtr};</div>
<div class="line"><span class="lineno">  506</span>  <span class="keywordtype">int</span> *nbdof_ptr[] = {&amp;problem_ptr-&gt;nbDofsRow, &amp;problem_ptr-&gt;nbDofsCol};</div>
<div class="line"><span class="lineno">  507</span>  <span class="keywordtype">int</span> *local_nbdof_ptr[] = {&amp;problem_ptr-&gt;nbLocDofsRow,</div>
<div class="line"><span class="lineno">  508</span>                            &amp;problem_ptr-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno">  509</span>  <span class="keywordtype">int</span> *ghost_nbdof_ptr[] = {&amp;problem_ptr-&gt;nbGhostDofsRow,</div>
<div class="line"><span class="lineno">  510</span>                            &amp;problem_ptr-&gt;nbGhostDofsCol};</div>
<div class="line"><span class="lineno">  511</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss &lt; 2; ss++) {</div>
<div class="line"><span class="lineno">  512</span>    *(nbdof_ptr[ss]) = 0;</div>
<div class="line"><span class="lineno">  513</span>    *(local_nbdof_ptr[ss]) = 0;</div>
<div class="line"><span class="lineno">  514</span>    *(ghost_nbdof_ptr[ss]) = 0;</div>
<div class="line"><span class="lineno">  515</span>  }</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>  <span class="comment">// Loop over dofs on rows and columns and add to multi-indices in dofs</span></div>
<div class="line"><span class="lineno">  518</span>  <span class="comment">// problem structure,  set partition for each dof</span></div>
<div class="line"><span class="lineno">  519</span>  <span class="keywordtype">int</span> nb_local_dofs[] = {0, 0};</div>
<div class="line"><span class="lineno">  520</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss &lt; loop_size; ss++) {</div>
<div class="line"><span class="lineno">  521</span>    DofEntity_multiIndex_active_view::nth_index&lt;1&gt;::type::iterator miit,</div>
<div class="line"><span class="lineno">  522</span>        hi_miit;</div>
<div class="line"><span class="lineno">  523</span>    miit = dofs_ptr[ss]-&gt;get&lt;1&gt;().lower_bound(1);</div>
<div class="line"><span class="lineno">  524</span>    hi_miit = dofs_ptr[ss]-&gt;get&lt;1&gt;().upper_bound(1);</div>
<div class="line"><span class="lineno">  525</span>    <span class="keywordflow">for</span> (; miit != hi_miit; miit++) {</div>
<div class="line"><span class="lineno">  526</span>      <span class="keywordtype">int</span> owner_proc = (*miit)-&gt;getOwnerProc();</div>
<div class="line"><span class="lineno">  527</span>      <span class="keywordflow">if</span> (owner_proc == m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno">  528</span>        nb_local_dofs[ss]++;</div>
<div class="line"><span class="lineno">  529</span>      }</div>
<div class="line"><span class="lineno">  530</span>    }</div>
<div class="line"><span class="lineno">  531</span>  }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>  <span class="comment">// get layout</span></div>
<div class="line"><span class="lineno">  534</span>  <span class="keywordtype">int</span> start_ranges[2], end_ranges[2];</div>
<div class="line"><span class="lineno">  535</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != loop_size; ss++) {</div>
<div class="line"><span class="lineno">  536</span>    PetscLayout layout;</div>
<div class="line"><span class="lineno">  537</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;layout);</div>
<div class="line"><span class="lineno">  538</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetBlockSize(layout, 1);</div>
<div class="line"><span class="lineno">  539</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetLocalSize(layout, nb_local_dofs[ss]);</div>
<div class="line"><span class="lineno">  540</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetUp(layout);</div>
<div class="line"><span class="lineno">  541</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetSize(layout, &amp;*nbdof_ptr[ss]);</div>
<div class="line"><span class="lineno">  542</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetRange(layout, &amp;start_ranges[ss], &amp;end_ranges[ss]);</div>
<div class="line"><span class="lineno">  543</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutDestroy(&amp;layout);</div>
<div class="line"><span class="lineno">  544</span>  }</div>
<div class="line"><span class="lineno">  545</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno">  546</span>    nbdof_ptr[1] = nbdof_ptr[0];</div>
<div class="line"><span class="lineno">  547</span>    nb_local_dofs[1] = nb_local_dofs[0];</div>
<div class="line"><span class="lineno">  548</span>    start_ranges[1] = start_ranges[0];</div>
<div class="line"><span class="lineno">  549</span>    end_ranges[1] = end_ranges[0];</div>
<div class="line"><span class="lineno">  550</span>  }</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>  <span class="comment">// set local and global indices on own dofs</span></div>
<div class="line"><span class="lineno">  553</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx_data_type_size = <span class="keyword">sizeof</span>(IdxDataType);</div>
<div class="line"><span class="lineno">  554</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> data_block_size = idx_data_type_size / <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>);</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>  <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(IdxDataType) % <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>)) {</div>
<div class="line"><span class="lineno">  557</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;data inconsistency&quot;</span>);</div>
<div class="line"><span class="lineno">  558</span>  }</div>
<div class="line"><span class="lineno">  559</span>  std::vector&lt;std::vector&lt;IdxDataType&gt;&gt; ids_data_packed_rows(</div>
<div class="line"><span class="lineno">  560</span>      m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>()),</div>
<div class="line"><span class="lineno">  561</span>      ids_data_packed_cols(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>());</div>
<div class="line"><span class="lineno">  562</span> </div>
<div class="line"><span class="lineno">  563</span>  <span class="comment">// Loop over dofs on this processor and prepare those dofs to send on</span></div>
<div class="line"><span class="lineno">  564</span>  <span class="comment">// another proc</span></div>
<div class="line"><span class="lineno">  565</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != loop_size; ++ss) {</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span>    DofEntity_multiIndex_active_view::nth_index&lt;0&gt;::type::iterator miit,</div>
<div class="line"><span class="lineno">  568</span>        hi_miit;</div>
<div class="line"><span class="lineno">  569</span>    hi_miit = dofs_ptr[ss]-&gt;get&lt;0&gt;().end();</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>    boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt; dofs_array =</div>
<div class="line"><span class="lineno">  572</span>        boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt;(</div>
<div class="line"><span class="lineno">  573</span>            <span class="keyword">new</span> std::vector&lt;NumeredDofEntity&gt;());</div>
<div class="line"><span class="lineno">  574</span>    <span class="keywordtype">int</span> nb_dofs_to_add = 0;</div>
<div class="line"><span class="lineno">  575</span>    miit = dofs_ptr[ss]-&gt;get&lt;0&gt;().begin();</div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">for</span> (; miit != hi_miit; ++miit) {</div>
<div class="line"><span class="lineno">  577</span>      <span class="comment">// Only set global idx for dofs on this processor part</span></div>
<div class="line"><span class="lineno">  578</span>      <span class="keywordflow">if</span> (!(miit-&gt;get()-&gt;getActive()))</div>
<div class="line"><span class="lineno">  579</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  580</span>      ++nb_dofs_to_add;</div>
<div class="line"><span class="lineno">  581</span>    }</div>
<div class="line"><span class="lineno">  582</span>    dofs_array-&gt;reserve(nb_dofs_to_add);</div>
<div class="line"><span class="lineno">  583</span>    <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno">  584</span>      problem_ptr-&gt;getRowDofsSequence()-&gt;push_back(dofs_array);</div>
<div class="line"><span class="lineno">  585</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  586</span>      problem_ptr-&gt;getColDofsSequence()-&gt;push_back(dofs_array);</div>
<div class="line"><span class="lineno">  587</span>    }</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>    <span class="keywordtype">int</span> &amp;local_idx = *local_nbdof_ptr[ss];</div>
<div class="line"><span class="lineno">  590</span>    miit = dofs_ptr[ss]-&gt;get&lt;0&gt;().begin();</div>
<div class="line"><span class="lineno">  591</span>    <span class="keywordflow">for</span> (; miit != hi_miit; ++miit) {</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>      <span class="comment">// Only set global idx for dofs on this processor part</span></div>
<div class="line"><span class="lineno">  594</span>      <span class="keywordflow">if</span> (!(miit-&gt;get()-&gt;getActive()))</div>
<div class="line"><span class="lineno">  595</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>      dofs_array-&gt;emplace_back(*miit);</div>
<div class="line"><span class="lineno">  598</span> </div>
<div class="line"><span class="lineno">  599</span>      <span class="keywordtype">int</span> owner_proc = dofs_array-&gt;back().getOwnerProc();</div>
<div class="line"><span class="lineno">  600</span>      <span class="keywordflow">if</span> (owner_proc &lt; 0) {</div>
<div class="line"><span class="lineno">  601</span>        SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno">  602</span>                <span class="stringliteral">&quot;data inconsistency&quot;</span>);</div>
<div class="line"><span class="lineno">  603</span>      }</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>      <span class="keywordflow">if</span> (owner_proc != m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno">  606</span>        dofs_array-&gt;back().pArt = owner_proc;</div>
<div class="line"><span class="lineno">  607</span>        dofs_array-&gt;back().dofIdx = -1;</div>
<div class="line"><span class="lineno">  608</span>        dofs_array-&gt;back().petscGloablDofIdx = -1;</div>
<div class="line"><span class="lineno">  609</span>        dofs_array-&gt;back().petscLocalDofIdx = -1;</div>
<div class="line"><span class="lineno">  610</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>        <span class="comment">// Set part and indexes</span></div>
<div class="line"><span class="lineno">  613</span>        <span class="keywordtype">int</span> glob_idx = start_ranges[ss] + local_idx;</div>
<div class="line"><span class="lineno">  614</span>        dofs_array-&gt;back().pArt = owner_proc;</div>
<div class="line"><span class="lineno">  615</span>        dofs_array-&gt;back().dofIdx = glob_idx;</div>
<div class="line"><span class="lineno">  616</span>        dofs_array-&gt;back().petscGloablDofIdx = glob_idx;</div>
<div class="line"><span class="lineno">  617</span>        dofs_array-&gt;back().petscLocalDofIdx = local_idx;</div>
<div class="line"><span class="lineno">  618</span>        local_idx++;</div>
<div class="line"><span class="lineno">  619</span> </div>
<div class="line"><span class="lineno">  620</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pstatus = dofs_array-&gt;back().getPStatus();</div>
<div class="line"><span class="lineno">  621</span>        <span class="comment">// check id dof is shared, if that is a case global idx added to data</span></div>
<div class="line"><span class="lineno">  622</span>        <span class="comment">// structure and is sended to other processors</span></div>
<div class="line"><span class="lineno">  623</span>        <span class="keywordflow">if</span> (pstatus &gt; 0) {</div>
<div class="line"><span class="lineno">  624</span> </div>
<div class="line"><span class="lineno">  625</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> proc = 0;</div>
<div class="line"><span class="lineno">  626</span>               proc &lt; MAX_SHARING_PROCS &amp;&amp;</div>
<div class="line"><span class="lineno">  627</span>               -1 != dofs_array-&gt;back().getSharingProcsPtr()[proc];</div>
<div class="line"><span class="lineno">  628</span>               proc++) {</div>
<div class="line"><span class="lineno">  629</span>            <span class="comment">// make it different for rows and columns when needed</span></div>
<div class="line"><span class="lineno">  630</span>            <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno">  631</span>              ids_data_packed_rows[dofs_array-&gt;back()</div>
<div class="line"><span class="lineno">  632</span>                                       .getSharingProcsPtr()[proc]]</div>
<div class="line"><span class="lineno">  633</span>                  .emplace_back(dofs_array-&gt;back().getGlobalUniqueId(),</div>
<div class="line"><span class="lineno">  634</span>                                glob_idx);</div>
<div class="line"><span class="lineno">  635</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  636</span>              ids_data_packed_cols[dofs_array-&gt;back()</div>
<div class="line"><span class="lineno">  637</span>                                       .getSharingProcsPtr()[proc]]</div>
<div class="line"><span class="lineno">  638</span>                  .emplace_back(dofs_array-&gt;back().getGlobalUniqueId(),</div>
<div class="line"><span class="lineno">  639</span>                                glob_idx);</div>
<div class="line"><span class="lineno">  640</span>            }</div>
<div class="line"><span class="lineno">  641</span>            <span class="keywordflow">if</span> (!(pstatus &amp; PSTATUS_MULTISHARED)) {</div>
<div class="line"><span class="lineno">  642</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  643</span>            }</div>
<div class="line"><span class="lineno">  644</span>          }</div>
<div class="line"><span class="lineno">  645</span>        }</div>
<div class="line"><span class="lineno">  646</span>      }</div>
<div class="line"><span class="lineno">  647</span>    }</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span>    <span class="keyword">auto</span> hint = numered_dofs_ptr[ss]-&gt;end();</div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a> : *dofs_array)</div>
<div class="line"><span class="lineno">  651</span>      hint = numered_dofs_ptr[ss]-&gt;emplace_hint(hint, dofs_array, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>);</div>
<div class="line"><span class="lineno">  652</span>  }</div>
<div class="line"><span class="lineno">  653</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno">  654</span>    local_nbdof_ptr[1] = local_nbdof_ptr[0];</div>
<div class="line"><span class="lineno">  655</span>  }</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>  <span class="keywordtype">int</span> nsends_rows = 0, nsends_cols = 0;</div>
<div class="line"><span class="lineno">  658</span>  <span class="comment">// Non zero lengths[i] represent a message to i of length lengths[i].</span></div>
<div class="line"><span class="lineno">  659</span>  std::vector&lt;int&gt; lengths_rows(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>()),</div>
<div class="line"><span class="lineno">  660</span>      lengths_cols(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>());</div>
<div class="line"><span class="lineno">  661</span>  lengths_rows.clear();</div>
<div class="line"><span class="lineno">  662</span>  lengths_cols.clear();</div>
<div class="line"><span class="lineno">  663</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> proc = 0; proc &lt; m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>(); proc++) {</div>
<div class="line"><span class="lineno">  664</span>    lengths_rows[proc] = ids_data_packed_rows[proc].size() * data_block_size;</div>
<div class="line"><span class="lineno">  665</span>    lengths_cols[proc] = ids_data_packed_cols[proc].size() * data_block_size;</div>
<div class="line"><span class="lineno">  666</span>    <span class="keywordflow">if</span> (!ids_data_packed_rows[proc].empty())</div>
<div class="line"><span class="lineno">  667</span>      nsends_rows++;</div>
<div class="line"><span class="lineno">  668</span>    <span class="keywordflow">if</span> (!ids_data_packed_cols[proc].empty())</div>
<div class="line"><span class="lineno">  669</span>      nsends_cols++;</div>
<div class="line"><span class="lineno">  670</span>  }</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>  MPI_Status *status;</div>
<div class="line"><span class="lineno">  673</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc1(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>(), &amp;status);</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>  <span class="comment">// Do rows</span></div>
<div class="line"><span class="lineno">  676</span>  <span class="keywordtype">int</span> nrecvs_rows;    <span class="comment">// number of messages received</span></div>
<div class="line"><span class="lineno">  677</span>  <span class="keywordtype">int</span> *onodes_rows;   <span class="comment">// list of node-ids from which messages are expected</span></div>
<div class="line"><span class="lineno">  678</span>  <span class="keywordtype">int</span> *olengths_rows; <span class="comment">// corresponding message lengths</span></div>
<div class="line"><span class="lineno">  679</span>  <span class="keywordtype">int</span> **rbuf_row;     <span class="comment">// must bee freed by user</span></div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span>  <span class="comment">// make sure it is a PETSc comm</span></div>
<div class="line"><span class="lineno">  682</span>  MPI_Comm comm;</div>
<div class="line"><span class="lineno">  683</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscCommDuplicate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;comm, NULL);</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>  {</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>    <span class="comment">// rows</span></div>
<div class="line"><span class="lineno">  688</span> </div>
<div class="line"><span class="lineno">  689</span>    <span class="comment">// Computes the number of messages a node expects to receive</span></div>
<div class="line"><span class="lineno">  690</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscGatherNumberOfMessages(comm, NULL, &amp;lengths_rows[0],</div>
<div class="line"><span class="lineno">  691</span>                                       &amp;nrecvs_rows);</div>
<div class="line"><span class="lineno">  692</span>    <span class="comment">// std::cerr &lt;&lt; nrecvs_rows &lt;&lt; std::endl;</span></div>
<div class="line"><span class="lineno">  693</span> </div>
<div class="line"><span class="lineno">  694</span>    <span class="comment">// Computes info about messages that a MPI-node will receive, including</span></div>
<div class="line"><span class="lineno">  695</span>    <span class="comment">// (from-id,length) pairs for each message.</span></div>
<div class="line"><span class="lineno">  696</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscGatherMessageLengths(comm, nsends_rows, nrecvs_rows,</div>
<div class="line"><span class="lineno">  697</span>                                     &amp;lengths_rows[0], &amp;onodes_rows,</div>
<div class="line"><span class="lineno">  698</span>                                     &amp;olengths_rows);</div>
<div class="line"><span class="lineno">  699</span> </div>
<div class="line"><span class="lineno">  700</span>    <span class="comment">// Gets a unique new tag from a PETSc communicator. All processors that</span></div>
<div class="line"><span class="lineno">  701</span>    <span class="comment">// share the communicator MUST call this routine EXACTLY the same number</span></div>
<div class="line"><span class="lineno">  702</span>    <span class="comment">// of times. This tag should only be used with the current objects</span></div>
<div class="line"><span class="lineno">  703</span>    <span class="comment">// communicator; do NOT use it with any other MPI communicator.</span></div>
<div class="line"><span class="lineno">  704</span>    <span class="keywordtype">int</span> tag_row;</div>
<div class="line"><span class="lineno">  705</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscCommGetNewTag(comm, &amp;tag_row);</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span>    <span class="comment">// Allocate a buffer sufficient to hold messages of size specified in</span></div>
<div class="line"><span class="lineno">  708</span>    <span class="comment">// olengths. And post Irecvs on these buffers using node info from onodes</span></div>
<div class="line"><span class="lineno">  709</span>    MPI_Request *r_waits_row; <span class="comment">// must bee freed by user</span></div>
<div class="line"><span class="lineno">  710</span>    <span class="comment">// rbuf has a pointers to messeges. It has size of of nrecvs (number of</span></div>
<div class="line"><span class="lineno">  711</span>    <span class="comment">// messages) +1. In the first index a block is allocated,</span></div>
<div class="line"><span class="lineno">  712</span>    <span class="comment">// such that rbuf[i] = rbuf[i-1]+olengths[i-1].</span></div>
<div class="line"><span class="lineno">  713</span> </div>
<div class="line"><span class="lineno">  714</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscPostIrecvInt(comm, tag_row, nrecvs_rows, onodes_rows,</div>
<div class="line"><span class="lineno">  715</span>                             olengths_rows, &amp;rbuf_row, &amp;r_waits_row);</div>
<div class="line"><span class="lineno">  716</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(onodes_rows);</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>    MPI_Request *s_waits_row; <span class="comment">// status of sens messages</span></div>
<div class="line"><span class="lineno">  719</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc1(nsends_rows, &amp;s_waits_row);</div>
<div class="line"><span class="lineno">  720</span> </div>
<div class="line"><span class="lineno">  721</span>    <span class="comment">// Send messeges</span></div>
<div class="line"><span class="lineno">  722</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> proc = 0, kk = 0; proc &lt; m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>(); proc++) {</div>
<div class="line"><span class="lineno">  723</span>      <span class="keywordflow">if</span> (!lengths_rows[proc])</div>
<div class="line"><span class="lineno">  724</span>        <span class="keywordflow">continue</span>; <span class="comment">// no message to send to this proc</span></div>
<div class="line"><span class="lineno">  725</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Isend(&amp;(ids_data_packed_rows[proc])[0], <span class="comment">// buffer to send</span></div>
<div class="line"><span class="lineno">  726</span>                       lengths_rows[proc],               <span class="comment">// message length</span></div>
<div class="line"><span class="lineno">  727</span>                       MPIU_INT, proc,                   <span class="comment">// to proc</span></div>
<div class="line"><span class="lineno">  728</span>                       tag_row, comm, s_waits_row + kk);</div>
<div class="line"><span class="lineno">  729</span>      kk++;</div>
<div class="line"><span class="lineno">  730</span>    }</div>
<div class="line"><span class="lineno">  731</span> </div>
<div class="line"><span class="lineno">  732</span>    <span class="keywordflow">if</span> (nrecvs_rows) {</div>
<div class="line"><span class="lineno">  733</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Waitall(nrecvs_rows, r_waits_row, status);</div>
<div class="line"><span class="lineno">  734</span>    }</div>
<div class="line"><span class="lineno">  735</span>    <span class="keywordflow">if</span> (nsends_rows) {</div>
<div class="line"><span class="lineno">  736</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Waitall(nsends_rows, s_waits_row, status);</div>
<div class="line"><span class="lineno">  737</span>    }</div>
<div class="line"><span class="lineno">  738</span> </div>
<div class="line"><span class="lineno">  739</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(r_waits_row);</div>
<div class="line"><span class="lineno">  740</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(s_waits_row);</div>
<div class="line"><span class="lineno">  741</span>  }</div>
<div class="line"><span class="lineno">  742</span> </div>
<div class="line"><span class="lineno">  743</span>  <span class="comment">// cols</span></div>
<div class="line"><span class="lineno">  744</span>  <span class="keywordtype">int</span> nrecvs_cols = nrecvs_rows;</div>
<div class="line"><span class="lineno">  745</span>  <span class="keywordtype">int</span> *olengths_cols = olengths_rows;</div>
<div class="line"><span class="lineno">  746</span>  PetscInt **rbuf_col = rbuf_row;</div>
<div class="line"><span class="lineno">  747</span>  <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno">  748</span> </div>
<div class="line"><span class="lineno">  749</span>    <span class="comment">// Computes the number of messages a node expects to receive</span></div>
<div class="line"><span class="lineno">  750</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscGatherNumberOfMessages(comm, NULL, &amp;lengths_cols[0],</div>
<div class="line"><span class="lineno">  751</span>                                       &amp;nrecvs_cols);</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>    <span class="comment">// Computes info about messages that a MPI-node will receive, including</span></div>
<div class="line"><span class="lineno">  754</span>    <span class="comment">// (from-id,length) pairs for each message.</span></div>
<div class="line"><span class="lineno">  755</span>    <span class="keywordtype">int</span> *onodes_cols;</div>
<div class="line"><span class="lineno">  756</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscGatherMessageLengths(comm, nsends_cols, nrecvs_cols,</div>
<div class="line"><span class="lineno">  757</span>                                     &amp;lengths_cols[0], &amp;onodes_cols,</div>
<div class="line"><span class="lineno">  758</span>                                     &amp;olengths_cols);</div>
<div class="line"><span class="lineno">  759</span> </div>
<div class="line"><span class="lineno">  760</span>    <span class="comment">// Gets a unique new tag from a PETSc communicator.</span></div>
<div class="line"><span class="lineno">  761</span>    <span class="keywordtype">int</span> tag_col;</div>
<div class="line"><span class="lineno">  762</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscCommGetNewTag(comm, &amp;tag_col);</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>    <span class="comment">// Allocate a buffer sufficient to hold messages of size specified in</span></div>
<div class="line"><span class="lineno">  765</span>    <span class="comment">// olengths. And post Irecvs on these buffers using node info from onodes</span></div>
<div class="line"><span class="lineno">  766</span>    MPI_Request *r_waits_col; <span class="comment">// must bee freed by user</span></div>
<div class="line"><span class="lineno">  767</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscPostIrecvInt(comm, tag_col, nrecvs_cols, onodes_cols,</div>
<div class="line"><span class="lineno">  768</span>                             olengths_cols, &amp;rbuf_col, &amp;r_waits_col);</div>
<div class="line"><span class="lineno">  769</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(onodes_cols);</div>
<div class="line"><span class="lineno">  770</span> </div>
<div class="line"><span class="lineno">  771</span>    MPI_Request *s_waits_col; <span class="comment">// status of sens messages</span></div>
<div class="line"><span class="lineno">  772</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc1(nsends_cols, &amp;s_waits_col);</div>
<div class="line"><span class="lineno">  773</span> </div>
<div class="line"><span class="lineno">  774</span>    <span class="comment">// Send messages</span></div>
<div class="line"><span class="lineno">  775</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> proc = 0, kk = 0; proc &lt; m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>(); proc++) {</div>
<div class="line"><span class="lineno">  776</span>      <span class="keywordflow">if</span> (!lengths_cols[proc])</div>
<div class="line"><span class="lineno">  777</span>        <span class="keywordflow">continue</span>; <span class="comment">// no message to send to this proc</span></div>
<div class="line"><span class="lineno">  778</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Isend(&amp;(ids_data_packed_cols[proc])[0], <span class="comment">// buffer to send</span></div>
<div class="line"><span class="lineno">  779</span>                       lengths_cols[proc],               <span class="comment">// message length</span></div>
<div class="line"><span class="lineno">  780</span>                       MPIU_INT, proc,                   <span class="comment">// to proc</span></div>
<div class="line"><span class="lineno">  781</span>                       tag_col, comm, s_waits_col + kk);</div>
<div class="line"><span class="lineno">  782</span>      kk++;</div>
<div class="line"><span class="lineno">  783</span>    }</div>
<div class="line"><span class="lineno">  784</span> </div>
<div class="line"><span class="lineno">  785</span>    <span class="keywordflow">if</span> (nrecvs_cols) {</div>
<div class="line"><span class="lineno">  786</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Waitall(nrecvs_cols, r_waits_col, status);</div>
<div class="line"><span class="lineno">  787</span>    }</div>
<div class="line"><span class="lineno">  788</span>    <span class="keywordflow">if</span> (nsends_cols) {</div>
<div class="line"><span class="lineno">  789</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MPI_Waitall(nsends_cols, s_waits_col, status);</div>
<div class="line"><span class="lineno">  790</span>    }</div>
<div class="line"><span class="lineno">  791</span> </div>
<div class="line"><span class="lineno">  792</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(r_waits_col);</div>
<div class="line"><span class="lineno">  793</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(s_waits_col);</div>
<div class="line"><span class="lineno">  794</span>  }</div>
<div class="line"><span class="lineno">  795</span> </div>
<div class="line"><span class="lineno">  796</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscCommDestroy(&amp;comm);</div>
<div class="line"><span class="lineno">  797</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(status);</div>
<div class="line"><span class="lineno">  798</span> </div>
<div class="line"><span class="lineno">  799</span>  <a class="code hl_typedef" href="group__dof__multi__indices.html#ga579f604c4daea86eeff79cfcc2d737a3">DofEntity_multiIndex_global_uid_view</a> dofs_glob_uid_view;</div>
<div class="line"><span class="lineno">  800</span>  <span class="keyword">auto</span> hint = dofs_glob_uid_view.begin();</div>
<div class="line"><span class="lineno">  801</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> dof : *m_field.get_dofs())</div>
<div class="line"><span class="lineno">  802</span>    dofs_glob_uid_view.emplace_hint(hint, dof);</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>  <span class="comment">// set values received from other processors</span></div>
<div class="line"><span class="lineno">  805</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != loop_size; ++ss) {</div>
<div class="line"><span class="lineno">  806</span> </div>
<div class="line"><span class="lineno">  807</span>    <span class="keywordtype">int</span> nrecvs;</div>
<div class="line"><span class="lineno">  808</span>    <span class="keywordtype">int</span> *olengths;</div>
<div class="line"><span class="lineno">  809</span>    <span class="keywordtype">int</span> **data_procs;</div>
<div class="line"><span class="lineno">  810</span>    <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno">  811</span>      nrecvs = nrecvs_rows;</div>
<div class="line"><span class="lineno">  812</span>      olengths = olengths_rows;</div>
<div class="line"><span class="lineno">  813</span>      data_procs = rbuf_row;</div>
<div class="line"><span class="lineno">  814</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  815</span>      nrecvs = nrecvs_cols;</div>
<div class="line"><span class="lineno">  816</span>      olengths = olengths_cols;</div>
<div class="line"><span class="lineno">  817</span>      data_procs = rbuf_col;</div>
<div class="line"><span class="lineno">  818</span>    }</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>    <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a6e2e24dfdf43940a5a3d7c72a975b289">UId</a> uid;</div>
<div class="line"><span class="lineno">  821</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> kk = 0; kk != nrecvs; ++kk) {</div>
<div class="line"><span class="lineno">  822</span>      <span class="keywordtype">int</span> len = olengths[kk];</div>
<div class="line"><span class="lineno">  823</span>      <span class="keywordtype">int</span> *data_from_proc = data_procs[kk];</div>
<div class="line"><span class="lineno">  824</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dd = 0; <a class="code hl_function" href="namespaceFTensor.html#ad4a6ecc7f7a6e3b3903a9cff27887f39">dd</a> &lt; len; <a class="code hl_function" href="namespaceFTensor.html#ad4a6ecc7f7a6e3b3903a9cff27887f39">dd</a> += data_block_size) {</div>
<div class="line"><span class="lineno">  825</span>        uid = IdxDataTypePtr(&amp;data_from_proc[dd]).getUId();</div>
<div class="line"><span class="lineno">  826</span>        <span class="keyword">auto</span> ddit = dofs_glob_uid_view.find(uid);</div>
<div class="line"><span class="lineno">  827</span>        <span class="keyword">const</span> <span class="keyword">auto</span> owner_proc = <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#ae2385d4cde52b88c64a87bc2cbb7b615">FieldEntity::getOwnerFromUniqueId</a>(uid);</div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>        <span class="keywordflow">if</span> (owner_proc == m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>() &amp;&amp;</div>
<div class="line"><span class="lineno">  830</span>            PetscUnlikely(ddit == dofs_glob_uid_view.end())) {</div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  833</span>          <span class="keyword">auto</span> ents_field_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga33e7aeb086f44048bde7151fd8634ab2">get_field_ents</a>();</div>
<div class="line"><span class="lineno">  834</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  835</span>              &lt;&lt; <span class="stringliteral">&quot;DOF is shared or multishared between processors. For example &quot;</span></div>
<div class="line"><span class="lineno">  836</span>                 <span class="stringliteral">&quot;if order of field on given entity is set in inconsistently, &quot;</span></div>
<div class="line"><span class="lineno">  837</span>                 <span class="stringliteral">&quot;has different value on two processor, error such as this is &quot;</span></div>
<div class="line"><span class="lineno">  838</span>                 <span class="stringliteral">&quot;triggered&quot;</span>;</div>
<div class="line"><span class="lineno">  839</span> </div>
<div class="line"><span class="lineno">  840</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error) &lt;&lt; <span class="stringliteral">&quot;UId &quot;</span> &lt;&lt; uid &lt;&lt; <span class="stringliteral">&quot; is not found&quot;</span>;</div>
<div class="line"><span class="lineno">  841</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  842</span>              &lt;&lt; <span class="stringliteral">&quot;Problematic UId owner proc is &quot;</span> &lt;&lt; owner_proc;</div>
<div class="line"><span class="lineno">  843</span>          <span class="keyword">const</span> <span class="keyword">auto</span> uid_handle = <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a0b2b7998f7e8f67a43d371978e278e0e">FieldEntity::getHandleFromUniqueId</a>(uid);</div>
<div class="line"><span class="lineno">  844</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  845</span>              &lt;&lt; <span class="stringliteral">&quot;Problematic UId entity owning processor handle is &quot;</span></div>
<div class="line"><span class="lineno">  846</span>              &lt;&lt; uid_handle &lt;&lt; <span class="stringliteral">&quot; entity type &quot;</span></div>
<div class="line"><span class="lineno">  847</span>              &lt;&lt; moab::CN::EntityTypeName(<a class="code hl_function" href="namespaceMoFEM.html#a01f67868b6366749021d5258535655cd">type_from_handle</a>(uid_handle));</div>
<div class="line"><span class="lineno">  848</span>          <span class="keyword">const</span> <span class="keyword">auto</span> uid_bit_number =</div>
<div class="line"><span class="lineno">  849</span>              <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a1229056d4a3f0c74321808bde69d947a">FieldEntity::getFieldBitNumberFromUniqueId</a>(uid);</div>
<div class="line"><span class="lineno">  850</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  851</span>              &lt;&lt; <span class="stringliteral">&quot;Problematic UId field is &quot;</span></div>
<div class="line"><span class="lineno">  852</span>              &lt;&lt; m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#aa78f41b59afb60f8e34861eb33d4d880">get_field_name</a>(</div>
<div class="line"><span class="lineno">  853</span>                     <a class="code hl_function" href="namespaceMoFEM.html#aa36843c42ce7d4c71b63265fcbeb4c9b">field_bit_from_bit_number</a>(uid_bit_number));</div>
<div class="line"><span class="lineno">  854</span> </div>
<div class="line"><span class="lineno">  855</span>          <a class="code hl_typedef" href="group__dof__multi__indices.html#ga00be449558fa8e5b6822c32c061aa5cd">FieldEntity_multiIndex_global_uid_view</a> field_view;</div>
<div class="line"><span class="lineno">  856</span>          field_view.insert(ents_field_ptr-&gt;begin(), ents_field_ptr-&gt;end());</div>
<div class="line"><span class="lineno">  857</span>          <span class="keyword">auto</span> fe_it = field_view.find(<a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#af2642046f8c6e9544ea604807cd2a9c7">FieldEntity::getGlobalUniqueIdCalculate</a>(</div>
<div class="line"><span class="lineno">  858</span>              owner_proc, uid_bit_number, uid_handle));</div>
<div class="line"><span class="lineno">  859</span>          <span class="keywordflow">if</span> (fe_it == field_view.end()) {</div>
<div class="line"><span class="lineno">  860</span>            <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  861</span>                &lt;&lt; <span class="stringliteral">&quot;Also, no field entity in database for given global UId&quot;</span>;</div>
<div class="line"><span class="lineno">  862</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  863</span>            <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error) &lt;&lt; <span class="stringliteral">&quot;Field entity in databse exist &quot;</span></div>
<div class="line"><span class="lineno">  864</span>                                             <span class="stringliteral">&quot;(but have no DOF wih give UId&quot;</span>;</div>
<div class="line"><span class="lineno">  865</span>            <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error) &lt;&lt; **fe_it;</div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span>            <span class="comment">// Save file with missing entity</span></div>
<div class="line"><span class="lineno">  868</span>            <span class="keyword">auto</span> error_file_name =</div>
<div class="line"><span class="lineno">  869</span>                <span class="stringliteral">&quot;error_with_missing_entity_&quot;</span> +</div>
<div class="line"><span class="lineno">  870</span>                boost::lexical_cast&lt;std::string&gt;(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) +</div>
<div class="line"><span class="lineno">  871</span>                <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line"><span class="lineno">  872</span>            <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::error)</div>
<div class="line"><span class="lineno">  873</span>                &lt;&lt; <span class="stringliteral">&quot;Look to file &lt; &quot;</span> &lt;&lt; error_file_name</div>
<div class="line"><span class="lineno">  874</span>                &lt;&lt; <span class="stringliteral">&quot; &gt; it contains entity with missing DOF.&quot;</span>;</div>
<div class="line"><span class="lineno">  875</span> </div>
<div class="line"><span class="lineno">  876</span>            <span class="keyword">auto</span> tmp_msh = <a class="code hl_function" href="namespaceMoFEM.html#ad17eefd5d88d2b51c71ec46cae8569ac">get_temp_meshset_ptr</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>());</div>
<div class="line"><span class="lineno">  877</span>            <span class="keyword">const</span> <span class="keyword">auto</span> local_fe_ent = (*fe_it)-&gt;getEnt();</div>
<div class="line"><span class="lineno">  878</span>            <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().add_entities(*tmp_msh, &amp;local_fe_ent, 1);</div>
<div class="line"><span class="lineno">  879</span>            <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().write_file(error_file_name.c_str(), <span class="stringliteral">&quot;VTK&quot;</span>,</div>
<div class="line"><span class="lineno">  880</span>                                                 <span class="stringliteral">&quot;&quot;</span>, tmp_msh-&gt;get_ptr(), 1);</div>
<div class="line"><span class="lineno">  881</span>          }</div>
<div class="line"><span class="lineno">  882</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  883</span> </div>
<div class="line"><span class="lineno">  884</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno">  885</span>                  <span class="stringliteral">&quot;DOF with global UId not found (Compile code in Debug to &quot;</span></div>
<div class="line"><span class="lineno">  886</span>                  <span class="stringliteral">&quot;learn more about problem&quot;</span>);</div>
<div class="line"><span class="lineno">  887</span>        }</div>
<div class="line"><span class="lineno">  888</span> </div>
<div class="line"><span class="lineno">  889</span>        <span class="keywordflow">if</span> (PetscUnlikely(ddit == dofs_glob_uid_view.end())) {</div>
<div class="line"><span class="lineno">  890</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  891</span>        }</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>        <span class="keyword">auto</span> dit = numered_dofs_ptr[ss]-&gt;find((*ddit)-&gt;getLocalUniqueId());</div>
<div class="line"><span class="lineno">  894</span> </div>
<div class="line"><span class="lineno">  895</span>        <span class="keywordflow">if</span> (dit != numered_dofs_ptr[ss]-&gt;end()) {</div>
<div class="line"><span class="lineno">  896</span> </div>
<div class="line"><span class="lineno">  897</span>          <span class="keywordtype">int</span> global_idx = IdxDataTypePtr(&amp;data_from_proc[dd]).getDofIdx();</div>
<div class="line"><span class="lineno">  898</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  899</span>          <span class="keywordflow">if</span> (PetscUnlikely(global_idx &lt; 0))</div>
<div class="line"><span class="lineno">  900</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno">  901</span>                    <span class="stringliteral">&quot;received negative dof&quot;</span>);</div>
<div class="line"><span class="lineno">  902</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  903</span>          <span class="keywordtype">bool</span> success;</div>
<div class="line"><span class="lineno">  904</span>          success = numered_dofs_ptr[ss]-&gt;modify(</div>
<div class="line"><span class="lineno">  905</span>              dit, NumeredDofEntity_mofem_index_change(global_idx));</div>
<div class="line"><span class="lineno">  906</span> </div>
<div class="line"><span class="lineno">  907</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  908</span>          <span class="keywordflow">if</span> (PetscUnlikely(!success))</div>
<div class="line"><span class="lineno">  909</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno">  910</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno">  911</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  912</span>          success = numered_dofs_ptr[ss]-&gt;modify(</div>
<div class="line"><span class="lineno">  913</span>              dit, NumeredDofEntity_part_and_glob_idx_change((*dit)-&gt;getPart(),</div>
<div class="line"><span class="lineno">  914</span>                                                             global_idx));</div>
<div class="line"><span class="lineno">  915</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  916</span>          <span class="keywordflow">if</span> (PetscUnlikely(!success))</div>
<div class="line"><span class="lineno">  917</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno">  918</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno">  919</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  920</span>        };</div>
<div class="line"><span class="lineno">  921</span> </div>
<div class="line"><span class="lineno">  922</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  923</span>        <span class="keywordflow">if</span> (PetscUnlikely(ddit-&gt;get()-&gt;getPStatus() == 0)) {</div>
<div class="line"><span class="lineno">  924</span> </div>
<div class="line"><span class="lineno">  925</span>          <span class="comment">// Dof is shared on this processor, however there is no element</span></div>
<div class="line"><span class="lineno">  926</span>          <span class="comment">// which have this dof. If DOF is not shared and received from other</span></div>
<div class="line"><span class="lineno">  927</span>          <span class="comment">// processor, but not marked as a shared on other that means that is</span></div>
<div class="line"><span class="lineno">  928</span>          <span class="comment">// data inconstancy and error should be thrown.</span></div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>          std::ostringstream zz;</div>
<div class="line"><span class="lineno">  931</span>          zz &lt;&lt; **ddit &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  932</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno">  933</span>                   <span class="stringliteral">&quot;data inconsistency, dofs is not shared, but received &quot;</span></div>
<div class="line"><span class="lineno">  934</span>                   <span class="stringliteral">&quot;from other proc\n&quot;</span></div>
<div class="line"><span class="lineno">  935</span>                   <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line"><span class="lineno">  936</span>                   zz.str().c_str());</div>
<div class="line"><span class="lineno">  937</span>        }</div>
<div class="line"><span class="lineno">  938</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  939</span>      }</div>
<div class="line"><span class="lineno">  940</span>    }</div>
<div class="line"><span class="lineno">  941</span>  }</div>
<div class="line"><span class="lineno">  942</span> </div>
<div class="line"><span class="lineno">  943</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno">  944</span>    (problem_ptr-&gt;nbDofsCol) = (problem_ptr-&gt;nbDofsRow);</div>
<div class="line"><span class="lineno">  945</span>    (problem_ptr-&gt;nbLocDofsCol) = (problem_ptr-&gt;nbLocDofsRow);</div>
<div class="line"><span class="lineno">  946</span>  }</div>
<div class="line"><span class="lineno">  947</span> </div>
<div class="line"><span class="lineno">  948</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(olengths_rows);</div>
<div class="line"><span class="lineno">  949</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(rbuf_row[0]);</div>
<div class="line"><span class="lineno">  950</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(rbuf_row);</div>
<div class="line"><span class="lineno">  951</span>  <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno">  952</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(olengths_cols);</div>
<div class="line"><span class="lineno">  953</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(rbuf_col[0]);</div>
<div class="line"><span class="lineno">  954</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscFree(rbuf_col);</div>
<div class="line"><span class="lineno">  955</span>  }</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno">  958</span>    <span class="keywordflow">if</span> (numered_dofs_ptr[0]-&gt;size() != numered_dofs_ptr[1]-&gt;size()) {</div>
<div class="line"><span class="lineno">  959</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno">  960</span>              <span class="stringliteral">&quot;data inconsistency for square_matrix %ld!=%ld&quot;</span>,</div>
<div class="line"><span class="lineno">  961</span>              numered_dofs_ptr[0]-&gt;size(), numered_dofs_ptr[1]-&gt;size());</div>
<div class="line"><span class="lineno">  962</span>    }</div>
<div class="line"><span class="lineno">  963</span>    <span class="keywordflow">if</span> (problem_ptr-&gt;numeredRowDofsPtr != problem_ptr-&gt;numeredColDofsPtr) {</div>
<div class="line"><span class="lineno">  964</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno">  965</span>              <span class="stringliteral">&quot;data inconsistency for square_matrix&quot;</span>);</div>
<div class="line"><span class="lineno">  966</span>    }</div>
<div class="line"><span class="lineno">  967</span>  }</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(problem_ptr, verb);</div>
<div class="line"><span class="lineno">  970</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#ae1931e8cb3ddacb79ed9f2dafb15b82d">debugPartitionedProblem</a>(problem_ptr, verb);</div>
<div class="line"><span class="lineno">  971</span> </div>
<div class="line"><span class="lineno">  972</span>  PetscLogEventEnd(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#a56028dc495690ec5e028feb66809ccde">MOFEM_EVENT_ProblemsManager</a>, 0, 0, 0, 0);</div>
<div class="line"><span class="lineno">  973</span> </div>
<div class="line"><span class="lineno">  974</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno">  975</span>}</div>
<div class="ttc" id="aclassRange_html"><div class="ttname"><a href="classRange.html">Range</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873">MOFEM_NOT_FOUND</a></div><div class="ttdeci">@ MOFEM_NOT_FOUND</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00033">definitions.h:33</a></div></div>
<div class="ttc" id="agroup__dof__multi__indices_html_ga00be449558fa8e5b6822c32c061aa5cd"><div class="ttname"><a href="group__dof__multi__indices.html#ga00be449558fa8e5b6822c32c061aa5cd">MoFEM::FieldEntity_multiIndex_global_uid_view</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; FieldEntity &gt;, indexed_by&lt; ordered_unique&lt; tag&lt; Unique_mi_tag &gt;, const_mem_fun&lt; FieldEntity, UId, &amp;FieldEntity::getGlobalUniqueId &gt; &gt; &gt; &gt; FieldEntity_multiIndex_global_uid_view</div><div class="ttdoc">multi-index view on DofEntity by uid</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00436">FieldEntsMultiIndices.hpp:444</a></div></div>
<div class="ttc" id="agroup__dof__multi__indices_html_ga5688631bd2bcf927612519092e127d36"><div class="ttname"><a href="group__dof__multi__indices.html#ga5688631bd2bcf927612519092e127d36">NumeredDofEntity_multiIndex</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; NumeredDofEntity &gt;, indexed_by&lt; ordered_unique&lt; tag&lt; Unique_mi_tag &gt;, const_mem_fun&lt; NumeredDofEntity::interface_type_DofEntity, UId, &amp;NumeredDofEntity::getLocalUniqueId &gt; &gt;, ordered_non_unique&lt; tag&lt; Part_mi_tag &gt;, member&lt; NumeredDofEntity, unsigned int, &amp;NumeredDofEntity::pArt &gt; &gt;, ordered_non_unique&lt; tag&lt; Idx_mi_tag &gt;, member&lt; NumeredDofEntity, DofIdx, &amp;NumeredDofEntity::dofIdx &gt; &gt;, ordered_non_unique&lt; tag&lt; PetscGlobalIdx_mi_tag &gt;, member&lt; NumeredDofEntity, DofIdx, &amp;NumeredDofEntity::petscGloablDofIdx &gt; &gt;, ordered_non_unique&lt; tag&lt; PetscLocalIdx_mi_tag &gt;, member&lt; NumeredDofEntity, DofIdx, &amp;NumeredDofEntity::petscLocalDofIdx &gt; &gt;, ordered_non_unique&lt; tag&lt; Ent_mi_tag &gt;, const_mem_fun&lt; NumeredDofEntity::interface_type_DofEntity, EntityHandle, &amp;NumeredDofEntity::getEnt &gt; &gt; &gt; &gt; NumeredDofEntity_multiIndex</div><div class="ttdoc">MultiIndex container keeps NumeredDofEntity.</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00469">DofsMultiIndices.hpp:469</a></div></div>
<div class="ttc" id="agroup__dof__multi__indices_html_ga579f604c4daea86eeff79cfcc2d737a3"><div class="ttname"><a href="group__dof__multi__indices.html#ga579f604c4daea86eeff79cfcc2d737a3">MoFEM::DofEntity_multiIndex_global_uid_view</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; DofEntity &gt;, indexed_by&lt; ordered_unique&lt; const_mem_fun&lt; DofEntity, UId, &amp;DofEntity::getGlobalUniqueId &gt; &gt; &gt; &gt; DofEntity_multiIndex_global_uid_view</div><div class="ttdoc">multi-index view on DofEntity by uid</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00342">DofsMultiIndices.hpp:349</a></div></div>
<div class="ttc" id="agroup__mofem__access_html_ga3da3ee1182ff3eee599ba61513325271"><div class="ttname"><a href="group__mofem__access.html#ga3da3ee1182ff3eee599ba61513325271">MoFEM::CoreInterface::get_finite_elements</a></div><div class="ttdeci">virtual const FiniteElement_multiIndex * get_finite_elements() const =0</div><div class="ttdoc">Get the finite elements object.</div></div>
<div class="ttc" id="agroup__mofem__access_html_gad8c14651264988002ca4423aaae10599"><div class="ttname"><a href="group__mofem__access.html#gad8c14651264988002ca4423aaae10599">MoFEM::CoreInterface::get_fields</a></div><div class="ttdeci">virtual const Field_multiIndex * get_fields() const =0</div><div class="ttdoc">Get the fields object.</div></div>
<div class="ttc" id="anamespaceFTensor_html_ad4a6ecc7f7a6e3b3903a9cff27887f39"><div class="ttname"><a href="namespaceFTensor.html#ad4a6ecc7f7a6e3b3903a9cff27887f39">FTensor::dd</a></div><div class="ttdeci">const Tensor2_symmetric_Expr&lt; const ddTensor0&lt; T, Dim, i, j &gt;, typename promote&lt; T, double &gt;::V, Dim, i, j &gt; dd(const Tensor0&lt; T * &gt; &amp;a, const Index&lt; i, Dim &gt; index1, const Index&lt; j, Dim &gt; index2, const Tensor1&lt; int, Dim &gt; &amp;d_ijk, const Tensor1&lt; double, Dim &gt; &amp;d_xyz)</div><div class="ttdef"><b>Definition</b> <a href="ddTensor0_8hpp_source.html#l00033">ddTensor0.hpp:33</a></div></div>
<div class="ttc" id="anamespaceHenckyOps_html_a990086ab6bdc667b830a40f0ffb74aa3"><div class="ttname"><a href="namespaceHenckyOps.html#a990086ab6bdc667b830a40f0ffb74aa3">HenckyOps::f</a></div><div class="ttdeci">auto f</div><div class="ttdef"><b>Definition</b> <a href="HenckyOps_8hpp_source.html#l00015">HenckyOps.hpp:15</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Types_html_a5d134560d22ac9eebf058d8be240cf06"><div class="ttname"><a href="namespaceMoFEM_1_1Types.html#a5d134560d22ac9eebf058d8be240cf06">MoFEM::Types::BitFieldId</a></div><div class="ttdeci">std::bitset&lt; BITFIELDID_SIZE &gt; BitFieldId</div><div class="ttdoc">Field Id.</div><div class="ttdef"><b>Definition</b> <a href="Types_8hpp_source.html#l00042">Types.hpp:42</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a01f67868b6366749021d5258535655cd"><div class="ttname"><a href="namespaceMoFEM.html#a01f67868b6366749021d5258535655cd">MoFEM::type_from_handle</a></div><div class="ttdeci">auto type_from_handle(const EntityHandle h)</div><div class="ttdoc">get type from entity handle</div><div class="ttdef"><b>Definition</b> <a href="Templates_8hpp_source.html#l01898">Templates.hpp:1898</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_aa36843c42ce7d4c71b63265fcbeb4c9b"><div class="ttname"><a href="namespaceMoFEM.html#aa36843c42ce7d4c71b63265fcbeb4c9b">MoFEM::field_bit_from_bit_number</a></div><div class="ttdeci">auto field_bit_from_bit_number(const int bit_number)</div><div class="ttdoc">get field bit id from bit number</div><div class="ttdef"><b>Definition</b> <a href="Templates_8hpp_source.html#l01930">Templates.hpp:1930</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_ad17eefd5d88d2b51c71ec46cae8569ac"><div class="ttname"><a href="namespaceMoFEM.html#ad17eefd5d88d2b51c71ec46cae8569ac">MoFEM::get_temp_meshset_ptr</a></div><div class="ttdeci">auto get_temp_meshset_ptr(moab::Interface &amp;moab)</div><div class="ttdoc">Create smart pointer to temporary meshset.</div><div class="ttdef"><b>Definition</b> <a href="Templates_8hpp_source.html#l01886">Templates.hpp:1886</a></div></div>
<div class="ttc" id="anamespaceconvert_html_a4db4d50b047acc94e54fdf4df9f3077c"><div class="ttname"><a href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">convert.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition</b> <a href="convert_8py_source.html#l00064">convert.py:64</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_a093526a60371b07213a0be2aaf7afa35"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">MoFEM::CoreInterface::get_comm_size</a></div><div class="ttdeci">virtual int get_comm_size() const =0</div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_a174e70b67f4f235d096d3c45d865645b"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">MoFEM::CoreInterface::get_moab</a></div><div class="ttdeci">virtual moab::Interface &amp; get_moab()=0</div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_aa78f41b59afb60f8e34861eb33d4d880"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#aa78f41b59afb60f8e34861eb33d4d880">MoFEM::CoreInterface::get_field_name</a></div><div class="ttdeci">virtual std::string get_field_name(const BitFieldId id) const =0</div><div class="ttdoc">get field name from id</div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_a07b8c0660cbaa149aa8950f05eb618fa"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#a07b8c0660cbaa149aa8950f05eb618fa">MoFEM::FieldEntity::getHiBitNumberUId</a></div><div class="ttdeci">static UId getHiBitNumberUId(const FieldBitNumber bit_number)</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00228">FieldEntsMultiIndices.hpp:228</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_a0b2b7998f7e8f67a43d371978e278e0e"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#a0b2b7998f7e8f67a43d371978e278e0e">MoFEM::FieldEntity::getHandleFromUniqueId</a></div><div class="ttdeci">static auto getHandleFromUniqueId(const UId uid)</div><div class="ttdoc">Get the Handle From Unique Id.</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00192">FieldEntsMultiIndices.hpp:192</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_a1229056d4a3f0c74321808bde69d947a"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#a1229056d4a3f0c74321808bde69d947a">MoFEM::FieldEntity::getFieldBitNumberFromUniqueId</a></div><div class="ttdeci">static auto getFieldBitNumberFromUniqueId(const UId uid)</div><div class="ttdoc">Get the Field Bit Number From Unique Id.</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00205">FieldEntsMultiIndices.hpp:205</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_a39602b28e32049441386fffae194f258"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#a39602b28e32049441386fffae194f258">MoFEM::FieldEntity::getLocalUniqueIdCalculate</a></div><div class="ttdeci">UId getLocalUniqueIdCalculate()</div><div class="ttdoc">Get the Local Unique Id Calculate object.</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00136">FieldEntsMultiIndices.hpp:136</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_a58d767a919831ecbb8b3b72faad3e9fa"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#a58d767a919831ecbb8b3b72faad3e9fa">MoFEM::FieldEntity::getLoBitNumberUId</a></div><div class="ttdeci">static UId getLoBitNumberUId(const FieldBitNumber bit_number)</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00222">FieldEntsMultiIndices.hpp:222</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_ae2385d4cde52b88c64a87bc2cbb7b615"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#ae2385d4cde52b88c64a87bc2cbb7b615">MoFEM::FieldEntity::getOwnerFromUniqueId</a></div><div class="ttdeci">static auto getOwnerFromUniqueId(const UId uid)</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00177">FieldEntsMultiIndices.hpp:177</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FieldEntity_html_af2642046f8c6e9544ea604807cd2a9c7"><div class="ttname"><a href="structMoFEM_1_1FieldEntity.html#af2642046f8c6e9544ea604807cd2a9c7">MoFEM::FieldEntity::getGlobalUniqueIdCalculate</a></div><div class="ttdeci">UId getGlobalUniqueIdCalculate() const</div><div class="ttdoc">Calculate global UId.</div><div class="ttdef"><b>Definition</b> <a href="FieldEntsMultiIndices_8hpp_source.html#l00216">FieldEntsMultiIndices.hpp:216</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_a91d4ed9ef01690296073b191cb69e85c"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#a91d4ed9ef01690296073b191cb69e85c">MoFEM::ProblemsManager::buildProblemFromFields</a></div><div class="ttdeci">PetscBool buildProblemFromFields</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8hpp_source.html#l00030">ProblemsManager.hpp:30</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_ac9b1d4c2a30de1cae19355a37cb45948"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#ac9b1d4c2a30de1cae19355a37cb45948">MoFEM::ProblemsManager::synchroniseProblemEntities</a></div><div class="ttdeci">PetscBool synchroniseProblemEntities</div><div class="ttdoc">DOFs in fields, not from DOFs on elements.</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8hpp_source.html#l00033">ProblemsManager.hpp:33</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ProblemsManager_html_afee5bf9ff21af9d37bdd1ed5f994bef2"><div class="ttname"><a href="structMoFEM_1_1ProblemsManager.html#afee5bf9ff21af9d37bdd1ed5f994bef2">MoFEM::ProblemsManager::getOptions</a></div><div class="ttdeci">MoFEMErrorCode getOptions()</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l00062">ProblemsManager.cpp:62</a></div></div>
<div class="ttc" id="astructMoFEM_1_1UnknownInterface_html_a7ab248ec45fca778800dcd92e5171beb"><div class="ttname"><a href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">MoFEM::UnknownInterface::getInterface</a></div><div class="ttdeci">MoFEMErrorCode getInterface(IFACE *&amp;iface) const</div><div class="ttdoc">Get interface reference to pointer of interface.</div><div class="ttdef"><b>Definition</b> <a href="UnknownInterface_8hpp_source.html#l00093">UnknownInterface.hpp:93</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga9c86df8247b9fda02508dd26018fff8c" name="ga9c86df8247b9fda02508dd26018fff8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9c86df8247b9fda02508dd26018fff8c">&#9670;&#160;</a></span>buildSubProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::buildSubProblem </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>out_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>fields_row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>fields_col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>main_problem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>square_matrix</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classRange.html">Range</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>entityMapRow</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classRange.html">Range</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>entityMapCol</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build sub problem </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out_name</td><td>problem </td></tr>
    <tr><td class="paramname">fields_row</td><td>vector of fields composing problem </td></tr>
    <tr><td class="paramname">fields_col</td><td>vector of fields composing problem </td></tr>
    <tr><td class="paramname">main_problem</td><td>main problem </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error code </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="free_surface_8cpp-example.html#a217">free_surface.cpp</a>, and <a class="el" href="remove_entities_from_problem_8cpp-example.html#a49">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00977">977</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  988</span>              {</div>
<div class="line"><span class="lineno">  989</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno">  990</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno">  991</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno">  992</span> </div>
<div class="line"><span class="lineno">  993</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__problems.html#ga97e18d7ea29369f0572f4c6cd3e3eeb5">clear_problem</a>(out_name);</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>  <span class="comment">// get reference to all problems</span></div>
<div class="line"><span class="lineno">  996</span>  <span class="keyword">using </span>ProblemByName = <span class="keyword">decltype</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno">  997</span>  <span class="keyword">auto</span> &amp;problems_by_name =</div>
<div class="line"><span class="lineno">  998</span>      <span class="keyword">const_cast&lt;</span>ProblemByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>  <span class="comment">// get iterators to out problem, i.e. build problem</span></div>
<div class="line"><span class="lineno"> 1001</span>  <span class="keyword">auto</span> out_problem_it = problems_by_name.find(out_name);</div>
<div class="line"><span class="lineno"> 1002</span>  <span class="keywordflow">if</span> (out_problem_it == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1003</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1004</span>             <span class="stringliteral">&quot;subproblem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1005</span>             out_name.c_str());</div>
<div class="line"><span class="lineno"> 1006</span>  }</div>
<div class="line"><span class="lineno"> 1007</span>  <span class="comment">// get iterator to main problem, i.e. out problem is subproblem of main</span></div>
<div class="line"><span class="lineno"> 1008</span>  <span class="comment">// problem</span></div>
<div class="line"><span class="lineno"> 1009</span>  <span class="keyword">auto</span> main_problem_it = problems_by_name.find(main_problem);</div>
<div class="line"><span class="lineno"> 1010</span>  <span class="keywordflow">if</span> (main_problem_it == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1011</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1012</span>             <span class="stringliteral">&quot;problem of subproblem with name &lt; %s &gt; not defined (top tip &quot;</span></div>
<div class="line"><span class="lineno"> 1013</span>             <span class="stringliteral">&quot;check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1014</span>             main_problem.c_str());</div>
<div class="line"><span class="lineno"> 1015</span>  }</div>
<div class="line"><span class="lineno"> 1016</span> </div>
<div class="line"><span class="lineno"> 1017</span>  <span class="comment">// get dofs for row &amp; columns for out problem,</span></div>
<div class="line"><span class="lineno"> 1018</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; out_problem_dofs[] = {</div>
<div class="line"><span class="lineno"> 1019</span>      out_problem_it-&gt;numeredRowDofsPtr, out_problem_it-&gt;numeredColDofsPtr};</div>
<div class="line"><span class="lineno"> 1020</span>  <span class="comment">// get dofs for row &amp; columns for main problem</span></div>
<div class="line"><span class="lineno"> 1021</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; main_problem_dofs[] = {</div>
<div class="line"><span class="lineno"> 1022</span>      main_problem_it-&gt;numeredRowDofsPtr, main_problem_it-&gt;numeredColDofsPtr};</div>
<div class="line"><span class="lineno"> 1023</span>  <span class="comment">// get local indices counter</span></div>
<div class="line"><span class="lineno"> 1024</span>  <span class="keywordtype">int</span> *nb_local_dofs[] = {&amp;out_problem_it-&gt;nbLocDofsRow,</div>
<div class="line"><span class="lineno"> 1025</span>                          &amp;out_problem_it-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 1026</span>  <span class="comment">// get global indices counter</span></div>
<div class="line"><span class="lineno"> 1027</span>  <span class="keywordtype">int</span> *nb_dofs[] = {&amp;out_problem_it-&gt;nbDofsRow, &amp;out_problem_it-&gt;nbDofsCol};</div>
<div class="line"><span class="lineno"> 1028</span> </div>
<div class="line"><span class="lineno"> 1029</span>  <span class="comment">// set number of ghost nodes to zero</span></div>
<div class="line"><span class="lineno"> 1030</span>  {</div>
<div class="line"><span class="lineno"> 1031</span>    out_problem_it-&gt;nbGhostDofsRow = 0;</div>
<div class="line"><span class="lineno"> 1032</span>    out_problem_it-&gt;nbGhostDofsCol = 0;</div>
<div class="line"><span class="lineno"> 1033</span>  }</div>
<div class="line"><span class="lineno"> 1034</span> </div>
<div class="line"><span class="lineno"> 1035</span>  <span class="comment">// put rows &amp; columns field names in array</span></div>
<div class="line"><span class="lineno"> 1036</span>  std::vector&lt;std::string&gt; fields[] = {fields_row, fields_col};</div>
<div class="line"><span class="lineno"> 1037</span>  <span class="keyword">const</span> map&lt;std::string, boost::shared_ptr&lt;Range&gt;&gt; *entityMap[] = {</div>
<div class="line"><span class="lineno"> 1038</span>      entityMapRow, entityMapCol};</div>
<div class="line"><span class="lineno"> 1039</span> </div>
<div class="line"><span class="lineno"> 1040</span>  <span class="comment">// make data structure fos sub-problem data</span></div>
<div class="line"><span class="lineno"> 1041</span>  out_problem_it-&gt;subProblemData =</div>
<div class="line"><span class="lineno"> 1042</span>      boost::make_shared&lt;Problem::SubProblemData&gt;();</div>
<div class="line"><span class="lineno"> 1043</span> </div>
<div class="line"><span class="lineno"> 1044</span>  <span class="comment">// Loop over rows and columns</span></div>
<div class="line"><span class="lineno"> 1045</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != (square_matrix ? 1 : 2); ++ss) {</div>
<div class="line"><span class="lineno"> 1046</span> </div>
<div class="line"><span class="lineno"> 1047</span>    <span class="comment">// reset dofs and columns counters</span></div>
<div class="line"><span class="lineno"> 1048</span>    (*nb_local_dofs[ss]) = 0;</div>
<div class="line"><span class="lineno"> 1049</span>    (*nb_dofs[ss]) = 0;</div>
<div class="line"><span class="lineno"> 1050</span>    <span class="comment">// clear arrays</span></div>
<div class="line"><span class="lineno"> 1051</span>    out_problem_dofs[ss]-&gt;clear();</div>
<div class="line"><span class="lineno"> 1052</span> </div>
<div class="line"><span class="lineno"> 1053</span>    <span class="comment">// If DOFs are cleared clear finite elements too.</span></div>
<div class="line"><span class="lineno"> 1054</span>    out_problem_it-&gt;numeredFiniteElementsPtr-&gt;clear();</div>
<div class="line"><span class="lineno"> 1055</span> </div>
<div class="line"><span class="lineno"> 1056</span>    <span class="comment">// get dofs by field name and insert them in out problem multi-indices</span></div>
<div class="line"><span class="lineno"> 1057</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> field : fields[ss]) {</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>      <span class="comment">// Following reserve memory in sequences, only two allocations are here,</span></div>
<div class="line"><span class="lineno"> 1060</span>      <span class="comment">// once for array of objects, next for array of shared pointers</span></div>
<div class="line"><span class="lineno"> 1061</span> </div>
<div class="line"><span class="lineno"> 1062</span>      <span class="comment">// aliased sequence of pointer is killed with element</span></div>
<div class="line"><span class="lineno"> 1063</span>      boost::shared_ptr&lt;std::vector&lt;NumeredDofEntity&gt;&gt; dofs_array =</div>
<div class="line"><span class="lineno"> 1064</span>          boost::make_shared&lt;std::vector&lt;NumeredDofEntity&gt;&gt;();</div>
<div class="line"><span class="lineno"> 1065</span>      <span class="comment">// reserve memory for field  dofs</span></div>
<div class="line"><span class="lineno"> 1066</span>      <span class="keywordflow">if</span> (!ss)</div>
<div class="line"><span class="lineno"> 1067</span>        out_problem_it-&gt;getRowDofsSequence()-&gt;emplace_back(dofs_array);</div>
<div class="line"><span class="lineno"> 1068</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1069</span>        out_problem_it-&gt;getColDofsSequence()-&gt;emplace_back(dofs_array);</div>
<div class="line"><span class="lineno"> 1070</span> </div>
<div class="line"><span class="lineno"> 1071</span>      <span class="comment">// create elements objects</span></div>
<div class="line"><span class="lineno"> 1072</span>      <span class="keyword">auto</span> bit_number = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a151a5aaa12774c726c7a32ba250d2586">get_field_bit_number</a>(field);</div>
<div class="line"><span class="lineno"> 1073</span> </div>
<div class="line"><span class="lineno"> 1074</span>      <span class="keyword">auto</span> add_dit_to_dofs_array = [&amp;](<span class="keyword">auto</span> &amp;dit) {</div>
<div class="line"><span class="lineno"> 1075</span>        <span class="keywordflow">if</span> (dit-&gt;get()-&gt;getPetscGlobalDofIdx() &gt;= 0)</div>
<div class="line"><span class="lineno"> 1076</span>          dofs_array-&gt;emplace_back(</div>
<div class="line"><span class="lineno"> 1077</span>              dit-&gt;get()-&gt;getDofEntityPtr(), dit-&gt;get()-&gt;getPetscGlobalDofIdx(),</div>
<div class="line"><span class="lineno"> 1078</span>              dit-&gt;get()-&gt;getPetscGlobalDofIdx(),</div>
<div class="line"><span class="lineno"> 1079</span>              dit-&gt;get()-&gt;getPetscLocalDofIdx(), dit-&gt;get()-&gt;getPart());</div>
<div class="line"><span class="lineno"> 1080</span>      };</div>
<div class="line"><span class="lineno"> 1081</span> </div>
<div class="line"><span class="lineno"> 1082</span>      <span class="keyword">auto</span> get_dafult_dof_range = [&amp;]() {</div>
<div class="line"><span class="lineno"> 1083</span>        <span class="keyword">auto</span> dit = main_problem_dofs[ss]-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(</div>
<div class="line"><span class="lineno"> 1084</span>            <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a58d767a919831ecbb8b3b72faad3e9fa">FieldEntity::getLoBitNumberUId</a>(bit_number));</div>
<div class="line"><span class="lineno"> 1085</span>        <span class="keyword">auto</span> hi_dit = main_problem_dofs[ss]-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno"> 1086</span>            <a class="code hl_function" href="structMoFEM_1_1FieldEntity.html#a07b8c0660cbaa149aa8950f05eb618fa">FieldEntity::getHiBitNumberUId</a>(bit_number));</div>
<div class="line"><span class="lineno"> 1087</span>        <span class="keywordflow">return</span> std::make_pair(dit, hi_dit);</div>
<div class="line"><span class="lineno"> 1088</span>      };</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span>      <span class="keyword">auto</span> check = [&amp;](<span class="keyword">auto</span> &amp;field) -&gt; boost::shared_ptr&lt;Range&gt; {</div>
<div class="line"><span class="lineno"> 1091</span>        <span class="keywordflow">if</span> (entityMap[ss]) {</div>
<div class="line"><span class="lineno"> 1092</span>          <span class="keyword">auto</span> mit = entityMap[ss]-&gt;find(field);</div>
<div class="line"><span class="lineno"> 1093</span>          <span class="keywordflow">if</span> (mit != entityMap[ss]-&gt;end()) {</div>
<div class="line"><span class="lineno"> 1094</span>            <span class="keywordflow">return</span> mit-&gt;second;</div>
<div class="line"><span class="lineno"> 1095</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1096</span>            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1097</span>          }</div>
<div class="line"><span class="lineno"> 1098</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1099</span>          <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1100</span>        }</div>
<div class="line"><span class="lineno"> 1101</span>      };</div>
<div class="line"><span class="lineno"> 1102</span> </div>
<div class="line"><span class="lineno"> 1103</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> r_ptr = check(field)) {</div>
<div class="line"><span class="lineno"> 1104</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> p = r_ptr-&gt;pair_begin(); p != r_ptr-&gt;pair_end(); ++p) {</div>
<div class="line"><span class="lineno"> 1105</span>          <span class="keyword">const</span> <span class="keyword">auto</span> lo_ent = p-&gt;first;</div>
<div class="line"><span class="lineno"> 1106</span>          <span class="keyword">const</span> <span class="keyword">auto</span> hi_ent = p-&gt;second;</div>
<div class="line"><span class="lineno"> 1107</span>          <span class="keyword">auto</span> dit = main_problem_dofs[ss]-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(</div>
<div class="line"><span class="lineno"> 1108</span>              <a class="code hl_function" href="structMoFEM_1_1DofEntity.html#a2c69be4a12745d83234af39160f0cb89">DofEntity::getLoFieldEntityUId</a>(bit_number, lo_ent));</div>
<div class="line"><span class="lineno"> 1109</span>          <span class="keyword">auto</span> hi_dit = main_problem_dofs[ss]-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno"> 1110</span>              <a class="code hl_function" href="structMoFEM_1_1DofEntity.html#a5b244cf6fac68fd7fe072bbf0bbf705c">DofEntity::getHiFieldEntityUId</a>(bit_number, hi_ent));</div>
<div class="line"><span class="lineno"> 1111</span>          dofs_array-&gt;reserve(std::distance(dit, hi_dit));</div>
<div class="line"><span class="lineno"> 1112</span>          <span class="keywordflow">for</span> (; dit != hi_dit; dit++) {</div>
<div class="line"><span class="lineno"> 1113</span>            add_dit_to_dofs_array(dit);</div>
<div class="line"><span class="lineno"> 1114</span>          }</div>
<div class="line"><span class="lineno"> 1115</span>        }</div>
<div class="line"><span class="lineno"> 1116</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1117</span>        <span class="keyword">auto</span> [dit, hi_dit] = get_dafult_dof_range();</div>
<div class="line"><span class="lineno"> 1118</span>        dofs_array-&gt;reserve(std::distance(dit, hi_dit));</div>
<div class="line"><span class="lineno"> 1119</span>        <span class="keywordflow">for</span> (; dit != hi_dit; dit++)</div>
<div class="line"><span class="lineno"> 1120</span>          add_dit_to_dofs_array(dit);</div>
<div class="line"><span class="lineno"> 1121</span>      }</div>
<div class="line"><span class="lineno"> 1122</span> </div>
<div class="line"><span class="lineno"> 1123</span>      <span class="comment">// fill multi-index</span></div>
<div class="line"><span class="lineno"> 1124</span>      <span class="keyword">auto</span> hint = out_problem_dofs[ss]-&gt;end();</div>
<div class="line"><span class="lineno"> 1125</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a> : *dofs_array)</div>
<div class="line"><span class="lineno"> 1126</span>        hint = out_problem_dofs[ss]-&gt;emplace_hint(hint, dofs_array, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#af16c6805bd7f1a6a9acfe503216a5555">v</a>);</div>
<div class="line"><span class="lineno"> 1127</span>    }</div>
<div class="line"><span class="lineno"> 1128</span>    <span class="comment">// Set local indexes</span></div>
<div class="line"><span class="lineno"> 1129</span>    {</div>
<div class="line"><span class="lineno"> 1130</span>      <span class="keyword">auto</span> dit = out_problem_dofs[ss]-&gt;get&lt;Idx_mi_tag&gt;().begin();</div>
<div class="line"><span class="lineno"> 1131</span>      <span class="keyword">auto</span> hi_dit = out_problem_dofs[ss]-&gt;get&lt;Idx_mi_tag&gt;().end();</div>
<div class="line"><span class="lineno"> 1132</span>      <span class="keywordflow">for</span> (; dit != hi_dit; dit++) {</div>
<div class="line"><span class="lineno"> 1133</span>        <span class="keywordtype">int</span> idx = -1; <span class="comment">// if dof is not part of partition, set local index to -1</span></div>
<div class="line"><span class="lineno"> 1134</span>        <span class="keywordflow">if</span> (dit-&gt;get()-&gt;getPart() == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1135</span>          idx = (*nb_local_dofs[ss])++;</div>
<div class="line"><span class="lineno"> 1136</span>        }</div>
<div class="line"><span class="lineno"> 1137</span>        <span class="keywordtype">bool</span> success = out_problem_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 1138</span>            out_problem_dofs[ss]-&gt;project&lt;0&gt;(dit),</div>
<div class="line"><span class="lineno"> 1139</span>            NumeredDofEntity_local_idx_change(idx));</div>
<div class="line"><span class="lineno"> 1140</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1141</span>          SETERRQ(PETSC_COMM_WORLD, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eab22230d41f866f427f7fa9496875bcc9">MOFEM_ATOM_TEST_INVALID</a>,</div>
<div class="line"><span class="lineno"> 1142</span>                  <span class="stringliteral">&quot;operation unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1143</span>        }</div>
<div class="line"><span class="lineno"> 1144</span>      };</div>
<div class="line"><span class="lineno"> 1145</span>    }</div>
<div class="line"><span class="lineno"> 1146</span>    <span class="comment">// Set global indexes, compress global indices</span></div>
<div class="line"><span class="lineno"> 1147</span>    {</div>
<div class="line"><span class="lineno"> 1148</span>      <span class="keyword">auto</span> dit =</div>
<div class="line"><span class="lineno"> 1149</span>          out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().lower_bound(0);</div>
<div class="line"><span class="lineno"> 1150</span>      <span class="keyword">auto</span> hi_dit =</div>
<div class="line"><span class="lineno"> 1151</span>          out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno"> 1152</span>              out_problem_dofs[ss]-&gt;size());</div>
<div class="line"><span class="lineno"> 1153</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> nb = std::distance(dit, hi_dit);</div>
<div class="line"><span class="lineno"> 1154</span>      <span class="comment">// get main problem global indices</span></div>
<div class="line"><span class="lineno"> 1155</span>      std::vector&lt;int&gt; main_indices(nb);</div>
<div class="line"><span class="lineno"> 1156</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = main_indices.begin(); dit != hi_dit; dit++, it++) {</div>
<div class="line"><span class="lineno"> 1157</span>        *it = dit-&gt;get()-&gt;getPetscGlobalDofIdx();</div>
<div class="line"><span class="lineno"> 1158</span>      }</div>
<div class="line"><span class="lineno"> 1159</span>      <span class="comment">// create is with global dofs</span></div>
<div class="line"><span class="lineno"> 1160</span>      IS is;</div>
<div class="line"><span class="lineno"> 1161</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISCreateGeneral(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), nb, &amp;*main_indices.begin(),</div>
<div class="line"><span class="lineno"> 1162</span>                             PETSC_USE_POINTER, &amp;is);</div>
<div class="line"><span class="lineno"> 1163</span>      <span class="comment">// create map form main problem global indices to out problem global</span></div>
<div class="line"><span class="lineno"> 1164</span>      <span class="comment">// indices</span></div>
<div class="line"><span class="lineno"> 1165</span>      AO ao;</div>
<div class="line"><span class="lineno"> 1166</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOCreateMappingIS(is, PETSC_NULLPTR, &amp;ao);</div>
<div class="line"><span class="lineno"> 1167</span>      <span class="keywordflow">if</span> (ss == 0) {</div>
<div class="line"><span class="lineno"> 1168</span>        IS is_dup;</div>
<div class="line"><span class="lineno"> 1169</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDuplicate(is, &amp;is_dup);</div>
<div class="line"><span class="lineno"> 1170</span>        out_problem_it-&gt;getSubData()-&gt;rowIs = SmartPetscObj&lt;IS&gt;(is_dup, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1171</span>        out_problem_it-&gt;getSubData()-&gt;rowMap = SmartPetscObj&lt;AO&gt;(ao, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1172</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1173</span>        IS is_dup;</div>
<div class="line"><span class="lineno"> 1174</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDuplicate(is, &amp;is_dup);</div>
<div class="line"><span class="lineno"> 1175</span>        out_problem_it-&gt;getSubData()-&gt;colIs = SmartPetscObj&lt;IS&gt;(is_dup, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1176</span>        out_problem_it-&gt;getSubData()-&gt;colMap = SmartPetscObj&lt;AO&gt;(ao, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1177</span>      }</div>
<div class="line"><span class="lineno"> 1178</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOApplicationToPetscIS(ao, is);</div>
<div class="line"><span class="lineno"> 1179</span>      <span class="comment">// set global number of DOFs</span></div>
<div class="line"><span class="lineno"> 1180</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetSize(is, nb_dofs[ss]);</div>
<div class="line"><span class="lineno"> 1181</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is);</div>
<div class="line"><span class="lineno"> 1182</span>      <span class="comment">// set out problem global indices after applying map</span></div>
<div class="line"><span class="lineno"> 1183</span>      dit = out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().lower_bound(0);</div>
<div class="line"><span class="lineno"> 1184</span>      <span class="keywordflow">for</span> (std::vector&lt;int&gt;::iterator it = main_indices.begin(); dit != hi_dit;</div>
<div class="line"><span class="lineno"> 1185</span>           dit++, it++) {</div>
<div class="line"><span class="lineno"> 1186</span>        <span class="keywordtype">bool</span> success = out_problem_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 1187</span>            out_problem_dofs[ss]-&gt;project&lt;0&gt;(dit),</div>
<div class="line"><span class="lineno"> 1188</span>            NumeredDofEntity_part_and_all_indices_change(</div>
<div class="line"><span class="lineno"> 1189</span>                dit-&gt;get()-&gt;getPart(), *it, *it,</div>
<div class="line"><span class="lineno"> 1190</span>                dit-&gt;get()-&gt;getPetscLocalDofIdx()));</div>
<div class="line"><span class="lineno"> 1191</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1192</span>          SETERRQ(PETSC_COMM_WORLD, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eab22230d41f866f427f7fa9496875bcc9">MOFEM_ATOM_TEST_INVALID</a>,</div>
<div class="line"><span class="lineno"> 1193</span>                  <span class="stringliteral">&quot;operation unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1194</span>        }</div>
<div class="line"><span class="lineno"> 1195</span>      }</div>
<div class="line"><span class="lineno"> 1196</span>      <span class="comment">// set global indices to nodes not on this part</span></div>
<div class="line"><span class="lineno"> 1197</span>      {</div>
<div class="line"><span class="lineno"> 1198</span>        NumeredDofEntityByLocalIdx::iterator dit =</div>
<div class="line"><span class="lineno"> 1199</span>            out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().lower_bound(-1);</div>
<div class="line"><span class="lineno"> 1200</span>        NumeredDofEntityByLocalIdx::iterator hi_dit =</div>
<div class="line"><span class="lineno"> 1201</span>            out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().upper_bound(-1);</div>
<div class="line"><span class="lineno"> 1202</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> nb = std::distance(dit, hi_dit);</div>
<div class="line"><span class="lineno"> 1203</span>        std::vector&lt;int&gt; main_indices_non_local(nb);</div>
<div class="line"><span class="lineno"> 1204</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = main_indices_non_local.begin(); dit != hi_dit;</div>
<div class="line"><span class="lineno"> 1205</span>             dit++, it++) {</div>
<div class="line"><span class="lineno"> 1206</span>          *it = dit-&gt;get()-&gt;getPetscGlobalDofIdx();</div>
<div class="line"><span class="lineno"> 1207</span>        }</div>
<div class="line"><span class="lineno"> 1208</span>        IS is;</div>
<div class="line"><span class="lineno"> 1209</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISCreateGeneral(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), nb,</div>
<div class="line"><span class="lineno"> 1210</span>                               &amp;*main_indices_non_local.begin(),</div>
<div class="line"><span class="lineno"> 1211</span>                               PETSC_USE_POINTER, &amp;is);</div>
<div class="line"><span class="lineno"> 1212</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOApplicationToPetscIS(ao, is);</div>
<div class="line"><span class="lineno"> 1213</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is);</div>
<div class="line"><span class="lineno"> 1214</span>        dit = out_problem_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().lower_bound(-1);</div>
<div class="line"><span class="lineno"> 1215</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = main_indices_non_local.begin(); dit != hi_dit;</div>
<div class="line"><span class="lineno"> 1216</span>             dit++, it++) {</div>
<div class="line"><span class="lineno"> 1217</span>          <span class="keywordtype">bool</span> success = out_problem_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 1218</span>              out_problem_dofs[ss]-&gt;project&lt;0&gt;(dit),</div>
<div class="line"><span class="lineno"> 1219</span>              NumeredDofEntity_part_and_all_indices_change(</div>
<div class="line"><span class="lineno"> 1220</span>                  dit-&gt;get()-&gt;getPart(), dit-&gt;get()-&gt;getDofIdx(), *it,</div>
<div class="line"><span class="lineno"> 1221</span>                  dit-&gt;get()-&gt;getPetscLocalDofIdx()));</div>
<div class="line"><span class="lineno"> 1222</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1223</span>            SETERRQ(PETSC_COMM_WORLD, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eab22230d41f866f427f7fa9496875bcc9">MOFEM_ATOM_TEST_INVALID</a>,</div>
<div class="line"><span class="lineno"> 1224</span>                    <span class="stringliteral">&quot;operation unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1225</span>          }</div>
<div class="line"><span class="lineno"> 1226</span>        }</div>
<div class="line"><span class="lineno"> 1227</span>      }</div>
<div class="line"><span class="lineno"> 1228</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AODestroy(&amp;ao);</div>
<div class="line"><span class="lineno"> 1229</span>    }</div>
<div class="line"><span class="lineno"> 1230</span>  }</div>
<div class="line"><span class="lineno"> 1231</span> </div>
<div class="line"><span class="lineno"> 1232</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1233</span>    out_problem_it-&gt;numeredColDofsPtr = out_problem_it-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno"> 1234</span>    out_problem_it-&gt;nbLocDofsCol = out_problem_it-&gt;nbLocDofsRow;</div>
<div class="line"><span class="lineno"> 1235</span>    out_problem_it-&gt;nbDofsCol = out_problem_it-&gt;nbDofsRow;</div>
<div class="line"><span class="lineno"> 1236</span>    out_problem_it-&gt;getSubData()-&gt;colIs = out_problem_it-&gt;getSubData()-&gt;rowIs;</div>
<div class="line"><span class="lineno"> 1237</span>    out_problem_it-&gt;getSubData()-&gt;colMap = out_problem_it-&gt;getSubData()-&gt;rowMap;</div>
<div class="line"><span class="lineno"> 1238</span>  }</div>
<div class="line"><span class="lineno"> 1239</span> </div>
<div class="line"><span class="lineno"> 1240</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(&amp;*out_problem_it, verb);</div>
<div class="line"><span class="lineno"> 1241</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#ae1931e8cb3ddacb79ed9f2dafb15b82d">debugPartitionedProblem</a>(&amp;*out_problem_it, verb);</div>
<div class="line"><span class="lineno"> 1242</span> </div>
<div class="line"><span class="lineno"> 1243</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1244</span>}</div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eab22230d41f866f427f7fa9496875bcc9"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eab22230d41f866f427f7fa9496875bcc9">MOFEM_ATOM_TEST_INVALID</a></div><div class="ttdeci">@ MOFEM_ATOM_TEST_INVALID</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00040">definitions.h:40</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_a151a5aaa12774c726c7a32ba250d2586"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#a151a5aaa12774c726c7a32ba250d2586">MoFEM::CoreInterface::get_field_bit_number</a></div><div class="ttdeci">virtual FieldBitNumber get_field_bit_number(const std::string name) const =0</div><div class="ttdoc">get field bit number</div></div>
<div class="ttc" id="astructMoFEM_1_1DofEntity_html_a2c69be4a12745d83234af39160f0cb89"><div class="ttname"><a href="structMoFEM_1_1DofEntity.html#a2c69be4a12745d83234af39160f0cb89">MoFEM::DofEntity::getLoFieldEntityUId</a></div><div class="ttdeci">static UId getLoFieldEntityUId(const FieldBitNumber bit, const EntityHandle ent)</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00069">DofsMultiIndices.hpp:69</a></div></div>
<div class="ttc" id="astructMoFEM_1_1DofEntity_html_a5b244cf6fac68fd7fe072bbf0bbf705c"><div class="ttname"><a href="structMoFEM_1_1DofEntity.html#a5b244cf6fac68fd7fe072bbf0bbf705c">MoFEM::DofEntity::getHiFieldEntityUId</a></div><div class="ttdeci">static UId getHiFieldEntityUId(const FieldBitNumber bit, const EntityHandle ent)</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00075">DofsMultiIndices.hpp:75</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gab994c93ba6c9ede9e253730b6f90f4da" name="gab994c93ba6c9ede9e253730b6f90f4da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab994c93ba6c9ede9e253730b6f90f4da">&#9670;&#160;</a></span>getFEMeshset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::getFEMeshset </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>prb_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>fe_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EntityHandle *&#160;</td>
          <td class="paramname"><em>meshset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>create add entities of finite element in the problem </p>
<p>\create add entities of finite element in the problem</p>
<dl class="section note"><dt>Note</dt><dd>Meshset entity has to be crated </dd>
<dd>
Meshset entity has to be crated</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">prb_name</td><td>name of the problem </td></tr>
    <tr><td class="paramname">fe_name</td><td>name of the entity </td></tr>
    <tr><td class="paramname">meshset</td><td>pointer meshset handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MoFEMErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02564">2564</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2566</span>                                                                          {</div>
<div class="line"><span class="lineno"> 2567</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2568</span>  <span class="keyword">const</span> Problem *problem_ptr;</div>
<div class="line"><span class="lineno"> 2569</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="group__fe__multi__indices.html#gafc0316a63e58811ef99c30317566954e">FiniteElement_multiIndex</a> *fes_ptr;</div>
<div class="line"><span class="lineno"> 2570</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2571</span> </div>
<div class="line"><span class="lineno"> 2572</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().create_meshset(MESHSET_SET, *meshset);</div>
<div class="line"><span class="lineno"> 2573</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">get_problem</a>(prb_name, &amp;problem_ptr);</div>
<div class="line"><span class="lineno"> 2574</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga3da3ee1182ff3eee599ba61513325271">get_finite_elements</a>(&amp;fes_ptr);</div>
<div class="line"><span class="lineno"> 2575</span> </div>
<div class="line"><span class="lineno"> 2576</span>  <span class="keyword">auto</span> fe_miit = fes_ptr-&gt;get&lt;FiniteElement_name_mi_tag&gt;().find(fe_name);</div>
<div class="line"><span class="lineno"> 2577</span>  <span class="keywordflow">if</span> (fe_miit != fes_ptr-&gt;get&lt;FiniteElement_name_mi_tag&gt;().end()) {</div>
<div class="line"><span class="lineno"> 2578</span>    <span class="keyword">auto</span> fit =</div>
<div class="line"><span class="lineno"> 2579</span>        problem_ptr-&gt;numeredFiniteElementsPtr-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(</div>
<div class="line"><span class="lineno"> 2580</span>            <a class="code hl_function" href="structMoFEM_1_1EntFiniteElement.html#a01a6659e3650d85c46981ca598a5a437">EntFiniteElement::getLocalUniqueIdCalculate</a>(</div>
<div class="line"><span class="lineno"> 2581</span>                0, (*fe_miit)-&gt;getFEUId()));</div>
<div class="line"><span class="lineno"> 2582</span>    <span class="keyword">auto</span> hi_fe_it =</div>
<div class="line"><span class="lineno"> 2583</span>        problem_ptr-&gt;numeredFiniteElementsPtr-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno"> 2584</span>            <a class="code hl_function" href="structMoFEM_1_1EntFiniteElement.html#a01a6659e3650d85c46981ca598a5a437">EntFiniteElement::getLocalUniqueIdCalculate</a>(</div>
<div class="line"><span class="lineno"> 2585</span>                get_id_for_max_type&lt;MBENTITYSET&gt;(), (*fe_miit)-&gt;getFEUId()));</div>
<div class="line"><span class="lineno"> 2586</span>    std::vector&lt;EntityHandle&gt; fe_vec;</div>
<div class="line"><span class="lineno"> 2587</span>    fe_vec.reserve(std::distance(fit, hi_fe_it));</div>
<div class="line"><span class="lineno"> 2588</span>    <span class="keywordflow">for</span> (; fit != hi_fe_it; fit++)</div>
<div class="line"><span class="lineno"> 2589</span>      fe_vec.push_back(fit-&gt;get()-&gt;getEnt());</div>
<div class="line"><span class="lineno"> 2590</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().add_entities(*meshset, &amp;*fe_vec.begin(),</div>
<div class="line"><span class="lineno"> 2591</span>                                           fe_vec.size());</div>
<div class="line"><span class="lineno"> 2592</span>  }</div>
<div class="line"><span class="lineno"> 2593</span> </div>
<div class="line"><span class="lineno"> 2594</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2595</span>}</div>
<div class="ttc" id="agroup__fe__multi__indices_html_gafc0316a63e58811ef99c30317566954e"><div class="ttname"><a href="group__fe__multi__indices.html#gafc0316a63e58811ef99c30317566954e">FiniteElement_multiIndex</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; FiniteElement &gt;, indexed_by&lt; hashed_unique&lt; tag&lt; FiniteElement_Meshset_mi_tag &gt;, member&lt; FiniteElement, EntityHandle, &amp;FiniteElement::meshset &gt; &gt;, hashed_unique&lt; tag&lt; BitFEId_mi_tag &gt;, const_mem_fun&lt; FiniteElement, BitFEId, &amp;FiniteElement::getId &gt;, HashBit&lt; BitFEId &gt;, EqBit&lt; BitFEId &gt; &gt;, ordered_unique&lt; tag&lt; FiniteElement_name_mi_tag &gt;, const_mem_fun&lt; FiniteElement, boost::string_ref, &amp;FiniteElement::getNameRef &gt; &gt; &gt; &gt; FiniteElement_multiIndex</div><div class="ttdoc">MultiIndex for entities for FiniteElement.</div><div class="ttdef"><b>Definition</b> <a href="FEMultiIndices_8hpp_source.html#l00849">FEMultiIndices.hpp:849</a></div></div>
<div class="ttc" id="astructMoFEM_1_1EntFiniteElement_html_a01a6659e3650d85c46981ca598a5a437"><div class="ttname"><a href="structMoFEM_1_1EntFiniteElement.html#a01a6659e3650d85c46981ca598a5a437">MoFEM::EntFiniteElement::getLocalUniqueIdCalculate</a></div><div class="ttdeci">UId getLocalUniqueIdCalculate() const</div><div class="ttdoc">Generate UId for finite element entity.</div><div class="ttdef"><b>Definition</b> <a href="FEMultiIndices_8hpp_source.html#l00528">FEMultiIndices.hpp:528</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gab726d4935d2706f51bade5ccd5cf40a6" name="gab726d4935d2706f51bade5ccd5cf40a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab726d4935d2706f51bade5ccd5cf40a6">&#9670;&#160;</a></span>getProblemElementsLayout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::getProblemElementsLayout </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>fe_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscLayout *&#160;</td>
          <td class="paramname"><em>layout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get layout of elements in the problem. </p>
<p>In layout is stored information how many elements is on each processor, for more information look int petsc documentation <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/IS/PetscLayoutCreate.html#PetscLayoutCreate">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/IS/PetscLayoutCreate.html#PetscLayoutCreate</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
    <tr><td class="paramname">fe_name</td><td>finite elements </td></tr>
    <tr><td class="paramname">layout</td><td>layout </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02598">2598</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2600</span>                                                                     {</div>
<div class="line"><span class="lineno"> 2601</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2602</span>  <span class="keyword">const</span> Problem *problem_ptr;</div>
<div class="line"><span class="lineno"> 2603</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2604</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">get_problem</a>(name, &amp;problem_ptr);</div>
<div class="line"><span class="lineno"> 2605</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> problem_ptr-&gt;<a class="code hl_function" href="structMoFEM_1_1Problem.html#a22d1a700921ff9e73863085ff4647b0c">getNumberOfElementsByNameAndPart</a>(PETSC_COMM_WORLD,</div>
<div class="line"><span class="lineno"> 2606</span>                                                       fe_name, layout);</div>
<div class="line"><span class="lineno"> 2607</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2608</span>}</div>
<div class="ttc" id="astructMoFEM_1_1Problem_html_a22d1a700921ff9e73863085ff4647b0c"><div class="ttname"><a href="structMoFEM_1_1Problem.html#a22d1a700921ff9e73863085ff4647b0c">MoFEM::Problem::getNumberOfElementsByNameAndPart</a></div><div class="ttdeci">MoFEMErrorCode getNumberOfElementsByNameAndPart(MPI_Comm comm, const std::string name, PetscLayout *layout) const</div><div class="ttdoc">Get number of finite elements by name on processors.</div><div class="ttdef"><b>Definition</b> <a href="ProblemsMultiIndices_8cpp_source.html#l00098">ProblemsMultiIndices.cpp:98</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gabb6e6723b26106294b1068f819538fd1" name="gabb6e6723b26106294b1068f819538fd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabb6e6723b26106294b1068f819538fd1">&#9670;&#160;</a></span>inheritPartition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::inheritPartition </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>problem_for_rows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>copy_rows</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>problem_for_cols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>copy_cols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>build indexing and partition problem inheriting indexing and partitioning from two other problems </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
    <tr><td class="paramname">problem_for_rows</td><td>problem used to index rows </td></tr>
    <tr><td class="paramname">copy_rows</td><td>just copy rows dofs </td></tr>
    <tr><td class="paramname">problem_for_cols</td><td>problem used to index cols </td></tr>
    <tr><td class="paramname">copy_cols</td><td>just copy cols dofs</td></tr>
  </table>
  </dd>
</dl>
<p>If copy_rows/copy_cols is set to false only partition is copied between problems. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="build_problems_8cpp-example.html#a34">build_problems.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l01892">1892</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1894</span>                                                                {</div>
<div class="line"><span class="lineno"> 1895</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 1896</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 1897</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1898</span> </div>
<div class="line"><span class="lineno"> 1899</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 1900</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;pRoblems not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1901</span> </div>
<div class="line"><span class="lineno"> 1902</span>  <span class="keyword">typedef</span> Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type ProblemByName;</div>
<div class="line"><span class="lineno"> 1903</span> </div>
<div class="line"><span class="lineno"> 1904</span>  <span class="comment">// find p_miit</span></div>
<div class="line"><span class="lineno"> 1905</span>  ProblemByName &amp;problems_by_name =</div>
<div class="line"><span class="lineno"> 1906</span>      <span class="keyword">const_cast&lt;</span>ProblemByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1907</span>  ProblemByName::iterator p_miit = problems_by_name.find(name);</div>
<div class="line"><span class="lineno"> 1908</span>  <span class="keywordflow">if</span> (p_miit == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1909</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873">MOFEM_NOT_FOUND</a>,</div>
<div class="line"><span class="lineno"> 1910</span>             <span class="stringliteral">&quot;problem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1911</span>             name.c_str());</div>
<div class="line"><span class="lineno"> 1912</span>  }</div>
<div class="line"><span class="lineno"> 1913</span>  <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>)</div>
<div class="line"><span class="lineno"> 1914</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform)</div>
<div class="line"><span class="lineno"> 1915</span>        &lt;&lt; p_miit-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; from rows of &quot;</span> &lt;&lt; problem_for_rows</div>
<div class="line"><span class="lineno"> 1916</span>        &lt;&lt; <span class="stringliteral">&quot; and columns of &quot;</span> &lt;&lt; problem_for_cols;</div>
<div class="line"><span class="lineno"> 1917</span> </div>
<div class="line"><span class="lineno"> 1918</span>  <span class="comment">// find p_miit_row</span></div>
<div class="line"><span class="lineno"> 1919</span>  ProblemByName::iterator p_miit_row = problems_by_name.find(problem_for_rows);</div>
<div class="line"><span class="lineno"> 1920</span>  <span class="keywordflow">if</span> (p_miit_row == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1921</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1922</span>             <span class="stringliteral">&quot;problem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1923</span>             problem_for_rows.c_str());</div>
<div class="line"><span class="lineno"> 1924</span>  }</div>
<div class="line"><span class="lineno"> 1925</span>  <span class="keyword">const</span> boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; dofs_row =</div>
<div class="line"><span class="lineno"> 1926</span>      p_miit_row-&gt;numeredRowDofsPtr;</div>
<div class="line"><span class="lineno"> 1927</span> </div>
<div class="line"><span class="lineno"> 1928</span>  <span class="comment">// find p_mit_col</span></div>
<div class="line"><span class="lineno"> 1929</span>  ProblemByName::iterator p_miit_col = problems_by_name.find(problem_for_cols);</div>
<div class="line"><span class="lineno"> 1930</span>  <span class="keywordflow">if</span> (p_miit_col == problems_by_name.end()) {</div>
<div class="line"><span class="lineno"> 1931</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1932</span>             <span class="stringliteral">&quot;problem with name &lt; %s &gt; not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1933</span>             problem_for_cols.c_str());</div>
<div class="line"><span class="lineno"> 1934</span>  }</div>
<div class="line"><span class="lineno"> 1935</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; dofs_col =</div>
<div class="line"><span class="lineno"> 1936</span>      p_miit_col-&gt;numeredColDofsPtr;</div>
<div class="line"><span class="lineno"> 1937</span> </div>
<div class="line"><span class="lineno"> 1938</span>  <span class="keywordtype">bool</span> copy[] = {copy_rows, copy_cols};</div>
<div class="line"><span class="lineno"> 1939</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; composed_dofs[] = {</div>
<div class="line"><span class="lineno"> 1940</span>      p_miit-&gt;numeredRowDofsPtr, p_miit-&gt;numeredColDofsPtr};</div>
<div class="line"><span class="lineno"> 1941</span> </div>
<div class="line"><span class="lineno"> 1942</span>  <span class="keywordtype">int</span> *nb_local_dofs[] = {&amp;p_miit-&gt;nbLocDofsRow, &amp;p_miit-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 1943</span>  <span class="keywordtype">int</span> *nb_dofs[] = {&amp;p_miit-&gt;nbDofsRow, &amp;p_miit-&gt;nbDofsCol};</div>
<div class="line"><span class="lineno"> 1944</span>  boost::shared_ptr&lt;NumeredDofEntity_multiIndex&gt; copied_dofs[] = {dofs_row,</div>
<div class="line"><span class="lineno"> 1945</span>                                                                  dofs_col};</div>
<div class="line"><span class="lineno"> 1946</span> </div>
<div class="line"><span class="lineno"> 1947</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss &lt; 2; ss++) {</div>
<div class="line"><span class="lineno"> 1948</span> </div>
<div class="line"><span class="lineno"> 1949</span>    <span class="comment">// build indices</span></div>
<div class="line"><span class="lineno"> 1950</span>    *nb_local_dofs[ss] = 0;</div>
<div class="line"><span class="lineno"> 1951</span>    <span class="keywordflow">if</span> (!copy[ss]) {</div>
<div class="line"><span class="lineno"> 1952</span> </div>
<div class="line"><span class="lineno"> 1953</span>      <span class="comment">// only copy indices which are belong to some elements if this problem</span></div>
<div class="line"><span class="lineno"> 1954</span>      std::vector&lt;int&gt; is_local, is_new;</div>
<div class="line"><span class="lineno"> 1955</span> </div>
<div class="line"><span class="lineno"> 1956</span>      <a class="code hl_typedef" href="group__dof__multi__indices.html#ga3fa4afad013bb6da2c9ee27e635d9c49">NumeredDofEntityByUId</a> &amp;dofs_by_uid =</div>
<div class="line"><span class="lineno"> 1957</span>          copied_dofs[ss]-&gt;get&lt;Unique_mi_tag&gt;();</div>
<div class="line"><span class="lineno"> 1958</span>      <span class="keywordflow">for</span> (NumeredDofEntity_multiIndex::iterator dit =</div>
<div class="line"><span class="lineno"> 1959</span>               composed_dofs[ss]-&gt;begin();</div>
<div class="line"><span class="lineno"> 1960</span>           dit != composed_dofs[ss]-&gt;end(); dit++) {</div>
<div class="line"><span class="lineno"> 1961</span>        NumeredDofEntityByUId::iterator diit =</div>
<div class="line"><span class="lineno"> 1962</span>            dofs_by_uid.find((*dit)-&gt;getLocalUniqueId());</div>
<div class="line"><span class="lineno"> 1963</span>        <span class="keywordflow">if</span> (diit == dofs_by_uid.end()) {</div>
<div class="line"><span class="lineno"> 1964</span>          SETERRQ(</div>
<div class="line"><span class="lineno"> 1965</span>              m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1966</span>              <span class="stringliteral">&quot;data inconsistency, could not find dof in composite problem&quot;</span>);</div>
<div class="line"><span class="lineno"> 1967</span>        }</div>
<div class="line"><span class="lineno"> 1968</span>        <span class="keywordtype">int</span> part_number = (*diit)-&gt;getPart(); <span class="comment">// get part number</span></div>
<div class="line"><span class="lineno"> 1969</span>        <span class="keywordtype">int</span> petsc_global_dof = (*diit)-&gt;getPetscGlobalDofIdx();</div>
<div class="line"><span class="lineno"> 1970</span>        <span class="keywordtype">bool</span> success;</div>
<div class="line"><span class="lineno"> 1971</span>        success = composed_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 1972</span>            dit, NumeredDofEntity_part_and_glob_idx_change(part_number,</div>
<div class="line"><span class="lineno"> 1973</span>                                                           petsc_global_dof));</div>
<div class="line"><span class="lineno"> 1974</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1975</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1976</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1977</span>        }</div>
<div class="line"><span class="lineno"> 1978</span>        <span class="keywordflow">if</span> ((*dit)-&gt;getPart() == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1979</span>          success = composed_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 1980</span>              dit, NumeredDofEntity_local_idx_change((*nb_local_dofs[ss])++));</div>
<div class="line"><span class="lineno"> 1981</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1982</span>            SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1983</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1984</span>          }</div>
<div class="line"><span class="lineno"> 1985</span>          is_local.push_back(petsc_global_dof);</div>
<div class="line"><span class="lineno"> 1986</span>        }</div>
<div class="line"><span class="lineno"> 1987</span>      }</div>
<div class="line"><span class="lineno"> 1988</span> </div>
<div class="line"><span class="lineno"> 1989</span>      AO ao;</div>
<div class="line"><span class="lineno"> 1990</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOCreateMapping(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), is_local.size(), &amp;is_local[0],</div>
<div class="line"><span class="lineno"> 1991</span>                             NULL, &amp;ao);</div>
<div class="line"><span class="lineno"> 1992</span> </div>
<div class="line"><span class="lineno"> 1993</span>      <span class="comment">// apply local to global mapping</span></div>
<div class="line"><span class="lineno"> 1994</span>      is_local.resize(0);</div>
<div class="line"><span class="lineno"> 1995</span>      <span class="keywordflow">for</span> (NumeredDofEntity_multiIndex::iterator dit =</div>
<div class="line"><span class="lineno"> 1996</span>               composed_dofs[ss]-&gt;begin();</div>
<div class="line"><span class="lineno"> 1997</span>           dit != composed_dofs[ss]-&gt;end(); dit++) {</div>
<div class="line"><span class="lineno"> 1998</span>        is_local.push_back((*dit)-&gt;getPetscGlobalDofIdx());</div>
<div class="line"><span class="lineno"> 1999</span>      }</div>
<div class="line"><span class="lineno"> 2000</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOPetscToApplication(ao, is_local.size(), &amp;is_local[0]);</div>
<div class="line"><span class="lineno"> 2001</span>      <span class="keywordtype">int</span> idx2 = 0;</div>
<div class="line"><span class="lineno"> 2002</span>      <span class="keywordflow">for</span> (NumeredDofEntity_multiIndex::iterator dit =</div>
<div class="line"><span class="lineno"> 2003</span>               composed_dofs[ss]-&gt;begin();</div>
<div class="line"><span class="lineno"> 2004</span>           dit != composed_dofs[ss]-&gt;end(); dit++) {</div>
<div class="line"><span class="lineno"> 2005</span>        <span class="keywordtype">int</span> part_number = (*dit)-&gt;getPart(); <span class="comment">// get part number</span></div>
<div class="line"><span class="lineno"> 2006</span>        <span class="keywordtype">int</span> petsc_global_dof = is_local[idx2++];</div>
<div class="line"><span class="lineno"> 2007</span>        <span class="keywordtype">bool</span> success;</div>
<div class="line"><span class="lineno"> 2008</span>        success = composed_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 2009</span>            dit, NumeredDofEntity_part_and_glob_idx_change(part_number,</div>
<div class="line"><span class="lineno"> 2010</span>                                                           petsc_global_dof));</div>
<div class="line"><span class="lineno"> 2011</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 2012</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 2013</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 2014</span>        }</div>
<div class="line"><span class="lineno"> 2015</span>      }</div>
<div class="line"><span class="lineno"> 2016</span> </div>
<div class="line"><span class="lineno"> 2017</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AODestroy(&amp;ao);</div>
<div class="line"><span class="lineno"> 2018</span> </div>
<div class="line"><span class="lineno"> 2019</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2020</span> </div>
<div class="line"><span class="lineno"> 2021</span>      <span class="keywordflow">for</span> (NumeredDofEntity_multiIndex::iterator dit = copied_dofs[ss]-&gt;begin();</div>
<div class="line"><span class="lineno"> 2022</span>           dit != copied_dofs[ss]-&gt;end(); dit++) {</div>
<div class="line"><span class="lineno"> 2023</span>        std::pair&lt;NumeredDofEntity_multiIndex::iterator, bool&gt; p;</div>
<div class="line"><span class="lineno"> 2024</span>        p = composed_dofs[ss]-&gt;insert(boost::shared_ptr&lt;NumeredDofEntity&gt;(</div>
<div class="line"><span class="lineno"> 2025</span>            <span class="keyword">new</span> NumeredDofEntity((*dit)-&gt;getDofEntityPtr())));</div>
<div class="line"><span class="lineno"> 2026</span>        <span class="keywordflow">if</span> (p.second) {</div>
<div class="line"><span class="lineno"> 2027</span>          (*nb_dofs[ss])++;</div>
<div class="line"><span class="lineno"> 2028</span>        }</div>
<div class="line"><span class="lineno"> 2029</span>        <span class="keywordtype">int</span> dof_idx = (*dit)-&gt;getDofIdx();</div>
<div class="line"><span class="lineno"> 2030</span>        <span class="keywordtype">int</span> part_number = (*dit)-&gt;getPart(); <span class="comment">// get part number</span></div>
<div class="line"><span class="lineno"> 2031</span>        <span class="keywordtype">int</span> petsc_global_dof = (*dit)-&gt;getPetscGlobalDofIdx();</div>
<div class="line"><span class="lineno"> 2032</span>        <span class="keywordflow">if</span> (part_number == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 2033</span>          <span class="keyword">const</span> <span class="keywordtype">bool</span> success = composed_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 2034</span>              p.first, NumeredDofEntity_part_and_all_indices_change(</div>
<div class="line"><span class="lineno"> 2035</span>                           part_number, dof_idx, petsc_global_dof,</div>
<div class="line"><span class="lineno"> 2036</span>                           (*nb_local_dofs[ss])++));</div>
<div class="line"><span class="lineno"> 2037</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 2038</span>            SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 2039</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 2040</span>          }</div>
<div class="line"><span class="lineno"> 2041</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2042</span>          <span class="keyword">const</span> <span class="keywordtype">bool</span> success = composed_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 2043</span>              p.first, NumeredDofEntity_part_and_mofem_glob_idx_change(</div>
<div class="line"><span class="lineno"> 2044</span>                           part_number, dof_idx, petsc_global_dof));</div>
<div class="line"><span class="lineno"> 2045</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 2046</span>            SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 2047</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 2048</span>          }</div>
<div class="line"><span class="lineno"> 2049</span>        }</div>
<div class="line"><span class="lineno"> 2050</span>      }</div>
<div class="line"><span class="lineno"> 2051</span>    }</div>
<div class="line"><span class="lineno"> 2052</span>  }</div>
<div class="line"><span class="lineno"> 2053</span> </div>
<div class="line"><span class="lineno"> 2054</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(&amp;*p_miit, verb);</div>
<div class="line"><span class="lineno"> 2055</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#ae1931e8cb3ddacb79ed9f2dafb15b82d">debugPartitionedProblem</a>(&amp;*p_miit, verb);</div>
<div class="line"><span class="lineno"> 2056</span> </div>
<div class="line"><span class="lineno"> 2057</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2058</span>}</div>
<div class="ttc" id="adefinitions_8h_html_a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28"><div class="ttname"><a href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a></div><div class="ttdeci">@ QUIET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00221">definitions.h:221</a></div></div>
<div class="ttc" id="agroup__dof__multi__indices_html_ga3fa4afad013bb6da2c9ee27e635d9c49"><div class="ttname"><a href="group__dof__multi__indices.html#ga3fa4afad013bb6da2c9ee27e635d9c49">MoFEM::NumeredDofEntityByUId</a></div><div class="ttdeci">NumeredDofEntity_multiIndex::index&lt; Unique_mi_tag &gt;::type NumeredDofEntityByUId</div><div class="ttdoc">Numbered DoF multi-index by UId.</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00475">DofsMultiIndices.hpp:476</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gabfd48a196686d30eeacb978b81d1a656" name="gabfd48a196686d30eeacb978b81d1a656"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabfd48a196686d30eeacb978b81d1a656">&#9670;&#160;</a></span>partitionFiniteElements()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionFiniteElements </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>part_from_moab</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>low_proc</em> = <code>-1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>hi_proc</em> = <code>-1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>partition finite elements </p>
<p>Function which partition finite elements based on dofs partitioning.<br  />
 In addition it sets information about local row and cols dofs at given element on partition.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td></td></tr>
    <tr><td class="paramname">part_from_moab</td><td></td></tr>
    <tr><td class="paramname">low_proc</td><td></td></tr>
    <tr><td class="paramname">hi_proc</td><td></td></tr>
    <tr><td class="paramname">verb</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MoFEMErrorCode</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
  </table>
  </dd>
</dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="build_problems_8cpp-example.html#a31">build_problems.cpp</a>, <a class="el" href="continuity_check_on_skeleton_3d_8cpp-example.html#a34">continuity_check_on_skeleton_3d.cpp</a>, <a class="el" href="forces_and_sources_testing_edge_element_8cpp-example.html#a38">forces_and_sources_testing_edge_element.cpp</a>, <a class="el" href="forces_and_sources_testing_flat_prism_element_8cpp-example.html#a42">forces_and_sources_testing_flat_prism_element.cpp</a>, <a class="el" href="hcurl_divergence_operator_2d_8cpp-example.html#a62">hcurl_divergence_operator_2d.cpp</a>, <a class="el" href="mesh_insert_interface_atom_8cpp-example.html#a40">mesh_insert_interface_atom.cpp</a>, <a class="el" href="prism_elements_from_surface_8cpp-example.html#a95">prism_elements_from_surface.cpp</a>, <a class="el" href="prism_polynomial_approximation_8cpp-example.html#a59">prism_polynomial_approximation.cpp</a>, <a class="el" href="quad_polynomial_approximation_8cpp-example.html#a56">quad_polynomial_approximation.cpp</a>, and <a class="el" href="remove_entities_from_problem_8cpp-example.html#a32">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02163">2163</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2166</span>                                                                               {</div>
<div class="line"><span class="lineno"> 2167</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2168</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 2169</span>  <span class="keyword">auto</span> fe_ent_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gab2e86ec3f5d76483b23e74c053ae669e">get_ents_finite_elements</a>();</div>
<div class="line"><span class="lineno"> 2170</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2171</span> </div>
<div class="line"><span class="lineno"> 2172</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2">Core::BUILD_FIELD</a>))</div>
<div class="line"><span class="lineno"> 2173</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2174</span> </div>
<div class="line"><span class="lineno"> 2175</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a">Core::BUILD_FE</a>))</div>
<div class="line"><span class="lineno"> 2176</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2177</span> </div>
<div class="line"><span class="lineno"> 2178</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c">Core::BUILD_ADJ</a>))</div>
<div class="line"><span class="lineno"> 2179</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2180</span>            <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2181</span> </div>
<div class="line"><span class="lineno"> 2182</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 2183</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;problem not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2184</span> </div>
<div class="line"><span class="lineno"> 2185</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 2186</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2187</span>            <span class="stringliteral">&quot;problem not partitioned&quot;</span>);</div>
<div class="line"><span class="lineno"> 2188</span> </div>
<div class="line"><span class="lineno"> 2189</span>  <span class="keywordflow">if</span> (low_proc == -1)</div>
<div class="line"><span class="lineno"> 2190</span>    low_proc = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>();</div>
<div class="line"><span class="lineno"> 2191</span>  <span class="keywordflow">if</span> (hi_proc == -1)</div>
<div class="line"><span class="lineno"> 2192</span>    hi_proc = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>();</div>
<div class="line"><span class="lineno"> 2193</span> </div>
<div class="line"><span class="lineno"> 2194</span>  <span class="comment">// Find pointer to problem of given name</span></div>
<div class="line"><span class="lineno"> 2195</span>  <span class="keyword">typedef</span> Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type ProblemByName;</div>
<div class="line"><span class="lineno"> 2196</span>  <span class="keyword">auto</span> &amp;problems =</div>
<div class="line"><span class="lineno"> 2197</span>      <span class="keyword">const_cast&lt;</span>ProblemByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 2198</span>  ProblemByName::iterator p_miit = problems.find(name);</div>
<div class="line"><span class="lineno"> 2199</span>  <span class="keywordflow">if</span> (p_miit == problems.end()) {</div>
<div class="line"><span class="lineno"> 2200</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873">MOFEM_NOT_FOUND</a>,</div>
<div class="line"><span class="lineno"> 2201</span>             <span class="stringliteral">&quot;problem &lt; %s &gt; not found (top tip: check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 2202</span>             name.c_str());</div>
<div class="line"><span class="lineno"> 2203</span>  }</div>
<div class="line"><span class="lineno"> 2204</span> </div>
<div class="line"><span class="lineno"> 2205</span>  <span class="comment">// Get reference on finite elements multi-index on the problem</span></div>
<div class="line"><span class="lineno"> 2206</span>  <a class="code hl_typedef" href="group__fe__multi__indices.html#ga0914c1fe9b4195f5b279d021a74cea73">NumeredEntFiniteElement_multiIndex</a> &amp;problem_finite_elements =</div>
<div class="line"><span class="lineno"> 2207</span>      *p_miit-&gt;numeredFiniteElementsPtr;</div>
<div class="line"><span class="lineno"> 2208</span> </div>
<div class="line"><span class="lineno"> 2209</span>  <span class="comment">// Clear all elements and data, build it again</span></div>
<div class="line"><span class="lineno"> 2210</span>  problem_finite_elements.clear();</div>
<div class="line"><span class="lineno"> 2211</span> </div>
<div class="line"><span class="lineno"> 2212</span>  <span class="comment">// Check if dofs and columns are the same, i.e. structurally symmetric</span></div>
<div class="line"><span class="lineno"> 2213</span>  <span class="comment">// problem</span></div>
<div class="line"><span class="lineno"> 2214</span>  <span class="keywordtype">bool</span> do_cols_prob = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2215</span>  <span class="keywordflow">if</span> (p_miit-&gt;numeredRowDofsPtr == p_miit-&gt;numeredColDofsPtr) {</div>
<div class="line"><span class="lineno"> 2216</span>    do_cols_prob = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2217</span>  }</div>
<div class="line"><span class="lineno"> 2218</span> </div>
<div class="line"><span class="lineno"> 2219</span>  <span class="keyword">auto</span> get_good_elems = [&amp;]() {</div>
<div class="line"><span class="lineno"> 2220</span>    <span class="keyword">auto</span> good_elems = std::vector&lt;<span class="keyword">decltype</span>(fe_ent_ptr-&gt;begin())&gt;();</div>
<div class="line"><span class="lineno"> 2221</span>    good_elems.reserve(fe_ent_ptr-&gt;size());</div>
<div class="line"><span class="lineno"> 2222</span> </div>
<div class="line"><span class="lineno"> 2223</span>    <span class="keyword">const</span> <span class="keyword">auto</span> prb_bit = p_miit-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno"> 2224</span>    <span class="keyword">const</span> <span class="keyword">auto</span> prb_mask = p_miit-&gt;getBitRefLevelMask();</div>
<div class="line"><span class="lineno"> 2225</span> </div>
<div class="line"><span class="lineno"> 2226</span>    <span class="comment">// Loop over all elements in database and if right element is there add it</span></div>
<div class="line"><span class="lineno"> 2227</span>    <span class="comment">// to problem finite element multi-index</span></div>
<div class="line"><span class="lineno"> 2228</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> efit = fe_ent_ptr-&gt;begin(); efit != fe_ent_ptr-&gt;end(); ++efit) {</div>
<div class="line"><span class="lineno"> 2229</span> </div>
<div class="line"><span class="lineno"> 2230</span>      <span class="comment">// if element is not part of problem</span></div>
<div class="line"><span class="lineno"> 2231</span>      <span class="keywordflow">if</span> (((*efit)-&gt;getId() &amp; p_miit-&gt;getBitFEId()).any()) {</div>
<div class="line"><span class="lineno"> 2232</span> </div>
<div class="line"><span class="lineno"> 2233</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;fe_bit = (*efit)-&gt;getBitRefLevel();</div>
<div class="line"><span class="lineno"> 2234</span> </div>
<div class="line"><span class="lineno"> 2235</span>        <span class="comment">// if entity is not problem refinement level</span></div>
<div class="line"><span class="lineno"> 2236</span>        <span class="keywordflow">if</span> ((fe_bit &amp; prb_mask) == fe_bit &amp;&amp; (fe_bit &amp; prb_bit).any())</div>
<div class="line"><span class="lineno"> 2237</span>          good_elems.emplace_back(efit);</div>
<div class="line"><span class="lineno"> 2238</span>      }</div>
<div class="line"><span class="lineno"> 2239</span>    }</div>
<div class="line"><span class="lineno"> 2240</span> </div>
<div class="line"><span class="lineno"> 2241</span>    <span class="keywordflow">return</span> good_elems;</div>
<div class="line"><span class="lineno"> 2242</span>  };</div>
<div class="line"><span class="lineno"> 2243</span> </div>
<div class="line"><span class="lineno"> 2244</span>  <span class="keyword">auto</span> good_elems = get_good_elems();</div>
<div class="line"><span class="lineno"> 2245</span> </div>
<div class="line"><span class="lineno"> 2246</span>  <span class="keyword">auto</span> numbered_good_elems_ptr =</div>
<div class="line"><span class="lineno"> 2247</span>      boost::make_shared&lt;std::vector&lt;NumeredEntFiniteElement&gt;&gt;();</div>
<div class="line"><span class="lineno"> 2248</span>  numbered_good_elems_ptr-&gt;reserve(good_elems.size());</div>
<div class="line"><span class="lineno"> 2249</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;efit : good_elems)</div>
<div class="line"><span class="lineno"> 2250</span>    numbered_good_elems_ptr-&gt;emplace_back(NumeredEntFiniteElement(*efit));</div>
<div class="line"><span class="lineno"> 2251</span> </div>
<div class="line"><span class="lineno"> 2252</span>  <span class="keywordflow">if</span> (!do_cols_prob) {</div>
<div class="line"><span class="lineno"> 2253</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;fe : *numbered_good_elems_ptr) {</div>
<div class="line"><span class="lineno"> 2254</span>      <span class="keywordflow">if</span> (fe.sPtr-&gt;getRowFieldEntsPtr() == fe.sPtr-&gt;getColFieldEntsPtr()) {</div>
<div class="line"><span class="lineno"> 2255</span>        fe.getColFieldEntsPtr() = fe.getRowFieldEntsPtr();</div>
<div class="line"><span class="lineno"> 2256</span>      }</div>
<div class="line"><span class="lineno"> 2257</span>    }</div>
<div class="line"><span class="lineno"> 2258</span>  }</div>
<div class="line"><span class="lineno"> 2259</span> </div>
<div class="line"><span class="lineno"> 2260</span>  <span class="keywordflow">if</span> (part_from_moab) {</div>
<div class="line"><span class="lineno"> 2261</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;fe : *numbered_good_elems_ptr) {</div>
<div class="line"><span class="lineno"> 2262</span>      <span class="keywordflow">if</span> (fe.getEntType() == MBENTITYSET) {</div>
<div class="line"><span class="lineno"> 2263</span>        fe.part = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>();</div>
<div class="line"><span class="lineno"> 2264</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2265</span>        <span class="comment">// if partition is taken from moab partition</span></div>
<div class="line"><span class="lineno"> 2266</span>        <span class="keywordtype">int</span> proc = fe.getPartProc();</div>
<div class="line"><span class="lineno"> 2267</span>        <span class="keywordflow">if</span> (proc == -1 &amp;&amp; fe.getEntType() == MBVERTEX)</div>
<div class="line"><span class="lineno"> 2268</span>          proc = fe.getOwnerProc();</div>
<div class="line"><span class="lineno"> 2269</span>        fe.part = proc;</div>
<div class="line"><span class="lineno"> 2270</span>      }</div>
<div class="line"><span class="lineno"> 2271</span>    }</div>
<div class="line"><span class="lineno"> 2272</span>  }</div>
<div class="line"><span class="lineno"> 2273</span> </div>
<div class="line"><span class="lineno"> 2274</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;fe : *numbered_good_elems_ptr) {</div>
<div class="line"><span class="lineno"> 2275</span> </div>
<div class="line"><span class="lineno"> 2276</span>    <a class="code hl_typedef" href="namespaceMoFEM.html#ad4cd449e7c241e5340d447a4dd75bc47">NumeredDofEntity_multiIndex_uid_view_ordered</a> rows_view;</div>
<div class="line"><span class="lineno"> 2277</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> fe.sPtr-&gt;getRowDofView(*(p_miit-&gt;numeredRowDofsPtr), rows_view);</div>
<div class="line"><span class="lineno"> 2278</span> </div>
<div class="line"><span class="lineno"> 2279</span>    <span class="keywordflow">if</span> (!part_from_moab) {</div>
<div class="line"><span class="lineno"> 2280</span>      <span class="keywordflow">if</span> (fe.getEntType() == MBENTITYSET) {</div>
<div class="line"><span class="lineno"> 2281</span>        fe.part = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>();</div>
<div class="line"><span class="lineno"> 2282</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2283</span>        std::vector&lt;int&gt; parts(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>(), 0);</div>
<div class="line"><span class="lineno"> 2284</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;dof_ptr : rows_view)</div>
<div class="line"><span class="lineno"> 2285</span>          parts[dof_ptr-&gt;pArt]++;</div>
<div class="line"><span class="lineno"> 2286</span>        std::vector&lt;int&gt;::iterator pos =</div>
<div class="line"><span class="lineno"> 2287</span>            max_element(parts.begin(), parts.end());</div>
<div class="line"><span class="lineno"> 2288</span>        <span class="keyword">const</span> <span class="keyword">auto</span> max_part = std::distance(parts.begin(), pos);</div>
<div class="line"><span class="lineno"> 2289</span>        fe.part = max_part;</div>
<div class="line"><span class="lineno"> 2290</span>      }</div>
<div class="line"><span class="lineno"> 2291</span>    }</div>
<div class="line"><span class="lineno"> 2292</span>  }</div>
<div class="line"><span class="lineno"> 2293</span> </div>
<div class="line"><span class="lineno"> 2294</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;fe : *numbered_good_elems_ptr) {</div>
<div class="line"><span class="lineno"> 2295</span> </div>
<div class="line"><span class="lineno"> 2296</span>    <span class="keyword">auto</span> check_fields_and_dofs = [&amp;]() {</div>
<div class="line"><span class="lineno"> 2297</span>      <span class="keywordflow">if</span> (!part_from_moab) {</div>
<div class="line"><span class="lineno"> 2298</span>        <span class="keywordflow">if</span> (fe.getBitFieldIdRow().none() &amp;&amp; m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>() == 0) {</div>
<div class="line"><span class="lineno"> 2299</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::warning)</div>
<div class="line"><span class="lineno"> 2300</span>              &lt;&lt; <span class="stringliteral">&quot;At least one field has to be added to element row to &quot;</span></div>
<div class="line"><span class="lineno"> 2301</span>                 <span class="stringliteral">&quot;determine partition of finite element. Check element &quot;</span> +</div>
<div class="line"><span class="lineno"> 2302</span>                     boost::lexical_cast&lt;std::string&gt;(fe.getName());</div>
<div class="line"><span class="lineno"> 2303</span>        }</div>
<div class="line"><span class="lineno"> 2304</span>      }</div>
<div class="line"><span class="lineno"> 2305</span> </div>
<div class="line"><span class="lineno"> 2306</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2307</span>    };</div>
<div class="line"><span class="lineno"> 2308</span> </div>
<div class="line"><span class="lineno"> 2309</span>    <span class="keywordflow">if</span> (check_fields_and_dofs()) {</div>
<div class="line"><span class="lineno"> 2310</span>      <span class="comment">// Add element to the problem</span></div>
<div class="line"><span class="lineno"> 2311</span>      <span class="keyword">auto</span> p = problem_finite_elements.insert(</div>
<div class="line"><span class="lineno"> 2312</span>          boost::shared_ptr&lt;NumeredEntFiniteElement&gt;(numbered_good_elems_ptr,</div>
<div class="line"><span class="lineno"> 2313</span>                                                     &amp;fe));</div>
<div class="line"><span class="lineno"> 2314</span>      <span class="keywordflow">if</span> (!p.second)</div>
<div class="line"><span class="lineno"> 2315</span>        SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2ea2ed69dd8a1568d1e9b634b9fb37df873">MOFEM_NOT_FOUND</a>, <span class="stringliteral">&quot;element is there&quot;</span>);</div>
<div class="line"><span class="lineno"> 2316</span>    }</div>
<div class="line"><span class="lineno"> 2317</span>  }</div>
<div class="line"><span class="lineno"> 2318</span> </div>
<div class="line"><span class="lineno"> 2319</span>  <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>) {</div>
<div class="line"><span class="lineno"> 2320</span>    <span class="keyword">auto</span> elements_on_rank =</div>
<div class="line"><span class="lineno"> 2321</span>        problem_finite_elements.get&lt;Part_mi_tag&gt;().equal_range(</div>
<div class="line"><span class="lineno"> 2322</span>            m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>());</div>
<div class="line"><span class="lineno"> 2323</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::verbose)</div>
<div class="line"><span class="lineno"> 2324</span>        &lt;&lt; p_miit-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; nb. elems &quot;</span></div>
<div class="line"><span class="lineno"> 2325</span>        &lt;&lt; std::distance(elements_on_rank.first, elements_on_rank.second);</div>
<div class="line"><span class="lineno"> 2326</span>    <span class="keyword">auto</span> fe_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#ga3da3ee1182ff3eee599ba61513325271">get_finite_elements</a>();</div>
<div class="line"><span class="lineno"> 2327</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;fe : *fe_ptr) {</div>
<div class="line"><span class="lineno"> 2328</span>      <span class="keyword">auto</span> e_range =</div>
<div class="line"><span class="lineno"> 2329</span>          problem_finite_elements.get&lt;Composite_Name_And_Part_mi_tag&gt;()</div>
<div class="line"><span class="lineno"> 2330</span>              .equal_range(</div>
<div class="line"><span class="lineno"> 2331</span>                  boost::make_tuple(fe-&gt;getName(), m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()));</div>
<div class="line"><span class="lineno"> 2332</span>      <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::noisy)</div>
<div class="line"><span class="lineno"> 2333</span>          &lt;&lt; <span class="stringliteral">&quot;Element &quot;</span> &lt;&lt; fe-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; nb. elems &quot;</span></div>
<div class="line"><span class="lineno"> 2334</span>          &lt;&lt; std::distance(e_range.first, e_range.second);</div>
<div class="line"><span class="lineno"> 2335</span>    }</div>
<div class="line"><span class="lineno"> 2336</span> </div>
<div class="line"><span class="lineno"> 2337</span>    <a class="code hl_define" href="LogManager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>());</div>
<div class="line"><span class="lineno"> 2338</span>  }</div>
<div class="line"><span class="lineno"> 2339</span> </div>
<div class="line"><span class="lineno"> 2340</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7a98159b8501e82de4023e065e570fed">Core::PARTITION_FE</a>;</div>
<div class="line"><span class="lineno"> 2341</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2342</span>}</div>
<div class="ttc" id="aLogManager_8hpp_html_adacc7b9e7c4fa95cc0959ca359f999f5"><div class="ttname"><a href="LogManager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a></div><div class="ttdeci">#define MOFEM_LOG_SYNCHRONISE(comm)</div><div class="ttdoc">Synchronise &quot;SYNC&quot; channel.</div><div class="ttdef"><b>Definition</b> <a href="LogManager_8hpp_source.html#l00353">LogManager.hpp:353</a></div></div>
<div class="ttc" id="agroup__fe__multi__indices_html_ga0914c1fe9b4195f5b279d021a74cea73"><div class="ttname"><a href="group__fe__multi__indices.html#ga0914c1fe9b4195f5b279d021a74cea73">NumeredEntFiniteElement_multiIndex</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; NumeredEntFiniteElement &gt;, indexed_by&lt; ordered_unique&lt; tag&lt; Unique_mi_tag &gt;, const_mem_fun&lt; NumeredEntFiniteElement::interface_type_EntFiniteElement, UId, &amp;NumeredEntFiniteElement::getLocalUniqueId &gt; &gt;, ordered_non_unique&lt; tag&lt; Part_mi_tag &gt;, member&lt; NumeredEntFiniteElement, unsigned int, &amp;NumeredEntFiniteElement::part &gt; &gt;, ordered_non_unique&lt; tag&lt; Ent_mi_tag &gt;, const_mem_fun&lt; NumeredEntFiniteElement::interface_type_RefEntity, EntityHandle, &amp;NumeredEntFiniteElement::getEnt &gt; &gt;, ordered_non_unique&lt; tag&lt; Composite_Name_And_Part_mi_tag &gt;, composite_key&lt; NumeredEntFiniteElement, const_mem_fun&lt; NumeredEntFiniteElement::interface_type_FiniteElement, boost::string_ref, &amp;NumeredEntFiniteElement::getNameRef &gt;, member&lt; NumeredEntFiniteElement, unsigned int, &amp;NumeredEntFiniteElement::part &gt; &gt; &gt; &gt; &gt; NumeredEntFiniteElement_multiIndex</div><div class="ttdoc">MultiIndex for entities for NumeredEntFiniteElement.</div><div class="ttdef"><b>Definition</b> <a href="FEMultiIndices_8hpp_source.html#l00807">FEMultiIndices.hpp:830</a></div></div>
<div class="ttc" id="agroup__mofem__access_html_gab2e86ec3f5d76483b23e74c053ae669e"><div class="ttname"><a href="group__mofem__access.html#gab2e86ec3f5d76483b23e74c053ae669e">MoFEM::CoreInterface::get_ents_finite_elements</a></div><div class="ttdeci">virtual const EntFiniteElement_multiIndex * get_ents_finite_elements() const =0</div><div class="ttdoc">Get the ents finite elements object.</div></div>
<div class="ttc" id="anamespaceMoFEM_html_ad4cd449e7c241e5340d447a4dd75bc47"><div class="ttname"><a href="namespaceMoFEM.html#ad4cd449e7c241e5340d447a4dd75bc47">MoFEM::NumeredDofEntity_multiIndex_uid_view_ordered</a></div><div class="ttdeci">multi_index_container&lt; boost::shared_ptr&lt; NumeredDofEntity &gt;, indexed_by&lt; ordered_unique&lt; const_mem_fun&lt; NumeredDofEntity::interface_type_DofEntity, UId, &amp;NumeredDofEntity::getLocalUniqueId &gt; &gt; &gt; &gt; NumeredDofEntity_multiIndex_uid_view_ordered</div><div class="ttdef"><b>Definition</b> <a href="DofsMultiIndices_8hpp_source.html#l00492">DofsMultiIndices.hpp:503</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8a7a98159b8501e82de4023e065e570fed"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7a98159b8501e82de4023e065e570fed">MoFEM::CoreTmp&lt; 0 &gt;::PARTITION_FE</a></div><div class="ttdeci">@ PARTITION_FE</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00217">Core.hpp:217</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga20ecb1883ad47d08f22a66d871a48114" name="ga20ecb1883ad47d08f22a66d871a48114"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga20ecb1883ad47d08f22a66d871a48114">&#9670;&#160;</a></span>partitionGhostDofs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionGhostDofs </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>determine ghost nodes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name</td></tr>
  </table>
  </dd>
</dl>
<p>DOFs are ghost dofs if are used by elements on given partition, but not owned by that partition. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="build_problems_8cpp-example.html#a32">build_problems.cpp</a>, <a class="el" href="continuity_check_on_skeleton_3d_8cpp-example.html#a35">continuity_check_on_skeleton_3d.cpp</a>, <a class="el" href="forces_and_sources_testing_edge_element_8cpp-example.html#a39">forces_and_sources_testing_edge_element.cpp</a>, <a class="el" href="forces_and_sources_testing_flat_prism_element_8cpp-example.html#a43">forces_and_sources_testing_flat_prism_element.cpp</a>, <a class="el" href="hcurl_divergence_operator_2d_8cpp-example.html#a63">hcurl_divergence_operator_2d.cpp</a>, <a class="el" href="mesh_insert_interface_atom_8cpp-example.html#a41">mesh_insert_interface_atom.cpp</a>, <a class="el" href="prism_elements_from_surface_8cpp-example.html#a96">prism_elements_from_surface.cpp</a>, <a class="el" href="prism_polynomial_approximation_8cpp-example.html#a60">prism_polynomial_approximation.cpp</a>, <a class="el" href="quad_polynomial_approximation_8cpp-example.html#a57">quad_polynomial_approximation.cpp</a>, and <a class="el" href="remove_entities_from_problem_8cpp-example.html#a33">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02344">2344</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2345</span>                                                             {</div>
<div class="line"><span class="lineno"> 2346</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2347</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 2348</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2349</span> </div>
<div class="line"><span class="lineno"> 2350</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 2351</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2352</span>            <span class="stringliteral">&quot;partition of problem not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2353</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7a98159b8501e82de4023e065e570fed">Core::PARTITION_FE</a>))</div>
<div class="line"><span class="lineno"> 2354</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2355</span>            <span class="stringliteral">&quot;partitions finite elements not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2356</span> </div>
<div class="line"><span class="lineno"> 2357</span>  <span class="comment">// get problem pointer</span></div>
<div class="line"><span class="lineno"> 2358</span>  <span class="keyword">auto</span> p_miit = problems_ptr-&gt;get&lt;Problem_mi_tag&gt;().find(name);</div>
<div class="line"><span class="lineno"> 2359</span>  <span class="keywordflow">if</span> (p_miit == problems_ptr-&gt;get&lt;Problem_mi_tag&gt;().end())</div>
<div class="line"><span class="lineno"> 2360</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaded6d08fa6d0cd6d9b116fac8318c262">MOFEM_INVALID_DATA</a>, <span class="stringliteral">&quot;Problem %s not fond&quot;</span>,</div>
<div class="line"><span class="lineno"> 2361</span>             name.c_str());</div>
<div class="line"><span class="lineno"> 2362</span> </div>
<div class="line"><span class="lineno"> 2363</span>  <span class="comment">// get reference to number of ghost dofs</span></div>
<div class="line"><span class="lineno"> 2364</span>  <span class="keywordtype">int</span> &amp;nb_row_ghost_dofs = p_miit-&gt;nbGhostDofsRow;</div>
<div class="line"><span class="lineno"> 2365</span>  <span class="keywordtype">int</span> &amp;nb_col_ghost_dofs = p_miit-&gt;nbGhostDofsCol;</div>
<div class="line"><span class="lineno"> 2366</span>  nb_row_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 2367</span>  nb_col_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 2368</span> </div>
<div class="line"><span class="lineno"> 2369</span>  <span class="comment">// do work if more than one processor</span></div>
<div class="line"><span class="lineno"> 2370</span>  <span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>() &gt; 1) {</div>
<div class="line"><span class="lineno"> 2371</span> </div>
<div class="line"><span class="lineno"> 2372</span>    <a class="code hl_typedef" href="namespaceMoFEM.html#ad4cd449e7c241e5340d447a4dd75bc47">NumeredDofEntity_multiIndex_uid_view_ordered</a> ghost_idx_row_view,</div>
<div class="line"><span class="lineno"> 2373</span>        ghost_idx_col_view;</div>
<div class="line"><span class="lineno"> 2374</span> </div>
<div class="line"><span class="lineno"> 2375</span>    <span class="comment">// get elements on this partition</span></div>
<div class="line"><span class="lineno"> 2376</span>    <span class="keyword">auto</span> fe_range =</div>
<div class="line"><span class="lineno"> 2377</span>        p_miit-&gt;numeredFiniteElementsPtr-&gt;get&lt;Part_mi_tag&gt;().equal_range(</div>
<div class="line"><span class="lineno"> 2378</span>            m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>());</div>
<div class="line"><span class="lineno"> 2379</span> </div>
<div class="line"><span class="lineno"> 2380</span>    <span class="comment">// get dofs on elements which are not part of this partition</span></div>
<div class="line"><span class="lineno"> 2381</span> </div>
<div class="line"><span class="lineno"> 2382</span>    <span class="keyword">struct </span>Inserter {</div>
<div class="line"><span class="lineno"> 2383</span>      <span class="keyword">using </span><a class="code hl_typedef" href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">Vec</a> = std::vector&lt;boost::shared_ptr&lt;NumeredDofEntity&gt;&gt;;</div>
<div class="line"><span class="lineno"> 2384</span>      <span class="keyword">using </span>It = Vec::iterator;</div>
<div class="line"><span class="lineno"> 2385</span>      It operator()(Vec &amp;dofs_view, It &amp;hint,</div>
<div class="line"><span class="lineno"> 2386</span>                    boost::shared_ptr&lt;NumeredDofEntity&gt; &amp;&amp;dof) {</div>
<div class="line"><span class="lineno"> 2387</span>        dofs_view.emplace_back(dof);</div>
<div class="line"><span class="lineno"> 2388</span>        <span class="keywordflow">return</span> dofs_view.end();</div>
<div class="line"><span class="lineno"> 2389</span>      }</div>
<div class="line"><span class="lineno"> 2390</span>    };</div>
<div class="line"><span class="lineno"> 2391</span> </div>
<div class="line"><span class="lineno"> 2392</span>    <span class="comment">// rows</span></div>
<div class="line"><span class="lineno"> 2393</span>    std::vector&lt;boost::shared_ptr&lt;NumeredDofEntity&gt;&gt; fe_vec_view;</div>
<div class="line"><span class="lineno"> 2394</span>    <span class="keyword">auto</span> hint_r = ghost_idx_row_view.begin();</div>
<div class="line"><span class="lineno"> 2395</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fe_ptr = fe_range.first; fe_ptr != fe_range.second; ++fe_ptr) {</div>
<div class="line"><span class="lineno"> 2396</span> </div>
<div class="line"><span class="lineno"> 2397</span>      fe_vec_view.clear();</div>
<div class="line"><span class="lineno"> 2398</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1EntFiniteElement.html#a82e23e598817553745c5e59810e0a584">EntFiniteElement::getDofView</a>((*fe_ptr)-&gt;getRowFieldEnts(),</div>
<div class="line"><span class="lineno"> 2399</span>                                          *(p_miit-&gt;getNumeredRowDofsPtr()),</div>
<div class="line"><span class="lineno"> 2400</span>                                          fe_vec_view, Inserter());</div>
<div class="line"><span class="lineno"> 2401</span> </div>
<div class="line"><span class="lineno"> 2402</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;dof_ptr : fe_vec_view) {</div>
<div class="line"><span class="lineno"> 2403</span>        <span class="keywordflow">if</span> (dof_ptr-&gt;getPart() != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 2404</span>          hint_r = ghost_idx_row_view.emplace_hint(hint_r, dof_ptr);</div>
<div class="line"><span class="lineno"> 2405</span>        }</div>
<div class="line"><span class="lineno"> 2406</span>      }</div>
<div class="line"><span class="lineno"> 2407</span>    }</div>
<div class="line"><span class="lineno"> 2408</span> </div>
<div class="line"><span class="lineno"> 2409</span>    <span class="comment">// columns</span></div>
<div class="line"><span class="lineno"> 2410</span>    <span class="keywordflow">if</span> (p_miit-&gt;numeredColDofsPtr == p_miit-&gt;numeredRowDofsPtr) {</div>
<div class="line"><span class="lineno"> 2411</span> </div>
<div class="line"><span class="lineno"> 2412</span>      <span class="keyword">auto</span> hint_c = ghost_idx_col_view.begin();</div>
<div class="line"><span class="lineno"> 2413</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> fe_ptr = fe_range.first; fe_ptr != fe_range.second; ++fe_ptr) {</div>
<div class="line"><span class="lineno"> 2414</span> </div>
<div class="line"><span class="lineno"> 2415</span>        fe_vec_view.clear();</div>
<div class="line"><span class="lineno"> 2416</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1EntFiniteElement.html#a82e23e598817553745c5e59810e0a584">EntFiniteElement::getDofView</a>((*fe_ptr)-&gt;getColFieldEnts(),</div>
<div class="line"><span class="lineno"> 2417</span>                                            *(p_miit-&gt;getNumeredColDofsPtr()),</div>
<div class="line"><span class="lineno"> 2418</span>                                            fe_vec_view, Inserter());</div>
<div class="line"><span class="lineno"> 2419</span> </div>
<div class="line"><span class="lineno"> 2420</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;dof_ptr : fe_vec_view) {</div>
<div class="line"><span class="lineno"> 2421</span>          <span class="keywordflow">if</span> (dof_ptr-&gt;getPart() != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 2422</span>            hint_c = ghost_idx_col_view.emplace_hint(hint_c, dof_ptr);</div>
<div class="line"><span class="lineno"> 2423</span>          }</div>
<div class="line"><span class="lineno"> 2424</span>        }</div>
<div class="line"><span class="lineno"> 2425</span>      }</div>
<div class="line"><span class="lineno"> 2426</span>    }</div>
<div class="line"><span class="lineno"> 2427</span> </div>
<div class="line"><span class="lineno"> 2428</span>    <span class="keywordtype">int</span> *nb_ghost_dofs[2] = {&amp;nb_row_ghost_dofs, &amp;nb_col_ghost_dofs};</div>
<div class="line"><span class="lineno"> 2429</span>    <span class="keywordtype">int</span> nb_local_dofs[2] = {p_miit-&gt;nbLocDofsRow, p_miit-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 2430</span> </div>
<div class="line"><span class="lineno"> 2431</span>    <a class="code hl_typedef" href="namespaceMoFEM.html#ad4cd449e7c241e5340d447a4dd75bc47">NumeredDofEntity_multiIndex_uid_view_ordered</a> *ghost_idx_view[2] = {</div>
<div class="line"><span class="lineno"> 2432</span>        &amp;ghost_idx_row_view, &amp;ghost_idx_col_view};</div>
<div class="line"><span class="lineno"> 2433</span>    <a class="code hl_typedef" href="group__dof__multi__indices.html#ga3fa4afad013bb6da2c9ee27e635d9c49">NumeredDofEntityByUId</a> *dof_by_uid_no_const[2] = {</div>
<div class="line"><span class="lineno"> 2434</span>        &amp;p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Unique_mi_tag&gt;(),</div>
<div class="line"><span class="lineno"> 2435</span>        &amp;p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Unique_mi_tag&gt;()};</div>
<div class="line"><span class="lineno"> 2436</span> </div>
<div class="line"><span class="lineno"> 2437</span>    <span class="keywordtype">int</span> loop_size = 2;</div>
<div class="line"><span class="lineno"> 2438</span>    <span class="keywordflow">if</span> (p_miit-&gt;numeredColDofsPtr == p_miit-&gt;numeredRowDofsPtr) {</div>
<div class="line"><span class="lineno"> 2439</span>      loop_size = 1;</div>
<div class="line"><span class="lineno"> 2440</span>    }</div>
<div class="line"><span class="lineno"> 2441</span> </div>
<div class="line"><span class="lineno"> 2442</span>    <span class="comment">// set local ghost dofs indices</span></div>
<div class="line"><span class="lineno"> 2443</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != loop_size; ++ss) {</div>
<div class="line"><span class="lineno"> 2444</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;gid : *ghost_idx_view[ss]) {</div>
<div class="line"><span class="lineno"> 2445</span>        NumeredDofEntityByUId::iterator dof =</div>
<div class="line"><span class="lineno"> 2446</span>            dof_by_uid_no_const[ss]-&gt;find(gid-&gt;getLocalUniqueId());</div>
<div class="line"><span class="lineno"> 2447</span>        <span class="keywordflow">if</span> (PetscUnlikely((*dof)-&gt;petscLocalDofIdx != (<a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a>)-1))</div>
<div class="line"><span class="lineno"> 2448</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2449</span>                  <span class="stringliteral">&quot;inconsistent data, ghost dof already set&quot;</span>);</div>
<div class="line"><span class="lineno"> 2450</span>        <span class="keywordtype">bool</span> success = dof_by_uid_no_const[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 2451</span>            dof, NumeredDofEntity_local_idx_change(nb_local_dofs[ss]++));</div>
<div class="line"><span class="lineno"> 2452</span>        <span class="keywordflow">if</span> (PetscUnlikely(!success))</div>
<div class="line"><span class="lineno"> 2453</span>          SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 2454</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 2455</span>        (*nb_ghost_dofs[ss])++;</div>
<div class="line"><span class="lineno"> 2456</span>      }</div>
<div class="line"><span class="lineno"> 2457</span>    }</div>
<div class="line"><span class="lineno"> 2458</span>    <span class="keywordflow">if</span> (loop_size == 1) {</div>
<div class="line"><span class="lineno"> 2459</span>      (*nb_ghost_dofs[1]) = (*nb_ghost_dofs[0]);</div>
<div class="line"><span class="lineno"> 2460</span>    }</div>
<div class="line"><span class="lineno"> 2461</span>  }</div>
<div class="line"><span class="lineno"> 2462</span> </div>
<div class="line"><span class="lineno"> 2463</span>  <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>) {</div>
<div class="line"><span class="lineno"> 2464</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::inform)</div>
<div class="line"><span class="lineno"> 2465</span>        &lt;&lt; <span class="stringliteral">&quot; FEs ghost dofs on problem &quot;</span> &lt;&lt; p_miit-&gt;getName()</div>
<div class="line"><span class="lineno"> 2466</span>        &lt;&lt; <span class="stringliteral">&quot; Nb. ghost dof &quot;</span> &lt;&lt; p_miit-&gt;getNbGhostDofsRow() &lt;&lt; <span class="stringliteral">&quot; by &quot;</span></div>
<div class="line"><span class="lineno"> 2467</span>        &lt;&lt; p_miit-&gt;getNbGhostDofsCol() &lt;&lt; <span class="stringliteral">&quot; Nb. local dof &quot;</span></div>
<div class="line"><span class="lineno"> 2468</span>        &lt;&lt; p_miit-&gt;getNbLocalDofsCol() &lt;&lt; <span class="stringliteral">&quot; by &quot;</span> &lt;&lt; p_miit-&gt;getNbLocalDofsCol();</div>
<div class="line"><span class="lineno"> 2469</span> </div>
<div class="line"><span class="lineno"> 2470</span>    <a class="code hl_define" href="LogManager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>())</div>
<div class="line"><span class="lineno"> 2471</span>  }</div>
<div class="line"><span class="lineno"> 2472</span> </div>
<div class="line"><span class="lineno"> 2473</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7dc70dc71df931a518473f10efa354ed">Core::PARTITION_GHOST_DOFS</a>;</div>
<div class="line"><span class="lineno"> 2474</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2475</span>}</div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eaded6d08fa6d0cd6d9b116fac8318c262"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaded6d08fa6d0cd6d9b116fac8318c262">MOFEM_INVALID_DATA</a></div><div class="ttdeci">@ MOFEM_INVALID_DATA</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00036">definitions.h:36</a></div></div>
<div class="ttc" id="anamespaceEigenMatrix_html_a34cd82caee17a35f38d6df0cf87ee75b"><div class="ttname"><a href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">EigenMatrix::Vec</a></div><div class="ttdeci">const FTensor::Tensor2&lt; T, Dim, Dim &gt; Vec</div><div class="ttdef"><b>Definition</b> <a href="MatrixFunction_8hpp_source.html#l00064">MatrixFunction.hpp:64</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Types_html_a2cb126d359d48ddf277e1985549b94a9"><div class="ttname"><a href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">MoFEM::Types::DofIdx</a></div><div class="ttdeci">int DofIdx</div><div class="ttdoc">Index of DOF.</div><div class="ttdef"><b>Definition</b> <a href="Types_8hpp_source.html#l00018">Types.hpp:18</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa7f57150f004d7ec3fd18afd1e2760e8a7dc70dc71df931a518473f10efa354ed"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7dc70dc71df931a518473f10efa354ed">MoFEM::CoreTmp&lt; 0 &gt;::PARTITION_GHOST_DOFS</a></div><div class="ttdeci">@ PARTITION_GHOST_DOFS</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00218">Core.hpp:218</a></div></div>
<div class="ttc" id="astructMoFEM_1_1EntFiniteElement_html_a82e23e598817553745c5e59810e0a584"><div class="ttname"><a href="structMoFEM_1_1EntFiniteElement.html#a82e23e598817553745c5e59810e0a584">MoFEM::EntFiniteElement::getDofView</a></div><div class="ttdeci">static MoFEMErrorCode getDofView(const FE_ENTS &amp;fe_ents_view, const MOFEM_DOFS &amp;mofem_dofs, MOFEM_DOFS_VIEW &amp;dofs_view, INSERTER &amp;&amp;inserter)</div><div class="ttdef"><b>Definition</b> <a href="FEMultiIndices_8hpp_source.html#l00583">FEMultiIndices.hpp:583</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaaecef402c77353798047ed8dc9c77747" name="gaaecef402c77353798047ed8dc9c77747"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaaecef402c77353798047ed8dc9c77747">&#9670;&#160;</a></span>partitionGhostDofsOnDistributedMesh()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionGhostDofsOnDistributedMesh </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>determine ghost nodes on distributed meshes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name</td></tr>
  </table>
  </dd>
</dl>
<p>It is very similar for partitionGhostDofs, however this explits that mesh is distributed.</p>
<p>DOFs are ghosted if are shered but not owned by partition. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="remove_entities_from_problem_8cpp-example.html#a51">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02478">2478</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2479</span>                                                               {</div>
<div class="line"><span class="lineno"> 2480</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2481</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 2482</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2483</span> </div>
<div class="line"><span class="lineno"> 2484</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 2485</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2486</span>            <span class="stringliteral">&quot;partition of problem not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2487</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7a98159b8501e82de4023e065e570fed">Core::PARTITION_FE</a>))</div>
<div class="line"><span class="lineno"> 2488</span>    SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 2489</span>            <span class="stringliteral">&quot;partitions finite elements not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 2490</span> </div>
<div class="line"><span class="lineno"> 2491</span>  <span class="comment">// get problem pointer</span></div>
<div class="line"><span class="lineno"> 2492</span>  <span class="keyword">typedef</span> Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type ProblemsByName;</div>
<div class="line"><span class="lineno"> 2493</span>  <span class="comment">// find p_miit</span></div>
<div class="line"><span class="lineno"> 2494</span>  ProblemsByName &amp;problems_set =</div>
<div class="line"><span class="lineno"> 2495</span>      <span class="keyword">const_cast&lt;</span>ProblemsByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 2496</span>  ProblemsByName::iterator p_miit = problems_set.find(name);</div>
<div class="line"><span class="lineno"> 2497</span> </div>
<div class="line"><span class="lineno"> 2498</span>  <span class="comment">// get reference to number of ghost dofs</span></div>
<div class="line"><span class="lineno"> 2499</span>  <span class="comment">// get number of local dofs</span></div>
<div class="line"><span class="lineno"> 2500</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> *nb_ghost_dofs[2] = {&amp;(p_miit-&gt;nbGhostDofsRow),</div>
<div class="line"><span class="lineno"> 2501</span>                              &amp;(p_miit-&gt;nbGhostDofsCol)};</div>
<div class="line"><span class="lineno"> 2502</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> nb_local_dofs[2] = {p_miit-&gt;nbLocDofsRow, p_miit-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 2503</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != 2; ++ss) {</div>
<div class="line"><span class="lineno"> 2504</span>    (*nb_ghost_dofs[ss]) = 0;</div>
<div class="line"><span class="lineno"> 2505</span>  }</div>
<div class="line"><span class="lineno"> 2506</span> </div>
<div class="line"><span class="lineno"> 2507</span>  <span class="comment">// do work if more than one processor</span></div>
<div class="line"><span class="lineno"> 2508</span>  <span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>() &gt; 1) {</div>
<div class="line"><span class="lineno"> 2509</span>    <span class="comment">// determine if rows on columns are different from dofs on rows</span></div>
<div class="line"><span class="lineno"> 2510</span>    <span class="keywordtype">int</span> loop_size = 2;</div>
<div class="line"><span class="lineno"> 2511</span>    <span class="keywordflow">if</span> (p_miit-&gt;numeredColDofsPtr == p_miit-&gt;numeredRowDofsPtr) {</div>
<div class="line"><span class="lineno"> 2512</span>      loop_size = 1;</div>
<div class="line"><span class="lineno"> 2513</span>    }</div>
<div class="line"><span class="lineno"> 2514</span> </div>
<div class="line"><span class="lineno"> 2515</span>    <span class="keyword">typedef</span> <span class="keyword">decltype</span>(p_miit-&gt;numeredRowDofsPtr) NumbDofTypeSharedPtr;</div>
<div class="line"><span class="lineno"> 2516</span>    NumbDofTypeSharedPtr numered_dofs[] = {p_miit-&gt;numeredRowDofsPtr,</div>
<div class="line"><span class="lineno"> 2517</span>                                           p_miit-&gt;numeredColDofsPtr};</div>
<div class="line"><span class="lineno"> 2518</span> </div>
<div class="line"><span class="lineno"> 2519</span>    <span class="comment">// iterate over dofs on rows and dofs on columns</span></div>
<div class="line"><span class="lineno"> 2520</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ss = 0; ss != loop_size; ++ss) {</div>
<div class="line"><span class="lineno"> 2521</span> </div>
<div class="line"><span class="lineno"> 2522</span>      <span class="comment">// create dofs view by uid</span></div>
<div class="line"><span class="lineno"> 2523</span>      <span class="keyword">auto</span> <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a> = numered_dofs[ss]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().equal_range(-1);</div>
<div class="line"><span class="lineno"> 2524</span> </div>
<div class="line"><span class="lineno"> 2525</span>      std::vector&lt;NumeredDofEntity_multiIndex::iterator&gt; ghost_idx_view;</div>
<div class="line"><span class="lineno"> 2526</span>      ghost_idx_view.reserve(std::distance(<a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first, <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.second));</div>
<div class="line"><span class="lineno"> 2527</span>      <span class="keywordflow">for</span> (; <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first != <a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.second; ++<a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first)</div>
<div class="line"><span class="lineno"> 2528</span>        ghost_idx_view.emplace_back(numered_dofs[ss]-&gt;project&lt;0&gt;(<a class="code hl_variable" href="namespacesdf.html#a2f1f399a483aed931a5a8ac3b98f49ba">r</a>.first));</div>
<div class="line"><span class="lineno"> 2529</span> </div>
<div class="line"><span class="lineno"> 2530</span>      <span class="keyword">auto</span> cmp = [](<span class="keyword">auto</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>, <span class="keyword">auto</span> b) {</div>
<div class="line"><span class="lineno"> 2531</span>        <span class="keywordflow">return</span> (*a)-&gt;getLocalUniqueId() &lt; (*b)-&gt;getLocalUniqueId();</div>
<div class="line"><span class="lineno"> 2532</span>      };</div>
<div class="line"><span class="lineno"> 2533</span>      sort(ghost_idx_view.begin(), ghost_idx_view.end(), cmp);</div>
<div class="line"><span class="lineno"> 2534</span> </div>
<div class="line"><span class="lineno"> 2535</span>      <span class="comment">// iterate over dofs which have negative local index</span></div>
<div class="line"><span class="lineno"> 2536</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> gid_it : ghost_idx_view) {</div>
<div class="line"><span class="lineno"> 2537</span>        <span class="keywordtype">bool</span> success = numered_dofs[ss]-&gt;modify(</div>
<div class="line"><span class="lineno"> 2538</span>            gid_it, NumeredDofEntity_local_idx_change((nb_local_dofs[ss])++));</div>
<div class="line"><span class="lineno"> 2539</span>        <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 2540</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 2541</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 2542</span>        ++(*nb_ghost_dofs[ss]);</div>
<div class="line"><span class="lineno"> 2543</span>      }</div>
<div class="line"><span class="lineno"> 2544</span>    }</div>
<div class="line"><span class="lineno"> 2545</span>    <span class="keywordflow">if</span> (loop_size == 1) {</div>
<div class="line"><span class="lineno"> 2546</span>      (*nb_ghost_dofs[1]) = (*nb_ghost_dofs[0]);</div>
<div class="line"><span class="lineno"> 2547</span>    }</div>
<div class="line"><span class="lineno"> 2548</span>  }</div>
<div class="line"><span class="lineno"> 2549</span> </div>
<div class="line"><span class="lineno"> 2550</span>  <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>) {</div>
<div class="line"><span class="lineno"> 2551</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::inform)</div>
<div class="line"><span class="lineno"> 2552</span>        &lt;&lt; <span class="stringliteral">&quot; FEs ghost dofs on problem &quot;</span> &lt;&lt; p_miit-&gt;getName()</div>
<div class="line"><span class="lineno"> 2553</span>        &lt;&lt; <span class="stringliteral">&quot; Nb. ghost dof &quot;</span> &lt;&lt; p_miit-&gt;getNbGhostDofsRow() &lt;&lt; <span class="stringliteral">&quot; by &quot;</span></div>
<div class="line"><span class="lineno"> 2554</span>        &lt;&lt; p_miit-&gt;getNbGhostDofsCol() &lt;&lt; <span class="stringliteral">&quot; Nb. local dof &quot;</span></div>
<div class="line"><span class="lineno"> 2555</span>        &lt;&lt; p_miit-&gt;getNbLocalDofsCol() &lt;&lt; <span class="stringliteral">&quot; by &quot;</span> &lt;&lt; p_miit-&gt;getNbLocalDofsCol();</div>
<div class="line"><span class="lineno"> 2556</span> </div>
<div class="line"><span class="lineno"> 2557</span>    <a class="code hl_define" href="LogManager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>())</div>
<div class="line"><span class="lineno"> 2558</span>  }</div>
<div class="line"><span class="lineno"> 2559</span> </div>
<div class="line"><span class="lineno"> 2560</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a7dc70dc71df931a518473f10efa354ed">Core::PARTITION_GHOST_DOFS</a>;</div>
<div class="line"><span class="lineno"> 2561</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 2562</span>}</div>
<div class="ttc" id="aapprox__sphere_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition</b> <a href="approx__sphere_8cpp_source.html#l00030">approx_sphere.cpp:30</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gab37ad8b4ac4ef77413435ae826d76ca7" name="gab37ad8b4ac4ef77413435ae826d76ca7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab37ad8b4ac4ef77413435ae826d76ca7">&#9670;&#160;</a></span>partitionMesh() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::CommInterface::partitionMesh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classRange.html">Range</a> &amp;&#160;</td>
          <td class="paramname"><em>ents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>adj_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>n_parts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_vertex_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_edge_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_part_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>debug</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set partition tag to each finite element in the problem. </p>
<p>This will use one of the mesh partitioning programs available from PETSc See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatPartitioningType.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatPartitioningType.html</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ents</td><td>Entities to partition </td></tr>
    <tr><td class="paramname">dim</td><td>Dimension of entities to partition </td></tr>
    <tr><td class="paramname">adj_dim</td><td>Adjacency dimension </td></tr>
    <tr><td class="paramname">n_parts</td><td>Number of partitions </td></tr>
    <tr><td class="paramname">verb</td><td>Verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="partition_mesh_8cpp-example.html#a10">partition_mesh.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="CommInterface_8cpp_source.html#l00868">868</a> of file <a class="el" href="CommInterface_8cpp_source.html">CommInterface.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  871</span>                                                                               {</div>
<div class="line"><span class="lineno">  872</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1CommInterface.html#ab531417c6ed05f8aadbdc455817c4499">cOre</a>;</div>
<div class="line"><span class="lineno">  873</span>  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno">  874</span> </div>
<div class="line"><span class="lineno">  875</span>  <span class="comment">// get layout</span></div>
<div class="line"><span class="lineno">  876</span>  <span class="keywordtype">int</span> rstart, rend, nb_elems;</div>
<div class="line"><span class="lineno">  877</span>  {</div>
<div class="line"><span class="lineno">  878</span>    PetscLayout layout;</div>
<div class="line"><span class="lineno">  879</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;layout);</div>
<div class="line"><span class="lineno">  880</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetBlockSize(layout, 1);</div>
<div class="line"><span class="lineno">  881</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetSize(layout, ents.size());</div>
<div class="line"><span class="lineno">  882</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetUp(layout);</div>
<div class="line"><span class="lineno">  883</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetSize(layout, &amp;nb_elems);</div>
<div class="line"><span class="lineno">  884</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetRange(layout, &amp;rstart, &amp;rend);</div>
<div class="line"><span class="lineno">  885</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutDestroy(&amp;layout);</div>
<div class="line"><span class="lineno">  886</span>    <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a>) {</div>
<div class="line"><span class="lineno">  887</span>      <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::inform)</div>
<div class="line"><span class="lineno">  888</span>          &lt;&lt; <span class="stringliteral">&quot;Finite elements in problem: row lower &quot;</span> &lt;&lt; rstart &lt;&lt; <span class="stringliteral">&quot; row upper &quot;</span></div>
<div class="line"><span class="lineno">  889</span>          &lt;&lt; rend &lt;&lt; <span class="stringliteral">&quot; nb. elems &quot;</span> &lt;&lt; nb_elems &lt;&lt; <span class="stringliteral">&quot; ( &quot;</span> &lt;&lt; ents.size() &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>;</div>
<div class="line"><span class="lineno">  890</span>      <a class="code hl_define" href="LogManager_8hpp.html#adacc7b9e7c4fa95cc0959ca359f999f5">MOFEM_LOG_SYNCHRONISE</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>())</div>
<div class="line"><span class="lineno">  891</span>    }</div>
<div class="line"><span class="lineno">  892</span>  }</div>
<div class="line"><span class="lineno">  893</span> </div>
<div class="line"><span class="lineno">  894</span>  std::vector&lt;EntityHandle&gt; weight_ents;</div>
<div class="line"><span class="lineno">  895</span>  weight_ents.reserve(rend - rstart + 1);</div>
<div class="line"><span class="lineno">  896</span> </div>
<div class="line"><span class="lineno">  897</span>  <span class="keyword">struct </span>AdjBridge {</div>
<div class="line"><span class="lineno">  898</span>    EntityHandle ent;</div>
<div class="line"><span class="lineno">  899</span>    std::vector&lt;int&gt; adj;</div>
<div class="line"><span class="lineno">  900</span>    AdjBridge(<span class="keyword">const</span> EntityHandle ent, std::vector&lt;int&gt; &amp;adj)</div>
<div class="line"><span class="lineno">  901</span>        : ent(ent), adj(adj) {}</div>
<div class="line"><span class="lineno">  902</span>  };</div>
<div class="line"><span class="lineno">  903</span> </div>
<div class="line"><span class="lineno">  904</span>  <span class="keyword">typedef</span> multi_index_container&lt;</div>
<div class="line"><span class="lineno">  905</span>      AdjBridge,</div>
<div class="line"><span class="lineno">  906</span>      indexed_by&lt;</div>
<div class="line"><span class="lineno">  907</span> </div>
<div class="line"><span class="lineno">  908</span>          hashed_unique&lt;member&lt;AdjBridge, EntityHandle, &amp;AdjBridge::ent&gt;&gt;</div>
<div class="line"><span class="lineno">  909</span> </div>
<div class="line"><span class="lineno">  910</span>          &gt;&gt;</div>
<div class="line"><span class="lineno">  911</span>      AdjBridgeMap;</div>
<div class="line"><span class="lineno">  912</span> </div>
<div class="line"><span class="lineno">  913</span>  <span class="keyword">auto</span> get_it = [&amp;](<span class="keyword">auto</span> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) {</div>
<div class="line"><span class="lineno">  914</span>    <span class="keyword">auto</span> it = ents.begin();</div>
<div class="line"><span class="lineno">  915</span>    <span class="keywordflow">for</span> (; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> &gt; 0; --<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) {</div>
<div class="line"><span class="lineno">  916</span>      <span class="keywordflow">if</span> (it == ents.end())</div>
<div class="line"><span class="lineno">  917</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  918</span>      ++it;</div>
<div class="line"><span class="lineno">  919</span>    }</div>
<div class="line"><span class="lineno">  920</span>    <span class="keywordflow">return</span> it;</div>
<div class="line"><span class="lineno">  921</span>  };</div>
<div class="line"><span class="lineno">  922</span> </div>
<div class="line"><span class="lineno">  923</span>  <a class="code hl_class" href="classRange.html">Range</a> proc_ents;</div>
<div class="line"><span class="lineno">  924</span>  proc_ents.insert(get_it(rstart), get_it(rend));</div>
<div class="line"><span class="lineno">  925</span>  <span class="keywordflow">if</span> (proc_ents.size() != rend - rstart)</div>
<div class="line"><span class="lineno">  926</span>    SETERRQ(PETSC_COMM_WORLD, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno">  927</span>            <span class="stringliteral">&quot;Wrong number of elements in range %ld != %d&quot;</span>, proc_ents.size(),</div>
<div class="line"><span class="lineno">  928</span>            rend - rstart);</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>  <a class="code hl_class" href="classRange.html">Range</a> all_dim_ents;</div>
<div class="line"><span class="lineno">  931</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_adjacencies(</div>
<div class="line"><span class="lineno">  932</span>      proc_ents, adj_dim, <span class="keyword">true</span>, all_dim_ents, moab::Interface::UNION);</div>
<div class="line"><span class="lineno">  933</span> </div>
<div class="line"><span class="lineno">  934</span>  AdjBridgeMap adj_bridge_map;</div>
<div class="line"><span class="lineno">  935</span>  <span class="keyword">auto</span> hint = adj_bridge_map.begin();</div>
<div class="line"><span class="lineno">  936</span>  std::vector&lt;int&gt; adj;</div>
<div class="line"><span class="lineno">  937</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> ent : all_dim_ents) {</div>
<div class="line"><span class="lineno">  938</span>    <a class="code hl_class" href="classRange.html">Range</a> adj_ents;</div>
<div class="line"><span class="lineno">  939</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_adjacencies(&amp;ent, 1, dim, <span class="keyword">false</span>, adj_ents);</div>
<div class="line"><span class="lineno">  940</span>    adj_ents = intersect(adj_ents, ents);</div>
<div class="line"><span class="lineno">  941</span>    adj.clear();</div>
<div class="line"><span class="lineno">  942</span>    adj.reserve(adj_ents.size());</div>
<div class="line"><span class="lineno">  943</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> : adj_ents)</div>
<div class="line"><span class="lineno">  944</span>      adj.emplace_back(ents.index(<a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>));</div>
<div class="line"><span class="lineno">  945</span>    hint = adj_bridge_map.emplace_hint(hint, ent, adj);</div>
<div class="line"><span class="lineno">  946</span>  }</div>
<div class="line"><span class="lineno">  947</span> </div>
<div class="line"><span class="lineno">  948</span>  <span class="keywordtype">int</span> *_i;</div>
<div class="line"><span class="lineno">  949</span>  <span class="keywordtype">int</span> *_j;</div>
<div class="line"><span class="lineno">  950</span>  {</div>
<div class="line"><span class="lineno">  951</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> nb_loc_elements = rend - rstart;</div>
<div class="line"><span class="lineno">  952</span>    std::vector&lt;int&gt; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>(nb_loc_elements + 1, 0), <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line"><span class="lineno">  953</span>    {</div>
<div class="line"><span class="lineno">  954</span>      std::vector&lt;int&gt; row_adj;</div>
<div class="line"><span class="lineno">  955</span>      Range::iterator fe_it;</div>
<div class="line"><span class="lineno">  956</span>      <span class="keywordtype">int</span> ii, jj;</div>
<div class="line"><span class="lineno">  957</span>      <span class="keywordtype">size_t</span> max_row_size;</div>
<div class="line"><span class="lineno">  958</span>      <span class="keywordflow">for</span> (fe_it = proc_ents.begin(), ii = rstart, jj = 0, max_row_size = 0;</div>
<div class="line"><span class="lineno">  959</span>           fe_it != proc_ents.end(); ++fe_it, ++ii) {</div>
<div class="line"><span class="lineno">  960</span> </div>
<div class="line"><span class="lineno">  961</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceMoFEM.html#a01f67868b6366749021d5258535655cd">type_from_handle</a>(*fe_it) == MBENTITYSET) {</div>
<div class="line"><span class="lineno">  962</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaef48b40a28ec42fda55bc4824e906baf">MOFEM_NOT_IMPLEMENTED</a>,</div>
<div class="line"><span class="lineno">  963</span>                  <span class="stringliteral">&quot;not yet implemented, don&#39;t know what to do for meshset &quot;</span></div>
<div class="line"><span class="lineno">  964</span>                  <span class="stringliteral">&quot;element&quot;</span>);</div>
<div class="line"><span class="lineno">  965</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  966</span> </div>
<div class="line"><span class="lineno">  967</span>          <a class="code hl_class" href="classRange.html">Range</a> dim_ents;</div>
<div class="line"><span class="lineno">  968</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_adjacencies(&amp;*fe_it, 1, adj_dim, <span class="keyword">false</span>,</div>
<div class="line"><span class="lineno">  969</span>                                                    dim_ents);</div>
<div class="line"><span class="lineno">  970</span>          dim_ents = intersect(dim_ents, all_dim_ents);</div>
<div class="line"><span class="lineno">  971</span> </div>
<div class="line"><span class="lineno">  972</span>          row_adj.clear();</div>
<div class="line"><span class="lineno">  973</span>          <span class="keywordflow">for</span> (<span class="keyword">auto</span> e : dim_ents) {</div>
<div class="line"><span class="lineno">  974</span>            <span class="keyword">auto</span> adj_it = adj_bridge_map.find(e);</div>
<div class="line"><span class="lineno">  975</span>            <span class="keywordflow">if</span> (adj_it != adj_bridge_map.end()) {</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>              <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> idx : adj_it-&gt;adj)</div>
<div class="line"><span class="lineno">  978</span>                row_adj.push_back(idx);</div>
<div class="line"><span class="lineno">  979</span> </div>
<div class="line"><span class="lineno">  980</span>            } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  981</span>              SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno">  982</span>                      <span class="stringliteral">&quot;Entity not found&quot;</span>);</div>
<div class="line"><span class="lineno">  983</span>          }</div>
<div class="line"><span class="lineno">  984</span> </div>
<div class="line"><span class="lineno">  985</span>          std::sort(row_adj.begin(), row_adj.end());</div>
<div class="line"><span class="lineno">  986</span>          <span class="keyword">auto</span> end = std::unique(row_adj.begin(), row_adj.end());</div>
<div class="line"><span class="lineno">  987</span> </div>
<div class="line"><span class="lineno">  988</span>          <span class="keywordtype">size_t</span> row_size = std::distance(row_adj.begin(), end);</div>
<div class="line"><span class="lineno">  989</span>          max_row_size = std::max(max_row_size, row_size);</div>
<div class="line"><span class="lineno">  990</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.capacity() &lt; (nb_loc_elements - jj) * max_row_size)</div>
<div class="line"><span class="lineno">  991</span>            <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.reserve(nb_loc_elements * max_row_size);</div>
<div class="line"><span class="lineno">  992</span> </div>
<div class="line"><span class="lineno">  993</span>          <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>[jj] = <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.size();</div>
<div class="line"><span class="lineno">  994</span>          <span class="keyword">auto</span> diag = ents.index(*fe_it);</div>
<div class="line"><span class="lineno">  995</span>          <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = row_adj.begin(); it != end; ++it)</div>
<div class="line"><span class="lineno">  996</span>            <span class="keywordflow">if</span> (*it != diag)</div>
<div class="line"><span class="lineno">  997</span>              <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.push_back(*it);</div>
<div class="line"><span class="lineno">  998</span>        }</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>        ++jj;</div>
<div class="line"><span class="lineno"> 1001</span> </div>
<div class="line"><span class="lineno"> 1002</span>        <span class="keywordflow">if</span> (th_vertex_weights != NULL)</div>
<div class="line"><span class="lineno"> 1003</span>          weight_ents.push_back(*fe_it);</div>
<div class="line"><span class="lineno"> 1004</span>      }</div>
<div class="line"><span class="lineno"> 1005</span> </div>
<div class="line"><span class="lineno"> 1006</span>      <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>[jj] = <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.size();</div>
<div class="line"><span class="lineno"> 1007</span>    }</div>
<div class="line"><span class="lineno"> 1008</span> </div>
<div class="line"><span class="lineno"> 1009</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>.size() * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), &amp;_i);</div>
<div class="line"><span class="lineno"> 1010</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.size() * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), &amp;_j);</div>
<div class="line"><span class="lineno"> 1011</span>    copy(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>.begin(), <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>.end(), _i);</div>
<div class="line"><span class="lineno"> 1012</span>    copy(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.begin(), <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>.end(), _j);</div>
<div class="line"><span class="lineno"> 1013</span>  }</div>
<div class="line"><span class="lineno"> 1014</span> </div>
<div class="line"><span class="lineno"> 1015</span>  <span class="comment">// get weights</span></div>
<div class="line"><span class="lineno"> 1016</span>  <span class="keywordtype">int</span> *vertex_weights = NULL;</div>
<div class="line"><span class="lineno"> 1017</span>  <span class="keywordflow">if</span> (th_vertex_weights != NULL) {</div>
<div class="line"><span class="lineno"> 1018</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscMalloc(weight_ents.size() * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), &amp;vertex_weights);</div>
<div class="line"><span class="lineno"> 1019</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_get_data(*th_vertex_weights,</div>
<div class="line"><span class="lineno"> 1020</span>                                           &amp;*weight_ents.begin(),</div>
<div class="line"><span class="lineno"> 1021</span>                                           weight_ents.size(), vertex_weights);</div>
<div class="line"><span class="lineno"> 1022</span>  }</div>
<div class="line"><span class="lineno"> 1023</span> </div>
<div class="line"><span class="lineno"> 1024</span>  {</div>
<div class="line"><span class="lineno"> 1025</span>    Mat Adj;</div>
<div class="line"><span class="lineno"> 1026</span>    <span class="comment">// Adjacency matrix used to partition problems, f.e. METIS</span></div>
<div class="line"><span class="lineno"> 1027</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatCreateMPIAdj(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), rend - rstart, nb_elems, _i, _j,</div>
<div class="line"><span class="lineno"> 1028</span>                           PETSC_NULLPTR, &amp;Adj);</div>
<div class="line"><span class="lineno"> 1029</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatSetOption(Adj, MAT_STRUCTURALLY_SYMMETRIC, PETSC_TRUE);</div>
<div class="line"><span class="lineno"> 1030</span> </div>
<div class="line"><span class="lineno"> 1031</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structMoFEM_1_1CommInterface.html#a6a735cf8281a4ca5b86bb95cdf1cb160">debug</a>) {</div>
<div class="line"><span class="lineno"> 1032</span>      Mat <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>;</div>
<div class="line"><span class="lineno"> 1033</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatConvert(Adj, MATMPIAIJ, MAT_INITIAL_MATRIX, &amp;<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>);</div>
<div class="line"><span class="lineno"> 1034</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatView(<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>, PETSC_VIEWER_DRAW_WORLD);</div>
<div class="line"><span class="lineno"> 1035</span>      std::string wait;</div>
<div class="line"><span class="lineno"> 1036</span>      std::cin &gt;&gt; wait;</div>
<div class="line"><span class="lineno"> 1037</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>);</div>
<div class="line"><span class="lineno"> 1038</span>    }</div>
<div class="line"><span class="lineno"> 1039</span> </div>
<div class="line"><span class="lineno"> 1040</span>    <span class="comment">// run pets to do partitioning</span></div>
<div class="line"><span class="lineno"> 1041</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::verbose) &lt;&lt; <span class="stringliteral">&quot;Start&quot;</span>;</div>
<div class="line"><span class="lineno"> 1042</span> </div>
<div class="line"><span class="lineno"> 1043</span>    MatPartitioning part;</div>
<div class="line"><span class="lineno"> 1044</span>    IS is;</div>
<div class="line"><span class="lineno"> 1045</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;part);</div>
<div class="line"><span class="lineno"> 1046</span> </div>
<div class="line"><span class="lineno"> 1047</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetAdjacency(part, Adj);</div>
<div class="line"><span class="lineno"> 1048</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetFromOptions(part);</div>
<div class="line"><span class="lineno"> 1049</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetNParts(part, n_parts);</div>
<div class="line"><span class="lineno"> 1050</span>    <span class="keywordflow">if</span> (th_vertex_weights != NULL) {</div>
<div class="line"><span class="lineno"> 1051</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetVertexWeights(part, vertex_weights);</div>
<div class="line"><span class="lineno"> 1052</span>    }</div>
<div class="line"><span class="lineno"> 1053</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningApply(part, &amp;is);</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>    <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::verbose) &lt;&lt; <span class="stringliteral">&quot;End&quot;</span>;</div>
<div class="line"><span class="lineno"> 1056</span> </div>
<div class="line"><span class="lineno"> 1057</span>    <span class="comment">// gather</span></div>
<div class="line"><span class="lineno"> 1058</span>    IS is_gather, is_num, is_gather_num;</div>
<div class="line"><span class="lineno"> 1059</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISAllGather(is, &amp;is_gather);</div>
<div class="line"><span class="lineno"> 1060</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISPartitioningToNumbering(is, &amp;is_num);</div>
<div class="line"><span class="lineno"> 1061</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISAllGather(is_num, &amp;is_gather_num);</div>
<div class="line"><span class="lineno"> 1062</span> </div>
<div class="line"><span class="lineno"> 1063</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> *part_number, *gids;</div>
<div class="line"><span class="lineno"> 1064</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetIndices(is_gather, &amp;part_number);</div>
<div class="line"><span class="lineno"> 1065</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetIndices(is_gather_num, &amp;gids);</div>
<div class="line"><span class="lineno"> 1066</span> </div>
<div class="line"><span class="lineno"> 1067</span>    <span class="comment">// set partition tag and gid tag to entities</span></div>
<div class="line"><span class="lineno"> 1068</span>    ParallelComm *pcomm = ParallelComm::get_pcomm(</div>
<div class="line"><span class="lineno"> 1069</span>        &amp;m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>(), m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#afc8134b45759ab88b40c92f07a785bf5">get_basic_entity_data_ptr</a>()-&gt;pcommID);</div>
<div class="line"><span class="lineno"> 1070</span>    Tag part_tag = pcomm-&gt;part_tag();</div>
<div class="line"><span class="lineno"> 1071</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_set_data(part_tag, ents, part_number);</div>
<div class="line"><span class="lineno"> 1072</span>    Tag gid_tag = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().globalId_tag();</div>
<div class="line"><span class="lineno"> 1073</span> </div>
<div class="line"><span class="lineno"> 1074</span>    std::map&lt;int, Range&gt; parts_ents;</div>
<div class="line"><span class="lineno"> 1075</span>    {</div>
<div class="line"><span class="lineno"> 1076</span>      <span class="comment">// get entities on each part</span></div>
<div class="line"><span class="lineno"> 1077</span>      Range::iterator eit = ents.begin();</div>
<div class="line"><span class="lineno"> 1078</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; eit != ents.end(); eit++, ii++) {</div>
<div class="line"><span class="lineno"> 1079</span>        parts_ents[part_number[ii]].insert(*eit);</div>
<div class="line"><span class="lineno"> 1080</span>      }</div>
<div class="line"><span class="lineno"> 1081</span>      <a class="code hl_class" href="classRange.html">Range</a> tagged_sets;</div>
<div class="line"><span class="lineno"> 1082</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_entities_by_type_and_tag(</div>
<div class="line"><span class="lineno"> 1083</span>          0, MBENTITYSET, &amp;part_tag, NULL, 1, tagged_sets,</div>
<div class="line"><span class="lineno"> 1084</span>          moab::Interface::UNION);</div>
<div class="line"><span class="lineno"> 1085</span>      <span class="keywordflow">if</span> (!tagged_sets.empty())</div>
<div class="line"><span class="lineno"> 1086</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_delete_data(part_tag, tagged_sets);</div>
<div class="line"><span class="lineno"> 1087</span> </div>
<div class="line"><span class="lineno"> 1088</span>      <span class="keywordflow">if</span> (n_parts &gt; (<span class="keywordtype">int</span>)tagged_sets.size()) {</div>
<div class="line"><span class="lineno"> 1089</span>        <span class="comment">// too few partition sets - create missing ones</span></div>
<div class="line"><span class="lineno"> 1090</span>        <span class="keywordtype">int</span> num_new = n_parts - tagged_sets.size();</div>
<div class="line"><span class="lineno"> 1091</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> = 0; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> &lt; num_new; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>++) {</div>
<div class="line"><span class="lineno"> 1092</span>          EntityHandle new_set;</div>
<div class="line"><span class="lineno"> 1093</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().create_meshset(MESHSET_SET, new_set);</div>
<div class="line"><span class="lineno"> 1094</span>          tagged_sets.insert(new_set);</div>
<div class="line"><span class="lineno"> 1095</span>        }</div>
<div class="line"><span class="lineno"> 1096</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_parts &lt; (<span class="keywordtype">int</span>)tagged_sets.size()) {</div>
<div class="line"><span class="lineno"> 1097</span>        <span class="comment">// too many partition sets - delete extras</span></div>
<div class="line"><span class="lineno"> 1098</span>        <span class="keywordtype">int</span> num_del = tagged_sets.size() - n_parts;</div>
<div class="line"><span class="lineno"> 1099</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> = 0; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> &lt; num_del; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>++) {</div>
<div class="line"><span class="lineno"> 1100</span>          EntityHandle old_set = tagged_sets.pop_back();</div>
<div class="line"><span class="lineno"> 1101</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().delete_entities(&amp;old_set, 1);</div>
<div class="line"><span class="lineno"> 1102</span>        }</div>
<div class="line"><span class="lineno"> 1103</span>      }</div>
<div class="line"><span class="lineno"> 1104</span>      <span class="comment">// write a tag to those sets denoting they&#39;re partition sets, with a</span></div>
<div class="line"><span class="lineno"> 1105</span>      <span class="comment">// value of the proc number</span></div>
<div class="line"><span class="lineno"> 1106</span>      std::vector&lt;int&gt; dum_ids(n_parts);</div>
<div class="line"><span class="lineno"> 1107</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> = 0; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> &lt; n_parts; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>++)</div>
<div class="line"><span class="lineno"> 1108</span>        dum_ids[<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>] = <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line"><span class="lineno"> 1109</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_set_data(part_tag, tagged_sets,</div>
<div class="line"><span class="lineno"> 1110</span>                                             &amp;*dum_ids.begin());</div>
<div class="line"><span class="lineno"> 1111</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().clear_meshset(tagged_sets);</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>      <span class="comment">// get lower dimension entities on each part</span></div>
<div class="line"><span class="lineno"> 1114</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pp = 0; pp != n_parts; pp++) {</div>
<div class="line"><span class="lineno"> 1115</span>        <a class="code hl_class" href="classRange.html">Range</a> dim_ents = parts_ents[pp].subset_by_dimension(dim);</div>
<div class="line"><span class="lineno"> 1116</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dd = dim - 1; <a class="code hl_function" href="namespaceFTensor.html#ad4a6ecc7f7a6e3b3903a9cff27887f39">dd</a> &gt;= 0; <a class="code hl_function" href="namespaceFTensor.html#ad4a6ecc7f7a6e3b3903a9cff27887f39">dd</a>--) {</div>
<div class="line"><span class="lineno"> 1117</span>          <a class="code hl_class" href="classRange.html">Range</a> adj_ents;</div>
<div class="line"><span class="lineno"> 1118</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().get_adjacencies(</div>
<div class="line"><span class="lineno"> 1119</span>              dim_ents, dd, <span class="keyword">false</span>, adj_ents, moab::Interface::UNION);</div>
<div class="line"><span class="lineno"> 1120</span>          parts_ents[pp].merge(adj_ents);</div>
<div class="line"><span class="lineno"> 1121</span>        }</div>
<div class="line"><span class="lineno"> 1122</span>      }</div>
<div class="line"><span class="lineno"> 1123</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pp = 1; pp != n_parts; pp++) {</div>
<div class="line"><span class="lineno"> 1124</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ppp = 0; ppp != pp; ppp++) {</div>
<div class="line"><span class="lineno"> 1125</span>          parts_ents[pp] = subtract(parts_ents[pp], parts_ents[ppp]);</div>
<div class="line"><span class="lineno"> 1126</span>        }</div>
<div class="line"><span class="lineno"> 1127</span>      }</div>
<div class="line"><span class="lineno"> 1128</span> </div>
<div class="line"><span class="lineno"> 1129</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pp = 0; pp != n_parts; pp++) {</div>
<div class="line"><span class="lineno"> 1130</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().add_entities(tagged_sets[pp], parts_ents[pp]);</div>
<div class="line"><span class="lineno"> 1131</span>      }</div>
<div class="line"><span class="lineno"> 1132</span> </div>
<div class="line"><span class="lineno"> 1133</span>      <span class="keyword">auto</span> set_part = [&amp;]() {</div>
<div class="line"><span class="lineno"> 1134</span>        <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1135</span>        <span class="keywordflow">for</span> (EntityType <a class="code hl_variable" href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a> = MBEDGE; <a class="code hl_variable" href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a> != MBENTITYSET; ++<a class="code hl_variable" href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a>) {</div>
<div class="line"><span class="lineno"> 1136</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pp = 0; pp != n_parts; pp++) {</div>
<div class="line"><span class="lineno"> 1137</span>            <a class="code hl_class" href="classRange.html">Range</a> type_ents = parts_ents[pp].subset_by_type(<a class="code hl_variable" href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a>);</div>
<div class="line"><span class="lineno"> 1138</span>            <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_clear_data(part_tag, type_ents, &amp;pp);</div>
<div class="line"><span class="lineno"> 1139</span>          }</div>
<div class="line"><span class="lineno"> 1140</span>        }</div>
<div class="line"><span class="lineno"> 1141</span>        <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1142</span>      };</div>
<div class="line"><span class="lineno"> 1143</span> </div>
<div class="line"><span class="lineno"> 1144</span>      <span class="keyword">auto</span> set_gid = [&amp;]() {</div>
<div class="line"><span class="lineno"> 1145</span>        <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1146</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; <a class="code hl_variable" href="namespacesdf__hertz__2d__axisymm__plane.html#a8204f26163e5d184298bc6fa855b88ea">d</a> != 4; ++<a class="code hl_variable" href="namespacesdf__hertz__2d__axisymm__plane.html#a8204f26163e5d184298bc6fa855b88ea">d</a>) {</div>
<div class="line"><span class="lineno"> 1147</span> </div>
<div class="line"><span class="lineno"> 1148</span>          <span class="keywordtype">void</span> *ptr;</div>
<div class="line"><span class="lineno"> 1149</span>          <span class="keywordtype">int</span> count;</div>
<div class="line"><span class="lineno"> 1150</span> </div>
<div class="line"><span class="lineno"> 1151</span>          <span class="keywordtype">int</span> gid = 1; <span class="comment">// moab indexing from 1</span></div>
<div class="line"><span class="lineno"> 1152</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pp = 0; pp != n_parts; pp++) {</div>
<div class="line"><span class="lineno"> 1153</span>            <a class="code hl_class" href="classRange.html">Range</a> type_ents = parts_ents[pp].subset_by_dimension(d);</div>
<div class="line"><span class="lineno"> 1154</span> </div>
<div class="line"><span class="lineno"> 1155</span>            <span class="keyword">auto</span> eit = type_ents.begin();</div>
<div class="line"><span class="lineno"> 1156</span>            <span class="keywordflow">for</span> (; eit != type_ents.end();) {</div>
<div class="line"><span class="lineno"> 1157</span>              <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().tag_iterate(</div>
<div class="line"><span class="lineno"> 1158</span>                  gid_tag, eit, type_ents.end(), count, ptr);</div>
<div class="line"><span class="lineno"> 1159</span>              <span class="keyword">auto</span> gid_tag_ptr = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span> *<span class="keyword">&gt;</span>(ptr);</div>
<div class="line"><span class="lineno"> 1160</span>              <span class="keywordflow">for</span> (; count &gt; 0; --count) {</div>
<div class="line"><span class="lineno"> 1161</span>                *gid_tag_ptr = gid;</div>
<div class="line"><span class="lineno"> 1162</span>                ++eit;</div>
<div class="line"><span class="lineno"> 1163</span>                ++gid;</div>
<div class="line"><span class="lineno"> 1164</span>                ++gid_tag_ptr;</div>
<div class="line"><span class="lineno"> 1165</span>              }</div>
<div class="line"><span class="lineno"> 1166</span>            }</div>
<div class="line"><span class="lineno"> 1167</span>          }</div>
<div class="line"><span class="lineno"> 1168</span>        }</div>
<div class="line"><span class="lineno"> 1169</span> </div>
<div class="line"><span class="lineno"> 1170</span>        <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1171</span>      };</div>
<div class="line"><span class="lineno"> 1172</span> </div>
<div class="line"><span class="lineno"> 1173</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_part();</div>
<div class="line"><span class="lineno"> 1174</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_gid();</div>
<div class="line"><span class="lineno"> 1175</span>    }</div>
<div class="line"><span class="lineno"> 1176</span> </div>
<div class="line"><span class="lineno"> 1177</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="structMoFEM_1_1CommInterface.html#a6a735cf8281a4ca5b86bb95cdf1cb160">debug</a>) {</div>
<div class="line"><span class="lineno"> 1178</span>      <span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>() == 0) {</div>
<div class="line"><span class="lineno"> 1179</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != n_parts; rr++) {</div>
<div class="line"><span class="lineno"> 1180</span>          ostringstream ss;</div>
<div class="line"><span class="lineno"> 1181</span>          ss &lt;&lt; <span class="stringliteral">&quot;out_part_&quot;</span> &lt;&lt; rr &lt;&lt; <span class="stringliteral">&quot;.vtk&quot;</span>;</div>
<div class="line"><span class="lineno"> 1182</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SELF&quot;</span>, Sev::inform) &lt;&lt; <span class="stringliteral">&quot;Save debug part mesh &quot;</span> &lt;&lt; ss.str();</div>
<div class="line"><span class="lineno"> 1183</span>          EntityHandle meshset;</div>
<div class="line"><span class="lineno"> 1184</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().create_meshset(MESHSET_SET, meshset);</div>
<div class="line"><span class="lineno"> 1185</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().add_entities(meshset, parts_ents[rr]);</div>
<div class="line"><span class="lineno"> 1186</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().write_file(ss.str().c_str(), <span class="stringliteral">&quot;VTK&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 1187</span>                                               &amp;meshset, 1);</div>
<div class="line"><span class="lineno"> 1188</span>          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a174e70b67f4f235d096d3c45d865645b">get_moab</a>().delete_entities(&amp;meshset, 1);</div>
<div class="line"><span class="lineno"> 1189</span>        }</div>
<div class="line"><span class="lineno"> 1190</span>      }</div>
<div class="line"><span class="lineno"> 1191</span>    }</div>
<div class="line"><span class="lineno"> 1192</span> </div>
<div class="line"><span class="lineno"> 1193</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISRestoreIndices(is_gather, &amp;part_number);</div>
<div class="line"><span class="lineno"> 1194</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISRestoreIndices(is_gather_num, &amp;gids);</div>
<div class="line"><span class="lineno"> 1195</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_num);</div>
<div class="line"><span class="lineno"> 1196</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_gather_num);</div>
<div class="line"><span class="lineno"> 1197</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_gather);</div>
<div class="line"><span class="lineno"> 1198</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is);</div>
<div class="line"><span class="lineno"> 1199</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningDestroy(&amp;part);</div>
<div class="line"><span class="lineno"> 1200</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;Adj);</div>
<div class="line"><span class="lineno"> 1201</span>  }</div>
<div class="line"><span class="lineno"> 1202</span> </div>
<div class="line"><span class="lineno"> 1203</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1204</span>}</div>
<div class="ttc" id="adefinitions_8h_html_a6c0b52978f1abc88bf8a1ba70b7308e3"><div class="ttname"><a href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a></div><div class="ttdeci">#define MoFEMFunctionBegin</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00359">definitions.h:359</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eaef48b40a28ec42fda55bc4824e906baf"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaef48b40a28ec42fda55bc4824e906baf">MOFEM_NOT_IMPLEMENTED</a></div><div class="ttdeci">@ MOFEM_NOT_IMPLEMENTED</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00032">definitions.h:32</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a8191f28ba278df9c5d32a75cadb2bbd5"><div class="ttname"><a href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a></div><div class="ttdeci">FTensor::Index&lt; 'j', 3 &gt; j</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00019">matrix_function.cpp:19</a></div></div>
<div class="ttc" id="anamespacesdf__hertz__2d__axisymm__plane_html_a8204f26163e5d184298bc6fa855b88ea"><div class="ttname"><a href="namespacesdf__hertz__2d__axisymm__plane.html#a8204f26163e5d184298bc6fa855b88ea">sdf_hertz_2d_axisymm_plane.d</a></div><div class="ttdeci">float d</div><div class="ttdef"><b>Definition</b> <a href="sdf__hertz__2d__axisymm__plane_8py_source.html#l00004">sdf_hertz_2d_axisymm_plane.py:4</a></div></div>
<div class="ttc" id="aoperators__tests_8cpp_html_aaea25cacd18f8fc7fbbaa4311fe33b72"><div class="ttname"><a href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a></div><div class="ttdeci">constexpr AssemblyType A</div><div class="ttdef"><b>Definition</b> <a href="operators__tests_8cpp_source.html#l00030">operators_tests.cpp:30</a></div></div>
<div class="ttc" id="aplate_8cpp_html_a95479f31dffaa5e5858822a5e4c231d6"><div class="ttname"><a href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a></div><div class="ttdeci">constexpr double t</div><div class="ttdoc">plate stiffness</div><div class="ttdef"><b>Definition</b> <a href="plate_8cpp_source.html#l00058">plate.cpp:58</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CommInterface_html_a6a735cf8281a4ca5b86bb95cdf1cb160"><div class="ttname"><a href="structMoFEM_1_1CommInterface.html#a6a735cf8281a4ca5b86bb95cdf1cb160">MoFEM::CommInterface::debug</a></div><div class="ttdeci">static bool debug</div><div class="ttdef"><b>Definition</b> <a href="CommInterface_8hpp_source.html#l00023">CommInterface.hpp:23</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CommInterface_html_ab531417c6ed05f8aadbdc455817c4499"><div class="ttname"><a href="structMoFEM_1_1CommInterface.html#ab531417c6ed05f8aadbdc455817c4499">MoFEM::CommInterface::cOre</a></div><div class="ttdeci">MoFEM::Core &amp; cOre</div><div class="ttdef"><b>Definition</b> <a href="CommInterface_8hpp_source.html#l00029">CommInterface.hpp:29</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreInterface_html_afc8134b45759ab88b40c92f07a785bf5"><div class="ttname"><a href="structMoFEM_1_1CoreInterface.html#afc8134b45759ab88b40c92f07a785bf5">MoFEM::CoreInterface::get_basic_entity_data_ptr</a></div><div class="ttdeci">virtual boost::shared_ptr&lt; BasicEntityData &gt; &amp; get_basic_entity_data_ptr()=0</div><div class="ttdoc">Get pointer to basic entity data.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga9a750159b072bbc8107d5626fc1bc42b" name="ga9a750159b072bbc8107d5626fc1bc42b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9a750159b072bbc8107d5626fc1bc42b">&#9670;&#160;</a></span>partitionMesh() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionMesh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classRange.html">Range</a> &amp;&#160;</td>
          <td class="paramname"><em>ents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>adj_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>n_parts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_vertex_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_edge_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Tag *&#160;</td>
          <td class="paramname"><em>th_part_weights</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>debug</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set partition tag to each finite element in the problem. </p>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000068">Deprecated:</a></b></dt><dd>Use <a class="el" href="structMoFEM_1_1CommInterface.html" title="Managing BitRefLevels.">CommInterface</a> </dd></dl>
<p>This will use one of the mesh partitioning programs available from PETSc See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatPartitioningType.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatPartitioningType.html</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ents</td><td>Entities to partition </td></tr>
    <tr><td class="paramname">dim</td><td>Dimension of entities to partition </td></tr>
    <tr><td class="paramname">adj_dim</td><td>Adjacency dimension </td></tr>
    <tr><td class="paramname">n_parts</td><td>Number of partitions </td></tr>
    <tr><td class="paramname">verb</td><td>Verbosity level </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l00076">76</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   79</span>                                {</div>
<div class="line"><span class="lineno">   80</span>  <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;<span class="keyword">&gt;</span>(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>)</div>
<div class="line"><span class="lineno">   81</span>      .getInterface&lt;CommInterface&gt;()</div>
<div class="line"><span class="lineno">   82</span>      -&gt;partitionMesh(ents, dim, adj_dim, n_parts, th_vertex_weights,</div>
<div class="line"><span class="lineno">   83</span>                      th_edge_weights, th_part_weights, verb, <a class="code hl_variable" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>);</div>
<div class="line"><span class="lineno">   84</span>}</div>
<div class="ttc" id="anamespaceMoFEM_html_a2e89479afd4801ad925769bb157de81f"><div class="ttname"><a href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">MoFEM::debug</a></div><div class="ttdeci">static const bool debug</div><div class="ttdef"><b>Definition</b> <a href="ConstrainMatrixCtx_8cpp_source.html#l00009">ConstrainMatrixCtx.cpp:9</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaa0e280c88443b6240bf3255c0dce0ef2" name="gaa0e280c88443b6240bf3255c0dce0ef2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa0e280c88443b6240bf3255c0dce0ef2">&#9670;&#160;</a></span>partitionProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionProblem </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>partition problem dofs (collective) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
  </table>
  </dd>
</dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="build_problems_8cpp-example.html#a30">build_problems.cpp</a>, <a class="el" href="continuity_check_on_skeleton_3d_8cpp-example.html#a33">continuity_check_on_skeleton_3d.cpp</a>, <a class="el" href="mesh_insert_interface_atom_8cpp-example.html#a39">mesh_insert_interface_atom.cpp</a>, and <a class="el" href="remove_entities_from_problem_not_partitioned_8cpp-example.html#a32">remove_entities_from_problem_not_partitioned.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l01679">1679</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1680</span>                                                           {</div>
<div class="line"><span class="lineno"> 1681</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 1682</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 1683</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1684</span> </div>
<div class="line"><span class="lineno"> 1685</span>  <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::noisy) &lt;&lt; <span class="stringliteral">&quot;Partition problem &quot;</span> &lt;&lt; name;</div>
<div class="line"><span class="lineno"> 1686</span> </div>
<div class="line"><span class="lineno"> 1687</span>  <span class="keyword">using </span>NumeredDofEntitysByIdx =</div>
<div class="line"><span class="lineno"> 1688</span>      NumeredDofEntity_multiIndex::index&lt;Idx_mi_tag&gt;::type;</div>
<div class="line"><span class="lineno"> 1689</span>  <span class="keyword">using </span>ProblemsByName = Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type;</div>
<div class="line"><span class="lineno"> 1690</span> </div>
<div class="line"><span class="lineno"> 1691</span>  <span class="comment">// Find problem pointer by name</span></div>
<div class="line"><span class="lineno"> 1692</span>  <span class="keyword">auto</span> &amp;problems_set =</div>
<div class="line"><span class="lineno"> 1693</span>      <span class="keyword">const_cast&lt;</span>ProblemsByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1694</span>  <span class="keyword">auto</span> p_miit = problems_set.find(name);</div>
<div class="line"><span class="lineno"> 1695</span>  <span class="keywordflow">if</span> (p_miit == problems_set.end()) {</div>
<div class="line"><span class="lineno"> 1696</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaded6d08fa6d0cd6d9b116fac8318c262">MOFEM_INVALID_DATA</a>,</div>
<div class="line"><span class="lineno"> 1697</span>             <span class="stringliteral">&quot;problem with name %s not defined (top tip check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1698</span>             name.c_str());</div>
<div class="line"><span class="lineno"> 1699</span>  }</div>
<div class="line"><span class="lineno"> 1700</span>  <span class="keywordtype">int</span> nb_dofs_row = p_miit-&gt;getNbDofsRow();</div>
<div class="line"><span class="lineno"> 1701</span> </div>
<div class="line"><span class="lineno"> 1702</span>  <span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>() != 1) {</div>
<div class="line"><span class="lineno"> 1703</span> </div>
<div class="line"><span class="lineno"> 1704</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 0)))</div>
<div class="line"><span class="lineno"> 1705</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1706</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 1)))</div>
<div class="line"><span class="lineno"> 1707</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1708</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 2)))</div>
<div class="line"><span class="lineno"> 1709</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 1710</span>              <span class="stringliteral">&quot;entFEAdjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1711</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; (1 &lt;&lt; 3)))</div>
<div class="line"><span class="lineno"> 1712</span>      SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;Problems not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1713</span> </div>
<div class="line"><span class="lineno"> 1714</span>    Mat Adj;</div>
<div class="line"><span class="lineno"> 1715</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;MatrixManager&gt;()</div>
<div class="line"><span class="lineno"> 1716</span>        -&gt;createMPIAdjWithArrays&lt;Idx_mi_tag&gt;(name, &amp;Adj, verb);</div>
<div class="line"><span class="lineno"> 1717</span> </div>
<div class="line"><span class="lineno"> 1718</span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#afd53743d1af6bfa2856255b23b5a41a9">n</a>;</div>
<div class="line"><span class="lineno"> 1719</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatGetSize(Adj, &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#afd53743d1af6bfa2856255b23b5a41a9">n</a>);</div>
<div class="line"><span class="lineno"> 1720</span>    <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca05ac9ca266f9e1731e2832c50fc14849">VERY_VERBOSE</a>)</div>
<div class="line"><span class="lineno"> 1721</span>      MatView(Adj, PETSC_VIEWER_STDOUT_WORLD);</div>
<div class="line"><span class="lineno"> 1722</span> </div>
<div class="line"><span class="lineno"> 1723</span>    <span class="comment">// partitioning</span></div>
<div class="line"><span class="lineno"> 1724</span>    MatPartitioning part;</div>
<div class="line"><span class="lineno"> 1725</span>    IS is;</div>
<div class="line"><span class="lineno"> 1726</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;part);</div>
<div class="line"><span class="lineno"> 1727</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetAdjacency(part, Adj);</div>
<div class="line"><span class="lineno"> 1728</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetFromOptions(part);</div>
<div class="line"><span class="lineno"> 1729</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningSetNParts(part, m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>());</div>
<div class="line"><span class="lineno"> 1730</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningApply(part, &amp;is);</div>
<div class="line"><span class="lineno"> 1731</span>    <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca05ac9ca266f9e1731e2832c50fc14849">VERY_VERBOSE</a>)</div>
<div class="line"><span class="lineno"> 1732</span>      ISView(is, PETSC_VIEWER_STDOUT_WORLD);</div>
<div class="line"><span class="lineno"> 1733</span> </div>
<div class="line"><span class="lineno"> 1734</span>    <span class="comment">// gather</span></div>
<div class="line"><span class="lineno"> 1735</span>    IS is_gather, is_num, is_gather_num;</div>
<div class="line"><span class="lineno"> 1736</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISAllGather(is, &amp;is_gather);</div>
<div class="line"><span class="lineno"> 1737</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISPartitioningToNumbering(is, &amp;is_num);</div>
<div class="line"><span class="lineno"> 1738</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISAllGather(is_num, &amp;is_gather_num);</div>
<div class="line"><span class="lineno"> 1739</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> *part_number, *petsc_idx;</div>
<div class="line"><span class="lineno"> 1740</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetIndices(is_gather, &amp;part_number);</div>
<div class="line"><span class="lineno"> 1741</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetIndices(is_gather_num, &amp;petsc_idx);</div>
<div class="line"><span class="lineno"> 1742</span>    <span class="keywordtype">int</span> size_is_num, size_is_gather;</div>
<div class="line"><span class="lineno"> 1743</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetSize(is_gather, &amp;size_is_gather);</div>
<div class="line"><span class="lineno"> 1744</span>    <span class="keywordflow">if</span> (size_is_gather != (<span class="keywordtype">int</span>)nb_dofs_row)</div>
<div class="line"><span class="lineno"> 1745</span>      SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_SIZ,</div>
<div class="line"><span class="lineno"> 1746</span>               <span class="stringliteral">&quot;data inconsistency %d != %d&quot;</span>, size_is_gather, nb_dofs_row);</div>
<div class="line"><span class="lineno"> 1747</span> </div>
<div class="line"><span class="lineno"> 1748</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISGetSize(is_num, &amp;size_is_num);</div>
<div class="line"><span class="lineno"> 1749</span>    <span class="keywordflow">if</span> (size_is_num != (<span class="keywordtype">int</span>)nb_dofs_row)</div>
<div class="line"><span class="lineno"> 1750</span>      SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_SIZ,</div>
<div class="line"><span class="lineno"> 1751</span>               <span class="stringliteral">&quot;data inconsistency %d != %d&quot;</span>, size_is_num, nb_dofs_row);</div>
<div class="line"><span class="lineno"> 1752</span> </div>
<div class="line"><span class="lineno"> 1753</span>    <span class="keywordtype">bool</span> square_matrix = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1754</span>    <span class="keywordflow">if</span> (p_miit-&gt;numeredRowDofsPtr == p_miit-&gt;numeredColDofsPtr)</div>
<div class="line"><span class="lineno"> 1755</span>      square_matrix = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1756</span> </div>
<div class="line"><span class="lineno"> 1757</span>    <span class="comment">// if (!square_matrix) {</span></div>
<div class="line"><span class="lineno"> 1758</span>    <span class="comment">//   // FIXME: This is for back compatibility, if deprecate interface</span></div>
<div class="line"><span class="lineno"> 1759</span>    <span class="comment">//   function</span></div>
<div class="line"><span class="lineno"> 1760</span>    <span class="comment">//   // build interfaces is removed, this part of the code will be obsolete</span></div>
<div class="line"><span class="lineno"> 1761</span>    <span class="comment">//   auto mit_row = p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Idx_mi_tag&gt;().begin();</span></div>
<div class="line"><span class="lineno"> 1762</span>    <span class="comment">//   auto hi_mit_row = p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Idx_mi_tag&gt;().end();</span></div>
<div class="line"><span class="lineno"> 1763</span>    <span class="comment">//   auto mit_col = p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Idx_mi_tag&gt;().begin();</span></div>
<div class="line"><span class="lineno"> 1764</span>    <span class="comment">//   auto hi_mit_col = p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Idx_mi_tag&gt;().end();</span></div>
<div class="line"><span class="lineno"> 1765</span>    <span class="comment">//   for (; mit_row != hi_mit_row; mit_row++, mit_col++) {</span></div>
<div class="line"><span class="lineno"> 1766</span>    <span class="comment">//     if (mit_col == hi_mit_col) {</span></div>
<div class="line"><span class="lineno"> 1767</span>    <span class="comment">//       SETERRQ(</span></div>
<div class="line"><span class="lineno"> 1768</span>    <span class="comment">//           PETSC_COMM_SELF, MOFEM_DATA_INCONSISTENCY,</span></div>
<div class="line"><span class="lineno"> 1769</span>    <span class="comment">//           &quot;check finite element definition, nb. of rows is not equal to &quot;</span></div>
<div class="line"><span class="lineno"> 1770</span>    <span class="comment">//           &quot;number for columns&quot;);</span></div>
<div class="line"><span class="lineno"> 1771</span>    <span class="comment">//     }</span></div>
<div class="line"><span class="lineno"> 1772</span>    <span class="comment">//     if (mit_row-&gt;get()-&gt;getLocalUniqueId() !=</span></div>
<div class="line"><span class="lineno"> 1773</span>    <span class="comment">//         mit_col-&gt;get()-&gt;getLocalUniqueId()) {</span></div>
<div class="line"><span class="lineno"> 1774</span>    <span class="comment">//       SETERRQ(</span></div>
<div class="line"><span class="lineno"> 1775</span>    <span class="comment">//           PETSC_COMM_SELF, MOFEM_DATA_INCONSISTENCY,</span></div>
<div class="line"><span class="lineno"> 1776</span>    <span class="comment">//           &quot;check finite element definition, nb. of rows is not equal to &quot;</span></div>
<div class="line"><span class="lineno"> 1777</span>    <span class="comment">//           &quot;number for columns&quot;);</span></div>
<div class="line"><span class="lineno"> 1778</span>    <span class="comment">//     }</span></div>
<div class="line"><span class="lineno"> 1779</span>    <span class="comment">//   }</span></div>
<div class="line"><span class="lineno"> 1780</span>    <span class="comment">// }</span></div>
<div class="line"><span class="lineno"> 1781</span> </div>
<div class="line"><span class="lineno"> 1782</span>    <span class="keyword">auto</span> number_dofs = [&amp;](<span class="keyword">auto</span> &amp;dofs_idx, <span class="keyword">auto</span> &amp;counter) {</div>
<div class="line"><span class="lineno"> 1783</span>      <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1784</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> miit_dofs_row = dofs_idx.begin();</div>
<div class="line"><span class="lineno"> 1785</span>           miit_dofs_row != dofs_idx.end(); miit_dofs_row++) {</div>
<div class="line"><span class="lineno"> 1786</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> part = part_number[(*miit_dofs_row)-&gt;dofIdx];</div>
<div class="line"><span class="lineno"> 1787</span>        <span class="keywordflow">if</span> (part == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1788</span>          <span class="keyword">const</span> <span class="keywordtype">bool</span> success = dofs_idx.modify(</div>
<div class="line"><span class="lineno"> 1789</span>              miit_dofs_row,</div>
<div class="line"><span class="lineno"> 1790</span>              NumeredDofEntity_part_and_indices_change(</div>
<div class="line"><span class="lineno"> 1791</span>                  part, petsc_idx[(*miit_dofs_row)-&gt;dofIdx], counter++));</div>
<div class="line"><span class="lineno"> 1792</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1793</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1794</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1795</span>          }</div>
<div class="line"><span class="lineno"> 1796</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1797</span>          <span class="keyword">const</span> <span class="keywordtype">bool</span> success = dofs_idx.modify(</div>
<div class="line"><span class="lineno"> 1798</span>              miit_dofs_row, NumeredDofEntity_part_and_glob_idx_change(</div>
<div class="line"><span class="lineno"> 1799</span>                                 part, petsc_idx[(*miit_dofs_row)-&gt;dofIdx]));</div>
<div class="line"><span class="lineno"> 1800</span>          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1801</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1802</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1803</span>          }</div>
<div class="line"><span class="lineno"> 1804</span>        }</div>
<div class="line"><span class="lineno"> 1805</span>      }</div>
<div class="line"><span class="lineno"> 1806</span>      <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1807</span>    };</div>
<div class="line"><span class="lineno"> 1808</span> </div>
<div class="line"><span class="lineno"> 1809</span>    <span class="comment">// Set petsc global indices</span></div>
<div class="line"><span class="lineno"> 1810</span>    <span class="keyword">auto</span> &amp;dofs_row_by_idx_no_const = <span class="keyword">const_cast&lt;</span>NumeredDofEntitysByIdx &amp;<span class="keyword">&gt;</span>(</div>
<div class="line"><span class="lineno"> 1811</span>        p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Idx_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1812</span>    <span class="keywordtype">int</span> &amp;nb_row_local_dofs = p_miit-&gt;nbLocDofsRow;</div>
<div class="line"><span class="lineno"> 1813</span>    <span class="keywordtype">int</span> &amp;nb_row_ghost_dofs = p_miit-&gt;nbGhostDofsRow;</div>
<div class="line"><span class="lineno"> 1814</span>    nb_row_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1815</span>    nb_row_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1816</span> </div>
<div class="line"><span class="lineno"> 1817</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> number_dofs(dofs_row_by_idx_no_const, nb_row_local_dofs);</div>
<div class="line"><span class="lineno"> 1818</span> </div>
<div class="line"><span class="lineno"> 1819</span>    <span class="keywordtype">int</span> &amp;nb_col_local_dofs = p_miit-&gt;nbLocDofsCol;</div>
<div class="line"><span class="lineno"> 1820</span>    <span class="keywordtype">int</span> &amp;nb_col_ghost_dofs = p_miit-&gt;nbGhostDofsCol;</div>
<div class="line"><span class="lineno"> 1821</span>    <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1822</span>      nb_col_local_dofs = nb_row_local_dofs;</div>
<div class="line"><span class="lineno"> 1823</span>      nb_col_ghost_dofs = nb_row_ghost_dofs;</div>
<div class="line"><span class="lineno"> 1824</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1825</span>      NumeredDofEntitysByIdx &amp;dofs_col_by_idx_no_const =</div>
<div class="line"><span class="lineno"> 1826</span>          <span class="keyword">const_cast&lt;</span>NumeredDofEntitysByIdx &amp;<span class="keyword">&gt;</span>(</div>
<div class="line"><span class="lineno"> 1827</span>              p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Idx_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1828</span>      nb_col_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1829</span>      nb_col_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1830</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> number_dofs(dofs_col_by_idx_no_const, nb_col_local_dofs);</div>
<div class="line"><span class="lineno"> 1831</span>    }</div>
<div class="line"><span class="lineno"> 1832</span> </div>
<div class="line"><span class="lineno"> 1833</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISRestoreIndices(is_gather, &amp;part_number);</div>
<div class="line"><span class="lineno"> 1834</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISRestoreIndices(is_gather_num, &amp;petsc_idx);</div>
<div class="line"><span class="lineno"> 1835</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_num);</div>
<div class="line"><span class="lineno"> 1836</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_gather_num);</div>
<div class="line"><span class="lineno"> 1837</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is_gather);</div>
<div class="line"><span class="lineno"> 1838</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;is);</div>
<div class="line"><span class="lineno"> 1839</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatPartitioningDestroy(&amp;part);</div>
<div class="line"><span class="lineno"> 1840</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;Adj);</div>
<div class="line"><span class="lineno"> 1841</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(&amp;*p_miit, verb);</div>
<div class="line"><span class="lineno"> 1842</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1843</span> </div>
<div class="line"><span class="lineno"> 1844</span>    <span class="keyword">auto</span> number_dofs = [&amp;](<span class="keyword">auto</span> &amp;dof_idx, <span class="keyword">auto</span> &amp;counter) {</div>
<div class="line"><span class="lineno"> 1845</span>      <a class="code hl_define" href="definitions_8h.html#aee32377dce975c9a64ed73bd3a003404">MoFEMFunctionBeginHot</a>;</div>
<div class="line"><span class="lineno"> 1846</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> miit_dofs_row = dof_idx.begin(); miit_dofs_row != dof_idx.end();</div>
<div class="line"><span class="lineno"> 1847</span>           miit_dofs_row++) {</div>
<div class="line"><span class="lineno"> 1848</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> success = dof_idx.modify(</div>
<div class="line"><span class="lineno"> 1849</span>            miit_dofs_row,</div>
<div class="line"><span class="lineno"> 1850</span>            NumeredDofEntity_part_and_indices_change(0, counter, counter));</div>
<div class="line"><span class="lineno"> 1851</span>        ++counter;</div>
<div class="line"><span class="lineno"> 1852</span>        <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><span class="lineno"> 1853</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1854</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1855</span>        }</div>
<div class="line"><span class="lineno"> 1856</span>      }</div>
<div class="line"><span class="lineno"> 1857</span>      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"><span class="lineno"> 1858</span>    };</div>
<div class="line"><span class="lineno"> 1859</span> </div>
<div class="line"><span class="lineno"> 1860</span>    <span class="keyword">auto</span> &amp;dofs_row_by_idx_no_const = <span class="keyword">const_cast&lt;</span>NumeredDofEntitysByIdx &amp;<span class="keyword">&gt;</span>(</div>
<div class="line"><span class="lineno"> 1861</span>        p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Idx_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1862</span>    <span class="keywordtype">int</span> &amp;nb_row_local_dofs = p_miit-&gt;nbLocDofsRow;</div>
<div class="line"><span class="lineno"> 1863</span>    <span class="keywordtype">int</span> &amp;nb_row_ghost_dofs = p_miit-&gt;nbGhostDofsRow;</div>
<div class="line"><span class="lineno"> 1864</span>    nb_row_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1865</span>    nb_row_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1866</span> </div>
<div class="line"><span class="lineno"> 1867</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> number_dofs(dofs_row_by_idx_no_const, nb_row_local_dofs);</div>
<div class="line"><span class="lineno"> 1868</span> </div>
<div class="line"><span class="lineno"> 1869</span>    <span class="keywordtype">bool</span> square_matrix = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1870</span>    <span class="keywordflow">if</span> (p_miit-&gt;numeredRowDofsPtr == p_miit-&gt;numeredColDofsPtr)</div>
<div class="line"><span class="lineno"> 1871</span>      square_matrix = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1872</span> </div>
<div class="line"><span class="lineno"> 1873</span>    <span class="keywordtype">int</span> &amp;nb_col_local_dofs = p_miit-&gt;nbLocDofsCol;</div>
<div class="line"><span class="lineno"> 1874</span>    <span class="keywordtype">int</span> &amp;nb_col_ghost_dofs = p_miit-&gt;nbGhostDofsCol;</div>
<div class="line"><span class="lineno"> 1875</span>    <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1876</span>      nb_col_local_dofs = nb_row_local_dofs;</div>
<div class="line"><span class="lineno"> 1877</span>      nb_col_ghost_dofs = nb_row_ghost_dofs;</div>
<div class="line"><span class="lineno"> 1878</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1879</span>      NumeredDofEntitysByIdx &amp;dofs_col_by_idx_no_const =</div>
<div class="line"><span class="lineno"> 1880</span>          <span class="keyword">const_cast&lt;</span>NumeredDofEntitysByIdx &amp;<span class="keyword">&gt;</span>(</div>
<div class="line"><span class="lineno"> 1881</span>              p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Idx_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1882</span>      nb_col_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1883</span>      nb_col_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1884</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> number_dofs(dofs_col_by_idx_no_const, nb_col_local_dofs);</div>
<div class="line"><span class="lineno"> 1885</span>    }</div>
<div class="line"><span class="lineno"> 1886</span>  }</div>
<div class="line"><span class="lineno"> 1887</span> </div>
<div class="line"><span class="lineno"> 1888</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= 1 &lt;&lt; 4;</div>
<div class="line"><span class="lineno"> 1889</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1890</span>}</div>
<div class="ttc" id="adefinitions_8h_html_a018e38d630e7ebef4cfa48ab69889f2ca05ac9ca266f9e1731e2832c50fc14849"><div class="ttname"><a href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca05ac9ca266f9e1731e2832c50fc14849">VERY_VERBOSE</a></div><div class="ttdeci">@ VERY_VERBOSE</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00223">definitions.h:223</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_afd53743d1af6bfa2856255b23b5a41a9"><div class="ttname"><a href="initial__diffusion_8cpp.html#afd53743d1af6bfa2856255b23b5a41a9">n</a></div><div class="ttdeci">const double n</div><div class="ttdoc">refractive index of diffusive medium</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00038">initial_diffusion.cpp:38</a></div></div>
<div class="ttc" id="ashallow__wave_8cpp_html_ac1bb4bfd31a408c2fed3ca69bcad99fc"><div class="ttname"><a href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a></div><div class="ttdeci">FTensor::Index&lt; 'm', 3 &gt; m</div><div class="ttdef"><b>Definition</b> <a href="shallow__wave_8cpp_source.html#l00080">shallow_wave.cpp:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga5c3f0609c8e08c883e20f7aac6427ae0" name="ga5c3f0609c8e08c883e20f7aac6427ae0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5c3f0609c8e08c883e20f7aac6427ae0">&#9670;&#160;</a></span>partitionSimpleProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::partitionSimpleProblem </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>partition problem dofs </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>problem name </td></tr>
  </table>
  </dd>
</dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="forces_and_sources_testing_edge_element_8cpp-example.html#a37">forces_and_sources_testing_edge_element.cpp</a>, <a class="el" href="forces_and_sources_testing_flat_prism_element_8cpp-example.html#a41">forces_and_sources_testing_flat_prism_element.cpp</a>, <a class="el" href="hcurl_divergence_operator_2d_8cpp-example.html#a61">hcurl_divergence_operator_2d.cpp</a>, <a class="el" href="prism_elements_from_surface_8cpp-example.html#a94">prism_elements_from_surface.cpp</a>, <a class="el" href="prism_polynomial_approximation_8cpp-example.html#a58">prism_polynomial_approximation.cpp</a>, and <a class="el" href="quad_polynomial_approximation_8cpp-example.html#a55">quad_polynomial_approximation.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l01533">1533</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1534</span>                                                                 {</div>
<div class="line"><span class="lineno"> 1535</span> </div>
<div class="line"><span class="lineno"> 1536</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 1537</span>  <span class="keyword">auto</span> problems_ptr = m_field.<a class="code hl_function" href="group__mofem__access.html#gaad7cab6ce659fc4b4b74269228b739ae">get_problems</a>();</div>
<div class="line"><span class="lineno"> 1538</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 1539</span> </div>
<div class="line"><span class="lineno"> 1540</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8aafe75d31cc3bb7ad0020faf3c29120f2">Core::BUILD_FIELD</a>))</div>
<div class="line"><span class="lineno"> 1541</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;fields not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1542</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a0dff8ebeee66d643f27000505c70677a">Core::BUILD_FE</a>))</div>
<div class="line"><span class="lineno"> 1543</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;FEs not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1544</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8af7c0a8635a36779913cf264e1cb6b68c">Core::BUILD_ADJ</a>))</div>
<div class="line"><span class="lineno"> 1545</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1546</span>  <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() &amp; <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8ad89ecba811acde61bda1f4e881baf797">Core::BUILD_PROBLEM</a>))</div>
<div class="line"><span class="lineno"> 1547</span>    SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>, <span class="stringliteral">&quot;adjacencies not build&quot;</span>);</div>
<div class="line"><span class="lineno"> 1548</span>  <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;WORLD&quot;</span>, Sev::verbose) &lt;&lt; <span class="stringliteral">&quot;Simple partition problem &quot;</span> &lt;&lt; name;</div>
<div class="line"><span class="lineno"> 1549</span> </div>
<div class="line"><span class="lineno"> 1550</span>  <span class="comment">// find p_miit</span></div>
<div class="line"><span class="lineno"> 1551</span>  <span class="keyword">typedef</span> Problem_multiIndex::index&lt;Problem_mi_tag&gt;::type ProblemByName;</div>
<div class="line"><span class="lineno"> 1552</span>  ProblemByName &amp;problems_set =</div>
<div class="line"><span class="lineno"> 1553</span>      <span class="keyword">const_cast&lt;</span>ProblemByName &amp;<span class="keyword">&gt;</span>(problems_ptr-&gt;get&lt;Problem_mi_tag&gt;());</div>
<div class="line"><span class="lineno"> 1554</span>  ProblemByName::iterator p_miit = problems_set.find(name);</div>
<div class="line"><span class="lineno"> 1555</span>  <span class="keywordflow">if</span> (p_miit == problems_set.end()) {</div>
<div class="line"><span class="lineno"> 1556</span>    SETERRQ(PETSC_COMM_SELF, 1,</div>
<div class="line"><span class="lineno"> 1557</span>             <span class="stringliteral">&quot;problem &lt; %s &gt; is not found (top tip: check spelling)&quot;</span>,</div>
<div class="line"><span class="lineno"> 1558</span>             name.c_str());</div>
<div class="line"><span class="lineno"> 1559</span>  }</div>
<div class="line"><span class="lineno"> 1560</span>  <span class="keyword">typedef</span> boost::multi_index::index&lt;<a class="code hl_typedef" href="group__dof__multi__indices.html#ga5688631bd2bcf927612519092e127d36">NumeredDofEntity_multiIndex</a>,</div>
<div class="line"><span class="lineno"> 1561</span>                                    Idx_mi_tag&gt;::type NumeredDofEntitysByIdx;</div>
<div class="line"><span class="lineno"> 1562</span>  NumeredDofEntitysByIdx &amp;dofs_row_by_idx =</div>
<div class="line"><span class="lineno"> 1563</span>      p_miit-&gt;numeredRowDofsPtr-&gt;get&lt;Idx_mi_tag&gt;();</div>
<div class="line"><span class="lineno"> 1564</span>  NumeredDofEntitysByIdx &amp;dofs_col_by_idx =</div>
<div class="line"><span class="lineno"> 1565</span>      p_miit-&gt;numeredColDofsPtr-&gt;get&lt;Idx_mi_tag&gt;();</div>
<div class="line"><span class="lineno"> 1566</span>  boost::multi_index::index&lt;<a class="code hl_typedef" href="group__dof__multi__indices.html#ga5688631bd2bcf927612519092e127d36">NumeredDofEntity_multiIndex</a>,</div>
<div class="line"><span class="lineno"> 1567</span>                            Idx_mi_tag&gt;::type::iterator miit_row,</div>
<div class="line"><span class="lineno"> 1568</span>      hi_miit_row;</div>
<div class="line"><span class="lineno"> 1569</span>  boost::multi_index::index&lt;<a class="code hl_typedef" href="group__dof__multi__indices.html#ga5688631bd2bcf927612519092e127d36">NumeredDofEntity_multiIndex</a>,</div>
<div class="line"><span class="lineno"> 1570</span>                            Idx_mi_tag&gt;::type::iterator miit_col,</div>
<div class="line"><span class="lineno"> 1571</span>      hi_miit_col;</div>
<div class="line"><span class="lineno"> 1572</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> &amp;nb_row_local_dofs = p_miit-&gt;nbLocDofsRow;</div>
<div class="line"><span class="lineno"> 1573</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> &amp;nb_row_ghost_dofs = p_miit-&gt;nbGhostDofsRow;</div>
<div class="line"><span class="lineno"> 1574</span>  nb_row_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1575</span>  nb_row_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1576</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> &amp;nb_col_local_dofs = p_miit-&gt;nbLocDofsCol;</div>
<div class="line"><span class="lineno"> 1577</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> &amp;nb_col_ghost_dofs = p_miit-&gt;nbGhostDofsCol;</div>
<div class="line"><span class="lineno"> 1578</span>  nb_col_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 1579</span>  nb_col_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 1580</span> </div>
<div class="line"><span class="lineno"> 1581</span>  <span class="keywordtype">bool</span> square_matrix = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1582</span>  <span class="keywordflow">if</span> (p_miit-&gt;numeredRowDofsPtr == p_miit-&gt;numeredColDofsPtr) {</div>
<div class="line"><span class="lineno"> 1583</span>    square_matrix = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1584</span>  }</div>
<div class="line"><span class="lineno"> 1585</span> </div>
<div class="line"><span class="lineno"> 1586</span>  <span class="comment">// get row range of local indices</span></div>
<div class="line"><span class="lineno"> 1587</span>  PetscLayout layout_row;</div>
<div class="line"><span class="lineno"> 1588</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> *ranges_row;</div>
<div class="line"><span class="lineno"> 1589</span> </div>
<div class="line"><span class="lineno"> 1590</span>  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> nb_dofs_row = dofs_row_by_idx.size();</div>
<div class="line"><span class="lineno"> 1591</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;layout_row);</div>
<div class="line"><span class="lineno"> 1592</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetBlockSize(layout_row, 1);</div>
<div class="line"><span class="lineno"> 1593</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetSize(layout_row, nb_dofs_row);</div>
<div class="line"><span class="lineno"> 1594</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetUp(layout_row);</div>
<div class="line"><span class="lineno"> 1595</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetRanges(layout_row, &amp;ranges_row);</div>
<div class="line"><span class="lineno"> 1596</span>  <span class="comment">// get col range of local indices</span></div>
<div class="line"><span class="lineno"> 1597</span>  PetscLayout layout_col;</div>
<div class="line"><span class="lineno"> 1598</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> *ranges_col;</div>
<div class="line"><span class="lineno"> 1599</span>  <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno"> 1600</span>    <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a2cb126d359d48ddf277e1985549b94a9">DofIdx</a> nb_dofs_col = dofs_col_by_idx.size();</div>
<div class="line"><span class="lineno"> 1601</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutCreate(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), &amp;layout_col);</div>
<div class="line"><span class="lineno"> 1602</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetBlockSize(layout_col, 1);</div>
<div class="line"><span class="lineno"> 1603</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetSize(layout_col, nb_dofs_col);</div>
<div class="line"><span class="lineno"> 1604</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutSetUp(layout_col);</div>
<div class="line"><span class="lineno"> 1605</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutGetRanges(layout_col, &amp;ranges_col);</div>
<div class="line"><span class="lineno"> 1606</span>  }</div>
<div class="line"><span class="lineno"> 1607</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> part = 0; part &lt; (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="namespaceconvert.html#a4db4d50b047acc94e54fdf4df9f3077c">int</a>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a093526a60371b07213a0be2aaf7afa35">get_comm_size</a>();</div>
<div class="line"><span class="lineno"> 1608</span>       part++) {</div>
<div class="line"><span class="lineno"> 1609</span>    miit_row = dofs_row_by_idx.lower_bound(ranges_row[part]);</div>
<div class="line"><span class="lineno"> 1610</span>    hi_miit_row = dofs_row_by_idx.lower_bound(ranges_row[part + 1]);</div>
<div class="line"><span class="lineno"> 1611</span>    <span class="keywordflow">if</span> (std::distance(miit_row, hi_miit_row) !=</div>
<div class="line"><span class="lineno"> 1612</span>        ranges_row[part + 1] - ranges_row[part]) {</div>
<div class="line"><span class="lineno"> 1613</span>      SETERRQ(</div>
<div class="line"><span class="lineno"> 1614</span>          PETSC_COMM_SELF, PETSC_ERR_ARG_SIZ,</div>
<div class="line"><span class="lineno"> 1615</span>          <span class="stringliteral">&quot;data inconsistency, std::distance(miit_row,hi_miit_row) != rend - &quot;</span></div>
<div class="line"><span class="lineno"> 1616</span>          <span class="stringliteral">&quot;rstart (%ld != %d - %d = %d) &quot;</span>,</div>
<div class="line"><span class="lineno"> 1617</span>          std::distance(miit_row, hi_miit_row), ranges_row[part + 1],</div>
<div class="line"><span class="lineno"> 1618</span>          ranges_row[part], ranges_row[part + 1] - ranges_row[part]);</div>
<div class="line"><span class="lineno"> 1619</span>    }</div>
<div class="line"><span class="lineno"> 1620</span>    <span class="comment">// loop rows</span></div>
<div class="line"><span class="lineno"> 1621</span>    <span class="keywordflow">for</span> (; miit_row != hi_miit_row; miit_row++) {</div>
<div class="line"><span class="lineno"> 1622</span>      <span class="keywordtype">bool</span> success = dofs_row_by_idx.modify(</div>
<div class="line"><span class="lineno"> 1623</span>          miit_row,</div>
<div class="line"><span class="lineno"> 1624</span>          NumeredDofEntity_part_and_glob_idx_change(part, (*miit_row)-&gt;dofIdx));</div>
<div class="line"><span class="lineno"> 1625</span>      <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 1626</span>        SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1627</span>                <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1628</span>      <span class="keywordflow">if</span> (part == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1629</span>        success = dofs_row_by_idx.modify(</div>
<div class="line"><span class="lineno"> 1630</span>            miit_row, NumeredDofEntity_local_idx_change(nb_row_local_dofs++));</div>
<div class="line"><span class="lineno"> 1631</span>        <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 1632</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1633</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1634</span>      }</div>
<div class="line"><span class="lineno"> 1635</span>    }</div>
<div class="line"><span class="lineno"> 1636</span>    <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno"> 1637</span>      miit_col = dofs_col_by_idx.lower_bound(ranges_col[part]);</div>
<div class="line"><span class="lineno"> 1638</span>      hi_miit_col = dofs_col_by_idx.lower_bound(ranges_col[part + 1]);</div>
<div class="line"><span class="lineno"> 1639</span>      <span class="keywordflow">if</span> (std::distance(miit_col, hi_miit_col) !=</div>
<div class="line"><span class="lineno"> 1640</span>          ranges_col[part + 1] - ranges_col[part]) {</div>
<div class="line"><span class="lineno"> 1641</span>        SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_SIZ,</div>
<div class="line"><span class="lineno"> 1642</span>                 <span class="stringliteral">&quot;data inconsistency, std::distance(miit_col,hi_miit_col) != &quot;</span></div>
<div class="line"><span class="lineno"> 1643</span>                 <span class="stringliteral">&quot;rend - &quot;</span></div>
<div class="line"><span class="lineno"> 1644</span>                 <span class="stringliteral">&quot;rstart (%ld != %d - %d = %d) &quot;</span>,</div>
<div class="line"><span class="lineno"> 1645</span>                 std::distance(miit_col, hi_miit_col), ranges_col[part + 1],</div>
<div class="line"><span class="lineno"> 1646</span>                 ranges_col[part], ranges_col[part + 1] - ranges_col[part]);</div>
<div class="line"><span class="lineno"> 1647</span>      }</div>
<div class="line"><span class="lineno"> 1648</span>      <span class="comment">// loop cols</span></div>
<div class="line"><span class="lineno"> 1649</span>      <span class="keywordflow">for</span> (; miit_col != hi_miit_col; miit_col++) {</div>
<div class="line"><span class="lineno"> 1650</span>        <span class="keywordtype">bool</span> success = dofs_col_by_idx.modify(</div>
<div class="line"><span class="lineno"> 1651</span>            miit_col, NumeredDofEntity_part_and_glob_idx_change(</div>
<div class="line"><span class="lineno"> 1652</span>                          part, (*miit_col)-&gt;dofIdx));</div>
<div class="line"><span class="lineno"> 1653</span>        <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 1654</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1655</span>                  <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1656</span>        <span class="keywordflow">if</span> (part == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#af2224ce77b33637b5cfad66a275a2ffb">get_comm_rank</a>()) {</div>
<div class="line"><span class="lineno"> 1657</span>          success = dofs_col_by_idx.modify(</div>
<div class="line"><span class="lineno"> 1658</span>              miit_col, NumeredDofEntity_local_idx_change(nb_col_local_dofs++));</div>
<div class="line"><span class="lineno"> 1659</span>          <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 1660</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 1661</span>                    <span class="stringliteral">&quot;modification unsuccessful&quot;</span>);</div>
<div class="line"><span class="lineno"> 1662</span>        }</div>
<div class="line"><span class="lineno"> 1663</span>      }</div>
<div class="line"><span class="lineno"> 1664</span>    }</div>
<div class="line"><span class="lineno"> 1665</span>  }</div>
<div class="line"><span class="lineno"> 1666</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutDestroy(&amp;layout_row);</div>
<div class="line"><span class="lineno"> 1667</span>  <span class="keywordflow">if</span> (!square_matrix) {</div>
<div class="line"><span class="lineno"> 1668</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscLayoutDestroy(&amp;layout_col);</div>
<div class="line"><span class="lineno"> 1669</span>  }</div>
<div class="line"><span class="lineno"> 1670</span>  <span class="keywordflow">if</span> (square_matrix) {</div>
<div class="line"><span class="lineno"> 1671</span>    nb_col_local_dofs = nb_row_local_dofs;</div>
<div class="line"><span class="lineno"> 1672</span>    nb_col_ghost_dofs = nb_row_ghost_dofs;</div>
<div class="line"><span class="lineno"> 1673</span>  }</div>
<div class="line"><span class="lineno"> 1674</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structMoFEM_1_1ProblemsManager.html#a22e7fc80dfe26f76571f97b47c1b624b">printPartitionedProblem</a>(&amp;*p_miit, verb);</div>
<div class="line"><span class="lineno"> 1675</span>  <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>.<a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a3e25c681e21c731b027a97acdd89cf62">getBuildMoFEM</a>() |= <a class="code hl_enumvalue" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa7f57150f004d7ec3fd18afd1e2760e8a4825317003e180779b85cfa769f988d5">Core::PARTITION_PROBLEM</a>;</div>
<div class="line"><span class="lineno"> 1676</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 1677</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga55e6d0b8908997abbb5be6373306c3f9" name="ga55e6d0b8908997abbb5be6373306c3f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga55e6d0b8908997abbb5be6373306c3f9">&#9670;&#160;</a></span>removeDofsOnEntities() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::removeDofsOnEntities </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>problem_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a>&#160;</td>
          <td class="paramname"><em>bit_ref_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceMoFEM_1_1Types.html#aa9495b406c5326b7bca937846ec421c5">BitRefLevel</a>&#160;</td>
          <td class="paramname"><em>bit_ref_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRange.html">Range</a> *&#160;</td>
          <td class="paramname"><em>ents_ptr</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lo_coeff</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>hi_coeff</em> = <code><a class="el" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lo_order</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>hi_order</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>debug</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove DOFs from problem by bit ref level. </p>
<p>See for more detail other implementation for removeDofsOnEntities.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">problem_name</td><td>name of the problem </td></tr>
    <tr><td class="paramname">field_name</td><td>name of the field </td></tr>
    <tr><td class="paramname">bit_ref_level</td><td>bit ref level on which DOFs are removed </td></tr>
    <tr><td class="paramname">bit_ref_mask</td><td>bit ref mask on which DOFs are removed </td></tr>
    <tr><td class="paramname">ents_ptr</td><td>filter entities with given bit and mask </td></tr>
    <tr><td class="paramname">lo_coeff</td><td>low dof coefficient (rank) </td></tr>
    <tr><td class="paramname">hi_coeff</td><td>high dof coefficient (rank) </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
    <tr><td class="paramname">debug</td><td>to debug and seek for inconsistencies set to true </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MoFEMErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l03499">3499</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3503</span>                                                    {</div>
<div class="line"><span class="lineno"> 3504</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 3505</span>  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 3506</span> </div>
<div class="line"><span class="lineno"> 3507</span>  <span class="keyword">auto</span> bit_manager = m_field.<a class="code hl_function" href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>&lt;BitRefManager&gt;();</div>
<div class="line"><span class="lineno"> 3508</span> </div>
<div class="line"><span class="lineno"> 3509</span>  <a class="code hl_class" href="classRange.html">Range</a> ents;</div>
<div class="line"><span class="lineno"> 3510</span>  <span class="keywordflow">if</span> (ents_ptr) {</div>
<div class="line"><span class="lineno"> 3511</span>    ents = *ents_ptr;</div>
<div class="line"><span class="lineno"> 3512</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bit_manager-&gt;filterEntitiesByRefLevel(bit_ref_level, bit_ref_mask,</div>
<div class="line"><span class="lineno"> 3513</span>                                                 ents, verb);</div>
<div class="line"><span class="lineno"> 3514</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3515</span>    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> bit_manager-&gt;getEntitiesByRefLevel(bit_ref_level, bit_ref_mask, ents,</div>
<div class="line"><span class="lineno"> 3516</span>                                              verb);</div>
<div class="line"><span class="lineno"> 3517</span>  }</div>
<div class="line"><span class="lineno"> 3518</span> </div>
<div class="line"><span class="lineno"> 3519</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__mofem__problems__manager.html#gaf0db6004cade0e29bef97f933834b61e">removeDofsOnEntities</a>(problem_name, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, ents, lo_coeff,</div>
<div class="line"><span class="lineno"> 3520</span>                              hi_coeff, lo_order, hi_order, verb, <a class="code hl_variable" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>);</div>
<div class="line"><span class="lineno"> 3521</span> </div>
<div class="line"><span class="lineno"> 3522</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 3523</span>}</div>
<div class="ttc" id="agroup__mofem__problems__manager_html_gaf0db6004cade0e29bef97f933834b61e"><div class="ttname"><a href="group__mofem__problems__manager.html#gaf0db6004cade0e29bef97f933834b61e">MoFEM::ProblemsManager::removeDofsOnEntities</a></div><div class="ttdeci">MoFEMErrorCode removeDofsOnEntities(const std::string problem_name, const std::string field_name, const Range ents, const int lo_coeff=0, const int hi_coeff=MAX_DOFS_ON_ENTITY, const int lo_order=0, const int hi_order=100, int verb=VERBOSE, const bool debug=false)</div><div class="ttdoc">Remove DOFs from problem.</div><div class="ttdef"><b>Definition</b> <a href="ProblemsManager_8cpp_source.html#l02959">ProblemsManager.cpp:2959</a></div></div>
<div class="ttc" id="apoisson__2d__homogeneous_8cpp_html_a3917f3987bad1f4e24b85c9d0ab84a5e"><div class="ttname"><a href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a></div><div class="ttdeci">constexpr auto field_name</div><div class="ttdef"><b>Definition</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00013">poisson_2d_homogeneous.cpp:13</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaf0db6004cade0e29bef97f933834b61e" name="gaf0db6004cade0e29bef97f933834b61e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf0db6004cade0e29bef97f933834b61e">&#9670;&#160;</a></span>removeDofsOnEntities() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> MoFEM::ProblemsManager::removeDofsOnEntities </td>
          <td>(</td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>problem_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string&#160;</td>
          <td class="paramname"><em>field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classRange.html">Range</a>&#160;</td>
          <td class="paramname"><em>ents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lo_coeff</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>hi_coeff</em> = <code><a class="el" href="definitions_8h.html#a2d9985594995d39619ace246858c70b5">MAX_DOFS_ON_ENTITY</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>lo_order</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>hi_order</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verb</em> = <code><a class="el" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2cace3e26676763569084c86b8c3b67d601">VERBOSE</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>debug</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove DOFs from problem. </p>
<p>Remove DOFs from problem which are on entities on the given range and given field name. On the finite element level, DOFs can be still accessed however local PETSc indices and global PETSc indices are marked with the index -1.</p>
<dl class="section note"><dt>Note</dt><dd>If the index is marked -1 it is not assembled and dropped by VecSetValues and MatSetValues.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000042">Todo:</a></b></dt><dd>Not yet implemented update for AO maps and IS ranges if removed entities in composite problem or sub-problem</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">problem_name</td><td>name of the problem </td></tr>
    <tr><td class="paramname">field_name</td><td>name of the field </td></tr>
    <tr><td class="paramname">ents</td><td>entities on which DOFs are removed </td></tr>
    <tr><td class="paramname">lo_coeff</td><td>low dof coefficient (rank) </td></tr>
    <tr><td class="paramname">hi_coeff</td><td>high dof coefficient (rank) </td></tr>
    <tr><td class="paramname">verb</td><td>verbosity level </td></tr>
    <tr><td class="paramname">debug</td><td>to debug and seek for inconsistencies set to true </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MoFEMErrorCode </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="hanging_node_approx_8cpp-example.html#a96">hanging_node_approx.cpp</a>, <a class="el" href="helmholtz_8cpp-example.html#a45">helmholtz.cpp</a>, and <a class="el" href="remove_entities_from_problem_8cpp-example.html#a41">remove_entities_from_problem.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ProblemsManager_8cpp_source.html#l02959">2959</a> of file <a class="el" href="ProblemsManager_8cpp_source.html">ProblemsManager.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2962</span>                                                                        {</div>
<div class="line"><span class="lineno"> 2963</span> </div>
<div class="line"><span class="lineno"> 2964</span>  <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = <a class="code hl_variable" href="structMoFEM_1_1ProblemsManager.html#ab753c3a0d74f180acd6380b6fd0b4d35">cOre</a>;</div>
<div class="line"><span class="lineno"> 2965</span>  <a class="code hl_define" href="ProblemsManager_8cpp.html#a7b48fee6ededa6018fb84bef11790d4f">ProblemManagerFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 2966</span> </div>
<div class="line"><span class="lineno"> 2967</span>  <span class="keyword">const</span> Problem *prb_ptr;</div>
<div class="line"><span class="lineno"> 2968</span>  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__access.html#ga311e33eaba451897a151813e8ea6fae4">get_problem</a>(problem_name, &amp;prb_ptr);</div>
<div class="line"><span class="lineno"> 2969</span> </div>
<div class="line"><span class="lineno"> 2970</span>  <span class="keyword">decltype</span>(prb_ptr-&gt;numeredRowDofsPtr) numered_dofs[2] = {</div>
<div class="line"><span class="lineno"> 2971</span>      prb_ptr-&gt;<a class="code hl_variable" href="structMoFEM_1_1Problem.html#a54dbffef1909f2e198d0836fa96fa95e">numeredRowDofsPtr</a>, <span class="keyword">nullptr</span>};</div>
<div class="line"><span class="lineno"> 2972</span>  <span class="keywordflow">if</span> (prb_ptr-&gt;numeredRowDofsPtr != prb_ptr-&gt;numeredColDofsPtr)</div>
<div class="line"><span class="lineno"> 2973</span>    numered_dofs[1] = prb_ptr-&gt;numeredColDofsPtr;</div>
<div class="line"><span class="lineno"> 2974</span> </div>
<div class="line"><span class="lineno"> 2975</span>  <span class="keywordtype">int</span> *nbdof_ptr[] = {&amp;prb_ptr-&gt;nbDofsRow, &amp;prb_ptr-&gt;nbDofsCol};</div>
<div class="line"><span class="lineno"> 2976</span>  <span class="keywordtype">int</span> *local_nbdof_ptr[] = {&amp;prb_ptr-&gt;nbLocDofsRow, &amp;prb_ptr-&gt;nbLocDofsCol};</div>
<div class="line"><span class="lineno"> 2977</span>  <span class="keywordtype">int</span> *ghost_nbdof_ptr[] = {&amp;prb_ptr-&gt;nbGhostDofsRow, &amp;prb_ptr-&gt;nbGhostDofsCol};</div>
<div class="line"><span class="lineno"> 2978</span> </div>
<div class="line"><span class="lineno"> 2979</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_init_row_dofs = prb_ptr-&gt;getNbDofsRow();</div>
<div class="line"><span class="lineno"> 2980</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_init_col_dofs = prb_ptr-&gt;getNbDofsCol();</div>
<div class="line"><span class="lineno"> 2981</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_init_loc_row_dofs = prb_ptr-&gt;getNbLocalDofsRow();</div>
<div class="line"><span class="lineno"> 2982</span>  <span class="comment">// const int nb_init_loc_col_dofs = prb_ptr-&gt;getNbLocalDofsCol();</span></div>
<div class="line"><span class="lineno"> 2983</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_init_ghost_row_dofs = prb_ptr-&gt;getNbGhostDofsRow();</div>
<div class="line"><span class="lineno"> 2984</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_init_ghost_col_dofs = prb_ptr-&gt;getNbGhostDofsCol();</div>
<div class="line"><span class="lineno"> 2985</span> </div>
<div class="line"><span class="lineno"> 2986</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = 0; s != 2; ++s)</div>
<div class="line"><span class="lineno"> 2987</span>    <span class="keywordflow">if</span> (numered_dofs[s]) {</div>
<div class="line"><span class="lineno"> 2988</span> </div>
<div class="line"><span class="lineno"> 2989</span>      <span class="keyword">using </span>NumeredDofEntity_it_view_multiIndex = multi_index_container&lt;</div>
<div class="line"><span class="lineno"> 2990</span> </div>
<div class="line"><span class="lineno"> 2991</span>          NumeredDofEntity_multiIndex::iterator, indexed_by&lt;sequenced&lt;&gt;&gt;</div>
<div class="line"><span class="lineno"> 2992</span> </div>
<div class="line"><span class="lineno"> 2993</span>          &gt;;</div>
<div class="line"><span class="lineno"> 2994</span> </div>
<div class="line"><span class="lineno"> 2995</span>      <span class="keyword">const</span> <span class="keyword">auto</span> bit_number = m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a151a5aaa12774c726c7a32ba250d2586">get_field_bit_number</a>(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>);</div>
<div class="line"><span class="lineno"> 2996</span>      NumeredDofEntity_it_view_multiIndex dofs_it_view;</div>
<div class="line"><span class="lineno"> 2997</span> </div>
<div class="line"><span class="lineno"> 2998</span>      <span class="comment">// Set -1 to global and local dofs indices</span></div>
<div class="line"><span class="lineno"> 2999</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> pit = ents.const_pair_begin(); pit != ents.const_pair_end();</div>
<div class="line"><span class="lineno"> 3000</span>           ++pit) {</div>
<div class="line"><span class="lineno"> 3001</span>        <span class="keyword">auto</span> lo = numered_dofs[s]-&gt;get&lt;Unique_mi_tag&gt;().lower_bound(</div>
<div class="line"><span class="lineno"> 3002</span>            <a class="code hl_function" href="structMoFEM_1_1DofEntity.html#a2c69be4a12745d83234af39160f0cb89">DofEntity::getLoFieldEntityUId</a>(bit_number, pit-&gt;first));</div>
<div class="line"><span class="lineno"> 3003</span>        <span class="keyword">auto</span> hi = numered_dofs[s]-&gt;get&lt;Unique_mi_tag&gt;().upper_bound(</div>
<div class="line"><span class="lineno"> 3004</span>            <a class="code hl_function" href="structMoFEM_1_1DofEntity.html#a5b244cf6fac68fd7fe072bbf0bbf705c">DofEntity::getHiFieldEntityUId</a>(bit_number, pit-&gt;second));</div>
<div class="line"><span class="lineno"> 3005</span> </div>
<div class="line"><span class="lineno"> 3006</span>        <span class="keywordflow">for</span> (; lo != hi; ++lo)</div>
<div class="line"><span class="lineno"> 3007</span>          <span class="keywordflow">if</span> ((*lo)-&gt;getDofCoeffIdx() &gt;= lo_coeff &amp;&amp;</div>
<div class="line"><span class="lineno"> 3008</span>              (*lo)-&gt;getDofCoeffIdx() &lt;= hi_coeff &amp;&amp;</div>
<div class="line"><span class="lineno"> 3009</span>              (*lo)-&gt;getDofOrder() &gt;= lo_order &amp;&amp;</div>
<div class="line"><span class="lineno"> 3010</span>              (*lo)-&gt;getDofOrder() &lt;= hi_order)</div>
<div class="line"><span class="lineno"> 3011</span>            dofs_it_view.emplace_back(numered_dofs[s]-&gt;project&lt;0&gt;(lo));</div>
<div class="line"><span class="lineno"> 3012</span>      }</div>
<div class="line"><span class="lineno"> 3013</span> </div>
<div class="line"><span class="lineno"> 3014</span>      <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>) {</div>
<div class="line"><span class="lineno"> 3015</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;dof : dofs_it_view)</div>
<div class="line"><span class="lineno"> 3016</span>          <a class="code hl_define" href="group__mofem__log__manager.html#ga19fe81dc9081ceb92ced847e619ca654">MOFEM_LOG</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, <a class="code hl_typedef" href="namespaceMoFEM.html#ab4d38dd36deb3c8334737f3526dfbf35">Sev</a>::noisy) &lt;&lt; **dof;</div>
<div class="line"><span class="lineno"> 3017</span>        <a class="code hl_define" href="LogManager_8hpp.html#a3b22f6000e678d07d69a2c790177a352">MOFEM_LOG_SEVERITY_SYNC</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), Sev::noisy);</div>
<div class="line"><span class="lineno"> 3018</span>      }</div>
<div class="line"><span class="lineno"> 3019</span> </div>
<div class="line"><span class="lineno"> 3020</span>      <span class="comment">// create weak view</span></div>
<div class="line"><span class="lineno"> 3021</span>      std::vector&lt;boost::weak_ptr&lt;NumeredDofEntity&gt;&gt; dofs_weak_view;</div>
<div class="line"><span class="lineno"> 3022</span>      dofs_weak_view.reserve(dofs_it_view.size());</div>
<div class="line"><span class="lineno"> 3023</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit : dofs_it_view)</div>
<div class="line"><span class="lineno"> 3024</span>        dofs_weak_view.push_back(*dit);</div>
<div class="line"><span class="lineno"> 3025</span> </div>
<div class="line"><span class="lineno"> 3026</span>      <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2caa4fc5b9204f57a31e594e32c02d071e9">NOISY</a>)</div>
<div class="line"><span class="lineno"> 3027</span>        <a class="code hl_define" href="LogManager_8hpp.html#aef9b5316ec6db54581633adf7c670011">MOFEM_LOG_C</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::noisy,</div>
<div class="line"><span class="lineno"> 3028</span>                    <span class="stringliteral">&quot;Number of DOFs in multi-index %d and to delete %d\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 3029</span>                    numered_dofs[s]-&gt;size(), dofs_it_view.size());</div>
<div class="line"><span class="lineno"> 3030</span> </div>
<div class="line"><span class="lineno"> 3031</span>      <span class="comment">// erase dofs from problem</span></div>
<div class="line"><span class="lineno"> 3032</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> weak_dit : dofs_weak_view)</div>
<div class="line"><span class="lineno"> 3033</span>        if (auto dit = weak_dit.lock()) {</div>
<div class="line"><span class="lineno"> 3034</span>          numered_dofs[s]-&gt;erase(dit-&gt;getLocalUniqueId());</div>
<div class="line"><span class="lineno"> 3035</span>        }</div>
<div class="line"><span class="lineno"> 3036</span> </div>
<div class="line"><span class="lineno"> 3037</span>      <span class="keywordflow">if</span> (verb &gt;= <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2caa4fc5b9204f57a31e594e32c02d071e9">NOISY</a>)</div>
<div class="line"><span class="lineno"> 3038</span>        <a class="code hl_define" href="LogManager_8hpp.html#aef9b5316ec6db54581633adf7c670011">MOFEM_LOG_C</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::noisy,</div>
<div class="line"><span class="lineno"> 3039</span>                    <span class="stringliteral">&quot;Number of DOFs in multi-index after delete %d\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 3040</span>                    numered_dofs[s]-&gt;size());</div>
<div class="line"><span class="lineno"> 3041</span> </div>
<div class="line"><span class="lineno"> 3042</span>      <span class="comment">// get current number of ghost dofs</span></div>
<div class="line"><span class="lineno"> 3043</span>      <span class="keywordtype">int</span> nb_local_dofs = 0;</div>
<div class="line"><span class="lineno"> 3044</span>      <span class="keywordtype">int</span> nb_ghost_dofs = 0;</div>
<div class="line"><span class="lineno"> 3045</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit = numered_dofs[s]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().begin();</div>
<div class="line"><span class="lineno"> 3046</span>           dit != numered_dofs[s]-&gt;get&lt;PetscLocalIdx_mi_tag&gt;().end(); ++dit) {</div>
<div class="line"><span class="lineno"> 3047</span>        <span class="keywordflow">if</span> ((*dit)-&gt;getPetscLocalDofIdx() &gt;= 0 &amp;&amp;</div>
<div class="line"><span class="lineno"> 3048</span>            (*dit)-&gt;getPetscLocalDofIdx() &lt; *(local_nbdof_ptr[s]))</div>
<div class="line"><span class="lineno"> 3049</span>          ++nb_local_dofs;</div>
<div class="line"><span class="lineno"> 3050</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*dit)-&gt;getPetscLocalDofIdx() &gt;= *(local_nbdof_ptr[s]))</div>
<div class="line"><span class="lineno"> 3051</span>          ++nb_ghost_dofs;</div>
<div class="line"><span class="lineno"> 3052</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 3053</span>          SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 3054</span>                   <span class="stringliteral">&quot;Impossible case. You could run problem on no distributed &quot;</span></div>
<div class="line"><span class="lineno"> 3055</span>                   <span class="stringliteral">&quot;mesh. That is not implemented. Dof local index is %d&quot;</span>,</div>
<div class="line"><span class="lineno"> 3056</span>                   (*dit)-&gt;getPetscLocalDofIdx());</div>
<div class="line"><span class="lineno"> 3057</span>      }</div>
<div class="line"><span class="lineno"> 3058</span> </div>
<div class="line"><span class="lineno"> 3059</span>      <span class="comment">// get indices</span></div>
<div class="line"><span class="lineno"> 3060</span>      <span class="keyword">auto</span> get_indices_by_tag = [&amp;](<span class="keyword">auto</span> tag, <span class="keyword">auto</span> &amp;indices, <span class="keywordtype">bool</span> only_local) {</div>
<div class="line"><span class="lineno"> 3061</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dofs = numered_dofs[s]-&gt;size();</div>
<div class="line"><span class="lineno"> 3062</span>        indices.clear();</div>
<div class="line"><span class="lineno"> 3063</span>        indices.reserve(nb_dofs);</div>
<div class="line"><span class="lineno"> 3064</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit = numered_dofs[s]-&gt;get&lt;<span class="keyword">decltype</span>(tag)&gt;().begin();</div>
<div class="line"><span class="lineno"> 3065</span>             dit != numered_dofs[s]-&gt;get&lt;<span class="keyword">decltype</span>(tag)&gt;().end(); ++dit) {</div>
<div class="line"><span class="lineno"> 3066</span>          <span class="keywordtype">bool</span> add = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 3067</span>          <span class="keywordflow">if</span> (only_local) {</div>
<div class="line"><span class="lineno"> 3068</span>            <span class="keywordflow">if</span> ((*dit)-&gt;getPetscLocalDofIdx() &lt; 0 ||</div>
<div class="line"><span class="lineno"> 3069</span>                (*dit)-&gt;getPetscLocalDofIdx() &gt;= *(local_nbdof_ptr[s])) {</div>
<div class="line"><span class="lineno"> 3070</span>              add = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 3071</span>            }</div>
<div class="line"><span class="lineno"> 3072</span>          }</div>
<div class="line"><span class="lineno"> 3073</span>          <span class="keywordflow">if</span> (add)</div>
<div class="line"><span class="lineno"> 3074</span>            indices.push_back(<span class="keyword">decltype</span>(tag)::get_index(dit));</div>
<div class="line"><span class="lineno"> 3075</span>        }</div>
<div class="line"><span class="lineno"> 3076</span>      };</div>
<div class="line"><span class="lineno"> 3077</span> </div>
<div class="line"><span class="lineno"> 3078</span>      <span class="keyword">auto</span> get_indices_by_uid = [&amp;](<span class="keyword">auto</span> tag, <span class="keyword">auto</span> &amp;indices) {</div>
<div class="line"><span class="lineno"> 3079</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dofs = numered_dofs[s]-&gt;size();</div>
<div class="line"><span class="lineno"> 3080</span>        indices.clear();</div>
<div class="line"><span class="lineno"> 3081</span>        indices.reserve(nb_dofs);</div>
<div class="line"><span class="lineno"> 3082</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit = numered_dofs[s]-&gt;begin(); dit != numered_dofs[s]-&gt;end();</div>
<div class="line"><span class="lineno"> 3083</span>             ++dit)</div>
<div class="line"><span class="lineno"> 3084</span>          indices.push_back(<span class="keyword">decltype</span>(tag)::get_index(dit));</div>
<div class="line"><span class="lineno"> 3085</span>      };</div>
<div class="line"><span class="lineno"> 3086</span> </div>
<div class="line"><span class="lineno"> 3087</span>      <span class="keyword">auto</span> get_sub_ao = [&amp;](<span class="keyword">auto</span> sub_data) {</div>
<div class="line"><span class="lineno"> 3088</span>        <span class="keywordflow">if</span> (s == 0) {</div>
<div class="line"><span class="lineno"> 3089</span>          <span class="keywordflow">return</span> sub_data-&gt;getSmartRowMap();</div>
<div class="line"><span class="lineno"> 3090</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3091</span>          <span class="keywordflow">return</span> sub_data-&gt;getSmartColMap();</div>
<div class="line"><span class="lineno"> 3092</span>        }</div>
<div class="line"><span class="lineno"> 3093</span>      };</div>
<div class="line"><span class="lineno"> 3094</span> </div>
<div class="line"><span class="lineno"> 3095</span>      <span class="keyword">auto</span> set_sub_is_and_ao = [&amp;s, &amp;prb_ptr](<span class="keyword">auto</span> sub_data, <span class="keyword">auto</span> is, <span class="keyword">auto</span> ao) {</div>
<div class="line"><span class="lineno"> 3096</span>        <span class="keywordflow">if</span> (s == 0) {</div>
<div class="line"><span class="lineno"> 3097</span>          sub_data-&gt;rowIs = is;</div>
<div class="line"><span class="lineno"> 3098</span>          sub_data-&gt;rowMap = ao;</div>
<div class="line"><span class="lineno"> 3099</span>          sub_data-&gt;colIs = is; <span class="comment">// if square problem col is equal to row</span></div>
<div class="line"><span class="lineno"> 3100</span>          sub_data-&gt;colMap = ao;</div>
<div class="line"><span class="lineno"> 3101</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3102</span>          sub_data-&gt;colIs = is;</div>
<div class="line"><span class="lineno"> 3103</span>          sub_data-&gt;colMap = ao;</div>
<div class="line"><span class="lineno"> 3104</span>        }</div>
<div class="line"><span class="lineno"> 3105</span>      };</div>
<div class="line"><span class="lineno"> 3106</span> </div>
<div class="line"><span class="lineno"> 3107</span>      <span class="keyword">auto</span> apply_symmetry = [&amp;s, &amp;prb_ptr](<span class="keyword">auto</span> sub_data) {</div>
<div class="line"><span class="lineno"> 3108</span>        <span class="keywordflow">if</span> (s == 0) {</div>
<div class="line"><span class="lineno"> 3109</span>          <span class="keywordflow">if</span> (prb_ptr-&gt;numeredRowDofsPtr == prb_ptr-&gt;numeredColDofsPtr) {</div>
<div class="line"><span class="lineno"> 3110</span>            sub_data-&gt;colIs = sub_data-&gt;getSmartRowIs();</div>
<div class="line"><span class="lineno"> 3111</span>            sub_data-&gt;colMap = sub_data-&gt;getSmartRowMap();</div>
<div class="line"><span class="lineno"> 3112</span>          }</div>
<div class="line"><span class="lineno"> 3113</span>        }</div>
<div class="line"><span class="lineno"> 3114</span>      };</div>
<div class="line"><span class="lineno"> 3115</span> </div>
<div class="line"><span class="lineno"> 3116</span>      <span class="keyword">auto</span> concatenate_dofs = [&amp;](<span class="keyword">auto</span> tag, <span class="keyword">auto</span> &amp;indices,</div>
<div class="line"><span class="lineno"> 3117</span>                                  <span class="keyword">const</span> <span class="keyword">auto</span> local_only) {</div>
<div class="line"><span class="lineno"> 3118</span>        <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 3119</span>        get_indices_by_tag(tag, indices, local_only);</div>
<div class="line"><span class="lineno"> 3120</span> </div>
<div class="line"><span class="lineno"> 3121</span>        SmartPetscObj&lt;AO&gt; ao;</div>
<div class="line"><span class="lineno"> 3122</span>        <span class="comment">// Create AO from app indices (i.e. old), to pestc indices (new after</span></div>
<div class="line"><span class="lineno"> 3123</span>        <span class="comment">// remove)</span></div>
<div class="line"><span class="lineno"> 3124</span>        <span class="keywordflow">if</span> (local_only)</div>
<div class="line"><span class="lineno"> 3125</span>          ao = <a class="code hl_function" href="namespaceMoFEM.html#a69e4731b62ce470449eb4e780df69fba">createAOMapping</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), indices.size(),</div>
<div class="line"><span class="lineno"> 3126</span>                               &amp;*indices.begin(), PETSC_NULLPTR);</div>
<div class="line"><span class="lineno"> 3127</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 3128</span>          ao = <a class="code hl_function" href="namespaceMoFEM.html#a69e4731b62ce470449eb4e780df69fba">createAOMapping</a>(PETSC_COMM_SELF, indices.size(),</div>
<div class="line"><span class="lineno"> 3129</span>                               &amp;*indices.begin(), PETSC_NULLPTR);</div>
<div class="line"><span class="lineno"> 3130</span> </div>
<div class="line"><span class="lineno"> 3131</span>        <span class="comment">// Set mapping to sub dm data</span></div>
<div class="line"><span class="lineno"> 3132</span>        <span class="keywordflow">if</span> (local_only) {</div>
<div class="line"><span class="lineno"> 3133</span>          <span class="keywordflow">if</span> (<span class="keyword">auto</span> sub_data = prb_ptr-&gt;getSubData()) {</div>
<div class="line"><span class="lineno"> 3134</span>            <span class="comment">// create is and then map it to main problem of sub-problem</span></div>
<div class="line"><span class="lineno"> 3135</span>            <span class="keyword">auto</span> sub_is = <a class="code hl_function" href="namespaceMoFEM.html#a63e4d1be7ab2082bd7db6fff982aaaf6">createISGeneral</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), indices.size(),</div>
<div class="line"><span class="lineno"> 3136</span>                                          &amp;*indices.begin(), PETSC_COPY_VALUES);</div>
<div class="line"><span class="lineno"> 3137</span>            <span class="comment">// get old app, i.e. oroginal befor sub indices, and ao, from app,</span></div>
<div class="line"><span class="lineno"> 3138</span>            <span class="comment">// to petsc sub indices.</span></div>
<div class="line"><span class="lineno"> 3139</span>            <span class="keyword">auto</span> sub_ao = get_sub_ao(sub_data);</div>
<div class="line"><span class="lineno"> 3140</span>            <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOPetscToApplicationIS(sub_ao, sub_is);</div>
<div class="line"><span class="lineno"> 3141</span>            sub_ao = <a class="code hl_function" href="namespaceMoFEM.html#a9f975731f30667ce5912e6969ff5978e">createAOMappingIS</a>(sub_is, PETSC_NULLPTR);</div>
<div class="line"><span class="lineno"> 3142</span>            <span class="comment">// set new sub ao</span></div>
<div class="line"><span class="lineno"> 3143</span>            set_sub_is_and_ao(sub_data, sub_is, sub_ao);</div>
<div class="line"><span class="lineno"> 3144</span>            apply_symmetry(sub_data);</div>
<div class="line"><span class="lineno"> 3145</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3146</span>            <span class="comment">// create sub data</span></div>
<div class="line"><span class="lineno"> 3147</span>            prb_ptr-&gt;getSubData() =</div>
<div class="line"><span class="lineno"> 3148</span>                boost::make_shared&lt;Problem::SubProblemData&gt;();</div>
<div class="line"><span class="lineno"> 3149</span>            <span class="keyword">auto</span> sub_is = <a class="code hl_function" href="namespaceMoFEM.html#a63e4d1be7ab2082bd7db6fff982aaaf6">createISGeneral</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), indices.size(),</div>
<div class="line"><span class="lineno"> 3150</span>                                          &amp;*indices.begin(), PETSC_COPY_VALUES);</div>
<div class="line"><span class="lineno"> 3151</span>            <span class="comment">// set sub is ao</span></div>
<div class="line"><span class="lineno"> 3152</span>            set_sub_is_and_ao(prb_ptr-&gt;getSubData(), sub_is, ao);</div>
<div class="line"><span class="lineno"> 3153</span>            apply_symmetry(prb_ptr-&gt;getSubData());</div>
<div class="line"><span class="lineno"> 3154</span>          }</div>
<div class="line"><span class="lineno"> 3155</span>        }</div>
<div class="line"><span class="lineno"> 3156</span> </div>
<div class="line"><span class="lineno"> 3157</span>        get_indices_by_uid(tag, indices);</div>
<div class="line"><span class="lineno"> 3158</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> AOApplicationToPetsc(ao, indices.size(), &amp;*indices.begin());</div>
<div class="line"><span class="lineno"> 3159</span> </div>
<div class="line"><span class="lineno"> 3160</span>        <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 3161</span>      };</div>
<div class="line"><span class="lineno"> 3162</span> </div>
<div class="line"><span class="lineno"> 3163</span>      <span class="comment">// set indices index</span></div>
<div class="line"><span class="lineno"> 3164</span>      <span class="keyword">auto</span> set_concatenated_indices = [&amp;]() {</div>
<div class="line"><span class="lineno"> 3165</span>        std::vector&lt;int&gt; global_indices;</div>
<div class="line"><span class="lineno"> 3166</span>        std::vector&lt;int&gt; local_indices;</div>
<div class="line"><span class="lineno"> 3167</span>        <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"><span class="lineno"> 3168</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> concatenate_dofs(PetscGlobalIdx_mi_tag(), global_indices, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 3169</span>        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> concatenate_dofs(PetscLocalIdx_mi_tag(), local_indices, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 3170</span>        <span class="keyword">auto</span> gi = global_indices.begin();</div>
<div class="line"><span class="lineno"> 3171</span>        <span class="keyword">auto</span> li = local_indices.begin();</div>
<div class="line"><span class="lineno"> 3172</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit = numered_dofs[s]-&gt;begin(); dit != numered_dofs[s]-&gt;end();</div>
<div class="line"><span class="lineno"> 3173</span>             ++dit) {</div>
<div class="line"><span class="lineno"> 3174</span>          <span class="keyword">auto</span> mod = NumeredDofEntity_part_and_all_indices_change(</div>
<div class="line"><span class="lineno"> 3175</span>              (*dit)-&gt;getPart(), (*dit)-&gt;getDofIdx(), *gi, *li);</div>
<div class="line"><span class="lineno"> 3176</span>          <span class="keywordtype">bool</span> success = numered_dofs[s]-&gt;modify(dit, mod);</div>
<div class="line"><span class="lineno"> 3177</span>          <span class="keywordflow">if</span> (!success)</div>
<div class="line"><span class="lineno"> 3178</span>            SETERRQ(PETSC_COMM_SELF, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eaa4d3788e72b298f5fc901644e3f1ad95">MOFEM_OPERATION_UNSUCCESSFUL</a>,</div>
<div class="line"><span class="lineno"> 3179</span>                    <span class="stringliteral">&quot;can not set negative indices&quot;</span>);</div>
<div class="line"><span class="lineno"> 3180</span>          ++gi;</div>
<div class="line"><span class="lineno"> 3181</span>          ++li;</div>
<div class="line"><span class="lineno"> 3182</span>        }</div>
<div class="line"><span class="lineno"> 3183</span>        <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 3184</span>      };</div>
<div class="line"><span class="lineno"> 3185</span>      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> set_concatenated_indices();</div>
<div class="line"><span class="lineno"> 3186</span> </div>
<div class="line"><span class="lineno"> 3187</span>      MPI_Allreduce(&amp;nb_local_dofs, nbdof_ptr[s], 1, MPI_INT, MPI_SUM,</div>
<div class="line"><span class="lineno"> 3188</span>                    m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>());</div>
<div class="line"><span class="lineno"> 3189</span>      *(local_nbdof_ptr[s]) = nb_local_dofs;</div>
<div class="line"><span class="lineno"> 3190</span>      *(ghost_nbdof_ptr[s]) = nb_ghost_dofs;</div>
<div class="line"><span class="lineno"> 3191</span> </div>
<div class="line"><span class="lineno"> 3192</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceMoFEM.html#a2e89479afd4801ad925769bb157de81f">debug</a>)</div>
<div class="line"><span class="lineno"> 3193</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dof : (*numered_dofs[s])) {</div>
<div class="line"><span class="lineno"> 3194</span>          <span class="keywordflow">if</span> (dof-&gt;getPetscGlobalDofIdx() &lt; 0) {</div>
<div class="line"><span class="lineno"> 3195</span>            SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 3196</span>                    <span class="stringliteral">&quot;Negative global idx&quot;</span>);</div>
<div class="line"><span class="lineno"> 3197</span>          }</div>
<div class="line"><span class="lineno"> 3198</span>          <span class="keywordflow">if</span> (dof-&gt;getPetscLocalDofIdx() &lt; 0) {</div>
<div class="line"><span class="lineno"> 3199</span>            SETERRQ(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line"><span class="lineno"> 3200</span>                    <span class="stringliteral">&quot;Negative local idx&quot;</span>);</div>
<div class="line"><span class="lineno"> 3201</span>          }</div>
<div class="line"><span class="lineno"> 3202</span>        }</div>
<div class="line"><span class="lineno"> 3203</span> </div>
<div class="line"><span class="lineno"> 3204</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3205</span> </div>
<div class="line"><span class="lineno"> 3206</span>      *(nbdof_ptr[1]) = *(nbdof_ptr[0]);</div>
<div class="line"><span class="lineno"> 3207</span>      *(local_nbdof_ptr[1]) = *(local_nbdof_ptr[0]);</div>
<div class="line"><span class="lineno"> 3208</span>      *(ghost_nbdof_ptr[1]) = *(ghost_nbdof_ptr[0]);</div>
<div class="line"><span class="lineno"> 3209</span>    }</div>
<div class="line"><span class="lineno"> 3210</span> </div>
<div class="line"><span class="lineno"> 3211</span>  <span class="keywordflow">if</span> (verb &gt; <a class="code hl_enumvalue" href="definitions_8h.html#a018e38d630e7ebef4cfa48ab69889f2ca4e8e36e4a6c3348cb98fd3223fb07b28">QUIET</a>) {</div>
<div class="line"><span class="lineno"> 3212</span>    <a class="code hl_define" href="LogManager_8hpp.html#aef9b5316ec6db54581633adf7c670011">MOFEM_LOG_C</a>(</div>
<div class="line"><span class="lineno"> 3213</span>        <span class="stringliteral">&quot;WORLD&quot;</span>, Sev::inform,</div>
<div class="line"><span class="lineno"> 3214</span>        <span class="stringliteral">&quot;Removed DOFs from problem %s dofs [%d / %d (before %d / %d) global]&quot;</span>,</div>
<div class="line"><span class="lineno"> 3215</span>        prb_ptr-&gt;getName().c_str(), prb_ptr-&gt;getNbDofsRow(),</div>
<div class="line"><span class="lineno"> 3216</span>        prb_ptr-&gt;getNbDofsCol(), nb_init_row_dofs, nb_init_col_dofs);</div>
<div class="line"><span class="lineno"> 3217</span>    <a class="code hl_define" href="LogManager_8hpp.html#aef9b5316ec6db54581633adf7c670011">MOFEM_LOG_C</a>(<span class="stringliteral">&quot;SYNC&quot;</span>, Sev::verbose,</div>
<div class="line"><span class="lineno"> 3218</span>                <span class="stringliteral">&quot;Removed DOFs from problem %s dofs [ %d / %d  &quot;</span></div>
<div class="line"><span class="lineno"> 3219</span>                <span class="stringliteral">&quot;(before %d / %d) local, %d / %d (before %d / %d)]&quot;</span>,</div>
<div class="line"><span class="lineno"> 3220</span>                prb_ptr-&gt;getName().c_str(), prb_ptr-&gt;getNbLocalDofsRow(),</div>
<div class="line"><span class="lineno"> 3221</span>                prb_ptr-&gt;getNbLocalDofsCol(), nb_init_loc_row_dofs,</div>
<div class="line"><span class="lineno"> 3222</span>                nb_init_loc_row_dofs, prb_ptr-&gt;getNbGhostDofsRow(),</div>
<div class="line"><span class="lineno"> 3223</span>                prb_ptr-&gt;getNbGhostDofsCol(), nb_init_ghost_row_dofs,</div>
<div class="line"><span class="lineno"> 3224</span>                nb_init_ghost_col_dofs);</div>
<div class="line"><span class="lineno"> 3225</span>    <a class="code hl_define" href="LogManager_8hpp.html#a3b22f6000e678d07d69a2c790177a352">MOFEM_LOG_SEVERITY_SYNC</a>(m_field.<a class="code hl_function" href="structMoFEM_1_1CoreInterface.html#a9b2bc8c1b980f49d31a0b5f7fbe756f5">get_comm</a>(), Sev::verbose);</div>
<div class="line"><span class="lineno"> 3226</span>  }</div>
<div class="line"><span class="lineno"> 3227</span> </div>
<div class="line"><span class="lineno"> 3228</span>  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line"><span class="lineno"> 3229</span>}</div>
<div class="ttc" id="aLogManager_8hpp_html_aef9b5316ec6db54581633adf7c670011"><div class="ttname"><a href="LogManager_8hpp.html#aef9b5316ec6db54581633adf7c670011">MOFEM_LOG_C</a></div><div class="ttdeci">#define MOFEM_LOG_C(channel, severity, format,...)</div><div class="ttdef"><b>Definition</b> <a href="LogManager_8hpp_source.html#l00319">LogManager.hpp:319</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a63e4d1be7ab2082bd7db6fff982aaaf6"><div class="ttname"><a href="namespaceMoFEM.html#a63e4d1be7ab2082bd7db6fff982aaaf6">MoFEM::createISGeneral</a></div><div class="ttdeci">auto createISGeneral(MPI_Comm comm, PetscInt n, const PetscInt idx[], PetscCopyMode mode)</div><div class="ttdoc">Creates a data structure for an index set containing a list of integers.</div><div class="ttdef"><b>Definition</b> <a href="PetscSmartObj_8hpp_source.html#l00287">PetscSmartObj.hpp:287</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a69e4731b62ce470449eb4e780df69fba"><div class="ttname"><a href="namespaceMoFEM.html#a69e4731b62ce470449eb4e780df69fba">MoFEM::createAOMapping</a></div><div class="ttdeci">auto createAOMapping(MPI_Comm comm, PetscInt napp, const PetscInt myapp[], const PetscInt mypetsc[])</div><div class="ttdoc">Creates an application mapping using two integer arrays.</div><div class="ttdef"><b>Definition</b> <a href="PetscSmartObj_8hpp_source.html#l00338">PetscSmartObj.hpp:338</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a9f975731f30667ce5912e6969ff5978e"><div class="ttname"><a href="namespaceMoFEM.html#a9f975731f30667ce5912e6969ff5978e">MoFEM::createAOMappingIS</a></div><div class="ttdeci">auto createAOMappingIS(IS isapp, IS ispetsc)</div><div class="ttdoc">Creates an application mapping using two index sets.</div><div class="ttdef"><b>Definition</b> <a href="PetscSmartObj_8hpp_source.html#l00318">PetscSmartObj.hpp:318</a></div></div>
<div class="ttc" id="astructMoFEM_1_1Problem_html_a54dbffef1909f2e198d0836fa96fa95e"><div class="ttname"><a href="structMoFEM_1_1Problem.html#a54dbffef1909f2e198d0836fa96fa95e">MoFEM::Problem::numeredRowDofsPtr</a></div><div class="ttdeci">boost::shared_ptr&lt; NumeredDofEntity_multiIndex &gt; numeredRowDofsPtr</div><div class="ttdoc">store DOFs on rows for this problem</div><div class="ttdef"><b>Definition</b> <a href="ProblemsMultiIndices_8hpp_source.html#l00073">ProblemsMultiIndices.hpp:73</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.8
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>
