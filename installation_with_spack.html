<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: Installation with Spack (Advanced)</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
  <script>
    window.MathJax = {
      tex: {
        tags: 'all', // Enables equation numbering
      },
      loader: {
        load: ['[tex]/boldsymbol']
      }
    };
  </script>
  <script type="text/javascript " src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.15.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Installation with Spack (Advanced)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md62">Installing MoFEM with Spack on Ubuntu Noble</a><ul><li class="level2"><a href="#autotoc_md63">🧰 Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md64">📦 Step 1: Install System Dependencies</a></li>
<li class="level2"><a href="#autotoc_md65">📁 Step 2: Set Up Directories</a></li>
<li class="level2"><a href="#autotoc_md66">📥 Step 3: Download and Unpack Spack</a></li>
<li class="level2"><a href="#autotoc_md67">🧠 Step 4: Initialise Spack</a></li>
<li class="level2"><a href="#autotoc_md68">🔧 Step 5: Configure Spack</a></li>
<li class="level2"><a href="#autotoc_md69">🧩 Step 6: Add Clone and Custom MoFEM Package Repository</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md70">Set the MoFEM source directory</a><ul><li class="level2"><a href="#autotoc_md71">🏗️ Step 10: Build MoFEM Core Library</a></li>
<li class="level2"><a href="#autotoc_md72">✅ Done!</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md73">🚧 MoFEM Installation on Oak Development Server</a><ul><li class="level2"><a href="#autotoc_md74">🛠️ 1. Set Up Environment in &lt;tt&gt;~/.bashrc&lt;/tt&gt;</a></li>
<li class="level2"><a href="#autotoc_md75">📁 2. Prepare Installation Directory</a></li>
<li class="level2"><a href="#autotoc_md76">📦 3. Clone the MoFEM Repository</a></li>
<li class="level2"><a href="#autotoc_md77">🧪 4. Create and Configure the Release Environment</a></li>
<li class="level2"><a href="#autotoc_md78">🐞 5. (Optional) Create a Debugging Environment</a><ul><li class="level3"><a href="#autotoc_md79">⚙️ Create and Configure the Debug Environment</a></li>
<li class="level3"><a href="#autotoc_md80">🔬 Work on PETSc and MOAB Code (Optional)</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md81">✅ Done!</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md82">🚧 MoFEM Installation on Buckedhead (SLURM System)</a><ul><li class="level2"><a href="#autotoc_md83">📦 1. Load Required Modules</a></li>
<li class="level2"><a href="#autotoc_md84">📁 2. Create Directory Layout</a></li>
<li class="level2"><a href="#autotoc_md85">📥 3. Download and Unpack Spack</a></li>
<li class="level2"><a href="#autotoc_md86">🧠 4. Initialise Spack</a></li>
<li class="level2"><a href="#autotoc_md87">🔧 5. Configure Spack with External Packages</a></li>
<li class="level2"><a href="#autotoc_md88">🧩 6. Clone and Register MoFEM Repo</a></li>
<li class="level2"><a href="#autotoc_md89">🌱 7. Create and Configure Spack Environment</a></li>
<li class="level2"><a href="#autotoc_md90">🚀 8. Add and Build MoFEM</a></li>
<li class="level2"><a href="#autotoc_md91">🧪 9. (Optional) Create Debug Environment</a></li>
<li class="level2"><a href="#autotoc_md92">✅ 10. Run MoFEM in SLURM Job</a></li>
</ul>
</li>
<li class="level1"><a href="#spack_faq">FAQ</a><ul><li class="level2"><a href="#autotoc_md93">How to get packages installed today?</a></li>
<li class="level2"><a href="#autotoc_md94">How to find packages that were only installed today?</a></li>
</ul>
</li>
<li class="level1"><a href="#spack_contact">Contact</a></li>
</ul>
</div>
<div class="textblock"><p><a href="https://spack.io">Spack</a> is a <b>flexible package manager</b> designed to support multiple versions, configurations, platforms, and compilers.</p>
<p>It is actively developed by a vibrant open-source community of users and contributors who maintain package configurations across a wide range of platforms, including macOS and Linux. This enables a <b>consistent and reproducible build environment</b> for many scientific software packages.</p>
<p><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is best deployed and developed using Spack, which is the <b>recommended installation method</b>. Please note that Spack builds all packages <b>from source</b>; precompiled binaries are not provided.</p>
<p>If you encounter issues, have feedback, or would like to suggest improvements, feel free to contact us at <br  />
 <a href="https://groups.google.com/forum/#!forum/mofem-group">mofem-group@googlegroups.com</a>.</p>
<blockquote class="doxtable">
<p>&zwj;Installation instructions besides Oak are not valid. We changed patterns how we work </p>
</blockquote>
<p>with Spack, and change <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> infrastructure. Documentation is not yet updated.</p>
<h1><a class="anchor" id="autotoc_md62"></a>
Installing MoFEM with Spack on Ubuntu Noble</h1>
<p>This guide walks you through setting up <b><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></b> using <b>Spack</b> on Ubuntu Noble, based on the official Docker build.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
🧰 Prerequisites</h2>
<p>Ensure you're running <b>Ubuntu 24.04 (Noble Numbat)</b> and have <code>sudo</code> privileges.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
📦 Step 1: Install System Dependencies</h2>
<div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt install -y \</div>
<div class="line">  file \</div>
<div class="line">  zlib1g-dev \</div>
<div class="line">  openssh-server \</div>
<div class="line">  wget \</div>
<div class="line">  valgrind \</div>
<div class="line">  curl \</div>
<div class="line">  git \</div>
<div class="line">  g++ \</div>
<div class="line">  gfortran \</div>
<div class="line">  gdb \</div>
<div class="line">  m4 \</div>
<div class="line">  automake \</div>
<div class="line">  build-essential \</div>
<div class="line">  libtool \</div>
<div class="line">  libsigsegv2 \</div>
<div class="line">  libjpeg-dev \</div>
<div class="line">  graphviz \</div>
<div class="line">  doxygen \</div>
<div class="line">  cmake \</div>
<div class="line">  pkg-config \</div>
<div class="line">  gnuplot \</div>
<div class="line">  ca-certificates \</div>
<div class="line">  python3-setuptools \</div>
<div class="line">  python3-dev \</div>
<div class="line">  python3-numpy \</div>
<div class="line">  python3-scipy \</div>
<div class="line">  libx11-dev \</div>
<div class="line">  xauth \</div>
<div class="line">  xterm \</div>
<div class="line">  unzip \</div>
<div class="line">  mesa-common-dev \</div>
<div class="line">  libglu1-mesa-dev \</div>
<div class="line">  libxmu-dev \</div>
<div class="line">  libxi-dev \</div>
<div class="line">  libssl-dev \</div>
<div class="line">  gawk \</div>
<div class="line">  gettext \</div>
<div class="line">  libboost-all-dev \</div>
<div class="line">  libboost-python-dev \</div>
<div class="line">  openmpi-bin \</div>
<div class="line">  libopenmpi-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md65"></a>
📁 Step 2: Set Up Directories</h2>
<div class="fragment"><div class="line">export MOFEM_INSTALL_DIR=$HOME/mofem_install</div>
<div class="line">export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</div>
<div class="line"> </div>
<div class="line">mkdir -p $SPACK_ROOT</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md66"></a>
📥 Step 3: Download and Unpack Spack</h2>
<div class="fragment"><div class="line">curl -L https://github.com/spack/spack/archive/refs/tags/v0.23.1.tar.gz | \</div>
<div class="line">  tar -xz -C $SPACK_ROOT --strip-components=1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
🧠 Step 4: Initialise Spack</h2>
<p>Add to your <code>.bashrc</code> or <code>.bash_profile</code>:</p>
<div class="fragment"><div class="line">export MOFEM_INSTALL_DIR=$HOME/mofem_install</div>
<div class="line">export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</div>
<div class="line">. $SPACK_ROOT/share/spack/setup-env.sh</div>
</div><!-- fragment --><p>Then apply:</p>
<div class="fragment"><div class="line">source ~/.bashrc</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
🔧 Step 5: Configure Spack</h2>
<div class="fragment"><div class="line">spack compiler find</div>
<div class="line">spack external find</div>
<div class="line"> </div>
<div class="line">spack config add &quot;packages:all:target:[x86_64]&quot;</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=Release&quot;</div>
</div><!-- fragment --><p>Then, update <code>~/.spack/packages.yaml</code> (or use <code>sed</code>) to mark some packages as external:</p>
<div class="fragment"><div class="line">openmpi:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: openmpi@4.1.6</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">python:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: python@3.12.3</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">py-numpy:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: py-numpy@1.26.4 ^python@3.12.13</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">boost:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: boost@1.83.0</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">icu4c:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: icu4c@74.2</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
🧩 Step 6: Add Clone and Custom MoFEM Package Repository</h2>
<p>If you have a custom <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> Spack repo:</p>
<div class="fragment"><div class="line"># Clone the MoFEM repository</div>
<div class="line">cd $MOFEM_INSTALL_DIR</div>
<div class="line">git clone -b $MOFEM_BRANCH https://bitbucket.org/mofem/mofem-cephas.git</div>
</div><!-- fragment --><p>spack repo add $MOFEM_INSTALL_DIR/mofem_cephas </p><div class="fragment"><div class="line">Ensure:</div>
<div class="line">- `$MOFEM_INSTALL_DIR/mofem_cephas/repo.yaml`</div>
<div class="line">- `$MOFEM_INSTALL_DIR/mofem_cephas/packages/...`</div>
<div class="line"> </div>
<div class="line">## 🚀 Step 7: Install MoFEM Dependencies</div>
</div><!-- fragment --><p> bash spack install &ndash;only dependencies <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0+mgis ^petsc+X </p><div class="fragment"><div class="line">## 🧹 Step 8: Clean Build Cache</div>
</div><!-- fragment --><p> bash spack clean -a </p><div class="fragment"><div class="line">## 📥 Step 9: Build MoFEM</div>
</div><!-- fragment --><p> bash </p>
<h1><a class="anchor" id="autotoc_md70"></a>
Set the MoFEM source directory</h1>
<p>export MOFEM_SRC_DIR=$MOFEM_INSTALL_DIR/mofem-cephas export MOFEM_BRANCH=Version0.15.0</p>
<h2><a class="anchor" id="autotoc_md71"></a>
🏗️ Step 10: Build MoFEM Core Library</h2>
<div class="fragment"><div class="line">. $SPACK_ROOT/share/spack/setup-env.sh</div>
<div class="line"> </div>
<div class="line"># Create and activate environment</div>
<div class="line">spack env create mofem</div>
<div class="line">spack env activate mofem</div>
<div class="line"> </div>
<div class="line"># Configure and build</div>
<div class="line">spack config add &quot;packages:all:target:[x86_64]&quot;</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=Release&quot;</div>
<div class="line">spack add mofem-cephas@0.15.0+adol-c+med+mgis~shared+slepc+tetgen install_id=0 ^petsc+X</div>
<div class="line">spack develop -p $MOFEM_SRC_DIR mofem-cephas@0.15.0</div>
<div class="line">spack concretize -f</div>
<div class="line">spack install -v</div>
<div class="line"> </div>
<div class="line"># Clean build cache</div>
<div class="line">spack clean -a</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md72"></a>
✅ Done!</h2>
<p><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is now installed using Spack and ready to use.</p>
<p>To persist environment setup across sessions, you may add:</p>
<div class="fragment"><div class="line">echo &quot;. $SPACK_ROOT/share/spack/setup-env.sh&quot; | sudo tee /etc/profile.d/mofem.sh</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md73"></a>
🚧 MoFEM Installation on Oak Development Server</h1>
<p>These instructions describe how to install <b><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></b> using <b>Spack</b> on the Oak development server.</p>
<h2><a class="anchor" id="autotoc_md74"></a>
🛠️ 1. Set Up Environment in &lt;tt&gt;~/.bashrc&lt;/tt&gt;</h2>
<p>If you have an account on Oak, configure your shell environment by adding the following lines:</p>
<div class="fragment"><div class="line">echo &quot;export TMPDIR=/home/lk58p/tmp&quot; &gt;&gt; ~/.bashrc</div>
<div class="line">echo &quot;. /mofem_install/vanilla_spack/share/spack/setup-env.sh&quot; &gt;&gt; ~/.bashrc</div>
</div><!-- fragment --><p>Then <b>restart your terminal</b>, or run the above lines in your current shell to apply them immediately.</p>
<h2><a class="anchor" id="autotoc_md75"></a>
📁 2. Prepare Installation Directory</h2>
<div class="fragment"><div class="line">mkdir -p $HOME/mofem_install</div>
<div class="line">cd $HOME/mofem_install</div>
</div><!-- fragment --><p> and copy packages list </p><div class="fragment"><div class="line">cp /mofem_install/packages.yaml  $HOME/.spack</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
📦 3. Clone the MoFEM Repository</h2>
<div class="fragment"><div class="line">git clone git@bitbucket.org:mofem/mofem-cephas.git</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
🧪 4. Create and Configure the Release Environment</h2>
<div class="fragment"><div class="line">mkdir -p $HOME/mofem_install/release_env</div>
<div class="line">cd $HOME/mofem_install/release_env</div>
</div><!-- fragment --><p>Add the <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> repository to Spack:</p>
<div class="fragment"><div class="line">spack repo add $HOME/mofem_install/mofem-cephas</div>
</div><!-- fragment --><p>Create a new Spack environment and configure it:</p>
<div class="fragment"><div class="line">spack env create -d .</div>
<div class="line">spacktivate .</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=RelWithDebInfo&quot;</div>
</div><!-- fragment --><p>Add <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> and its dependencies:</p>
<div class="fragment"><div class="line">spack add mofem-cephas@0.15.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X</div>
<div class="line">spack develop -p $HOME/mofem_install/mofem-cephas</div>
</div><!-- fragment --><p>Build the environment:</p>
<div class="fragment"><div class="line">spack concretize -f</div>
<div class="line">spack install -v --test=root mofem-cephas@0.15.0</div>
</div><!-- fragment --><p>To activate the environment in future sessions:</p>
<div class="fragment"><div class="line">spack env activate -d $HOME/mofem_install/release_env</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
🐞 5. (Optional) Create a Debugging Environment</h2>
<p>Use this to build with debug flags and work on source-level changes to <b>PETSc</b> or <b>MOAB</b>.</p>
<h3><a class="anchor" id="autotoc_md79"></a>
⚙️ Create and Configure the Debug Environment</h3>
<div class="fragment"><div class="line">mkdir -p $HOME/mofem_install/debug_env</div>
<div class="line">cd $HOME/mofem_install/debug_env</div>
<div class="line"> </div>
<div class="line">spack env create -d .</div>
<div class="line">spacktivate .</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=Debug&quot;</div>
<div class="line">spack add mofem-cephas@0.15.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X</div>
<div class="line">spack develop -p $HOME/mofem_install/mofem-cephas</div>
<div class="line">spack concretize -f</div>
<div class="line">spack install -v --test=root mofem-cephas@0.15.0</div>
</div><!-- fragment --><p>Activate the environment:</p>
<div class="fragment"><div class="line">spack env activate -d $HOME/mofem_install/debug_env</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md80"></a>
🔬 Work on PETSc and MOAB Code (Optional)</h3>
<p>If you plan to modify <b>PETSc</b> or <b>MOAB</b>, you can clone and develop them directly:</p>
<div class="fragment"><div class="line">cd $HOME/mofem_install/debug_env</div>
<div class="line"> </div>
<div class="line"># Add source-controlled PETSc and MOAB</div>
<div class="line">spack add moab@5.5.1</div>
<div class="line">spack add petsc@3.22.1</div>
<div class="line"> </div>
<div class="line"># Mark them for local development</div>
<div class="line">spack develop -p $PWD/moab moab@5.5.1</div>
<div class="line">spack develop -p $PWD/petsc petsc@3.22.1</div>
<div class="line"> </div>
<div class="line"># Re-concretise and install</div>
<div class="line">spack concretize -f</div>
<div class="line">spack install -v</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
✅ Done!</h2>
<p><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is now installed and ready for use. To make development smoother:</p><ul>
<li>Use <code>spack env activate -d &lt;path&gt;</code> to switch environments.</li>
<li>Add common commands to your <code>.bashrc</code> or <code>.bash_aliases</code>.</li>
<li>Use <code>spack develop</code> to link your changes into the build.</li>
</ul>
<h1><a class="anchor" id="autotoc_md82"></a>
🚧 MoFEM Installation on Buckedhead (SLURM System)</h1>
<p>This guide assumes you're using modules and installing into your user space, without admin privileges.</p>
<h2><a class="anchor" id="autotoc_md83"></a>
📦 1. Load Required Modules</h2>
<div class="fragment"><div class="line">module purge</div>
<div class="line">module load gcc/14.2.0</div>
<div class="line">module load mpi/openmpi/4.1.7/gcc-14.2.0</div>
<div class="line">module load python/3.12.8</div>
</div><!-- fragment --><p>Check that they are loaded correctly:</p>
<div class="fragment"><div class="line">which gcc</div>
<div class="line">which mpicc</div>
<div class="line">python3 --version</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md84"></a>
📁 2. Create Directory Layout</h2>
<div class="fragment"><div class="line">export MOFEM_INSTALL_DIR=$HOME/mofem_install</div>
<div class="line">export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</div>
<div class="line"> </div>
<div class="line">mkdir -p $SPACK_ROOT</div>
<div class="line">mkdir -p $MOFEM_INSTALL_DIR</div>
<div class="line">cd $MOFEM_INSTALL_DIR</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md85"></a>
📥 3. Download and Unpack Spack</h2>
<div class="fragment"><div class="line">curl -L https://github.com/spack/spack/archive/refs/tags/v0.23.1.tar.gz | \</div>
<div class="line">  tar -xz -C $SPACK_ROOT --strip-components=1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md86"></a>
🧠 4. Initialise Spack</h2>
<p>Add to your <code>.bashrc</code> or run interactively:</p>
<div class="fragment"><div class="line">export SPACK_ROOT=$HOME/mofem_install/spack</div>
<div class="line">. $SPACK_ROOT/share/spack/setup-env.sh</div>
</div><!-- fragment --><p>Apply changes:</p>
<div class="fragment"><div class="line">source ~/.bashrc</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md87"></a>
🔧 5. Configure Spack with External Packages</h2>
<div class="fragment"><div class="line">spack compiler find</div>
<div class="line">spack external find</div>
</div><!-- fragment --><p>Edit <code>~/.spack/packages.yaml</code> and add:</p>
<div class="fragment"><div class="line">packages:</div>
<div class="line">  all:</div>
<div class="line">    target: [x86_64]</div>
<div class="line">    variants: +mpi build_type=Release</div>
<div class="line"> </div>
<div class="line">  python:</div>
<div class="line">    externals:</div>
<div class="line">    - spec: python@3.12.8</div>
<div class="line">      prefix: /software/python/3.12.8</div>
<div class="line">    buildable: false</div>
<div class="line"> </div>
<div class="line">  openmpi:</div>
<div class="line">    externals:</div>
<div class="line">    - spec: openmpi@4.1.7</div>
<div class="line">      prefix: /software/mpi/openmpi/4.1.7/gcc-14.2.0</div>
<div class="line">    buildable: false</div>
<div class="line"> </div>
<div class="line">  boost:</div>
<div class="line">    externals:</div>
<div class="line">    - spec: boost@1.83.0</div>
<div class="line">      prefix: /usr</div>
<div class="line">    buildable: false</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md88"></a>
🧩 6. Clone and Register MoFEM Repo</h2>
<div class="fragment"><div class="line">cd $MOFEM_INSTALL_DIR</div>
<div class="line">git clone --branch Version0.15.0 https://bitbucket.org/mofem/mofem-cephas.git</div>
<div class="line"> </div>
<div class="line">spack repo add $MOFEM_INSTALL_DIR/mofem-cephas</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md89"></a>
🌱 7. Create and Configure Spack Environment</h2>
<div class="fragment"><div class="line">mkdir -p $MOFEM_INSTALL_DIR/release_env</div>
<div class="line">cd $MOFEM_INSTALL_DIR/release_env</div>
<div class="line">spack env create -d .</div>
<div class="line">spack env activate .</div>
<div class="line"> </div>
<div class="line">spack config add &quot;packages:all:target:[x86_64]&quot;</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=RelWithDebInfo&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md90"></a>
🚀 8. Add and Build MoFEM</h2>
<div class="fragment"><div class="line">spack add mofem-cephas@0.15.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X</div>
<div class="line">spack develop -p $MOFEM_INSTALL_DIR/mofem-cephas</div>
<div class="line">spack concretize -f</div>
<div class="line">spack install -v</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md91"></a>
🧪 9. (Optional) Create Debug Environment</h2>
<div class="fragment"><div class="line">mkdir -p $MOFEM_INSTALL_DIR/debug_env</div>
<div class="line">cd $MOFEM_INSTALL_DIR/debug_env</div>
<div class="line">spack env create -d .</div>
<div class="line">spack env activate .</div>
<div class="line"> </div>
<div class="line">spack config add &quot;packages:all:variants:build_type=Debug&quot;</div>
<div class="line">spack add mofem-cephas@0.15.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X</div>
<div class="line">spack develop -p $MOFEM_INSTALL_DIR/mofem-cephas</div>
<div class="line">spack concretize -f</div>
<div class="line">spack install -v</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md92"></a>
✅ 10. Run MoFEM in SLURM Job</h2>
<p><a class="el" href="structExample.html" title="[Example]">Example</a> SLURM script:</p>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">#SBATCH --job-name=mofem_test</div>
<div class="line">#SBATCH --ntasks=4</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line"> </div>
<div class="line">module purge</div>
<div class="line">module load gcc/14.2.0</div>
<div class="line">module load mpi/openmpi/4.1.7/gcc-14.2.0</div>
<div class="line">module load python/3.12.8</div>
<div class="line"> </div>
<div class="line">source $HOME/mofem_install/spack/share/spack/setup-env.sh</div>
<div class="line">spack env activate $HOME/mofem_install/release_env</div>
<div class="line"> </div>
<div class="line">mpirun ./my_mofem_app</div>
</div><!-- fragment --><h1><a class="anchor" id="spack_faq"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md93"></a>
How to get packages installed today?</h2>
<p>Run command: </p><div class="fragment"><div class="line">spack find -p -L --start-date `date +%F`</div>
</div><!-- fragment --><p> and you will get: </p><div class="fragment"><div class="line">-- darwin-elcapitan-x86_64 / clang@7.3.0-apple ------------------</div>
<div class="line">ugi2gm7    mofem-cephas@develop     /spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/mofem-cephas-develop-ugi2gm7lydyjwmiwneefhxq7ahvpnuzc</div>
<div class="line">gu4uheh    mofem-users-modules@develop  /spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/mofem-users-modules-develop-gu4uhehai3edtqow7kivuxgpw5lmvbxz</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md94"></a>
How to find packages that were only installed today?</h2>
<p>Run command: </p><div class="fragment"><div class="line">ls -lhd `spack find -lp  | grep mofem | awk &#39;\&#39;&#39;{print $3}&#39;\&#39;&#39;`</div>
</div><!-- fragment --><h1><a class="anchor" id="spack_contact"></a>
Contact</h1>
<p>If you are experiencing any problems with this installation, please contact us by <a href="https://groups.google.com/forum/#!forum/mofem-group">mofem-group@googlegroups.com</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.8
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>