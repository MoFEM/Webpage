<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: COR-8: Implementation of spring element</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
  <script>
    window.MathJax = {
      tex: {
        tags: 'all', // Enables equation numbering
      },
      loader: {
        load: ['[tex]/boldsymbol']
      }
    };
  </script>
  <script type="text/javascript " src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.15.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">COR-8: Implementation of spring element</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#spring_element_introduction">Introduction</a></li>
<li class="level1"><a href="#spring_fe_formulation">Formulation</a></li>
<li class="level1"><a href="#spring_implementation">Implementation</a><ul><li class="level2"><a href="#spring_opspringfs">Operator OpSpringFs for the RHS</a></li>
<li class="level2"><a href="#spring_opspringks">Operator OpSpringKs for the LHS</a></li>
<li class="level2"><a href="#spring_other_function">Other functions</a><ul><li class="level3"><a href="#spring_declaration_function">Declaration of spring elements</a></li>
<li class="level3"><a href="#spring_set_operator_function">Pushing operators to finite element instances</a></li>
<li class="level3"><a href="#spring_transformation_function">Transformation of the spring</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#spring_sample_application">Sample applications</a><ul><li class="level2"><a href="#spring_linear_elasticity">Elasticity problem</a></li>
<li class="level2"><a href="#spring_nonlinear_elasticity">Nonlinear elasticity problem</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="spring_element_introduction"></a>
Introduction</h1>
<p>This tutorial presents the implementation of spring elements in <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>. The spring elements are used to model the interaction between the structure being considered and other structures in surrounding environment. In contrast to other type of boundary conditions where the displacements/rotations at the surface of contact are fixed, the spring boundary condition allows the surface to move during the analysis which in turn creates reaction forces acting on the structure at the boundary surface. The magnitude of this force is changed propotionally to the spring stiffness and the extension or contraction in its length. <a class="el" href="spring_element.html#figure_spring_elastic_foundation">Figure 1</a> illustrates a plate bearing load \( q \) sits on elastic foundation which is modelled by springs with stiffness \( k_s \).</p>
<p><a class="anchor" id="figure_spring_elastic_foundation"></a></p><div class="image">
<img src="elastic_foundation.png" alt="" width="400px"/>
<div class="caption">
Figure 1: Plate on elastic foundation modelled by springs</div></div>
<p>The remaining of this tutorial is organised as follows. The next section describes the finite element formulation of the spring element where its contributions to the right-hand side (RHS) and the left-hand side (LHS) are presented. It is followed by the description of the implementation of spring element in the platform of <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>. The following section closes this tutorial by showing sample implementations of spring elements to the elasticity and nonlinear elasticity modules.</p>
<h1><a class="anchor" id="spring_fe_formulation"></a>
Formulation</h1>
<p>The finite element formulation of the spring element contributing to RHS and LHS can be respectively derived as follows  </p><p class="formulaDsp">
\[
    \begin{align}
        f_s &amp;=  \int\limits_{\Gamma }^{} {{\psi ^T}{F^s}\left( u
        \right)d\Gamma }  = \int\limits_{\Gamma }^{} {{\psi
        ^T}{k_s} u d \Gamma }, \\
        {K^s} &amp;= \int\limits_\Gamma ^{} {{\psi ^T}{k_s}\psi d\Gamma }.
    \end{align}
 \]
</p>
<p> where \( \Gamma \) is the domain occupied by the surface with springs, \(
 \psi \) is approximation function, \( k_s \) denotes spring stiffness, and \( u \) is the extension/contraction of the spring which can be calculated by the displacement of the point on the surface where spring is applied. Physically, \( k_s \) can be considered as spring density on the surface.</p>
<h1><a class="anchor" id="spring_implementation"></a>
Implementation</h1>
<p>In the platform of <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, the implementation of user data operators (UDO) for spring boundary conditions can be found in SpringElement.cpp and SpringElement.hpp. Particularly, the operators OpSpringFs and OpSpringKs are developed to calculate the contribution of springs to the RHS and LHS of the system of equations, respectively.</p>
<h2><a class="anchor" id="spring_opspringfs"></a>
Operator OpSpringFs for the RHS</h2>
<ul>
<li>The operator OpSpringFs is a class that inherits from another class of <a class="el" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html" title="default operator for TRI element">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator</a>. It is worth noting that, in the current implementation, springs are applied on face elements only. <div class="fragment"><div class="line"><span class="keyword">struct </span>OpSpringFs : <a class="code hl_struct" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator</a> {</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="ttc" id="astructMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator_html"><div class="ttname"><a href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator</a></div><div class="ttdoc">default operator for TRI element</div><div class="ttdef"><b>Definition</b> <a href="FaceElementForcesAndSourcesCore_8hpp_source.html#l00094">FaceElementForcesAndSourcesCore.hpp:95</a></div></div>
</div><!-- fragment --></li>
<li>Public members include (1) <em>nF</em> is a sub-vector that stores force at each degree of freedom, (2) <em>commonDataPtr</em> pointing to spring data associated with Gauss points, (3) <em>dAta</em> contains block data, and (4) <em>is_spatial_position</em> being a flag to check the field name, e.g. SPATIAL_POSITION or DISPLACEMENT, which later be used to determine the displacements at Gauss points. <div class="fragment"><div class="line"><span class="comment">// vector used to store force vector for each degree of freedom</span></div>
<div class="line">  VectorDouble nF;</div>
<div class="line">  </div>
<div class="line">  boost::shared_ptr&lt;DataAtIntegrationPtsSprings&gt; commonDataPtr;</div>
<div class="line">  BlockOptionDataSprings &amp;dAta;</div>
<div class="line">  <span class="keywordtype">bool</span> is_spatial_position = <span class="keyword">true</span>;</div>
</div><!-- fragment --></li>
<li>Then, the OpSpringFs constructor is implemented <div class="fragment"><div class="line">OpSpringFs(boost::shared_ptr&lt;DataAtIntegrationPtsSprings&gt; &amp;common_data_ptr,</div>
<div class="line">           BlockOptionDataSprings &amp;data, <span class="keyword">const</span> std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>)</div>
<div class="line">    : <a class="code hl_namespace" href="namespaceMoFEM.html">MoFEM</a>::FaceElementForcesAndSourcesCore::<a class="code hl_class" href="classUserDataOperator.html">UserDataOperator</a>(</div>
<div class="line">          <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>.c_str(), OPROW),</div>
<div class="line">      commonDataPtr(common_data_ptr), dAta(data) {</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>.compare(0, 16, <span class="stringliteral">&quot;SPATIAL_POSITION&quot;</span>) != 0)</div>
<div class="line">    is_spatial_position = <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassUserDataOperator_html"><div class="ttname"><a href="classUserDataOperator.html">UserDataOperator</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html"><div class="ttname"><a href="namespaceMoFEM.html">MoFEM</a></div><div class="ttdoc">implementation of Data Operators for Forces and Sources</div><div class="ttdef"><b>Definition</b> <a href="Common_8hpp_source.html#l00010">Common.hpp:10</a></div></div>
<div class="ttc" id="apoisson__2d__homogeneous_8cpp_html_a3917f3987bad1f4e24b85c9d0ab84a5e"><div class="ttname"><a href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a></div><div class="ttdeci">constexpr auto field_name</div><div class="ttdef"><b>Definition</b> <a href="poisson__2d__homogeneous_8cpp_source.html#l00013">poisson_2d_homogeneous.cpp:13</a></div></div>
</div><!-- fragment --></li>
<li>Finally, the OpSpringFs::doWork method of the OpSpringFs operator is implemented as follows <br  />
 <div class="fragment"><div class="line">MoFEMErrorCode doWork(<span class="keywordtype">int</span> side, EntityType type,</div>
<div class="line">                      EntitiesFieldData::EntData &amp;data) {</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// check that the faces have associated degrees of freedom</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_dofs = data.getIndices().size();</div>
<div class="line">  <span class="keywordflow">if</span> (nb_dofs == 0)</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (dAta.tRis.find(getNumeredEntFiniteElementPtr()-&gt;getEnt()) ==</div>
<div class="line">      dAta.tRis.end()) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> commonDataPtr-&gt;getBlockData(dAta);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// size of force vector associated to the entity</span></div>
<div class="line">  <span class="comment">// set equal to the number of degrees of freedom of associated with the</span></div>
<div class="line">  <span class="comment">// entity</span></div>
<div class="line">  nF.resize(nb_dofs, <span class="keyword">false</span>);</div>
<div class="line">  nF.clear();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// get number of Gauss points</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> nb_gauss_pts = data.getN().size1();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// get intergration weights</span></div>
<div class="line">  <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// FTensor indices</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;i&#39;</span>, 3&gt; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;j&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;k&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>;</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_local(</div>
<div class="line">      commonDataPtr-&gt;springStiffnessNormal, 0., 0., 0.,</div>
<div class="line">      commonDataPtr-&gt;springStiffnessTangent, 0., 0., 0.,</div>
<div class="line">      commonDataPtr-&gt;springStiffnessTangent);</div>
<div class="line">  <span class="comment">// create a 3d vector to be used as the normal to the face with length equal</span></div>
<div class="line">  <span class="comment">// to the face area</span></div>
<div class="line">  <span class="keyword">auto</span> t_normal_ptr = getFTensor1Normal();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_normal;</div>
<div class="line">  t_normal(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = t_normal_ptr(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// First tangent vector</span></div>
<div class="line">  <span class="keyword">auto</span> t_tangent1_ptr = getFTensor1Tangent1AtGaussPts();</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent1;</div>
<div class="line">  t_tangent1(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = t_tangent1_ptr(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Second tangent vector, such that t_n = t_t1 x t_t2 | t_t2 = t_n x t_t1</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent2;</div>
<div class="line">  t_tangent2(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = <a class="code hl_function" href="namespaceFTensor.html#a50ff153c38920d1001276f5d857e0599">FTensor::levi_civita</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>) * t_normal(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) * t_tangent1(<a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Spring stiffness in global coordinate</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_global;</div>
<div class="line">  t_spring_global = MetaSpringBC::transformLocalToGlobal(</div>
<div class="line">      t_normal, t_tangent1, t_tangent2, t_spring_local);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Extract solution at Gauss points</span></div>
<div class="line">  <span class="keyword">auto</span> t_solution_at_gauss_point =</div>
<div class="line">      getFTensor1FromMat&lt;3&gt;(*commonDataPtr-&gt;xAtPts);</div>
<div class="line">  <span class="keyword">auto</span> t_init_solution_at_gauss_point =</div>
<div class="line">      getFTensor1FromMat&lt;3&gt;(*commonDataPtr-&gt;xInitAtPts);</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_displacement_at_gauss_point;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// loop over all Gauss points of the face</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != nb_gauss_pts; ++gg) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate the displacement at the Gauss point</span></div>
<div class="line">    <span class="keywordflow">if</span> (is_spatial_position) { <span class="comment">// &quot;SPATIAL_POSITION&quot;</span></div>
<div class="line">      t_displacement_at_gauss_point(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) =</div>
<div class="line">          t_solution_at_gauss_point(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) - t_init_solution_at_gauss_point(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line">    } <span class="keywordflow">else</span> { <span class="comment">// e.g. &quot;DISPLACEMENT&quot; or &quot;U&quot;</span></div>
<div class="line">      t_displacement_at_gauss_point(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = t_solution_at_gauss_point(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code hl_variable" href="namespacesdf__wavy__2d.html#ab736ce7138c0ba29f61877ebea4f2bc6">w</a> = t_w * getArea();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> t_base_func = data.getFTensor0N(gg, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// create a vector t_nf whose pointer points an array of 3 pointers</span></div>
<div class="line">    <span class="comment">// pointing to nF  memory location of components</span></div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;FTensor::PackPtr&lt;double *, 3&gt;</a>, 3&gt; t_nf(&amp;nF[0], &amp;nF[1],</div>
<div class="line">                                                            &amp;nF[2]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != nb_dofs / 3; ++rr) { <span class="comment">// loop over the nodes</span></div>
<div class="line">      t_nf(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) += <a class="code hl_variable" href="namespacesdf__wavy__2d.html#ab736ce7138c0ba29f61877ebea4f2bc6">w</a> * t_base_func * t_spring_global(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) *</div>
<div class="line">                 t_displacement_at_gauss_point(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// move to next base function</span></div>
<div class="line">      ++t_base_func;</div>
<div class="line">      <span class="comment">// move the pointer to next element of t_nf</span></div>
<div class="line">      ++t_nf;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// move to next integration weight</span></div>
<div class="line">    ++t_w;</div>
<div class="line">    <span class="comment">// move to the solutions at the next Gauss point</span></div>
<div class="line">    ++t_solution_at_gauss_point;</div>
<div class="line">    ++t_init_solution_at_gauss_point;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// add computed values of spring in the global right hand side vector</span></div>
<div class="line">  <a class="code hl_typedef" href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">Vec</a> <a class="code hl_variable" href="namespaceHenckyOps.html#a990086ab6bdc667b830a40f0ffb74aa3">f</a> = getFEMethod()-&gt;ksp_f != PETSC_NULLPTR ? getFEMethod()-&gt;ksp_f</div>
<div class="line">                                             : getFEMethod()-&gt;snes_f;</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#aef01d33cbe1d8ed916ce789bd25c4495">VecSetValues</a>(f, nb_dofs, &amp;data.getIndices()[0], &amp;nF[0], ADD_VALUES);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="aclassFTensor_1_1Index_html"><div class="ttname"><a href="classFTensor_1_1Index.html">FTensor::Index</a></div><div class="ttdef"><b>Definition</b> <a href="Index_8hpp_source.html#l00023">Index.hpp:24</a></div></div>
<div class="ttc" id="aclassFTensor_1_1Tensor1_html"><div class="ttname"><a href="classFTensor_1_1Tensor1.html">FTensor::Tensor1</a></div><div class="ttdef"><b>Definition</b> <a href="Tensor1__value_8hpp_source.html#l00008">Tensor1_value.hpp:9</a></div></div>
<div class="ttc" id="aclassFTensor_1_1Tensor2_html"><div class="ttname"><a href="classFTensor_1_1Tensor2.html">FTensor::Tensor2</a></div><div class="ttdef"><b>Definition</b> <a href="Tensor2__value_8hpp_source.html#l00016">Tensor2_value.hpp:17</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a59cd650c2f6d3e0dc1ad1c29821e8692"><div class="ttname"><a href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a></div><div class="ttdeci">#define MoFEMFunctionReturnHot(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00463">definitions.h:463</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a6c0b52978f1abc88bf8a1ba70b7308e3"><div class="ttname"><a href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a></div><div class="ttdeci">#define MoFEMFunctionBegin</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00359">definitions.h:359</a></div></div>
<div class="ttc" id="adefinitions_8h_html_acb0a46d159695a01bf667313b7788b45"><div class="ttname"><a href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a></div><div class="ttdeci">#define MoFEMFunctionReturn(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00432">definitions.h:432</a></div></div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00551">definitions.h:551</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a8191f28ba278df9c5d32a75cadb2bbd5"><div class="ttname"><a href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a></div><div class="ttdeci">FTensor::Index&lt; 'j', 3 &gt; j</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00019">matrix_function.cpp:19</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_ac93d777bbf9336cad5c09007df789c95"><div class="ttname"><a href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a></div><div class="ttdeci">FTensor::Index&lt; 'k', 3 &gt; k</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00020">matrix_function.cpp:20</a></div></div>
<div class="ttc" id="anamespaceEigenMatrix_html_a34cd82caee17a35f38d6df0cf87ee75b"><div class="ttname"><a href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">EigenMatrix::Vec</a></div><div class="ttdeci">const FTensor::Tensor2&lt; T, Dim, Dim &gt; Vec</div><div class="ttdef"><b>Definition</b> <a href="MatrixFunction_8hpp_source.html#l00064">MatrixFunction.hpp:64</a></div></div>
<div class="ttc" id="anamespaceFTensor_html_a50ff153c38920d1001276f5d857e0599"><div class="ttname"><a href="namespaceFTensor.html#a50ff153c38920d1001276f5d857e0599">FTensor::levi_civita</a></div><div class="ttdeci">constexpr std::enable_if&lt;(Dim0&lt;=2 &amp;&amp;Dim1&lt;=2), Tensor2_Expr&lt; Levi_Civita&lt; T &gt;, T, Dim0, Dim1, i, j &gt; &gt;::type levi_civita(const Index&lt; i, Dim0 &gt; &amp;, const Index&lt; j, Dim1 &gt; &amp;)</div><div class="ttdoc">levi_civita functions to make for easy adhoc use</div><div class="ttdef"><b>Definition</b> <a href="Levi__Civita_8hpp_source.html#l00617">Levi_Civita.hpp:617</a></div></div>
<div class="ttc" id="anamespaceHenckyOps_html_a990086ab6bdc667b830a40f0ffb74aa3"><div class="ttname"><a href="namespaceHenckyOps.html#a990086ab6bdc667b830a40f0ffb74aa3">HenckyOps::f</a></div><div class="ttdeci">auto f</div><div class="ttdef"><b>Definition</b> <a href="HenckyOps_8hpp_source.html#l00015">HenckyOps.hpp:15</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_aef01d33cbe1d8ed916ce789bd25c4495"><div class="ttname"><a href="namespaceMoFEM.html#aef01d33cbe1d8ed916ce789bd25c4495">MoFEM::VecSetValues</a></div><div class="ttdeci">MoFEMErrorCode VecSetValues(Vec V, const EntitiesFieldData::EntData &amp;data, const double *ptr, InsertMode iora)</div><div class="ttdoc">Assemble PETSc vector.</div><div class="ttdef"><b>Definition</b> <a href="EntitiesFieldData_8hpp_source.html#l01589">EntitiesFieldData.hpp:1589</a></div></div>
<div class="ttc" id="anamespacesdf__wavy__2d_html_ab736ce7138c0ba29f61877ebea4f2bc6"><div class="ttname"><a href="namespacesdf__wavy__2d.html#ab736ce7138c0ba29f61877ebea4f2bc6">sdf_wavy_2d.w</a></div><div class="ttdeci">int w</div><div class="ttdef"><b>Definition</b> <a href="sdf__wavy__2d_8py_source.html#l00006">sdf_wavy_2d.py:6</a></div></div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="spring_opspringks"></a>
Operator OpSpringKs for the LHS</h2>
<p>Similarly to the previous part, the operator OpSpringKs which calculates the contribution of the spring elements to the LHS is implemented as follows </p><div class="fragment"><div class="line"><span class="keyword">struct </span>OpSpringKs : <a class="code hl_struct" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator</a> {</div>
<div class="line"> </div>
<div class="line">  boost::shared_ptr&lt;DataAtIntegrationPtsSprings&gt; commonDataPtr;</div>
<div class="line">  BlockOptionDataSprings &amp;dAta;</div>
<div class="line"> </div>
<div class="line">  MatrixDouble locKs;</div>
<div class="line">  MatrixDouble transLocKs;</div>
<div class="line"> </div>
<div class="line">  OpSpringKs(boost::shared_ptr&lt;DataAtIntegrationPtsSprings&gt; &amp;common_data_ptr,</div>
<div class="line">             BlockOptionDataSprings &amp;data, <span class="keyword">const</span> std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>)</div>
<div class="line">      : <a class="code hl_namespace" href="namespaceMoFEM.html">MoFEM</a>::FaceElementForcesAndSourcesCore::<a class="code hl_class" href="classUserDataOperator.html">UserDataOperator</a>(</div>
<div class="line">            <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>.c_str(), <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>.c_str(), OPROWCOL),</div>
<div class="line">        commonDataPtr(common_data_ptr), dAta(data) {}</div>
<div class="line"> </div>
<div class="line">  MoFEMErrorCode <a class="code hl_function" href="structMoFEM_1_1DataOperator.html#a19219f04bba3938fd893898f128dcfb2">doWork</a>(<span class="keywordtype">int</span> row_side, <span class="keywordtype">int</span> col_side, EntityType row_type,</div>
<div class="line">                        EntityType col_type,</div>
<div class="line">                        EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                        EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// check if the volumes have associated degrees of freedom</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> row_nb_dofs = row_data.getIndices().size();</div>
<div class="line">    <span class="keywordflow">if</span> (!row_nb_dofs)</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> col_nb_dofs = col_data.getIndices().size();</div>
<div class="line">    <span class="keywordflow">if</span> (!col_nb_dofs)</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dAta.tRis.find(getNumeredEntFiniteElementPtr()-&gt;getEnt()) ==</div>
<div class="line">        dAta.tRis.end()) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> commonDataPtr-&gt;getBlockData(dAta);</div>
<div class="line">    <span class="comment">// size associated to the entity</span></div>
<div class="line">    locKs.resize(row_nb_dofs, col_nb_dofs, <span class="keyword">false</span>);</div>
<div class="line">    locKs.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get number of Gauss points</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> row_nb_gauss_pts = row_data.getN().size1();</div>
<div class="line">    <span class="keywordflow">if</span> (!row_nb_gauss_pts) <span class="comment">// check if number of Gauss point &lt;&gt; 0</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> row_nb_base_functions = row_data.getN().size2();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get intergration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = <a class="code hl_function" href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#a8d917e73cbaa9f177cdea72e1e7500dd">getFTensor0IntegrationWeight</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;i&#39;</span>, 3&gt; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;j&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;k&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>;</div>
<div class="line">    <span class="keyword">auto</span> get_tensor2 = [](MatrixDouble &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> r, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a>) {</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double *, 3, 3&gt;</a>(</div>
<div class="line">          &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 0, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 0), &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 0, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 1),</div>
<div class="line">          &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 0, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 2), &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 1, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 0),</div>
<div class="line">          &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 1, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 1), &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 1, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 2),</div>
<div class="line">          &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 2, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 0), &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 2, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 1),</div>
<div class="line">          &amp;<a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a>(3 * r + 2, 3 * <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> + 2));</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_local(</div>
<div class="line">        commonDataPtr-&gt;springStiffnessNormal, 0., 0., 0.,</div>
<div class="line">        commonDataPtr-&gt;springStiffnessTangent, 0., 0., 0.,</div>
<div class="line">        commonDataPtr-&gt;springStiffnessTangent);</div>
<div class="line">    <span class="comment">// create a 3d vector to be used as the normal to the face with length equal</span></div>
<div class="line">    <span class="comment">// to the face area</span></div>
<div class="line">    <span class="keyword">auto</span> t_normal_ptr = <a class="code hl_function" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#ab64719450dbeb9e309b870112d919b21">getFTensor1Normal</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_normal;</div>
<div class="line">    t_normal(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = t_normal_ptr(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// First tangent vector</span></div>
<div class="line">    <span class="keyword">auto</span> t_tangent1_ptr = <a class="code hl_function" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#af8475d6c8a263e00c0f00a8f190a9a35">getFTensor1Tangent1AtGaussPts</a>();</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent1;</div>
<div class="line">    t_tangent1(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = t_tangent1_ptr(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Second tangent vector, such that t_n = t_t1 x t_t2 | t_t2 = t_n x t_t1</span></div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent2;</div>
<div class="line">    t_tangent2(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) = <a class="code hl_function" href="namespaceFTensor.html#a50ff153c38920d1001276f5d857e0599">FTensor::levi_civita</a>(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>) * t_normal(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) * t_tangent1(<a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Spring stiffness in global coordinate</span></div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_global;</div>
<div class="line">    t_spring_global = MetaSpringBC::transformLocalToGlobal(</div>
<div class="line">        t_normal, t_tangent1, t_tangent2, t_spring_local);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// loop over the Gauss points</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != row_nb_gauss_pts; gg++) {</div>
<div class="line">      <span class="comment">// get area and integration weight</span></div>
<div class="line">      <span class="keywordtype">double</span> <a class="code hl_variable" href="namespacesdf__wavy__2d.html#ab736ce7138c0ba29f61877ebea4f2bc6">w</a> = t_w * <a class="code hl_function" href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#a4f30530b3cf454259c47b48c117764a3">getArea</a>();</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">auto</span> t_row_base_func = row_data.getFTensor0N(gg, 0);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != row_nb_dofs / 3; rr++) {</div>
<div class="line">        <span class="keyword">auto</span> t_col_base_func = col_data.getFTensor0N(gg, 0);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc != col_nb_dofs / 3; cc++) {</div>
<div class="line">          <span class="keyword">auto</span> assemble_m = get_tensor2(locKs, rr, cc);</div>
<div class="line">          assemble_m(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) +=</div>
<div class="line">              <a class="code hl_variable" href="namespacesdf__wavy__2d.html#ab736ce7138c0ba29f61877ebea4f2bc6">w</a> * t_row_base_func * t_col_base_func * t_spring_global(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>);</div>
<div class="line">          ++t_col_base_func;</div>
<div class="line">        }</div>
<div class="line">        ++t_row_base_func;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// move to next integration weight</span></div>
<div class="line">      ++t_w;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add computed values of spring stiffness to the global LHS matrix</span></div>
<div class="line">    Mat <a class="code hl_class" href="classB.html">B</a> = <a class="code hl_function" href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#acfe45d604c4b50bc9a6ecb79102c931f">getFEMethod</a>()-&gt;<a class="code hl_variable" href="structMoFEM_1_1KspMethod.html#a18d603d8a983e8aba704d4c38f809b4c">ksp_B</a> != PETSC_NULLPTR ? <a class="code hl_function" href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#acfe45d604c4b50bc9a6ecb79102c931f">getFEMethod</a>()-&gt;<a class="code hl_variable" href="structMoFEM_1_1KspMethod.html#a18d603d8a983e8aba704d4c38f809b4c">ksp_B</a></div>
<div class="line">                                               : <a class="code hl_function" href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#acfe45d604c4b50bc9a6ecb79102c931f">getFEMethod</a>()-&gt;<a class="code hl_variable" href="structMoFEM_1_1SnesMethod.html#abe24f80bfa98800b9c3b1ad28ffb2b4e">snes_B</a>;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MatSetValues</a>(<a class="code hl_class" href="classB.html">B</a>, row_nb_dofs, &amp;*row_data.getIndices().begin(),</div>
<div class="line">                        col_nb_dofs, &amp;*col_data.getIndices().begin(),</div>
<div class="line">                        &amp;locKs(0, 0), ADD_VALUES);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// is symmetric</span></div>
<div class="line">    <span class="keywordflow">if</span> (row_side != col_side || row_type != col_type) {</div>
<div class="line">      transLocKs.resize(col_nb_dofs, row_nb_dofs, <span class="keyword">false</span>);</div>
<div class="line">      noalias(transLocKs) = trans(locKs);</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MatSetValues</a>(<a class="code hl_class" href="classB.html">B</a>, col_nb_dofs, &amp;*col_data.getIndices().begin(),</div>
<div class="line">                          row_nb_dofs, &amp;*row_data.getIndices().begin(),</div>
<div class="line">                          &amp;transLocKs(0, 0), ADD_VALUES);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="aclassB_html"><div class="ttname"><a href="classB.html">B</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_a8fc6defe4e499b1b9b9c275689e44352"><div class="ttname"><a href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a></div><div class="ttdeci">const double c</div><div class="ttdoc">speed of light (cm/ns)</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00039">initial_diffusion.cpp:39</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a9c8c990b46b2b3994e4971b70f340074"><div class="ttname"><a href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MoFEM::MatSetValues</a></div><div class="ttdeci">MoFEMErrorCode MatSetValues(Mat M, const EntitiesFieldData::EntData &amp;row_data, const EntitiesFieldData::EntData &amp;col_data, const double *ptr, InsertMode iora)</div><div class="ttdoc">Assemble PETSc matrix.</div><div class="ttdef"><b>Definition</b> <a href="EntitiesFieldData_8hpp_source.html#l01644">EntitiesFieldData.hpp:1644</a></div></div>
<div class="ttc" id="ashallow__wave_8cpp_html_ac1bb4bfd31a408c2fed3ca69bcad99fc"><div class="ttname"><a href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a></div><div class="ttdeci">FTensor::Index&lt; 'm', 3 &gt; m</div><div class="ttdef"><b>Definition</b> <a href="shallow__wave_8cpp_source.html#l00080">shallow_wave.cpp:80</a></div></div>
<div class="ttc" id="astructMoFEM_1_1DataOperator_html_a19219f04bba3938fd893898f128dcfb2"><div class="ttname"><a href="structMoFEM_1_1DataOperator.html#a19219f04bba3938fd893898f128dcfb2">MoFEM::DataOperator::doWork</a></div><div class="ttdeci">virtual MoFEMErrorCode doWork(int row_side, int col_side, EntityType row_type, EntityType col_type, EntitiesFieldData::EntData &amp;row_data, EntitiesFieldData::EntData &amp;col_data)</div><div class="ttdoc">Operator for bi-linear form, usually to calculate values on left hand side.</div><div class="ttdef"><b>Definition</b> <a href="DataOperators_8hpp_source.html#l00040">DataOperators.hpp:40</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator_html_a4f30530b3cf454259c47b48c117764a3"><div class="ttname"><a href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#a4f30530b3cf454259c47b48c117764a3">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator::getArea</a></div><div class="ttdeci">double getArea()</div><div class="ttdoc">get area of face</div><div class="ttdef"><b>Definition</b> <a href="FaceElementForcesAndSourcesCore_8hpp_source.html#l00239">FaceElementForcesAndSourcesCore.hpp:239</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator_html_ab64719450dbeb9e309b870112d919b21"><div class="ttname"><a href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#ab64719450dbeb9e309b870112d919b21">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator::getFTensor1Normal</a></div><div class="ttdeci">auto getFTensor1Normal()</div><div class="ttdoc">get normal as tensor</div><div class="ttdef"><b>Definition</b> <a href="FaceElementForcesAndSourcesCore_8hpp_source.html#l00255">FaceElementForcesAndSourcesCore.hpp:255</a></div></div>
<div class="ttc" id="astructMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator_html_af8475d6c8a263e00c0f00a8f190a9a35"><div class="ttname"><a href="structMoFEM_1_1FaceElementForcesAndSourcesCore_1_1UserDataOperator.html#af8475d6c8a263e00c0f00a8f190a9a35">MoFEM::FaceElementForcesAndSourcesCore::UserDataOperator::getFTensor1Tangent1AtGaussPts</a></div><div class="ttdeci">auto getFTensor1Tangent1AtGaussPts()</div><div class="ttdoc">get tangent 1 at integration points</div><div class="ttdef"><b>Definition</b> <a href="FaceElementForcesAndSourcesCore_8hpp_source.html#l00322">FaceElementForcesAndSourcesCore.hpp:323</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator_html_a8d917e73cbaa9f177cdea72e1e7500dd"><div class="ttname"><a href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#a8d917e73cbaa9f177cdea72e1e7500dd">MoFEM::ForcesAndSourcesCore::UserDataOperator::getFTensor0IntegrationWeight</a></div><div class="ttdeci">auto getFTensor0IntegrationWeight()</div><div class="ttdoc">Get integration weights.</div><div class="ttdef"><b>Definition</b> <a href="ForcesAndSourcesCore_8hpp_source.html#l01257">ForcesAndSourcesCore.hpp:1257</a></div></div>
<div class="ttc" id="astructMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator_html_acfe45d604c4b50bc9a6ecb79102c931f"><div class="ttname"><a href="structMoFEM_1_1ForcesAndSourcesCore_1_1UserDataOperator.html#acfe45d604c4b50bc9a6ecb79102c931f">MoFEM::ForcesAndSourcesCore::UserDataOperator::getFEMethod</a></div><div class="ttdeci">const FEMethod * getFEMethod() const</div><div class="ttdoc">Return raw pointer to Finite Element Method object.</div><div class="ttdef"><b>Definition</b> <a href="ForcesAndSourcesCore_8hpp_source.html#l01059">ForcesAndSourcesCore.hpp:1059</a></div></div>
<div class="ttc" id="astructMoFEM_1_1KspMethod_html_a18d603d8a983e8aba704d4c38f809b4c"><div class="ttname"><a href="structMoFEM_1_1KspMethod.html#a18d603d8a983e8aba704d4c38f809b4c">MoFEM::KspMethod::ksp_B</a></div><div class="ttdeci">Mat &amp; ksp_B</div><div class="ttdef"><b>Definition</b> <a href="LoopMethods_8hpp_source.html#l00094">LoopMethods.hpp:94</a></div></div>
<div class="ttc" id="astructMoFEM_1_1SnesMethod_html_abe24f80bfa98800b9c3b1ad28ffb2b4e"><div class="ttname"><a href="structMoFEM_1_1SnesMethod.html#abe24f80bfa98800b9c3b1ad28ffb2b4e">MoFEM::SnesMethod::snes_B</a></div><div class="ttdeci">Mat &amp; snes_B</div><div class="ttdoc">preconditioner of jacobian matrix</div><div class="ttdef"><b>Definition</b> <a href="LoopMethods_8hpp_source.html#l00128">LoopMethods.hpp:128</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="spring_other_function"></a>
Other functions</h2>
<h3><a class="anchor" id="spring_declaration_function"></a>
Declaration of spring elements</h3>
<p>This function declares the spring element allowing the implementation of the spring element in the main program of a module become more straightforward.</p>
<div class="fragment"><div class="line">MoFEMErrorCode</div>
<div class="line">MetaSpringBC::addSpringElements(<a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field,</div>
<div class="line">                                <span class="keyword">const</span> std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>,</div>
<div class="line">                                <span class="keyword">const</span> std::string mesh_nodals_positions) {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Define boundary element that operates on rows, columns and data of a</span></div>
<div class="line">  <span class="comment">// given field</span></div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga4a5b822f605f1a4faa668595a3f2a5ae">add_finite_element</a>(<span class="stringliteral">&quot;SPRING&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gad29d66fc5706d3b20e4acd02eac81c9d">modify_finite_element_add_field_row</a>(<span class="stringliteral">&quot;SPRING&quot;</span>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga8a9935d6f31d07ed365e6cc76bd041d2">modify_finite_element_add_field_col</a>(<span class="stringliteral">&quot;SPRING&quot;</span>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">modify_finite_element_add_field_data</a>(<span class="stringliteral">&quot;SPRING&quot;</span>, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="group__mofem__field.html#gad43a6631f7d465ad31403cbb1d1896ba">check_field</a>(mesh_nodals_positions)) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">modify_finite_element_add_field_data</a>(<span class="stringliteral">&quot;SPRING&quot;</span>,</div>
<div class="line">                                                        mesh_nodals_positions);</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Add entities to that element, here we add all triangles with SPRING_BC</span></div>
<div class="line">  <span class="comment">// from cubit</span></div>
<div class="line">  <span class="keywordflow">for</span> (<a class="code hl_define" href="group__mofem__meshset__mng.html#gaff36ed0367e6b0a57541419546aa1323">_IT_CUBITMESHSETS_BY_SET_TYPE_FOR_LOOP_</a>(m_field, <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a>, <a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a>)) {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a>-&gt;getName().compare(0, 9, <span class="stringliteral">&quot;SPRING_BC&quot;</span>) == 0) {</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gacbb3bbf1fa80b85848bc3cfcd604182b">add_ents_to_finite_element_by_type</a>(<a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a>-&gt;getMeshset(),</div>
<div class="line">                                                        MBTRI, <span class="stringliteral">&quot;SPRING&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a></div><div class="ttdeci">@ BLOCKSET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00161">definitions.h:161</a></div></div>
<div class="ttc" id="agroup__mofem__fe_html_ga4a5b822f605f1a4faa668595a3f2a5ae"><div class="ttname"><a href="group__mofem__fe.html#ga4a5b822f605f1a4faa668595a3f2a5ae">MoFEM::CoreInterface::add_finite_element</a></div><div class="ttdeci">virtual MoFEMErrorCode add_finite_element(const std::string &amp;fe_name, enum MoFEMTypes bh=MF_EXCL, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">add finite element</div></div>
<div class="ttc" id="agroup__mofem__fe_html_ga8a9935d6f31d07ed365e6cc76bd041d2"><div class="ttname"><a href="group__mofem__fe.html#ga8a9935d6f31d07ed365e6cc76bd041d2">MoFEM::CoreInterface::modify_finite_element_add_field_col</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_col(const std::string &amp;fe_name, const std::string name_row)=0</div><div class="ttdoc">set field col which finite element use</div></div>
<div class="ttc" id="agroup__mofem__fe_html_gacbb3bbf1fa80b85848bc3cfcd604182b"><div class="ttname"><a href="group__mofem__fe.html#gacbb3bbf1fa80b85848bc3cfcd604182b">MoFEM::CoreInterface::add_ents_to_finite_element_by_type</a></div><div class="ttdeci">virtual MoFEMErrorCode add_ents_to_finite_element_by_type(const EntityHandle entities, const EntityType type, const std::string name, const bool recursive=true)=0</div><div class="ttdoc">add entities to finite element</div></div>
<div class="ttc" id="agroup__mofem__fe_html_gad29d66fc5706d3b20e4acd02eac81c9d"><div class="ttname"><a href="group__mofem__fe.html#gad29d66fc5706d3b20e4acd02eac81c9d">MoFEM::CoreInterface::modify_finite_element_add_field_row</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_row(const std::string &amp;fe_name, const std::string name_row)=0</div><div class="ttdoc">set field row which finite element use</div></div>
<div class="ttc" id="agroup__mofem__fe_html_gaef2eb2d85b90b55bd7c4f355e10fa498"><div class="ttname"><a href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">MoFEM::CoreInterface::modify_finite_element_add_field_data</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_data(const std::string &amp;fe_name, const std::string name_field)=0</div><div class="ttdoc">set finite element field data</div></div>
<div class="ttc" id="agroup__mofem__field_html_gad43a6631f7d465ad31403cbb1d1896ba"><div class="ttname"><a href="group__mofem__field.html#gad43a6631f7d465ad31403cbb1d1896ba">MoFEM::CoreInterface::check_field</a></div><div class="ttdeci">virtual bool check_field(const std::string &amp;name) const =0</div><div class="ttdoc">check if field is in database</div></div>
<div class="ttc" id="agroup__mofem__meshset__mng_html_gaff36ed0367e6b0a57541419546aa1323"><div class="ttname"><a href="group__mofem__meshset__mng.html#gaff36ed0367e6b0a57541419546aa1323">_IT_CUBITMESHSETS_BY_SET_TYPE_FOR_LOOP_</a></div><div class="ttdeci">#define _IT_CUBITMESHSETS_BY_SET_TYPE_FOR_LOOP_(MESHSET_MANAGER, CUBITBCTYPE, IT)</div><div class="ttdoc">Iterator that loops over a specific Cubit MeshSet having a particular BC meshset in a moFEM field.</div><div class="ttdef"><b>Definition</b> <a href="MeshsetsManager_8hpp_source.html#l00071">MeshsetsManager.hpp:71</a></div></div>
<div class="ttc" id="ahanging__node__approx_8cpp_html_ae63ebbb5e1ef5e0a8b9872228c595f8c"><div class="ttname"><a href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a></div><div class="ttdeci">auto bit</div><div class="ttdoc">set bit</div><div class="ttdef"><b>Definition</b> <a href="hanging__node__approx_8cpp_source.html#l00075">hanging_node_approx.cpp:75</a></div></div>
<div class="ttc" id="astructMoFEM_1_1DeprecatedCoreInterface_html"><div class="ttname"><a href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition</b> <a href="DeprecatedCoreInterface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="spring_set_operator_function"></a>
Pushing operators to finite element instances</h3>
<p>With same motivation as the previous function, this function which pushes implemented operators (OpSpringKs, OpSpringFs) to the finite element instances makes the implementation in different module easier.</p>
<div class="fragment"><div class="line">MoFEMErrorCode MetaSpringBC::setSpringOperators(</div>
<div class="line">    <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field,</div>
<div class="line">    boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_lhs_ptr,</div>
<div class="line">    boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_rhs_ptr,</div>
<div class="line">    <span class="keyword">const</span> std::string <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, <span class="keyword">const</span> std::string mesh_nodals_positions) {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Push operators to instances for springs</span></div>
<div class="line">  <span class="comment">// loop over blocks</span></div>
<div class="line">  boost::shared_ptr&lt;DataAtIntegrationPtsSprings&gt; commonDataPtr =</div>
<div class="line">      boost::make_shared&lt;DataAtIntegrationPtsSprings&gt;(m_field);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> commonDataPtr-&gt;getParameters();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;sitSpring : commonDataPtr-&gt;mapSpring) {</div>
<div class="line">    fe_spring_lhs_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpSpringKs(commonDataPtr, sitSpring.second, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line"> </div>
<div class="line">    fe_spring_rhs_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpCalculateVectorFieldValues&lt;3&gt;(<a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>, commonDataPtr-&gt;xAtPts));</div>
<div class="line">    fe_spring_rhs_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpCalculateVectorFieldValues&lt;3&gt;(mesh_nodals_positions,</div>
<div class="line">                                            commonDataPtr-&gt;xInitAtPts));</div>
<div class="line">    fe_spring_rhs_ptr-&gt;getOpPtrVector().push_back(</div>
<div class="line">        <span class="keyword">new</span> OpSpringFs(commonDataPtr, sitSpring.second, <a class="code hl_variable" href="poisson__2d__homogeneous_8cpp.html#a3917f3987bad1f4e24b85c9d0ab84a5e">field_name</a>));</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="spring_transformation_function"></a>
Transformation of the spring</h3>
<p>stiffnesses between local and global coordinates</p>
<p>This functions allows the transformation of the spring stiffnesses from local coordinate associated with the element face, where normal ( \(k_n\)) and in-plane (tangent, \(k_t\)) stiffnesses are initially defined, to the global coordinate.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> MetaSpringBC::transformLocalToGlobal(</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_normal_local,</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent1_local,</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_tangent2_local,</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_local) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// FTensor indices</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;i&#39;</span>, 3&gt; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>;</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;j&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>;</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;k&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>;</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;l&#39;</span>, 3&gt; <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Global base vectors</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_e1(1., 0., 0.);</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_e2(0., 1., 0.);</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> t_e3(0., 0., 1.);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Direction cosines</span></div>
<div class="line">  <span class="keyword">auto</span> get_cosine = [&amp;](<span class="keyword">auto</span> x, <span class="keyword">auto</span> xp) {</div>
<div class="line">    <span class="keywordflow">return</span> (x(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * xp(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>)) / (sqrt(x(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * x(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>)) * sqrt(xp(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>) * xp(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>)));</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Transformation matrix (tensor)</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_transformation_matrix(</div>
<div class="line">      get_cosine(t_e1, t_normal_local), get_cosine(t_e1, t_tangent1_local),</div>
<div class="line">      get_cosine(t_e1, t_tangent2_local), get_cosine(t_e2, t_normal_local),</div>
<div class="line">      get_cosine(t_e2, t_tangent1_local), get_cosine(t_e2, t_tangent2_local),</div>
<div class="line">      get_cosine(t_e3, t_normal_local), get_cosine(t_e3, t_tangent1_local),</div>
<div class="line">      get_cosine(t_e3, t_tangent2_local));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Spring stiffness in global coordinate, Q*ls*Q^T</span></div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor2.html">FTensor::Tensor2&lt;double, 3, 3&gt;</a> t_spring_global;</div>
<div class="line">  t_spring_global(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>) = t_transformation_matrix(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>) * t_spring_local(<a class="code hl_variable" href="matrix__function_8cpp.html#ac93d777bbf9336cad5c09007df789c95">k</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>) *</div>
<div class="line">                          t_transformation_matrix(<a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> t_spring_global;</div>
<div class="line">};</div>
<div class="ttc" id="amatrix__function_8cpp_html_a510d8658904ea5f9e62ae641c8122e49"><div class="ttname"><a href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a></div><div class="ttdeci">FTensor::Index&lt; 'l', 3 &gt; l</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00021">matrix_function.cpp:21</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="spring_sample_application"></a>
Sample applications</h1>
<p>With the spring element developed, the boundary condition employing elastic spring to model the interaction between the structure of interest and surrounding environment can be applied to any existing solid problems. For demonstration purposes, the following part presents how spring elements are added to the linear and nonlinear elasticity problems, i.e. elasticity.cpp and arc_length_nonlinear_elasticity.cpp, and how the inclusion of spring boundary condition affects the responses of the structure bearing external loads.</p>
<p>For numerical examples, a rod with rectangular cross section will be used. The input for the geometry and mesh of a rod with spring boundary condition as follows</p>
<ul>
<li>Simple journal script which can be used in Cubit to generate the rod geometry and mesh <div class="fragment"><div class="line">reset</div>
<div class="line"> </div>
<div class="line">brick x 1.2 y 1.4 z 4</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#rotate Volume 1  angle 70  about X include_merged</span></div>
<div class="line"> </div>
<div class="line">{<a class="code hl_variable" href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a> = 10}</div>
<div class="line">{<a class="code hl_variable" href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a> = 0}</div>
<div class="line">block 1 volume all </div>
<div class="line">block 1 name <span class="stringliteral">&#39;MAT_ELASTIC&#39;</span></div>
<div class="line">block 1 attribute count 2</div>
<div class="line">block 1 attribute index 1 {<a class="code hl_variable" href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a>}</div>
<div class="line">block 1 attribute index 2 {<a class="code hl_variable" href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a>}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Boundary conditions</span></div>
<div class="line"><span class="preprocessor">#create displacement on vertex 6 dof 1 dof 2 fix 0</span></div>
<div class="line"><span class="preprocessor">#create displacement on vertex 8 dof 1 fix 0</span></div>
<div class="line">create pressure  on <a class="code hl_namespace" href="namespacesurface.html">surface</a> 1 magnitude 12</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Spring</span></div>
<div class="line">{spring_stiffness_normal = 5}   </div>
<div class="line">{spring_stiffness_tangent = 100}        </div>
<div class="line">block 4 <a class="code hl_namespace" href="namespacesurface.html">surface</a> 2</div>
<div class="line">block 4 name <span class="stringliteral">&#39;SPRING_BC&#39;</span></div>
<div class="line">block 4 attribute count 2</div>
<div class="line">block 4 attribute index 1 {spring_stiffness_normal}</div>
<div class="line">block 4 attribute index 2 {spring_stiffness_tangent}</div>
<div class="line">volume all scheme Tetmesh</div>
<div class="line">volume all size <span class="keyword">auto</span> factor 10</div>
<div class="line">mesh volume all</div>
<div class="line"> </div>
<div class="line">save as <span class="stringliteral">&quot;/Users/username/mofem_install/mofem-cephas/mofem/users_modules/basic_finite_elements/nonlinear_elasticity/spring_rod.cub&quot;</span> overwrite</div>
<div class="ttc" id="anamespacesurface_html"><div class="ttname"><a href="namespacesurface.html">surface</a></div><div class="ttdef"><b>Definition</b> <a href="surface_8py_source.html#l00001">surface.py:1</a></div></div>
<div class="ttc" id="aplastic_8cpp_html_a0447f1370e525557f8d7c6a1ed22be14"><div class="ttname"><a href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a></div><div class="ttdeci">double young_modulus</div><div class="ttdoc">Young modulus.</div><div class="ttdef"><b>Definition</b> <a href="plastic_8cpp_source.html#l00125">plastic.cpp:125</a></div></div>
<div class="ttc" id="aplastic_8cpp_html_a571fc4d0022947a6d01a56a53d5668e6"><div class="ttname"><a href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a></div><div class="ttdeci">double poisson_ratio</div><div class="ttdoc">Poisson ratio.</div><div class="ttdef"><b>Definition</b> <a href="plastic_8cpp_source.html#l00126">plastic.cpp:126</a></div></div>
</div><!-- fragment --></li>
<li>The mesh of the rod can be found in <a class="el" href="spring_element.html#figure_spring_rod_mesh">Figure 2</a> where the translation in x and y directions of two vertices at the bottom surface are fixed to avoid rigid body rotation and the spring is applied at the bottom surface.</li>
</ul>
<p><a class="anchor" id="figure_spring_rod_mesh"></a></p><div class="image">
<img src="spring_rod_mesh.png" alt="" width="400px"/>
<div class="caption">
Figure 2: Mesh of a rod with pressure on the top surface and the boundary condition imposed on the bottom surface.</div></div>
<h2><a class="anchor" id="spring_linear_elasticity"></a>
Elasticity problem</h2>
<p>In order to include spring element in the linear elesticity problem elasticity.cpp, the following lines of code are needed in the main program.</p>
<ul>
<li>The header files for spring element implementation are embedded in BasicFiniteElements.hpp (directly included) and <a class="el" href="petsc_2impl_2All_8cpp.html">All.cpp</a> (via CMake) <div class="fragment"></div><!-- fragment --></li>
<li>Declaration of the spring element <div class="fragment"><div class="line"><span class="comment">// Add spring boundary condition applied on surfaces.</span></div>
<div class="line"><span class="comment">// This is only declaration not implementation.</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MetaSpringBC::addSpringElements(m_field, <span class="stringliteral">&quot;DISPLACEMENT&quot;</span>,</div>
<div class="line">                                         <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Implementation of spring element by creating new instances and calling function MetaSpringBC::setSpringOperators to push operators to them <div class="fragment"><div class="line"><span class="comment">// Implementation of spring element</span></div>
<div class="line"><span class="comment">// Create new instances of face elements for springs</span></div>
<div class="line">boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_lhs_ptr(</div>
<div class="line">    <span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
<div class="line">boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_rhs_ptr(</div>
<div class="line">    <span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MetaSpringBC::setSpringOperators(m_field, fe_spring_lhs_ptr,</div>
<div class="line">                                        fe_spring_rhs_ptr, <span class="stringliteral">&quot;DISPLACEMENT&quot;</span>,</div>
<div class="line">                                        <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Assign global matrix and vector to which springs contribute <div class="fragment"><div class="line">fe_spring_lhs_ptr-&gt;ksp_B = Aij;</div>
<div class="line">fe_spring_rhs_ptr-&gt;ksp_f = <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>;</div>
<div class="ttc" id="afree__surface_8cpp_html_a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d"><div class="ttname"><a href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a></div><div class="ttdeci">@ F</div><div class="ttdef"><b>Definition</b> <a href="free__surface_8cpp_source.html#l00396">free_surface.cpp:396</a></div></div>
</div><!-- fragment --></li>
<li>Loop over the elements to calculate the contribution of the spring boundary condition to the RHS and LHS and assemble them <div class="fragment"><div class="line"><span class="comment">// Assemble springs</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, <span class="stringliteral">&quot;SPRING&quot;</span>, fe_spring_lhs_ptr);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, <span class="stringliteral">&quot;SPRING&quot;</span>, fe_spring_rhs_ptr);</div>
</div><!-- fragment --></li>
</ul>
<p>Once the additional lines of code are added to include spring element to the linear elasticity module elasticity.cpp, the test using above rod model with springs is conducted. The displacement results using finite element analysis is presented in <a class="el" href="spring_element.html#figure_spring_result_linear">Figure 3</a>. The command line that has been used to run this test is as follows </p><div class="fragment"><div class="line">./elasticity -my_file spring_rod.cub -my_order 2 -ksp_type gmres -pc_type <span class="keyword">asm</span> -sub_pc_type lu</div>
</div><!-- fragment --><p><a class="anchor" id="figure_spring_result_linear"></a></p><div class="image">
<img src="spring_rod_result_linear_elasticity.png" alt="" width="400px"/>
<div class="caption">
Figure 3: Linear displacement result of the rod.</div></div>
<p>The hand calculation for the displacement of a point on the bottom surface where the spring is applied can be done as follows  </p><p class="formulaDsp">
\[ 
u = \frac{{F\left( {{A_F}} \right)}}{{k_s\left( {{A_k}} \right)}} = \frac{{p \times {A_F}}}{{{k_sz} \times {A_k}}} = \frac{{12 \times \left( {1.2 \times 1.4} \right)}}{{5 \times \left( {1.2 \times 1.4} \right)}} = 2.4
\]
</p>
<p> where \( p \) and \( k_z \) are the pressure and spring stiffness in z direction, respectively. Meanwhile, \( A_F \) and \( A_k \) represent the areas where pressure and spring are applied, respectively. As expected, the hand calculated result is consistent with that shown in <a class="el" href="spring_element.html#figure_spring_result_linear">Figure 3</a>.</p>
<h2><a class="anchor" id="spring_nonlinear_elasticity"></a>
Nonlinear elasticity problem</h2>
<p>Similar to the previous application, in order to include spring element in the nonlinear elesticity problem arc_length_nonlinear_elasticity.cpp, the following lines of code are needed in the main program.</p>
<ul>
<li>The header files for spring element implementation are embedded in BasicFiniteElements.hpp (directly included) and <a class="el" href="petsc_2impl_2All_8cpp.html">All.cpp</a> (via CMake) <div class="fragment"></div><!-- fragment --></li>
<li>Declaration of the spring element <div class="fragment"><div class="line"><span class="comment">// Add spring boundary condition applied on surfaces.</span></div>
<div class="line"><span class="comment">// This is only declaration not implementation.</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MetaSpringBC::addSpringElements(m_field, <span class="stringliteral">&quot;SPATIAL_POSITION&quot;</span>,</div>
<div class="line">                                         <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Set finite element for spring boundary condition <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__problems.html#gaf165948ec92b5fcfbe5ec19ea1918ba1">modify_problem_add_finite_element</a>(<span class="stringliteral">&quot;ELASTIC_MECHANICS&quot;</span>,</div>
<div class="line">                                                   <span class="stringliteral">&quot;SPRING&quot;</span>);</div>
<div class="ttc" id="agroup__mofem__problems_html_gaf165948ec92b5fcfbe5ec19ea1918ba1"><div class="ttname"><a href="group__mofem__problems.html#gaf165948ec92b5fcfbe5ec19ea1918ba1">MoFEM::CoreInterface::modify_problem_add_finite_element</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_problem_add_finite_element(const std::string name_problem, const std::string &amp;fe_name)=0</div><div class="ttdoc">add finite element to problem, this add entities assigned to finite element to a particular problem</div></div>
</div><!-- fragment --></li>
<li>Implementation of spring element by creating new instances and calling function MetaSpringBC::setSpringOperators to push operators to them <div class="fragment"><div class="line"><span class="comment">// Implementation of spring element</span></div>
<div class="line"><span class="comment">// Create new instances of face elements for springs</span></div>
<div class="line">boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_lhs_ptr(</div>
<div class="line">    <span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
<div class="line">boost::shared_ptr&lt;FaceElementForcesAndSourcesCore&gt; fe_spring_rhs_ptr(</div>
<div class="line">    <span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MetaSpringBC::setSpringOperators(</div>
<div class="line">    m_field, fe_spring_lhs_ptr, fe_spring_rhs_ptr, <span class="stringliteral">&quot;SPATIAL_POSITION&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Loop over the elements to calculate the contribution of the spring boundary condition to the RHS and LHS <div class="fragment"><div class="line">loops_to_do_Rhs.push_back(</div>
<div class="line">    SnesCtx::PairNameFEMethodPtr(<span class="stringliteral">&quot;SPRING&quot;</span>, fe_spring_rhs_ptr.get()));</div>
</div><!-- fragment --> <div class="fragment"><div class="line">loops_to_do_Mat.push_back(</div>
<div class="line">    SnesCtx::PairNameFEMethodPtr(<span class="stringliteral">&quot;SPRING&quot;</span>, fe_spring_lhs_ptr.get()));</div>
</div><!-- fragment --></li>
</ul>
<p>The nonlinear analysis of the rod is run using the command line with the output of the first two load steps as follows </p><div class="fragment"><div class="line">./arc_length_nonlinear_elasticity -my_file spring_rod.cub  -my_sr 1e-6 -my_ms 5 -snes_converged_reason -my_order 2</div>
</div><!-- fragment --><div class="fragment"><div class="line">    dlambda = 9.1847e-08 dx2 = 0.0000e+00</div>
<div class="line">    res_lambda = 0.0000e+00</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 9.1847e-08</div>
<div class="line">  0 SNES Function norm 1.000000000004e-06 </div>
<div class="line">    diag = 2.1775e-05</div>
<div class="line">    Flambda2 = 1.1854e+02</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 9.1847e-08</div>
<div class="line">    fnorm = 2.3303e-13</div>
<div class="line">    dlambda = 9.1847e-08 dx2 = 4.1486e-12</div>
<div class="line">    res_lambda = 0.0000e+00</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 9.1847e-08</div>
<div class="line">  1 SNES Function norm 2.330272528283e-13 </div>
<div class="line">Nonlinear solve converged due to CONVERGED_FNORM_ABS iterations 1</div>
<div class="line">number of Newton iterations = 1</div>
<div class="line">    Set alpha = 1.0000e+00 beta = 0.0000e+00</div>
<div class="line">    dlambda = 9.1847e-08 dx2 = 4.1486e-12</div>
<div class="line">    Set s = 2.0368e-06</div>
<div class="line">Load Step 2 step_size = 2.0368e-06 dlambda0 = 9.1847e-08 dx_nrm = 2.0368e-06 dx2 = 4.1486e-12</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 9.1847e-08, 1.8369e-07 (9.1847e-08)</div>
<div class="line">    Flambda2 = 1.1854e+02</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 1.8369e-07</div>
<div class="line">    fnorm = 9.3481e-13</div>
<div class="line">    dlambda = 9.1847e-08 dx2 = 4.1486e-12</div>
<div class="line">    res_lambda = 0.0000e+00</div>
<div class="line">    <a class="code hl_variable" href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 1.8369e-07</div>
<div class="line">  0 SNES Function norm 9.348064473394e-13 </div>
<div class="line">Nonlinear solve converged due to CONVERGED_FNORM_ABS iterations 0</div>
<div class="line">number of Newton iterations = 0</div>
<div class="ttc" id="aincompressible__elasticity_8cpp_html_a3db359547eed8cfd48ca821d95f577af"><div class="ttname"><a href="incompressible__elasticity_8cpp.html#a3db359547eed8cfd48ca821d95f577af">lambda</a></div><div class="ttdeci">static double lambda</div><div class="ttdef"><b>Definition</b> <a href="incompressible__elasticity_8cpp_source.html#l00181">incompressible_elasticity.cpp:181</a></div></div>
</div><!-- fragment --><p><a class="el" href="spring_element.html#figure_spring_result_nonlinear">Figure 4</a> presents the nonlinear displacement illustration of the rod after the first load step.</p>
<p><a class="anchor" id="figure_spring_result_nonlinear"></a></p><div class="image">
<img src="spring_rod_result_nonlinear_elasticity.png" alt="" width="400px"/>
<div class="caption">
Figure 4: Nonlinear displacement result of the rod.</div></div>
<p>The hand calculation for the nonlinear displacement after the first load step of a point on the bottom surface where the spring is applied can be done as follows  </p><p class="formulaDsp">
\[ 
u = \frac{{F\left( {{A_F}} \right)}} {{k_s\left( {{A_k}} \right)}} =
\frac{{\lambda \times p \times {A_F}}}{{{k_sz} \times {A_k}}} = \frac{{9.1847
\times 10^{-08} \times 12 \times \left({1.2 \times 1.4} \right)}}{{5 \times
\left( {1.2 \times 1.4} \right)}} = 2.204\times 10^{-07} 
\]
</p>
<p> where \( \lambda \) is the load factor being used in each load step which can be found in the output as \( lambda \). As expected, the numerical and hand-calculated results are consistent.</p>
<p>As an additional demonstration of the effect of spring boundary conditions on the structural response, the analysis result for a L-shaped structure is conducted. <a class="el" href="spring_element.html#figure_nonlinear_elasticity_spring">Figure 5</a> shows the geometry and the mesh while <a class="el" href="spring_element.html#figure_nonlinear_elasticity_spring">Figure 6</a> presents the comparison of the results for different boundary conditions applied at a face of the L-shaped structure. There are two analyses where springs with different stiffness magnitude in normal and in-plane local direction are applied. Additionally, another case in which clamp boundary condition is used is also presented. It is worth commenting that the deformed shapes of the structure get bigger are due to the small strain assumption and the solution scaling.</p>
<p><a class="anchor" id="figure_spring_LShape_mesh"></a></p><div class="image">
<img src="spring_LShape_mesh.png" alt="" width="400px"/>
<div class="caption">
Figure 5: Mesh of the L-shaped structure with the boundary condition imposed on the highlighted surface.</div></div>
<p><a class="anchor" id="figure_nonlinear_elasticity_spring"></a></p><div class="image">
<img src="spring_comparison.png" alt="" width="450px"/>
<div class="caption">
Figure 6: Effects of different boundary conditions on the displacement (E = 10, v = 0, pressure = 25).</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.8
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>