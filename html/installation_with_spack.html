<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: Installation with Spack (Advanced)</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
  <script>
    window.MathJax = {
      tex: {
        tags: 'all', // Enables equation numbering
      },
      loader: {
        load: ['[tex]/boldsymbol']
      }
    };
  </script>
  <script type="text/javascript " src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.15.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Installation with Spack (Advanced)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md62">Installing MoFEM with Spack on Ubuntu Noble</a><ul><li class="level2"><a href="#autotoc_md63">üß∞ Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md64">üì¶ Step 1: Install System Dependencies</a></li>
<li class="level2"><a href="#autotoc_md65">üìÅ Step 2: Set Up Directories</a></li>
<li class="level2"><a href="#autotoc_md66">üì• Step 3: Download and Unpack Spack</a></li>
<li class="level2"><a href="#autotoc_md67">üß† Step 4: Initialise Spack</a></li>
<li class="level2"><a href="#autotoc_md68">üîß Step 5: Configure Spack</a></li>
<li class="level2"><a href="#autotoc_md69">üß© Step 6: Add Clone and Custom MoFEM Package Repository</a></li>
<li class="level2"><a href="#autotoc_md70">üöÄ Step 7: Install MoFEM Dependencies</a></li>
<li class="level2"><a href="#autotoc_md71">üßπ Step 8: Clean Build Cache</a></li>
<li class="level2"><a href="#autotoc_md72">üì• Step 9: Build MoFEM</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md73">Create and activate environment</a></li>
<li class="level1"><a href="#autotoc_md74">Configure and build</a></li>
<li class="level1"><a href="#autotoc_md75">Clean build cache</a></li>
<li class="level1"><a href="#autotoc_md76">Add source-controlled PETSc and MOAB</a></li>
<li class="level1"><a href="#autotoc_md77">Mark them for local development</a></li>
<li class="level1"><a href="#autotoc_md78">Re-concretise and install</a></li>
<li class="level1"><a href="#spack_faq">FAQ</a><ul><li class="level2"><a href="#autotoc_md79">How to get packages installed today?</a></li>
<li class="level2"><a href="#autotoc_md80">How to find packages that were only installed today?</a></li>
</ul>
</li>
<li class="level1"><a href="#spack_contact">Contact</a></li>
</ul>
</div>
<div class="textblock"><p><a href="https://spack.io">Spack</a> is a <b>flexible package manager</b> designed to support multiple versions, configurations, platforms, and compilers.</p>
<p>It is actively developed by a vibrant open-source community of users and contributors who maintain package configurations across a wide range of platforms, including macOS and Linux. This enables a <b>consistent and reproducible build environment</b> for many scientific software packages.</p>
<p><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is best deployed and developed using Spack, which is the <b>recommended installation method</b>. Please note that Spack builds all packages <b>from source</b>; precompiled binaries are not provided.</p>
<p>If you encounter issues, have feedback, or would like to suggest improvements, feel free to contact us at <br  />
 <a href="https://groups.google.com/forum/#!forum/mofem-group">mofem-group@googlegroups.com</a>.</p>
<blockquote class="doxtable">
<p>&zwj;Installation instructions besides Oak are not valid. We changed patterns how we work </p>
</blockquote>
<p>with Spack, and change <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> infrastructure. Documentation is not yet updated.</p>
<h1><a class="anchor" id="autotoc_md62"></a>
Installing MoFEM with Spack on Ubuntu Noble</h1>
<p>This guide walks you through setting up <b><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a></b> using <b>Spack</b> on Ubuntu Noble, based on the official Docker build.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
üß∞ Prerequisites</h2>
<p>Ensure you're running <b>Ubuntu 24.04 (Noble Numbat)</b> and have <code>sudo</code> privileges.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
üì¶ Step 1: Install System Dependencies</h2>
<div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt install -y \</div>
<div class="line">  file \</div>
<div class="line">  zlib1g-dev \</div>
<div class="line">  openssh-server \</div>
<div class="line">  wget \</div>
<div class="line">  valgrind \</div>
<div class="line">  curl \</div>
<div class="line">  git \</div>
<div class="line">  g++ \</div>
<div class="line">  gfortran \</div>
<div class="line">  gdb \</div>
<div class="line">  m4 \</div>
<div class="line">  automake \</div>
<div class="line">  build-essential \</div>
<div class="line">  libtool \</div>
<div class="line">  libsigsegv2 \</div>
<div class="line">  libjpeg-dev \</div>
<div class="line">  graphviz \</div>
<div class="line">  doxygen \</div>
<div class="line">  cmake \</div>
<div class="line">  pkg-config \</div>
<div class="line">  gnuplot \</div>
<div class="line">  ca-certificates \</div>
<div class="line">  python3-setuptools \</div>
<div class="line">  python3-dev \</div>
<div class="line">  python3-numpy \</div>
<div class="line">  python3-scipy \</div>
<div class="line">  libx11-dev \</div>
<div class="line">  xauth \</div>
<div class="line">  xterm \</div>
<div class="line">  unzip \</div>
<div class="line">  mesa-common-dev \</div>
<div class="line">  libglu1-mesa-dev \</div>
<div class="line">  libxmu-dev \</div>
<div class="line">  libxi-dev \</div>
<div class="line">  libssl-dev \</div>
<div class="line">  gawk \</div>
<div class="line">  gettext \</div>
<div class="line">  libboost-all-dev \</div>
<div class="line">  libboost-python-dev \</div>
<div class="line">  openmpi-bin \</div>
<div class="line">  libopenmpi-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md65"></a>
üìÅ Step 2: Set Up Directories</h2>
<div class="fragment"><div class="line">export MOFEM_INSTALL_DIR=$HOME/mofem_install</div>
<div class="line">export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</div>
<div class="line"> </div>
<div class="line">mkdir -p $SPACK_ROOT</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md66"></a>
üì• Step 3: Download and Unpack Spack</h2>
<div class="fragment"><div class="line">curl -L https://github.com/spack/spack/archive/refs/tags/v0.23.1.tar.gz | \</div>
<div class="line">  tar -xz -C $SPACK_ROOT --strip-components=1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
üß† Step 4: Initialise Spack</h2>
<p>Add to your <code>.bashrc</code> or <code>.bash_profile</code>:</p>
<div class="fragment"><div class="line">export MOFEM_INSTALL_DIR=$HOME/mofem_install</div>
<div class="line">export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</div>
<div class="line">. $SPACK_ROOT/share/spack/setup-env.sh</div>
</div><!-- fragment --><p>Then apply:</p>
<div class="fragment"><div class="line">source ~/.bashrc</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
üîß Step 5: Configure Spack</h2>
<div class="fragment"><div class="line">spack compiler find</div>
<div class="line">spack external find</div>
<div class="line"> </div>
<div class="line">spack config add &quot;packages:all:target:[x86_64]&quot;</div>
<div class="line">spack config add &quot;packages:all:variants:build_type=Release&quot;</div>
</div><!-- fragment --><p>Then, update <code>~/.spack/packages.yaml</code> (or use <code>sed</code>) to mark some packages as external:</p>
<div class="fragment"><div class="line">openmpi:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: openmpi@4.1.6</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">python:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: python@3.12.3</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">py-numpy:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: py-numpy@1.26.4 ^python@3.12.13</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">boost:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: boost@1.83.0</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
<div class="line"> </div>
<div class="line">icu4c:</div>
<div class="line">  externals:</div>
<div class="line">  - spec: icu4c@74.2</div>
<div class="line">    prefix: /usr</div>
<div class="line">  buildable: false</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
üß© Step 6: Add Clone and Custom MoFEM Package Repository</h2>
<p>If you have a custom <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> Spack repo:</p>
<div class="fragment"><div class="line"># Clone the MoFEM repository</div>
<div class="line">cd $MOFEM_INSTALL_DIR</div>
<div class="line">git clone -b $MOFEM_BRANCH https://bitbucket.org/mofem/mofem-cephas.git</div>
</div><!-- fragment --><p>spack repo add $MOFEM_INSTALL_DIR/mofem_cephas</p>
<div class="fragment"><div class="line">Ensure:</div>
<div class="line">- `$MOFEM_INSTALL_DIR/mofem_cephas/repo.yaml`</div>
<div class="line">- `$MOFEM_INSTALL_DIR/mofem_cephas/packages/...`</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
üöÄ Step 7: Install MoFEM Dependencies</h2>
<div class="fragment"><div class="line">spack repo add $MOFEM_INSTALL_DIR/mofem_cephas</div>
<div class="line">spack install --only dependencies mofem-cephas@0.15.0+mgis ^petsc+X</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
üßπ Step 8: Clean Build Cache</h2>
<div class="fragment"><div class="line">spack clean -a</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md72"></a>
üì• Step 9: Build MoFEM</h2>
<div class="fragment"><div class="line"># Set the MoFEM source directory</div>
<div class="line">export MOFEM_SRC_DIR=$MOFEM_INSTALL_DIR/mofem-cephas</div>
<div class="line">export MOFEM_BRANCH=Version0.15.0</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">## üèóÔ∏è Step 10: Build MoFEM Core Library</div>
</div><!-- fragment --><p> bash . $SPACK_ROOT/share/spack/setup-env.sh</p>
<h1><a class="anchor" id="autotoc_md73"></a>
Create and activate environment</h1>
<p>spack env create mofem spack env activate mofem</p>
<h1><a class="anchor" id="autotoc_md74"></a>
Configure and build</h1>
<p>spack config add "packages:all:target:[x86_64]" spack config add "packages:all:variants:build_type=Release" spack add <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0+adol-c+med+mgis~shared+slepc+tetgen install_id=0 ^petsc+X spack develop -p $MOFEM_SRC_DIR <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 spack concretize -f spack install -v</p>
<h1><a class="anchor" id="autotoc_md75"></a>
Clean build cache</h1>
<p>spack clean -a </p><div class="fragment"><div class="line">## ‚úÖ Done!</div>
<div class="line"> </div>
<div class="line">MoFEM is now installed using Spack and ready to use.</div>
<div class="line"> </div>
<div class="line">To persist environment setup across sessions, you may add:</div>
</div><!-- fragment --><p> bash echo ". $SPACK_ROOT/share/spack/setup-env.sh" | sudo tee /etc/profile.d/mofem.sh </p><div class="fragment"><div class="line"># üöß MoFEM Installation on Oak Development Server</div>
<div class="line"> </div>
<div class="line">These instructions describe how to install **MoFEM** using **Spack** on the Oak development server.</div>
<div class="line"> </div>
<div class="line">## üõ†Ô∏è 1. Set Up Environment in `~/.bashrc`</div>
<div class="line"> </div>
<div class="line">If you have an account on Oak, configure your shell environment by adding the following lines:</div>
</div><!-- fragment --><p> bash echo "export TMPDIR=$HOME/tmp" &gt;&gt; ~/.bashrc echo ". /mofem_install/vanilla_spack/share/spack/setup-env.sh" &gt;&gt; ~/.bashrc </p><div class="fragment"><div class="line">Then **restart your terminal**, or run the above lines in your current shell to apply them immediately.</div>
<div class="line"> </div>
<div class="line">## üìÅ 2. Prepare Installation Directory</div>
</div><!-- fragment --><p> bash mkdir -p $HOME/mofem_install cd $HOME/mofem_install </p><div class="fragment"><div class="line">and copy packages list</div>
</div><!-- fragment --><p> cp /mofem_install/packages.yaml $HOME/.spack </p><div class="fragment"><div class="line">## üì¶ 3. Clone the MoFEM Repository</div>
</div><!-- fragment --><p> bash git clone <a href="#" onclick="location.href='mai'+'lto:'+'git'+'@b'+'itb'+'uc'+'ket'+'.o'+'rg'; return false;">git@b<span class="obfuscator">.nosp@m.</span>itbu<span class="obfuscator">.nosp@m.</span>cket.<span class="obfuscator">.nosp@m.</span>org</a>:mofem/mofem-cephas.git </p><div class="fragment"><div class="line">## üß™ 4. Create and Configure the Release Environment</div>
</div><!-- fragment --><p> bash mkdir -p $HOME/mofem_install/release_env cd $HOME/mofem_install/release_env </p><div class="fragment"><div class="line">Add the MoFEM repository to Spack:</div>
</div><!-- fragment --><p> bash spack repo add $HOME/mofem_install/mofem-cephas </p><div class="fragment"><div class="line">Create a new Spack environment and configure it:</div>
</div><!-- fragment --><p> bash spack env create -d . spacktivate . spack config add "packages:all:variants:build_type=RelWithDebInfo" </p><div class="fragment"><div class="line">Add MoFEM and its dependencies:</div>
</div><!-- fragment --><p> bash spack add <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 +adol-c +med +mgis ~shared +slepc +tetgen +build_tutorials install_id=$USER ^petsc+X spack develop -p $HOME/mofem_install/mofem-cephas </p><div class="fragment"><div class="line">Build the environment:</div>
</div><!-- fragment --><p> bash spack concretize -f spack install -v &ndash;test=root <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 </p><div class="fragment"><div class="line">To activate the environment in future sessions:</div>
</div><!-- fragment --><p> bash spack env activate -d $HOME/mofem_install/release_env </p><div class="fragment"><div class="line">## üêû 5. (Optional) Create a Debugging Environment</div>
<div class="line"> </div>
<div class="line">Use this to build with debug flags and work on source-level changes to **PETSc** or **MOAB**.</div>
<div class="line"> </div>
<div class="line">### ‚öôÔ∏è Create and Configure the Debug Environment</div>
</div><!-- fragment --><p> bash mkdir -p $HOME/mofem_install/debug_env cd $HOME/mofem_install/debug_env</p>
<p>spack env create -d . spacktivate . spack config add "packages:all:variants:build_type=Debug" spack add <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 +adol-c +med +mgis ~shared +slepc +tetgen +build_tutorials install_id=$USER ^petsc+X spack develop -p $HOME/mofem_install/mofem-cephas spack concretize -f spack install -v &ndash;test=root <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 </p><div class="fragment"><div class="line">Activate the environment:</div>
</div><!-- fragment --><p> bash spack env activate -d $HOME/mofem_install/debug_env </p><div class="fragment"><div class="line">### üî¨ Work on PETSc and MOAB Code (Optional)</div>
<div class="line"> </div>
<div class="line">If you plan to modify **PETSc** or **MOAB**, you can clone and develop them directly:</div>
</div><!-- fragment --><p> bash cd $HOME/mofem_install/debug_env</p>
<h1><a class="anchor" id="autotoc_md76"></a>
Add source-controlled PETSc and MOAB</h1>
<p>spack add moab@5.5.1 spack add <a href="#" onclick="location.href='mai'+'lto:'+'pet'+'sc'+'@3.'+'22'; return false;">petsc<span class="obfuscator">.nosp@m.</span>@3.2<span class="obfuscator">.nosp@m.</span>2</a>.1</p>
<h1><a class="anchor" id="autotoc_md77"></a>
Mark them for local development</h1>
<p>spack develop -p $PWD/moab moab@5.5.1 spack develop -p $PWD/petsc <a href="#" onclick="location.href='mai'+'lto:'+'pet'+'sc'+'@3.'+'22'; return false;">petsc<span class="obfuscator">.nosp@m.</span>@3.2<span class="obfuscator">.nosp@m.</span>2</a>.1</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Re-concretise and install</h1>
<p>spack concretize -f spack install -v </p><div class="fragment"><div class="line">## ‚úÖ Done!</div>
<div class="line"> </div>
<div class="line">MoFEM is now installed and ready for use. To make development smoother:</div>
<div class="line">- Use `spack env activate -d &lt;path&gt;` to switch environments.</div>
<div class="line">- Add common commands to your `.bashrc` or `.bash_aliases`.</div>
<div class="line">- Use `spack develop` to link your changes into the build.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># üöß MoFEM Installation on Buckedhead (SLURM System)</div>
<div class="line"> </div>
<div class="line">This guide assumes you&#39;re using modules and installing into your user space, without admin privileges.</div>
<div class="line"> </div>
<div class="line">## üì¶ 1. Load Required Modules</div>
</div><!-- fragment --><p> bash module purge module load gcc/14.2.0 module load mpi/openmpi/4.1.7/gcc-14.2.0 module load python/3.12.8 </p><div class="fragment"><div class="line">Check that they are loaded correctly:</div>
</div><!-- fragment --><p> bash which gcc which mpicc python3 &ndash;version </p><div class="fragment"><div class="line">## üìÅ 2. Create Directory Layout</div>
</div><!-- fragment --><p> bash export MOFEM_INSTALL_DIR=$HOME/mofem_install export SPACK_ROOT=$MOFEM_INSTALL_DIR/spack</p>
<p>mkdir -p $SPACK_ROOT mkdir -p $MOFEM_INSTALL_DIR cd $MOFEM_INSTALL_DIR </p><div class="fragment"><div class="line">## üì• 3. Download and Unpack Spack</div>
</div><!-- fragment --><p> bash curl -L <a href="https://github.com/spack/spack/archive/refs/tags/v0.23.1.tar.gz">https://github.com/spack/spack/archive/refs/tags/v0.23.1.tar.gz</a> | \ tar -xz -C $SPACK_ROOT &ndash;strip-components=1 </p><div class="fragment"><div class="line">## üß† 4. Initialise Spack</div>
<div class="line"> </div>
<div class="line">Add to your `.bashrc` or run interactively:</div>
</div><!-- fragment --><p> bash export SPACK_ROOT=$HOME/mofem_install/spack . $SPACK_ROOT/share/spack/setup-env.sh </p><div class="fragment"><div class="line">Apply changes:</div>
</div><!-- fragment --><p> bash source ~/.bashrc </p><div class="fragment"><div class="line">## üîß 5. Configure Spack with External Packages</div>
</div><!-- fragment --><p> bash spack compiler find spack external find </p><div class="fragment"><div class="line">Edit `~/.spack/packages.yaml` and add:</div>
</div><!-- fragment --><p> yaml packages: all: target: [x86_64] variants: +mpi build_type=Release</p>
<p>python: externals:</p><ul>
<li>spec: <a href="#" onclick="location.href='mai'+'lto:'+'pyt'+'ho'+'n@3'+'.1'+'2'; return false;">pytho<span class="obfuscator">.nosp@m.</span>n@3.<span class="obfuscator">.nosp@m.</span>12</a>.8 prefix: /software/python/3.12.8 buildable: false</li>
</ul>
<p>openmpi: externals:</p><ul>
<li>spec: openmpi@4.1.7 prefix: /software/mpi/openmpi/4.1.7/gcc-14.2.0 buildable: false</li>
</ul>
<p>boost: externals:</p><ul>
<li>spec: <a href="#" onclick="location.href='mai'+'lto:'+'boo'+'st'+'@1.'+'83'; return false;">boost<span class="obfuscator">.nosp@m.</span>@1.8<span class="obfuscator">.nosp@m.</span>3</a>.0 prefix: /usr buildable: false <div class="fragment"><div class="line">## üß© 6. Clone and Register MoFEM Repo</div>
</div><!-- fragment --> bash cd $MOFEM_INSTALL_DIR git clone &ndash;branch Version0.15.0 <a href="https://bitbucket.org/mofem/mofem-cephas.git">https://bitbucket.org/mofem/mofem-cephas.git</a></li>
</ul>
<p>spack repo add $MOFEM_INSTALL_DIR/mofem-cephas </p><div class="fragment"><div class="line">## üå± 7. Create and Configure Spack Environment</div>
</div><!-- fragment --><p> bash mkdir -p $MOFEM_INSTALL_DIR/release_env cd $MOFEM_INSTALL_DIR/release_env spack env create -d . spack env activate .</p>
<p>spack config add "packages:all:target:[x86_64]" spack config add "packages:all:variants:build_type=RelWithDebInfo" </p><div class="fragment"><div class="line">## üöÄ 8. Add and Build MoFEM</div>
</div><!-- fragment --><p> bash spack add <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X spack develop -p $MOFEM_INSTALL_DIR/mofem-cephas spack concretize -f spack install -v </p><div class="fragment"><div class="line">## üß™ 9. (Optional) Create Debug Environment</div>
</div><!-- fragment --><p> bash mkdir -p $MOFEM_INSTALL_DIR/debug_env cd $MOFEM_INSTALL_DIR/debug_env spack env create -d . spack env activate .</p>
<p>spack config add "packages:all:variants:build_type=Debug" spack add <a href="#" onclick="location.href='mai'+'lto:'+'mof'+'em'+'-ce'+'ph'+'as@'+'0.'+'15'; return false;">mofem<span class="obfuscator">.nosp@m.</span>-cep<span class="obfuscator">.nosp@m.</span>has@0<span class="obfuscator">.nosp@m.</span>.15</a>.0 +adol-c +med +mgis ~shared +slepc +tetgen ~build_tutorials install_id=$USER ^petsc+X spack develop -p $MOFEM_INSTALL_DIR/mofem-cephas spack concretize -f spack install -v </p><div class="fragment"><div class="line">## ‚úÖ 10. Run MoFEM in SLURM Job</div>
<div class="line"> </div>
<div class="line">Example SLURM script:</div>
</div><!-- fragment --><p> bash #!/bin/bash #SBATCH &ndash;job-name=mofem_test #SBATCH &ndash;ntasks=4 #SBATCH &ndash;time=01:00:00</p>
<p>module purge module load gcc/14.2.0 module load mpi/openmpi/4.1.7/gcc-14.2.0 module load python/3.12.8</p>
<p>source $HOME/mofem_install/spack/share/spack/setup-env.sh spack env activate $HOME/mofem_install/release_env</p>
<p>mpirun ./my_mofem_app ```</p>
<h1><a class="anchor" id="spack_faq"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md79"></a>
How to get packages installed today?</h2>
<p>Run command: </p><div class="fragment"><div class="line">spack find -p -L --start-date `date +%F`</div>
</div><!-- fragment --><p> and you will get: </p><div class="fragment"><div class="line">-- darwin-elcapitan-x86_64 / clang@7.3.0-apple ------------------</div>
<div class="line">ugi2gm7    mofem-cephas@develop     /spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/mofem-cephas-develop-ugi2gm7lydyjwmiwneefhxq7ahvpnuzc</div>
<div class="line">gu4uheh    mofem-users-modules@develop  /spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/mofem-users-modules-develop-gu4uhehai3edtqow7kivuxgpw5lmvbxz</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md80"></a>
How to find packages that were only installed today?</h2>
<p>Run command: </p><div class="fragment"><div class="line">ls -lhd `spack find -lp  | grep mofem | awk &#39;\&#39;&#39;{print $3}&#39;\&#39;&#39;`</div>
</div><!-- fragment --><h1><a class="anchor" id="spack_contact"></a>
Contact</h1>
<p>If you are experiencing any problems with this installation, please contact us by <a href="https://groups.google.com/forum/#!forum/mofem-group">mofem-group@googlegroups.com</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.8
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>