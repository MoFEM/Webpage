<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.12.0"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: COR-7: Mixed formulation for incompressible elasticity</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script>
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">COR-7: Mixed formulation for incompressible elasticity</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#elasticity_mixed_formulation_introduction">Introduction</a>
  </li>
  <li class="level1">
    <a href="#elasticity_mixed_formulation_mathematical_fe_formulation">Mathematical and finite element formulation</a>
  </li>
  <li class="level1">
    <a href="#elasticity_mixed_formulation_input_mesh">Input mesh</a>
  </li>
  <li class="level1">
    <a href="#elasticity_mixed_formulation_code_dissection">Code dissection</a>
    <ul>
      <li class="level2">
        <a href="#elasticity_mixed_formulation_init">Initialisation</a>
      </li>
      <li class="level2">
        <a href="#elasticity_mixed_formulation_solve_problem">Solving the problem</a>
      </li>
      <li class="level2">
        <a href="#elasticity_mixed_formulation_postproc">Postprocessing</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#elasticity_mixed_formulation_running_program">Running the program</a>
    <ul>
      <li class="level2">
        <a href="#elasticity_mixed_formulation_output_dissection">Output dissection</a>
      </li>
      <li class="level2">
        <a href="#elasticity_mixed_formulation_visualisation">Visualisation</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#Remark">Remark</a>
  </li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="elasticity_mixed_formulation_introduction"></a>
Introduction</h1>
<p>In this tutorial, the <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> implemenetation of the mixed formulation for incompressible elasticity problem will be presented. Interested readers are encouraged to have a look at <a class="el" href="general_data_structure.html">MoFEM Architecture</a>, <a class="el" href="hierarchical_approximation_1.html">FUN-2: Hierarchical approximation</a>, <a class="el" href="hello_world_tut1.html">FUN-0: Hello world</a>, and <a class="el" href="poisson_tut1.html">COR-2: Solving the Poisson equation</a> to have better ideas how <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> works and how a specific problem is implemented in the platform. They may also find this <a href="https://youtu.be/rO1_j8p9epk">tutorial video</a> helpful.</p>
<p>The remainder of the tutorial is organised as follows. The mathematical and finite element formulation is presented in the next section before the input mesh of the L-shape structure which is used as an example is defined. It is followed by explanation of the source code and then how to run and visualise the results. Remarks on choosing approximation order and its consequence will be discussed at the end of the tutorial.</p>
<h1><a class="anchor" id="elasticity_mixed_formulation_mathematical_fe_formulation"></a>
Mathematical and finite element formulation</h1>
<p>A compressible elasticity problem can be formally defined as follows assuming there is no body force.</p>
<p>For given loading \( \bf{f} \), traction \( \bf{t} \), and displacement  \(
\bf{\bar u} \), find \( \bf{u} \) such that         </p><p class="formulaDsp">
\[ 
    \begin{align}
-{\rm{div}} \boldsymbol{\sigma(u)} &amp;= \boldsymbol{f} \quad \text{in} \quad \Omega, \\

\boldsymbol{u} &amp;= \boldsymbol{\bar u} \quad \text{on} \quad \Gamma_u \subset \partial\Omega, \\

\boldsymbol{\sigma n} &amp;= \boldsymbol{t} \quad \text{on} \quad \Gamma_t \subset \partial\Omega. 
    \end{align}
\]
</p>
<p>The constitutive equation is given as     </p><p class="formulaDsp">
\[
    \begin{align}
\boldsymbol{\sigma} = \lambda \rm{tr}\boldsymbol{(\varepsilon)I} + 2\mu\boldsymbol{\varepsilon},
    \end{align}
\]
</p>
<p> where Lame's constants \( \lambda \) and \( \mu \) are related with Young's modulus \( E \) and Poisson's ratio \( \nu \) as       </p><p class="formulaDsp">
\[
    \begin{align}
        \lambda  &amp;= \frac{{\nu E}}{{\left( {1 + \nu } \right)\left( {1 - 2\nu }
        \right)}}, \\
        \mu  &amp;= \frac{E}{{2\left( {1 + \nu } \right)}}.
    \end{align}
\]
</p>
<p>The above problem of compressible elasticity can be solved using typical finite element procedure. However, in case of \( \nu=0.5 \), \( \lambda \) becomes infinity implying incompressible state. This causes <em>volumetric</em> <em>locking</em> which makes the approximation converge very slowly or even unable to converge. Therefore, an alternative formulation needs to be considered to bypass this difficulty. This can be done by introducing additional independent unknown called <em>hydrostatic</em> <em>pressure</em> \( p \) where \( p = -\lambda u_{k,k} \). Therefore, the following equation should be added to the formal problem definition presented in Eqs. (1)-(3)     </p><p class="formulaDsp">
\[
    \begin{align}
        -{\rm{div}} \boldsymbol{u} + \dfrac{1}{\lambda}p &amp;= 0 \quad \text{in} \quad \Omega.
    \end{align}
\]
</p>
<p>With two independent unknowns, \( u \) and \( p \), the incompressible elasticity problem is discretised as follows              </p><p class="formulaDsp">
\[
    \begin{align}
\left[ {\begin{array}{*{20}{c}}
{\bf{K}}&amp;{\bf{G}}\\
{{{\bf{G}}^T}}&amp;{\bf{P}}
\end{array}} \right]\left\{ {\begin{array}{*{20}{c}}
{{\bf{ u}}}\\
{{\bf{ p}}}
\end{array}} \right\} = \left\{ {\begin{array}{*{20}{c}}
{{\bf{ f}}}\\
{\bf{0}}
\end{array}} \right\},
    \end{align}
\]
</p>
<p> where</p>
<p class="formulaDsp">
\[
    \begin{align}
        {\bf{K}} &amp;= \int\limits_\Omega  {{{\bf{B}}^T}{{\bf{D}}_d}{\bf{B}}d\Omega } \\
        {\bf{G}} &amp;=  - \int\limits_\Omega  {{{\bf{B}}^T}{\bf m}{{\bf{N}}_p}d\Omega }, \\
        {\bf{P}} &amp;=  - \int\limits_\Omega  {{\bf{N}}_p^T\frac{1}{\lambda
        }{{\bf{N}}_p}d\Omega }, \\
        {\bf{ f}} &amp;= \int\limits_\Gamma  {{\bf{N}}_u^T{\bf{t}}d\Gamma }.
    \end{align}
\]
</p>
<p>In the platform of <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a>, while the complete implementation of user data operators (UDO) can be found in <a class="el" href="elasticity_mixed_formulation_8cpp-example.html">elasticity_mixed_formulation.cpp</a> and <a class="el" href="_elasticity_mixed_formulation_8hpp.html">ElasticityMixedFormulation.hpp</a>, the matrices above are implemented in UDO as follows</p><ul>
<li>\( {\bf K} \) is implemented in <a class="el" href="struct_op_assemble_k.html" title="Assemble K *.">OpAssembleK</a></li>
<li>\( {\bf G} \) is implemented in <a class="el" href="struct_op_assemble_g.html" title="Assemble G *.">OpAssembleG</a></li>
<li>\( {\bf P} \) is implemented in <a class="el" href="struct_op_assemble_p.html" title="Assemble P *.">OpAssembleP</a></li>
</ul>
<p>It is worth noting that, in order to obtain stable results for the problem of incompressible elasticity, the approximation order of displacement should be higher than that of hydrostatic pressure. The consequences of choosing inappropriate approximation order of the two unknowns will be discussed later in this tutorial.</p>
<h1><a class="anchor" id="elasticity_mixed_formulation_input_mesh"></a>
Input mesh</h1>
<p>As an example, an L-shape structure being clamped at the bottom surface and pressurised with unit magnitude at the top right surface will be used for the analysis of incompressible elasticity. The 3D model and mesh which shown in <a class="el" href="#figure_cubit_mesh">Figure 1</a> are created by Cubit using a simple journal script below</p>
<div class="fragment"><div class="line">reset</div>
<div class="line">set duplicate block elements on</div>
<div class="line"> </div>
<div class="line">brick x 1 y 2 z 0.5</div>
<div class="line">brick x 2 y 1 z 0.5</div>
<div class="line"> </div>
<div class="line">move curve 23 midpoint location curve 11 include_merged</div>
<div class="line">unite volume all </div>
<div class="line"> </div>
<div class="line">Sideset 1 <a class="code hl_namespace" href="namespacesurface.html">surface</a> 3 </div>
<div class="line">Sideset 2 <a class="code hl_namespace" href="namespacesurface.html">surface</a> 12 </div>
<div class="line"> </div>
<div class="line">Sideset 100 curve all </div>
<div class="line">nodeset 101 vertex all </div>
<div class="line">Sideset 102 <a class="code hl_namespace" href="namespacesurface.html">surface</a> all</div>
<div class="line"> </div>
<div class="line">{<a class="code hl_variable" href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a> = 1}</div>
<div class="line">{<a class="code hl_variable" href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a> = 0.5}</div>
<div class="line">block 1 volume all </div>
<div class="line">block 1 name <span class="stringliteral">&#39;MAT_ELASTIC&#39;</span></div>
<div class="line">block 1 attribute count 2</div>
<div class="line">block 1 attribute index 1 {<a class="code hl_variable" href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a>}</div>
<div class="line">block 1 attribute index 2 {<a class="code hl_variable" href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a>} </div>
<div class="line"> </div>
<div class="line">create displacement on <a class="code hl_namespace" href="namespacesurface.html">surface</a> 3 dof 1 dof 2 dof 3 fix 0</div>
<div class="line">create pressure on <a class="code hl_namespace" href="namespacesurface.html">surface</a> 12 magnitude 1 </div>
<div class="line"> </div>
<div class="line">volume all scheme tetmesh</div>
<div class="line">volume all size <span class="keyword">auto</span> factor 7</div>
<div class="line">mesh volume all</div>
<div class="line"> </div>
<div class="line">save as <span class="stringliteral">&quot;/Users/username/mofem_install/um/build/basic_finite_elements/elasticity_mixed_formulation/LShape_incompressible.cub&quot;</span> overwrite</div>
<div class="ttc" id="anamespacesurface_html"><div class="ttname"><a href="namespacesurface.html">surface</a></div><div class="ttdef"><b>Definition</b> <a href="surface_8py_source.html#l00001">surface.py:1</a></div></div>
<div class="ttc" id="aplastic_8cpp_html_a0447f1370e525557f8d7c6a1ed22be14"><div class="ttname"><a href="plastic_8cpp.html#a0447f1370e525557f8d7c6a1ed22be14">young_modulus</a></div><div class="ttdeci">double young_modulus</div><div class="ttdoc">Young modulus.</div><div class="ttdef"><b>Definition</b> <a href="plastic_8cpp_source.html#l00121">plastic.cpp:121</a></div></div>
<div class="ttc" id="aplastic_8cpp_html_a571fc4d0022947a6d01a56a53d5668e6"><div class="ttname"><a href="plastic_8cpp.html#a571fc4d0022947a6d01a56a53d5668e6">poisson_ratio</a></div><div class="ttdeci">double poisson_ratio</div><div class="ttdoc">Poisson ratio.</div><div class="ttdef"><b>Definition</b> <a href="plastic_8cpp_source.html#l00122">plastic.cpp:122</a></div></div>
</div><!-- fragment --><p><a class="anchor" id="figure_cubit_mesh"></a></p><div class="image">
<img src="emf_cubit_mesh.png" alt="" width="600px"/>
<div class="caption">
Figure 1: Element mesh.</div></div>
<h1><a class="anchor" id="elasticity_mixed_formulation_code_dissection"></a>
Code dissection</h1>
<h2><a class="anchor" id="elasticity_mixed_formulation_init"></a>
Initialisation</h2>
<ul>
<li>There are two header files in which the first one for basic finite elements and the second one contains the implementation of operators for finite elements.</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_elasticity_mixed_formulation_8hpp.html">ElasticityMixedFormulation.hpp</a>&gt;</span></div>
<div class="ttc" id="a_elasticity_mixed_formulation_8hpp_html"><div class="ttname"><a href="_elasticity_mixed_formulation_8hpp.html">ElasticityMixedFormulation.hpp</a></div></div>
</div><!-- fragment --><ul>
<li>Initialise <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> <div class="fragment"><div class="line"><span class="comment">// Initialise MoFEM</span></div>
<div class="line"><a class="code hl_function" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::Core::Initialize</a>(&amp;argc, &amp;argv, (<span class="keywordtype">char</span> *)0, <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>);</div>
<div class="ttc" id="aactivate__deactivate__dofs_8cpp_html_a29680e68c64040f4884f60691a193226"><div class="ttname"><a href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a></div><div class="ttdeci">static char help[]</div><div class="ttdef"><b>Definition</b> <a href="activate__deactivate__dofs_8cpp_source.html#l00013">activate_deactivate_dofs.cpp:13</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_tmp_3_010_01_4_html_a137f1f2092d00ef0c1ec679db94b8cb0"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::CoreTmp&lt; 0 &gt;::Initialize</a></div><div class="ttdeci">static MoFEMErrorCode Initialize(int *argc, char ***args, const char file[], const char help[])</div><div class="ttdoc">Initializes the MoFEM database PETSc, MOAB and MPI.</div><div class="ttdef"><b>Definition</b> <a href="_core_8cpp_source.html#l00072">Core.cpp:72</a></div></div>
</div><!-- fragment --></li>
<li>Create mesh database and an interface to interact with it <div class="fragment"><div class="line"><span class="comment">// Create mesh database</span></div>
<div class="line">moab::Core mb_instance;              <span class="comment">// create database</span></div>
<div class="line">moab::Interface &amp;moab = mb_instance; <span class="comment">// create interface to database</span></div>
</div><!-- fragment --></li>
<li>Creat MoAB communicator <div class="fragment"><div class="line">MPI_Comm moab_comm_world;</div>
<div class="line"><span class="keyword">auto</span> moab_comm_wrap =</div>
<div class="line">    boost::make_shared&lt;WrapMPIComm&gt;(PETSC_COMM_WORLD, <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordflow">if</span> (pcomm == NULL)</div>
<div class="line">  pcomm =</div>
<div class="line">      <span class="keyword">new</span> ParallelComm(&amp;moab, moab_comm_wrap-&gt;get_comm());</div>
</div><!-- fragment --></li>
<li>Declare variables and read arguments from the command line <div class="fragment"><div class="line"><span class="comment">// Get command line options</span></div>
<div class="line">    <span class="keywordtype">char</span> <a class="code hl_variable" href="mesh__smoothing_8cpp.html#ae20b66af13b03d8e8a4593186c23cd07">mesh_file_name</a>[255];</div>
<div class="line">    PetscBool flg_file;</div>
<div class="line">    <span class="keywordtype">int</span> order_p = 2; <span class="comment">// default approximation order_p</span></div>
<div class="line">    <span class="keywordtype">int</span> order_u = 3; <span class="comment">// default approximation order_u</span></div>
<div class="line">    PetscBool is_partitioned = PETSC_FALSE;</div>
<div class="line">    PetscBool calc_reactions = PETSC_FALSE;</div>
<div class="line">    PetscBool flg_test = PETSC_FALSE; <span class="comment">// true check if error is numerical error</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsBegin(PETSC_COMM_WORLD, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Mix elastic problem&quot;</span>,</div>
<div class="line">                             <span class="stringliteral">&quot;none&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsString(<span class="stringliteral">&quot;-my_file&quot;</span>, <span class="stringliteral">&quot;mesh file name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;mesh.h5m&quot;</span>,</div>
<div class="line">                              <a class="code hl_variable" href="mesh__smoothing_8cpp.html#ae20b66af13b03d8e8a4593186c23cd07">mesh_file_name</a>, 255, &amp;flg_file);</div>
<div class="line">    <span class="comment">// Set approximation order</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsInt(<span class="stringliteral">&quot;-my_order_p&quot;</span>, <span class="stringliteral">&quot;approximation order_p&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, order_p,</div>
<div class="line">                           &amp;order_p, PETSC_NULL);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsInt(<span class="stringliteral">&quot;-my_order_u&quot;</span>, <span class="stringliteral">&quot;approximation order_u&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, order_u,</div>
<div class="line">                           &amp;order_u, PETSC_NULL);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsBool(<span class="stringliteral">&quot;-is_partitioned&quot;</span>, <span class="stringliteral">&quot;is_partitioned?&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                            is_partitioned, &amp;is_partitioned, PETSC_NULL);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsBool(<span class="stringliteral">&quot;-calc_reactions&quot;</span>,</div>
<div class="line">                            <span class="stringliteral">&quot;calculate reactions for blocksets&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">                            calc_reactions, &amp;calc_reactions, PETSC_NULL);</div>
<div class="line">    <span class="comment">// Set testing (used by CTest)</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsBool(<span class="stringliteral">&quot;-test&quot;</span>, <span class="stringliteral">&quot;if true is ctest&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, flg_test,</div>
<div class="line">                            &amp;flg_test, PETSC_NULL);</div>
<div class="line">    <a class="code hl_variable" href="base__functions_8c.html#a56d2889a19d8d7affaa85cfca4aadd67">ierr</a> = PetscOptionsEnd();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (flg_file != PETSC_TRUE) {</div>
<div class="line">      SETERRQ(PETSC_COMM_SELF, 1, <span class="stringliteral">&quot;*** ERROR -my_file (MESH FILE NEEDED)&quot;</span>);</div>
<div class="line">    }</div>
<div class="ttc" id="abase__functions_8c_html_a56d2889a19d8d7affaa85cfca4aadd67"><div class="ttname"><a href="base__functions_8c.html#a56d2889a19d8d7affaa85cfca4aadd67">ierr</a></div><div class="ttdeci">static PetscErrorCode ierr</div><div class="ttdef"><b>Definition</b> <a href="base__functions_8c_source.html#l00013">base_functions.c:13</a></div></div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00548">definitions.h:548</a></div></div>
<div class="ttc" id="amesh__smoothing_8cpp_html_ae20b66af13b03d8e8a4593186c23cd07"><div class="ttname"><a href="mesh__smoothing_8cpp.html#ae20b66af13b03d8e8a4593186c23cd07">mesh_file_name</a></div><div class="ttdeci">char mesh_file_name[255]</div><div class="ttdef"><b>Definition</b> <a href="mesh__smoothing_8cpp_source.html#l00022">mesh_smoothing.cpp:22</a></div></div>
</div><!-- fragment --></li>
<li>Read the mesh <div class="fragment"><div class="line"><span class="comment">// Read whole mesh or part of it if partitioned</span></div>
<div class="line"> <span class="keywordflow">if</span> (is_partitioned == PETSC_TRUE) {</div>
<div class="line">   <span class="comment">// This is a case of distributed mesh and algebra. In that case each</span></div>
<div class="line">   <span class="comment">// processor keeps only part of the problem.</span></div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *option;</div>
<div class="line">   option = <span class="stringliteral">&quot;PARALLEL=READ_PART;&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;PARALLEL_RESOLVE_SHARED_ENTS;&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;PARTITION=PARALLEL_PARTITION;&quot;</span>;</div>
<div class="line">   <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> moab.load_file(<a class="code hl_variable" href="mesh__smoothing_8cpp.html#ae20b66af13b03d8e8a4593186c23cd07">mesh_file_name</a>, 0, option);</div>
<div class="line"> } <span class="keywordflow">else</span> {</div>
<div class="line">   <span class="comment">// In this case, we have distributed algebra, i.e. assembly of vectors and</span></div>
<div class="line">   <span class="comment">// matrices is in parallel, but whole mesh is stored on all processors.</span></div>
<div class="line">   <span class="comment">// Solver and matrix scales well, however problem set-up of problem is</span></div>
<div class="line">   <span class="comment">// not fully parallel.</span></div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *option;</div>
<div class="line">   option = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">   <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> moab.load_file(<a class="code hl_variable" href="mesh__smoothing_8cpp.html#ae20b66af13b03d8e8a4593186c23cd07">mesh_file_name</a>, 0, option);</div>
<div class="line"> }</div>
</div><!-- fragment --></li>
<li>Creat <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> database <div class="fragment"><div class="line"><span class="comment">// Create MoFEM database and link it to MoAB</span></div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html">MoFEM::Core</a> core(moab);</div>
<div class="line">    <a class="code hl_struct" href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::Interface</a> &amp;m_field = core;</div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_tmp_3_010_01_4_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_tmp_3_010_01_4.html">MoFEM::CoreTmp&lt; 0 &gt;</a></div><div class="ttdoc">Core (interface) class.</div><div class="ttdef"><b>Definition</b> <a href="_core_8hpp_source.html#l00082">Core.hpp:82</a></div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_deprecated_core_interface_html"><div class="ttname"><a href="struct_mo_f_e_m_1_1_deprecated_core_interface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition</b> <a href="_deprecated_core_interface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
</div><!-- fragment --></li>
<li>Output boundary condition and material properties from the mesh <div class="fragment"><div class="line"><span class="comment">// Print boundary conditions and material parameters</span></div>
<div class="line">MeshsetsManager *meshsets_mng_ptr;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>(meshsets_mng_ptr);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> meshsets_mng_ptr-&gt;printDisplacementSet();</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> meshsets_mng_ptr-&gt;printForceSet();</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> meshsets_mng_ptr-&gt;printMaterialsSet();</div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_unknown_interface_html_a7ab248ec45fca778800dcd92e5171beb"><div class="ttname"><a href="struct_mo_f_e_m_1_1_unknown_interface.html#a7ab248ec45fca778800dcd92e5171beb">MoFEM::UnknownInterface::getInterface</a></div><div class="ttdeci">MoFEMErrorCode getInterface(IFACE *&amp;iface) const</div><div class="ttdoc">Get interface reference to pointer of interface.</div><div class="ttdef"><b>Definition</b> <a href="_unknown_interface_8hpp_source.html#l00093">UnknownInterface.hpp:93</a></div></div>
</div><!-- fragment --></li>
<li>Add three fields <div class="fragment"><div class="line"><span class="comment">// **** ADD FIELDS **** //</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a8008ad16315eb609dcb0fd88746b991a">add_field</a>(<span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>,</div>
<div class="line">                         3);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#gaa584a5c9cc28f5ae0a7088d130683be8">add_ents_to_field_by_type</a>(0, MBTET, <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBVERTEX, <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>, 1);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a8008ad16315eb609dcb0fd88746b991a">add_field</a>(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 3);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#gaa584a5c9cc28f5ae0a7088d130683be8">add_ents_to_field_by_type</a>(0, MBTET, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBVERTEX, <span class="stringliteral">&quot;U&quot;</span>, 1);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBEDGE, <span class="stringliteral">&quot;U&quot;</span>, order_u);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBTRI, <span class="stringliteral">&quot;U&quot;</span>, order_u);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBTET, <span class="stringliteral">&quot;U&quot;</span>, order_u);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a8008ad16315eb609dcb0fd88746b991a">add_field</a>(<span class="stringliteral">&quot;P&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 1);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#gaa584a5c9cc28f5ae0a7088d130683be8">add_ents_to_field_by_type</a>(0, MBTET, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBVERTEX, <span class="stringliteral">&quot;P&quot;</span>, 1);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBEDGE, <span class="stringliteral">&quot;P&quot;</span>, order_p);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBTRI, <span class="stringliteral">&quot;P&quot;</span>, order_p);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">set_field_order</a>(0, MBTET, <span class="stringliteral">&quot;P&quot;</span>, order_p);</div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a></div><div class="ttdeci">@ AINSWORTH_LEGENDRE_BASE</div><div class="ttdoc">Ainsworth Cole (Legendre) approx. base nme:nme847.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00061">definitions.h:60</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120"><div class="ttname"><a href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a></div><div class="ttdeci">@ H1</div><div class="ttdoc">continuous field</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00085">definitions.h:85</a></div></div>
<div class="ttc" id="agroup__mofem__field_html_ga86f0c16b69cc30dabc5d7dd292299b07"><div class="ttname"><a href="group__mofem__field.html#ga86f0c16b69cc30dabc5d7dd292299b07">MoFEM::CoreInterface::set_field_order</a></div><div class="ttdeci">virtual MoFEMErrorCode set_field_order(const EntityHandle meshset, const EntityType type, const std::string &amp;name, const ApproximationOrder order, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Set order approximation of the entities in the field.</div></div>
<div class="ttc" id="agroup__mofem__field_html_gaa584a5c9cc28f5ae0a7088d130683be8"><div class="ttname"><a href="group__mofem__field.html#gaa584a5c9cc28f5ae0a7088d130683be8">MoFEM::CoreInterface::add_ents_to_field_by_type</a></div><div class="ttdeci">virtual MoFEMErrorCode add_ents_to_field_by_type(const Range &amp;ents, const EntityType type, const std::string &amp;name, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Add entities to field meshset.</div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_interface_html_a8008ad16315eb609dcb0fd88746b991a"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_interface.html#a8008ad16315eb609dcb0fd88746b991a">MoFEM::CoreInterface::add_field</a></div><div class="ttdeci">virtual MoFEMErrorCode add_field(const std::string name, const FieldSpace space, const FieldApproximationBase base, const FieldCoefficientsNumber nb_of_coefficients, const TagType tag_type=MB_TAG_SPARSE, const enum MoFEMTypes bh=MF_EXCL, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Add field.</div></div>
</div><!-- fragment --></li>
<li>Build fields <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__field.html#ga126ea0bb04802f9d1946435279c3da56">build_fields</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CHKERR m_field.getInterface&lt;FieldBlas&gt;()-&gt;setField(</span></div>
<div class="line"><span class="comment">//     0, MBVERTEX, &quot;P&quot;); // initial p = 0 everywhere</span></div>
<div class="line">{</div>
<div class="line">  Projection10NodeCoordsOnField ent_method_material(m_field,</div>
<div class="line">                                                    <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__loops.html#ga06843828fb475925d003a31b991c425e">loop_dofs</a>(<span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>, ent_method_material);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__mofem__field_html_ga126ea0bb04802f9d1946435279c3da56"><div class="ttname"><a href="group__mofem__field.html#ga126ea0bb04802f9d1946435279c3da56">MoFEM::CoreInterface::build_fields</a></div><div class="ttdeci">virtual MoFEMErrorCode build_fields(int verb=DEFAULT_VERBOSITY)=0</div></div>
<div class="ttc" id="agroup__mofem__loops_html_ga06843828fb475925d003a31b991c425e"><div class="ttname"><a href="group__mofem__loops.html#ga06843828fb475925d003a31b991c425e">MoFEM::CoreInterface::loop_dofs</a></div><div class="ttdeci">virtual MoFEMErrorCode loop_dofs(const Problem *problem_ptr, const std::string &amp;field_name, RowColData rc, DofMethod &amp;method, int lower_rank, int upper_rank, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Make a loop over dofs.</div></div>
</div><!-- fragment --></li>
<li>Add finite elements <div class="fragment"><div class="line"><span class="comment">// **** ADD ELEMENTS **** //</span></div>
<div class="line"><span class="comment">// Add finite element (this defines element, declaration comes later)</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga4a5b822f605f1a4faa668595a3f2a5ae">add_finite_element</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gad29d66fc5706d3b20e4acd02eac81c9d">modify_finite_element_add_field_row</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga8a9935d6f31d07ed365e6cc76bd041d2">modify_finite_element_add_field_col</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">modify_finite_element_add_field_data</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gad29d66fc5706d3b20e4acd02eac81c9d">modify_finite_element_add_field_row</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga8a9935d6f31d07ed365e6cc76bd041d2">modify_finite_element_add_field_col</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">modify_finite_element_add_field_data</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">modify_finite_element_add_field_data</a>(<span class="stringliteral">&quot;ELASTIC&quot;</span>,</div>
<div class="line">                                                    <span class="stringliteral">&quot;MESH_NODE_POSITIONS&quot;</span>);</div>
<div class="ttc" id="agroup__mofem__fe_html_ga4a5b822f605f1a4faa668595a3f2a5ae"><div class="ttname"><a href="group__mofem__fe.html#ga4a5b822f605f1a4faa668595a3f2a5ae">MoFEM::CoreInterface::add_finite_element</a></div><div class="ttdeci">virtual MoFEMErrorCode add_finite_element(const std::string &amp;fe_name, enum MoFEMTypes bh=MF_EXCL, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">add finite element</div></div>
<div class="ttc" id="agroup__mofem__fe_html_ga8a9935d6f31d07ed365e6cc76bd041d2"><div class="ttname"><a href="group__mofem__fe.html#ga8a9935d6f31d07ed365e6cc76bd041d2">MoFEM::CoreInterface::modify_finite_element_add_field_col</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_col(const std::string &amp;fe_name, const std::string name_row)=0</div><div class="ttdoc">set field col which finite element use</div></div>
<div class="ttc" id="agroup__mofem__fe_html_gad29d66fc5706d3b20e4acd02eac81c9d"><div class="ttname"><a href="group__mofem__fe.html#gad29d66fc5706d3b20e4acd02eac81c9d">MoFEM::CoreInterface::modify_finite_element_add_field_row</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_row(const std::string &amp;fe_name, const std::string name_row)=0</div><div class="ttdoc">set field row which finite element use</div></div>
<div class="ttc" id="agroup__mofem__fe_html_gaef2eb2d85b90b55bd7c4f355e10fa498"><div class="ttname"><a href="group__mofem__fe.html#gaef2eb2d85b90b55bd7c4f355e10fa498">MoFEM::CoreInterface::modify_finite_element_add_field_data</a></div><div class="ttdeci">virtual MoFEMErrorCode modify_finite_element_add_field_data(const std::string &amp;fe_name, const std::string name_field)=0</div><div class="ttdoc">set finite element field data</div></div>
</div><!-- fragment --></li>
<li>Add entities to elements and build them <div class="fragment"><div class="line"><span class="comment">// Add entities to that element</span></div>
<div class="line"> <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga8b068eced1fd720631edcaea59289a15">add_ents_to_finite_element_by_type</a>(0, MBTET, <span class="stringliteral">&quot;ELASTIC&quot;</span>);</div>
<div class="line"> <span class="comment">// build finite elements</span></div>
<div class="line"> <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="group__mofem__fe.html#ga735f920686a9c958073ec14ea0dc1da0">build_finite_elements</a>();</div>
<div class="line"> <span class="comment">// build adjacencies between elements and degrees of freedom</span></div>
<div class="line"> <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a727653d1367e758daf2a74cb65d4dfa5">build_adjacencies</a>(bit_level0); </div>
<div class="ttc" id="agroup__mofem__fe_html_ga735f920686a9c958073ec14ea0dc1da0"><div class="ttname"><a href="group__mofem__fe.html#ga735f920686a9c958073ec14ea0dc1da0">MoFEM::CoreInterface::build_finite_elements</a></div><div class="ttdeci">virtual MoFEMErrorCode build_finite_elements(int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">Build finite elements.</div></div>
<div class="ttc" id="agroup__mofem__fe_html_ga8b068eced1fd720631edcaea59289a15"><div class="ttname"><a href="group__mofem__fe.html#ga8b068eced1fd720631edcaea59289a15">MoFEM::CoreInterface::add_ents_to_finite_element_by_type</a></div><div class="ttdeci">virtual MoFEMErrorCode add_ents_to_finite_element_by_type(const EntityHandle entities, const EntityType type, const std::string &amp;name, const bool recursive=true)=0</div><div class="ttdoc">add entities to finite element</div></div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_interface_html_a727653d1367e758daf2a74cb65d4dfa5"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_interface.html#a727653d1367e758daf2a74cb65d4dfa5">MoFEM::CoreInterface::build_adjacencies</a></div><div class="ttdeci">virtual MoFEMErrorCode build_adjacencies(const Range &amp;ents, int verb=DEFAULT_VERBOSITY)=0</div><div class="ttdoc">build adjacencies</div></div>
</div><!-- fragment --></li>
<li>Build and setup discrete manager <div class="fragment"><div class="line"><span class="comment">// **** BUILD DM **** //</span></div>
<div class="line">DM dm;</div>
<div class="line">DMType dm_name = <span class="stringliteral">&quot;DM_ELASTIC_MIX&quot;</span>;</div>
<div class="line"><span class="comment">// Register DM problem</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMRegister_MoFEM(dm_name);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreate(PETSC_COMM_WORLD, &amp;dm);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetType(dm, dm_name);</div>
<div class="line"><span class="comment">// Create DM instance</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMCreateMoFEM(dm, &amp;m_field, dm_name, bit_level0);</div>
<div class="line"><span class="comment">// Configure DM form line command options (DM itself, solvers,</span></div>
<div class="line"><span class="comment">// pre-conditioners, ... )</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetFromOptions(dm);</div>
<div class="line"><span class="comment">// Add elements to dm (only one here)</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm, <span class="stringliteral">&quot;ELASTIC&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a63fc22416f2a0fbdea7406d3aa21fd17">check_finite_element</a>(<span class="stringliteral">&quot;PRESSURE_FE&quot;</span>))</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm, <span class="stringliteral">&quot;PRESSURE_FE&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (m_field.<a class="code hl_function" href="struct_mo_f_e_m_1_1_core_interface.html#a63fc22416f2a0fbdea7406d3aa21fd17">check_finite_element</a>(<span class="stringliteral">&quot;FORCE_FE&quot;</span>))</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm, <span class="stringliteral">&quot;FORCE_FE&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMSetIsPartitioned(dm, is_partitioned);</div>
<div class="line"><span class="comment">// setup the DM</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetUp(dm);</div>
<div class="ttc" id="astruct_mo_f_e_m_1_1_core_interface_html_a63fc22416f2a0fbdea7406d3aa21fd17"><div class="ttname"><a href="struct_mo_f_e_m_1_1_core_interface.html#a63fc22416f2a0fbdea7406d3aa21fd17">MoFEM::CoreInterface::check_finite_element</a></div><div class="ttdeci">virtual bool check_finite_element(const std::string &amp;name) const =0</div><div class="ttdoc">Check if finite element is in database.</div></div>
</div><!-- fragment --></li>
<li>Declare share pointers to finit element objects <div class="fragment"><div class="line">boost::shared_ptr&lt;FEMethod&gt; nullFE;</div>
<div class="line">boost::shared_ptr&lt;VolumeElementForcesAndSourcesCore&gt; feLhs(</div>
<div class="line">    <span class="keyword">new</span> VolumeElementForcesAndSourcesCore(m_field));</div>
<div class="line">boost::shared_ptr&lt;VolumeElementForcesAndSourcesCore&gt; feRhs(</div>
<div class="line">    <span class="keyword">new</span> VolumeElementForcesAndSourcesCore(m_field));</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="elasticity_mixed_formulation_solve_problem"></a>
Solving the problem</h2>
<ul>
<li>Stiffness matrix, vector of DOFs, and right-hand-side (RHS) vector are declared and associated to the Discrete Manager <div class="fragment"><div class="line">Mat Aij;      <span class="comment">// Stiffness matrix</span></div>
<div class="line">Vec d, F_ext; <span class="comment">// Vector of DOFs and the RHS</span></div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateGlobalVector_MoFEM(dm, &amp;d);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecZeroEntries(d);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDuplicate(d, &amp;F_ext);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateMatrix_MoFEM(dm, &amp;Aij);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateBegin(d, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecGhostUpdateEnd(d, INSERT_VALUES, SCATTER_FORWARD);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMMeshToLocalVector(dm, d, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatZeroEntries(Aij);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Finite element instances are pointed to the matrix and vector <div class="fragment"><div class="line"><span class="comment">// Assign global matrix/vector</span></div>
<div class="line">feLhs-&gt;ksp_B = Aij;</div>
<div class="line">feLhs-&gt;ksp_f = F_ext;</div>
</div><!-- fragment --></li>
<li>Loop over element to compute and assemble stiffness matrix, vectors of DOFs and RHS <div class="fragment"><div class="line">boost::shared_ptr&lt;DirichletDisplacementBc&gt; dirichlet_bc_ptr(</div>
<div class="line">    <span class="keyword">new</span> <a class="code hl_struct" href="struct_dirichlet_displacement_bc.html">DirichletDisplacementBc</a>(m_field, <span class="stringliteral">&quot;U&quot;</span>, Aij, d, F_ext));</div>
<div class="line">dirichlet_bc_ptr-&gt;snes_ctx = FEMethod::CTX_SNESNONE;</div>
<div class="line">dirichlet_bc_ptr-&gt;ts_ctx = FEMethod::CTX_TSNONE;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMPreProcessFiniteElements(dm, dirichlet_bc_ptr.get());</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, <span class="stringliteral">&quot;ELASTIC&quot;</span>, feLhs);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assemble pressure and traction forces.</span></div>
<div class="line">boost::ptr_map&lt;std::string, NeumannForcesSurface&gt; neumann_forces;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_meta_neumann_forces.html#ad0f272e64b6937cc53769ecaa409d8b1">MetaNeumannForces::setMomentumFluxOperators</a>(m_field, neumann_forces,</div>
<div class="line">                                                   F_ext, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  boost::ptr_map&lt;std::string, NeumannForcesSurface&gt;::iterator mit =</div>
<div class="line">      neumann_forces.begin();</div>
<div class="line">  <span class="keywordflow">for</span> (; mit != neumann_forces.end(); mit++) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, mit-&gt;first.c_str(),</div>
<div class="line">                                    &amp;mit-&gt;second-&gt;getLoopFe());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="comment">// Assemble forces applied to nodes, see implementation in NodalForce</span></div>
<div class="line">boost::ptr_map&lt;std::string, NodalForce&gt; nodal_forces;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_meta_nodal_forces.html#a84ba4b4c66e9df18c139cb81808cadc2">MetaNodalForces::setOperators</a>(m_field, nodal_forces, F_ext, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  boost::ptr_map&lt;std::string, NodalForce&gt;::iterator fit =</div>
<div class="line">      nodal_forces.begin();</div>
<div class="line">  <span class="keywordflow">for</span> (; fit != nodal_forces.end(); fit++) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, fit-&gt;first.c_str(),</div>
<div class="line">                                    &amp;fit-&gt;second-&gt;getLoopFe());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="comment">// Assemble edge forces</span></div>
<div class="line">boost::ptr_map&lt;std::string, EdgeForce&gt; edge_forces;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="struct_meta_edge_forces.html#a46625c9571b0469a5c4a7aa1c8f6c272">MetaEdgeForces::setOperators</a>(m_field, edge_forces, F_ext, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  boost::ptr_map&lt;std::string, EdgeForce&gt;::iterator fit =</div>
<div class="line">      edge_forces.begin();</div>
<div class="line">  <span class="keywordflow">for</span> (; fit != edge_forces.end(); fit++) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm, fit-&gt;first.c_str(),</div>
<div class="line">                                    &amp;fit-&gt;second-&gt;getLoopFe());</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga3fcdbd5c74eba11ee82492e57d730756">DMoFEMPostProcessFiniteElements</a>(dm, dirichlet_bc_ptr.get());</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gadf1d5425969ed88f332549c5b4ba5291">DMMoFEMKSPSetComputeOperators</a>(dm, <span class="stringliteral">&quot;ELASTIC&quot;</span>, feLhs, nullFE, nullFE);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyBegin(F_ext);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyEnd(F_ext);</div>
<div class="ttc" id="agroup__dm_html_ga3fcdbd5c74eba11ee82492e57d730756"><div class="ttname"><a href="group__dm.html#ga3fcdbd5c74eba11ee82492e57d730756">MoFEM::DMoFEMPostProcessFiniteElements</a></div><div class="ttdeci">PetscErrorCode DMoFEMPostProcessFiniteElements(DM dm, MoFEM::FEMethod *method)</div><div class="ttdoc">execute finite element method for each element in dm (problem)</div><div class="ttdef"><b>Definition</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00556">DMMoFEM.cpp:556</a></div></div>
<div class="ttc" id="agroup__dm_html_gaa77602fddf773ab52fee8369cc135d7e"><div class="ttname"><a href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">MoFEM::DMoFEMLoopFiniteElements</a></div><div class="ttdeci">PetscErrorCode DMoFEMLoopFiniteElements(DM dm, const char fe_name[], MoFEM::FEMethod *method, CacheTupleWeakPtr cache_ptr=CacheTupleSharedPtr())</div><div class="ttdoc">Executes FEMethod for finite elements in DM.</div><div class="ttdef"><b>Definition</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00586">DMMoFEM.cpp:586</a></div></div>
<div class="ttc" id="agroup__dm_html_gadf1d5425969ed88f332549c5b4ba5291"><div class="ttname"><a href="group__dm.html#gadf1d5425969ed88f332549c5b4ba5291">MoFEM::DMMoFEMKSPSetComputeOperators</a></div><div class="ttdeci">PetscErrorCode DMMoFEMKSPSetComputeOperators(DM dm, const char fe_name[], MoFEM::FEMethod *method, MoFEM::BasicMethod *pre_only, MoFEM::BasicMethod *post_only)</div><div class="ttdoc">Set KSP operators and push mofem finite element methods.</div><div class="ttdef"><b>Definition</b> <a href="_d_m_mo_f_e_m_8cpp_source.html#l00678">DMMoFEM.cpp:678</a></div></div>
<div class="ttc" id="astruct_dirichlet_displacement_bc_html"><div class="ttname"><a href="struct_dirichlet_displacement_bc.html">DirichletDisplacementBc</a></div><div class="ttdoc">Set Dirichlet boundary conditions on displacements.</div><div class="ttdef"><b>Definition</b> <a href="_dirichlet_b_c_8hpp_source.html#l00057">DirichletBC.hpp:57</a></div></div>
<div class="ttc" id="astruct_meta_edge_forces_html_a46625c9571b0469a5c4a7aa1c8f6c272"><div class="ttname"><a href="struct_meta_edge_forces.html#a46625c9571b0469a5c4a7aa1c8f6c272">MetaEdgeForces::setOperators</a></div><div class="ttdeci">static MoFEMErrorCode setOperators(MoFEM::Interface &amp;m_field, boost::ptr_map&lt; std::string, EdgeForce &gt; &amp;edge_forces, Vec F, const std::string field_name, std::string mesh_node_positions=&quot;MESH_NODE_POSITIONS&quot;)</div><div class="ttdoc">Set integration point operators.</div><div class="ttdef"><b>Definition</b> <a href="_edge_force_8hpp_source.html#l00097">EdgeForce.hpp:97</a></div></div>
<div class="ttc" id="astruct_meta_neumann_forces_html_ad0f272e64b6937cc53769ecaa409d8b1"><div class="ttname"><a href="struct_meta_neumann_forces.html#ad0f272e64b6937cc53769ecaa409d8b1">MetaNeumannForces::setMomentumFluxOperators</a></div><div class="ttdeci">static MoFEMErrorCode setMomentumFluxOperators(MoFEM::Interface &amp;m_field, boost::ptr_map&lt; std::string, NeumannForcesSurface &gt; &amp;neumann_forces, Vec F, const std::string field_name, const std::string mesh_nodals_positions=&quot;MESH_NODE_POSITIONS&quot;)</div><div class="ttdoc">Set operators to finite elements calculating right hand side vector.</div><div class="ttdef"><b>Definition</b> <a href="_surface_pressure_8cpp_source.html#l02069">SurfacePressure.cpp:2069</a></div></div>
<div class="ttc" id="astruct_meta_nodal_forces_html_a84ba4b4c66e9df18c139cb81808cadc2"><div class="ttname"><a href="struct_meta_nodal_forces.html#a84ba4b4c66e9df18c139cb81808cadc2">MetaNodalForces::setOperators</a></div><div class="ttdeci">static MoFEMErrorCode setOperators(MoFEM::Interface &amp;m_field, boost::ptr_map&lt; std::string, NodalForce &gt; &amp;nodal_forces, Vec F, const std::string field_name)</div><div class="ttdoc">Set integration point operators.</div><div class="ttdef"><b>Definition</b> <a href="_nodal_force_8hpp_source.html#l00128">NodalForce.hpp:128</a></div></div>
</div><!-- fragment --></li>
<li>The matrix and vectors have been assembled and now the system of equation is solved using KSP solver <div class="fragment"><div class="line">KSP solver;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPCreate(PETSC_COMM_WORLD, &amp;solver);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(solver);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetOperators(solver, Aij, Aij);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(solver);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(solver, F_ext, d);</div>
</div><!-- fragment --></li>
<li>Map the solutions to mesh entities <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMMeshToGlobalVector(dm, d, INSERT_VALUES, SCATTER_REVERSE);</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="elasticity_mixed_formulation_postproc"></a>
Postprocessing</h2>
<ul>
<li>The solutions are passed to the postprocessor and information is written to the output file <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc.generateReferenceElementMesh();</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc.addFieldValuesPostProc(<span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc.addFieldValuesPostProc(<span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm, <span class="stringliteral">&quot;ELASTIC&quot;</span>, &amp;post_proc);</div>
<div class="line">PetscPrintf(PETSC_COMM_WORLD, <span class="stringliteral">&quot;Output file: %s\n&quot;</span>, <span class="stringliteral">&quot;out.h5m&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> post_proc.postProcMesh.write_file(<span class="stringliteral">&quot;out.h5m&quot;</span>, <span class="stringliteral">&quot;MOAB&quot;</span>,</div>
<div class="line">                                         <span class="stringliteral">&quot;PARALLEL=WRITE_PART&quot;</span>);</div>
</div><!-- fragment --></li>
<li>Finally, all dynamic objects Aij, d, F_ext, and Discrete Manager are destroyed to release memory <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;Aij);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDestroy(&amp;d);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDestroy(&amp;F_ext);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm);</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="elasticity_mixed_formulation_running_program"></a>
Running the program</h1>
<p>In order to run the program, one should first go to the directory where the problem is located, compile the code and then run the executable file. Typically, this can be done as follows</p>
<div class="fragment"><div class="line">cd mofem_install/um/build/basic_finite_elements/elasticity_mixed_formulation</div>
<div class="line">make -j2</div>
<div class="line">mpirun -np 2 ./elasticity_mixed_formulation -my_file LShape_incompressible.cub -my_order_p 2 -my_order_u 3 -ksp_type gmres -pc_type lu -pc_factor_mat_solver_type mumps -ksp_monitor</div>
</div><!-- fragment --><p>The options are explained as follows</p><ul>
<li><em>mpirun</em> <em>-np</em> <em>2</em>: two processors are used to run the analysis</li>
<li><em></em>./elasticity_mixed_formulation: path and name of the executable file, dot means current directory</li>
<li><em>-my_file</em> <em>LShape_incompressible.cub:</em> name of the mesh file</li>
<li><em>-my_order_p</em> 2: second order approximation for hydrostatic pressure <em>p</em> </li>
<li><em>-my_order_u</em> 3: third order approximation for displacement <em>u</em> </li>
<li><em>-ksp_type</em> <em>gmres:</em> <a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/KSP/KSPGMRES.html#KSPGMRES">Generalised Minimal Residual</a> is used as an iterative <a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/KSP/KSPType.html">Krylov subspace method</a></li>
<li><em>-pc_type</em> <em>lu:</em> Direct solver based on <a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCLU.html#PCLU">LU factorisation</a> as a preconditioner</li>
<li><em>-pc_factor_mat_solver_type</em> <em>mumps:</em> <a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MATSOLVERMUMPS.html">MUMPS</a> is used as matrix solver</li>
<li><em>-ksp_monitor:</em> <a href="https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/KSP/KSPMonitorSet.html">function</a> to be called at every iteration to monitor the residual/error</li>
</ul>
<h2><a class="anchor" id="elasticity_mixed_formulation_output_dissection"></a>
Output dissection</h2>
<p><b>Initialisation</b> <b>and</b> <b>Setup</b> </p>
<ul>
<li>Cubit mesh being read <div class="fragment"><div class="line">read cubit meshset 12682136550675316776 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e">MAT_ELASTICSET</a> msId 1 name MAT_ELASTIC block header:  blockCol = 4294967295 blockMat = 0 blockDimension = 3</div>
<div class="line">read cubit meshset 12682136550675316777 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca7b4c0e5ae1385e1224a6e59abf47ecc0">NODESET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca9617e89781f10fe417167bc4bd86a843">DISPLACEMENTSET</a> msId 1</div>
<div class="line">read cubit meshset 12682136550675316778 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca7b4c0e5ae1385e1224a6e59abf47ecc0">NODESET</a> msId 101</div>
<div class="line">read cubit meshset 12682136550675316779 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a> msId 1</div>
<div class="line">read cubit meshset 12682136550675316780 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a> msId 2</div>
<div class="line">read cubit meshset 12682136550675316781 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca1aacb952ebfd7b0ad16085a9bf1fcf0a">PRESSURESET</a> msId 3</div>
<div class="line">read cubit meshset 12682136550675316782 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a> msId 100</div>
<div class="line">read cubit meshset 12682136550675316783 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a> msId 102</div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca1aacb952ebfd7b0ad16085a9bf1fcf0a"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca1aacb952ebfd7b0ad16085a9bf1fcf0a">PRESSURESET</a></div><div class="ttdeci">@ PRESSURESET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00165">definitions.h:165</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e">MAT_ELASTICSET</a></div><div class="ttdeci">@ MAT_ELASTICSET</div><div class="ttdoc">block name is &quot;MAT_ELASTIC&quot;</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00172">definitions.h:172</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca7b4c0e5ae1385e1224a6e59abf47ecc0"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca7b4c0e5ae1385e1224a6e59abf47ecc0">NODESET</a></div><div class="ttdeci">@ NODESET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00159">definitions.h:159</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca86c05035d6a2fbc5762f39215d6a8a22">SIDESET</a></div><div class="ttdeci">@ SIDESET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00160">definitions.h:160</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efca9617e89781f10fe417167bc4bd86a843"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca9617e89781f10fe417167bc4bd86a843">DISPLACEMENTSET</a></div><div class="ttdeci">@ DISPLACEMENTSET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00163">definitions.h:163</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab"><div class="ttname"><a href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a></div><div class="ttdeci">@ BLOCKSET</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00161">definitions.h:161</a></div></div>
</div><!-- fragment --></li>
<li><a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> version and commit ID <div class="fragment"><div class="line"><a class="code hl_namespace" href="namespace_mo_f_e_m.html">MoFEM</a> version 0.8.15 (MOAB 5.0.2 Petsc Release Version 3.9.3, Jul, 02, 2018 ) </div>
<div class="line">git commit <span class="keywordtype">id</span> cdfa37ee13d92b014cc527b5ab7b844baf73f98d</div>
<div class="ttc" id="anamespace_mo_f_e_m_html"><div class="ttname"><a href="namespace_mo_f_e_m.html">MoFEM</a></div><div class="ttdoc">implementation of Data Operators for Forces and Sources</div><div class="ttdef"><b>Definition</b> <a href="_common_8hpp_source.html#l00010">Common.hpp:10</a></div></div>
</div><!-- fragment --></li>
<li>Boundary conditions from the mesh <div class="fragment"><div class="line"><a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> s p <a class="code hl_variable" href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a> <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> <a class="code hl_variable" href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a> e <a class="code hl_variable" href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a> e <a class="code hl_variable" href="initial__diffusion_8cpp.html#afd53743d1af6bfa2856255b23b5a41a9">n</a> <a class="code hl_variable" href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a> </div>
<div class="line"> </div>
<div class="line">Flag <span class="keywordflow">for</span> X-Translation (0/1): 1</div>
<div class="line">Flag for Y-Translation (0/1): 1</div>
<div class="line">Flag for Z-Translation (0/1): 1</div>
<div class="line">Flag for X-Rotation (0/1): 0</div>
<div class="line">Flag for Y-Rotation (0/1): 0</div>
<div class="line">Flag for Z-Rotation (0/1): 0</div>
<div class="line"> </div>
<div class="line">Displacement magnitude (X-Translation): 0</div>
<div class="line">Displacement magnitude (Y-Translation): 0</div>
<div class="line">Displacement magnitude (Z-Translation): 0</div>
<div class="line">Displacement magnitude (X-Rotation): <a class="code hl_variable" href="speed__test_8cpp.html#ab2b6b0c222cd1ce70d6a831f57241e59">N</a>/A</div>
<div class="line">Displacement magnitude (Y-Rotation): <a class="code hl_variable" href="speed__test_8cpp.html#ab2b6b0c222cd1ce70d6a831f57241e59">N</a>/A</div>
<div class="line">Displacement magnitude (Z-Rotation): <a class="code hl_variable" href="speed__test_8cpp.html#ab2b6b0c222cd1ce70d6a831f57241e59">N</a>/A</div>
<div class="ttc" id="aapprox__sphere_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition</b> <a href="approx__sphere_8cpp_source.html#l00030">approx_sphere.cpp:30</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_a8fc6defe4e499b1b9b9c275689e44352"><div class="ttname"><a href="initial__diffusion_8cpp.html#a8fc6defe4e499b1b9b9c275689e44352">c</a></div><div class="ttdeci">const double c</div><div class="ttdoc">speed of light (cm/ns)</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00039">initial_diffusion.cpp:39</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_ad8657a5ec76e12f3066fb4b4eb75ace9"><div class="ttname"><a href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a></div><div class="ttdeci">double D</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00044">initial_diffusion.cpp:44</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_afd53743d1af6bfa2856255b23b5a41a9"><div class="ttname"><a href="initial__diffusion_8cpp.html#afd53743d1af6bfa2856255b23b5a41a9">n</a></div><div class="ttdeci">const double n</div><div class="ttdoc">refractive index of diffusive medium</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00038">initial_diffusion.cpp:38</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a510d8658904ea5f9e62ae641c8122e49"><div class="ttname"><a href="matrix__function_8cpp.html#a510d8658904ea5f9e62ae641c8122e49">l</a></div><div class="ttdeci">FTensor::Index&lt; 'l', 3 &gt; l</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00021">matrix_function.cpp:21</a></div></div>
<div class="ttc" id="aplate_8cpp_html_a95479f31dffaa5e5858822a5e4c231d6"><div class="ttname"><a href="plate_8cpp.html#a95479f31dffaa5e5858822a5e4c231d6">t</a></div><div class="ttdeci">constexpr double t</div><div class="ttdoc">plate stiffness</div><div class="ttdef"><b>Definition</b> <a href="plate_8cpp_source.html#l00058">plate.cpp:58</a></div></div>
<div class="ttc" id="ashallow__wave_8cpp_html_ac1bb4bfd31a408c2fed3ca69bcad99fc"><div class="ttname"><a href="shallow__wave_8cpp.html#ac1bb4bfd31a408c2fed3ca69bcad99fc">m</a></div><div class="ttdeci">FTensor::Index&lt; 'm', 3 &gt; m</div><div class="ttdef"><b>Definition</b> <a href="shallow__wave_8cpp_source.html#l00080">shallow_wave.cpp:80</a></div></div>
<div class="ttc" id="aspeed__test_8cpp_html_ab2b6b0c222cd1ce70d6a831f57241e59"><div class="ttname"><a href="speed__test_8cpp.html#ab2b6b0c222cd1ce70d6a831f57241e59">N</a></div><div class="ttdeci">const int N</div><div class="ttdef"><b>Definition</b> <a href="speed__test_8cpp_source.html#l00003">speed_test.cpp:3</a></div></div>
</div><!-- fragment --></li>
<li>Material used in the mesh <div class="fragment"><div class="line">meshset 12682136550675316776 type <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efcac77b6cdcfb446c668fd1d7c66cfd15ab">BLOCKSET</a> <a class="code hl_enumvalue" href="definitions_8h.html#a82340fd7aca566defb002f93cc299efca416c3e3070d3438afe45ae7359d0559e">MAT_ELASTICSET</a> msId 1 name MAT_ELASTIC block header:  blockCol = 4294967295 blockMat = 0 blockDimension = 3</div>
<div class="line"> </div>
<div class="line">Material Properties</div>
<div class="line">-------------------</div>
<div class="line">Young<span class="stringliteral">&#39;s modulus  = 1</span></div>
<div class="line"><span class="stringliteral">Poisson&#39;</span>s ratio  = 0.5</div>
<div class="line">Thermal expansion = 0</div>
<div class="line">User attribute 1 = 0</div>
<div class="line">User attribute 2 = 0</div>
<div class="line">User attribute 3 = 0</div>
<div class="line">User attribute 4 = 0</div>
<div class="line">User attribute 5 = 0</div>
<div class="line">User attribute 6 = 0</div>
<div class="line">User attribute 7 = 0</div>
<div class="line"> </div>
<div class="line">MAT_ELATIC msId 1 nb. tets 471</div>
</div><!-- fragment --></li>
<li>Three fields are added to the database. Fields are then built showing the number of active degrees of freedom (DOFs) for entities including vertices, edges, triangles (faces). <div class="fragment"><div class="line">add: name MESH_NODE_POSITIONS BitFieldId 1 <a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a> number 1 space <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a> approximation base <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a> rank 3 meshset 12682136550675316786</div>
<div class="line">add: name U BitFieldId 2 <a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a> number 2 space <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a> approximation base <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a> rank 3 meshset 12682136550675316787</div>
<div class="line">add: name P BitFieldId 4 <a class="code hl_variable" href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a> number 3 space <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a> approximation base</div>
<div class="line"><a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a> rank 1 meshset 12682136550675316788</div>
<div class="line"> </div>
<div class="line">Build Field MESH_NODE_POSITIONS (rank 0)</div>
<div class="line">nb added dofs (vertices) 465 (inactive 0)</div>
<div class="line">nb added dofs 465 (number of inactive dofs 0)</div>
<div class="line">Build Field U (rank 0)</div>
<div class="line">nb added dofs (vertices) 465 (inactive 0)</div>
<div class="line">nb added dofs (edges) 4482 (inactive 0)</div>
<div class="line">nb added dofs (triangles) 3192 (inactive 0)</div>
<div class="line">nb added dofs 8139 (number of inactive dofs 0)</div>
<div class="line">Build Field P (rank 0)</div>
<div class="line">nb added dofs (vertices) 155 (inactive 0)</div>
<div class="line">nb added dofs (edges) 747 (inactive 0)</div>
<div class="line">nb added dofs 902 (number of inactive dofs 0)</div>
<div class="line">Nb. dofs 9506</div>
<div class="line">Build Field MESH_NODE_POSITIONS (rank 1)</div>
<div class="line">nb added dofs (vertices) 465 (inactive 0)</div>
<div class="line">nb added dofs 465 (number of inactive dofs 0)</div>
<div class="line">Build Field U (rank 1)</div>
<div class="line">nb added dofs (vertices) 465 (inactive 0)</div>
<div class="line">nb added dofs (edges) 4482 (inactive 0)</div>
<div class="line">nb added dofs (triangles) 3192 (inactive 0)</div>
<div class="line">nb added dofs 8139 (number of inactive dofs 0)</div>
<div class="line">Build Field P (rank 1)</div>
<div class="line">nb added dofs (vertices) 155 (inactive 0)</div>
<div class="line">nb added dofs (edges) 747 (inactive 0)</div>
<div class="line">nb added dofs 902 (number of inactive dofs 0)</div>
<div class="line">Nb. dofs 9506</div>
<div class="ttc" id="ahanging__node__approx_8cpp_html_ae63ebbb5e1ef5e0a8b9872228c595f8c"><div class="ttname"><a href="hanging__node__approx_8cpp.html#ae63ebbb5e1ef5e0a8b9872228c595f8c">bit</a></div><div class="ttdeci">auto bit</div><div class="ttdoc">set bit</div><div class="ttdef"><b>Definition</b> <a href="hanging__node__approx_8cpp_source.html#l00075">hanging_node_approx.cpp:75</a></div></div>
</div><!-- fragment --></li>
<li>Three elements are added to the database. Finite elements are then built. <div class="fragment"><div class="line">add finite element: FORCE_FE</div>
<div class="line">add finite element: PRESSURE_FE</div>
<div class="line">add finite element: ELASTIC</div>
<div class="line"> </div>
<div class="line">Build Finite Elements FORCE_FE</div>
<div class="line">Build Finite Elements PRESSURE_FE</div>
<div class="line">Build Finite Elements ELASTIC</div>
<div class="line">Nb. FEs 485</div>
<div class="line">Nb. FEs 485</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000001 name FORCE_FE f_id_row 00000000000000000000000000000010 f_id_col 00000000000000000000000000000010 BitFEId_data 00000000000000000000000000000011 Nb. FEs 0</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000001 name FORCE_FE f_id_row 00000000000000000000000000000010 f_id_col 00000000000000000000000000000010 BitFEId_data 00000000000000000000000000000011 Nb. FEs 0</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000010 name PRESSURE_FE f_id_row 00000000000000000000000000000010 f_id_col 00000000000000000000000000000010 BitFEId_data 00000000000000000000000000000011 Nb. FEs 14</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000010 name PRESSURE_FE f_id_row 00000000000000000000000000000010 f_id_col 00000000000000000000000000000010 BitFEId_data 00000000000000000000000000000011 Nb. FEs 14</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000100 name ELASTIC f_id_row 00000000000000000000000000000110 f_id_col 00000000000000000000000000000110 BitFEId_data 00000000000000000000000000000111 Nb. FEs 471</div>
<div class="line"><span class="keywordtype">id</span> 00000000000000000000000000000100 name ELASTIC f_id_row 00000000000000000000000000000110 f_id_col 00000000000000000000000000000110 BitFEId_data 00000000000000000000000000000111 Nb. FEs 471</div>
<div class="line">Nb. entFEAdjacencies 13328</div>
<div class="line">Nb. entFEAdjacencies 13328</div>
</div><!-- fragment --></li>
<li>Problem is added and then built <div class="fragment"><div class="line">add problem: DM_ELASTIC_MIX</div>
<div class="line">Problem DM_ELASTIC_MIX Nb. rows 9041 Nb. cols 9041</div>
<div class="line">Problem DM_ELASTIC_MIX Nb. rows 9041 Nb. cols 9041</div>
<div class="line">Partition problem DM_ELASTIC_MIX</div>
<div class="line">    create_Mat: row lower 0 row upper 4521</div>
<div class="line">    create_Mat: row lower 4521 row upper 9041</div>
<div class="line">partition_problem: rank = 0 FEs row ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. local dof 4653 nb global row dofs 9041</div>
<div class="line">partition_problem: rank = 0 FEs col ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. local dof 4653 nb global col dofs 9041</div>
<div class="line">partition_problem: rank = 1 FEs row ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. local dof 4388 nb global row dofs 9041</div>
<div class="line">partition_problem: rank = 1 FEs col ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. local dof 4388 nb global col dofs 9041</div>
<div class="line">problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. elems 244 on proc 0</div>
<div class="line">problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. elems 241 on proc 1</div>
<div class="line">partition_ghost_col_dofs: rank = 0 FEs col ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. col ghost dof 221 Nb. local dof 4653</div>
<div class="line">partition_ghost_row_dofs: rank = 0 FEs row ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. row ghost dof 221 Nb. local dof 4653</div>
<div class="line">partition_ghost_col_dofs: rank = 1 FEs col ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. col ghost dof 181 Nb. local dof 4388</div>
<div class="line">partition_ghost_row_dofs: rank = 1 FEs row ghost dofs problem <span class="keywordtype">id</span> 00000000000000000000000000000001 FiniteElement <span class="keywordtype">id</span> 00000000000000000000000000000111 name DM_ELASTIC_MIX Nb. row ghost dof 181 Nb. local dof 4388</div>
</div><!-- fragment --></li>
</ul>
<p><b>Solution</b> </p>
<ul>
<li>KSP solver output <div class="fragment"><div class="line">0 KSP Residual norm 2.422191940287e+02 </div>
<div class="line">1 KSP Residual norm 3.461359964609e-11</div>
</div><!-- fragment --></li>
<li>Output file <div class="fragment"><div class="line">Output file: out.h5m</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="elasticity_mixed_formulation_visualisation"></a>
Visualisation</h2>
<p>Once the solution is obtained, one can convert the output file which has the extension of h5m to a vtk one before opening it in <a href="https://www.paraview.org">ParaView</a>.</p>
<div class="fragment"><div class="line">mbconvert out.h5m out.vtk</div>
<div class="line">open out.vtk</div>
</div><!-- fragment --><p>The visualisation of the results can then be viewed as shown in <a class="el" href="#figure_ord2_3_displacement">Figure 2</a> and <a class="el" href="#figure_ord2_3_pressure">Figure 3</a> for displacement and hydrostatic pressure, respectively.</p>
<p><a class="anchor" id="figure_ord2_3_displacement"></a></p><div class="image">
<img src="emf_ord2_3_displacement.png" alt="" width="600px"/>
<div class="caption">
Figure 2: Visualisation of displacement result.</div></div>
<p><a class="anchor" id="figure_ord2_3_pressure"></a></p><div class="image">
<img src="emf_ord2_3_pressure.png" alt="" width="600px"/>
<div class="caption">
Figure 3: Visualisation of hydrostatic pressure result.</div></div>
<h1><a class="anchor" id="Remark"></a>
Remark</h1>
<p>As mentioned earlier, the choices of approximation order for hydrostatic pressure and displacement are important. Practically, the approximation order of displacement should be higher than that of hydrostatic pressure. If the same order is assigned for displacement and hydrostatic pressure, oscillating results are expected as shown in <a class="el" href="#figure_ord2_2_pressure">Figure 4</a>.</p>
<p><a class="anchor" id="figure_ord2_2_pressure"></a></p><div class="image">
<img src="emf_ord2_2_pressure.png" alt="" width="600px"/>
<div class="caption">
Figure 4: Output of hydrostatic pressure when second order approximation is chosen for both variables.</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.12.0
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>
