<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.8.17"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: COR-10: Navier-Stokes equation</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">COR-10: Navier-Stokes equation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#navier_stokes_introduction">Introduction</a></li>
<li class="level1"><a href="#navier_stokes_scaling">Non-dimensionalization and scaling</a></li>
<li class="level1"><a href="#navier_stokes_fe_formulation">Finite-element formulation</a><ul><li class="level2"><a href="#navier_stokes_fe_formulation_weak_form">Weak form</a></li>
<li class="level2"><a href="#navier_stokes_fe_formulation_mixed_problem">Note on the choice of spaces for the mixed problem</a></li>
</ul>
</li>
<li class="level1"><a href="#navier_stokes_implementation">Implementation</a><ul><li class="level2"><a href="#navier_stokes_running_input_parameters">Reading mesh and input parameters</a></li>
<li class="level2"><a href="#navier_stokes_running_setup">Setting up fields, finite elements and the problem itself</a></li>
<li class="level2"><a href="#navier_stokes_running_solving_problem">Solving the problem and post-processing the results</a></li>
</ul>
</li>
<li class="level1"><a href="#navier_stokes_running">Running the example</a><ul><li class="level2"><a href="#navier_stokes_running_stokes">Stokes equation</a></li>
<li class="level2"><a href="#navier_stokes_running_navier_stokes">Navier-Stokes equations</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="navier_stokes_introduction"></a>
Introduction</h1>
<p>Navier-Stokes equations (NSE), governing the motion of a viscous fluid, are used in various applications: from simulations of the flow in blood vessels to studies of the air flow around aeroplane wings and rotor blades, scaling up to models of ocean and atmospheric currents. Even in the case of an incompressible steady flow, NSE are non-linear due to the effect of the inertia, which is more pronounced in case of a higher Reynolds number. In this tutorial we discuss the implementation of a viscous fluid model in <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> using hierarchical basis functions. This approach permits us to locally increase the order of approximation, enforcing conformity across finite element boundaries, without the need to change the implementation of an element. Moreover, the requirement of different approximation orders for primal (velocity) and dual (pressure) variables, necessary for a simulation of the flow using the mixed formulation, can be easily satisfied.</p>
<h1><a class="anchor" id="navier_stokes_problem_statement"></a>
Problem statement</h1>
<p>An incompressible isoviscous steady-state flow in a domain \(\Omega\) is governed by the following equations: </p><p class="formulaDsp">
\[ \begin{align} \label{eq:balance_momentum} \rho \left(\mathbf{u}\cdot\nabla\right)\mathbf{u} - \mu\nabla^2\mathbf{u} + \nabla p &amp;= \mathbf{f},\\ \label{eq:cont} \nabla\cdot\mathbf{u} &amp;= 0, \end{align} \]
</p>
<p> where \eqref{eq:balance_momentum} is the set of Navier-Stokes equations, representing the balance of the momentum, and \eqref{eq:cont} is the continuity equation; \(\mathbf{u}=[u_x, u_y, u_z]^\intercal\) is the velocity field, \(p\) is the hydrostatic pressure field, \(\rho\) is the fluid mass density, \(\mu\) is fluid viscosity and $\mathbf{f}$ is the density of external forces. The boundary value problem complements the above equations by the Dirichlet and Neumann conditions on the boundary \(\partial\Omega\): </p><p class="formulaDsp">
\[ \begin{align} \label{eq:bc_d}\mathbf{u} = \mathbf{u}_D &amp; \;\text{on}\; \Gamma_D,\\ \label{eq:bc_n}\mathbf{n}\cdot \left[-p\mathbf{I}+\mu\left(\nabla\mathbf{u} + \nabla\mathbf{u}^\intercal\right)\right] = \mathbf{g}_N &amp; \;\text{on} \;\Gamma_N, \end{align} \]
</p>
<p> where \(\mathbf{u}_D\) is the prescribed velocity on the part of the boundary \(\Gamma_D\subset\partial\Omega\), and \(\mathbf{g}_N\) is the prescribed traction vector on the part of the boundary \(\Gamma_N\subset\partial\Omega\), \(\mathbf{n}\) is an outward normal.</p>
<p>In this tutorial we will solve the problem of the fluid flow around a rigid sphere (see <a class="el" href="tutorial_navier_stokes.html#navier_stokes_problem_statement">Figure 1</a>) of a radius \(r\) positioned in the centre of a cubic domain, the side length \(2l\) of which is considered sufficiently large compared to \(r\), so that a uniform far-field velocity on the exterior boundaries is valid (note that the body forces are neglected). Exploiting the symmetry of the problem, we will use a quarter of the domain in our simulations.</p>
<p><a class="anchor" id="navier_stokes_problem_statement"></a></p><div class="image">
<img src="mesh_navier_stokes.png" alt="" width="900px"/>
<div class="caption">
Figure 1: (a) Finite-element mesh used for simulation of fluid flow around a rigid sphere. (b) Sketch of the problem set-up on a section $z=0$ of the mesh.</div></div>
<p>Note that due to the structure of differential operators in the Navier-Stokes equations \eqref{eq:balance_momentum}, the fluid pressure has to be specified on a part of boundary in order to obtain a unique solution. To achieve that, we will combine Dirichlet and Neumann condition on the outlet boundary of the domain, see see <a class="el" href="tutorial_navier_stokes.html#navier_stokes_problem_statement">Figure 1</a>. In the case when the flow is perpendicular to the boundary ( \(u_y = u_z = 0\)), which is enforced by the Dirichlet boundary condition, the hydrostatic fluid pressure equals to the normal traction on such boundary, see Theorem 1 in <a class="el" href="citelist.html#CITEREF_barth2007boundary">[11]</a>.</p>
<h1><a class="anchor" id="navier_stokes_scaling"></a>
Non-dimensionalization and scaling</h1>
<p>Reynolds number is introduced for the problems governed by the Navier-Stokes equations as a measure of the ratio of inertial forces to viscous forces: </p><p class="formulaDsp">
\[ \begin{equation} \mathcal{R} = \frac{\rho U L }{\mu}, \end{equation} \]
</p>
<p> where \(U\) is the scale for the velocity and \(L\) is a relevant length scale. For the problem of the fluid flow around a sphere, considered in this tutorial, the far-field velocity plays the role of the velocity scale, while \(L=2r\), where \(r\) is the radius of the sphere.</p>
<p>When viscous forces dominate over the inertia forces, \(\mathcal{R} \ll 1\), the non-linear term in \eqref{eq:balance_momentum} can be neglected, simplifying NSE down to Stokes equations. However, often this is not the case, i.e. the nonlinear term may become dominant over the viscous forces. In these cases non-dimensionalization (scaling) of Navier-Stokes equations is very useful, which permits to decrease the number of coefficients to only one &ndash; Reynolds number \(\mathcal{R}\). The following scales can be used for the case of flow with relatively low Reynolds number (e.g. less than 100). </p><a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Non-dimensionalization of Navier-Stokes equations </caption>
<tr>
<th>Physical quantity </th><th>Scale </th><th>Dimensionless variable </th></tr>
<tr>
<td style="text-align:center">Length </td><td style="text-align:center">\(L\) </td><td style="text-align:center">\(\mathbf{x}^{*}=\mathbf{x}\:/\:L, \quad \nabla^{*}(\cdot) = L\nabla(\cdot)\) </td></tr>
<tr>
<td style="text-align:center">Velocity </td><td style="text-align:center">\(U\) </td><td style="text-align:center">\(\mathbf{u}^{*}=\mathbf{u}\:/\:U\) </td></tr>
<tr>
<td style="text-align:center">Pressure </td><td style="text-align:center">\(P=\frac{\mu U}{L}\) </td><td style="text-align:center">\(p^{*}=p\:/\:P\) </td></tr>
</table>
<p>Mote that the scale for pressure depends on the scales for the length and the velocity. Using these scales, Navier-stokes equations (1) - (2) can be written in the following dimensionless form (considering zero external forces): </p><p class="formulaDsp">
\[ \begin{align} \label{eq:balance_momentum_dim_less} \mathcal{R} \left(\mathbf{u}^{*}\cdot\nabla^{*}\right)\mathbf{u}^{*} - (\nabla^{*})^2\mathbf{u}^{*} + \nabla^{*} p^{*} &amp;= 0,\\ \label{eq:cont_dim_less} \nabla^{*}\cdot\mathbf{u}^{*} &amp;= 0, \end{align} \]
</p>
<p>Note that now the influence of the non-linearity (inertia terms) on the problem is fully controlled by the value of the Reynolds number. On the one hand, if \(\mathcal{R} \ll 1\), or if one simply wants to consider the Stokes equation, the nonlinear term can be dropped. On the other hand, if the Reynolds number is sufficiently high, then the non-linearity can become strong and may pose problems for convergence (see below discussion of the linearisation of the problem for the Newton-Raphson method). In this case a certain iterative procedure can be used to obtain a solution. Indeed, to find the solution for a given Reynolds number, a number of intermediate problems can be solved for range of smaller \(\mathcal{R}\), eventually reaching the original value. Such technique will also be used in this tutorial. Note also that below we will drop the * symbol, implying that during computation all considered quantities are dimensionless, and a transformation to the dimensional variables is performed before post-processing of the results takes place.</p>
<h1><a class="anchor" id="navier_stokes_fe_formulation"></a>
Finite-element formulation</h1>
<h2><a class="anchor" id="navier_stokes_fe_formulation_weak_form"></a>
Weak form</h2>
<p>The weak statement of the problem \eqref{eq:balance_momentum}-\eqref{eq:bc_n} reads: Find a vector field \(\mathbf{u} \in \mathbf{H}^1(\Omega)\) and a scalar field \(p \in L^2(\Omega)\), such that for any test functions \(\mathbf{v} \in \mathbf{H}^1_0(\Omega)\) and \(q \in L^2(\Omega)\): </p><p class="formulaDsp">
\[ \begin{align} \label{eq:weak} \mathcal{R}\int\limits_\Omega \left(\mathbf{u}\cdot\nabla\right)\mathbf{u} \cdot\mathbf{v} \,d\Omega + \int\limits_{\Omega}\nabla\mathbf{u}\mathbin{:}\nabla\mathbf{v}\, d\Omega - \int\limits_{\Omega}p\, \nabla\cdot\mathbf{v} \, d\Omega &amp;= \int\limits_{\Omega}\mathbf{f}\cdot\mathbf{v}\,d\Omega + \int\limits_{\Gamma_N}\mathbf{g}_N\cdot\mathbf{v}\,d\Gamma_N,\\ - \int\limits_{\Omega}q\, \nabla\cdot\mathbf{u} \, d\Omega &amp;= 0 \end{align} \]
</p>
<p> Upon finite-element discretization of the domain \(\Omega\), we consider interpolation of both unknown fields introducing shape functions on each element: \begin{equation} \label{eq:shape} u_i = \sum\limits_{\alpha=1}^{n_{\mathbf{u}}} N_{\alpha}\, u_i^\alpha, \quad p = \sum\limits_{\beta=1}^{n_p} \Phi_{\beta}\, p^\beta; \quad v_i = \sum\limits_{\alpha=1}^{n_{\mathbf{u}}} N_{\alpha}\, v_i^\alpha, \quad q = \sum\limits_{\beta=1}^{n_p} \Phi_{\beta}\, q^\beta, \end{equation} where \(n_{\mathbf{u}}\) is the number of shape functions associated with the velocity field, and $n_p$ is the similar number for the pressure field. Using the hierarchical basis approximation, the vector of the shape functions can be decomposed into four sub-vectors, consisting of shape functions associated with element's entities: vertices, edges, faces and the volume of the element, e.g. for the velocity field: </p><p class="formulaDsp">
\[ \begin{equation} \label{eq:shape_hier} \mathbf{N}^\textit{el} = \left[N_1, \ldots N_\alpha, \ldots N_{n_{\mathbf{u}}}\right]^\intercal = \left[\mathbf{N}^\textit{ver}, \mathbf{N}^\textit{edge}, \mathbf{N}^\textit{face}, \mathbf{N}^\textit{vol}\right]^\intercal. \end{equation} \]
</p>
<h2><a class="anchor" id="navier_stokes_fe_formulation_mixed_problem"></a>
Note on the choice of spaces for the mixed problem</h2>
<p>Note that in the weak statement velocity and pressure fields belong to different spaces: \(H^1\) and \(L^2\), respectively. Two different approaches can be used for implementing such mixed formulation in the finite-element framework. One can use generalised Taylor-Hood elements, which feature continuous ( \(H^1\) ) approximation of both velocity and pressure fields, however, in order to enforce stability, the approximations functions for the pressure field should be one order lower than those for the velocity field. Furthermore, Taylor-Hood elements impose certain constraints on the mesh, see <a class="el" href="citelist.html#CITEREF_wieners2003taylor">[77]</a>. Alternatively, a discontinuous approximation for pressure can be used, however, in this case the difference between the orders of approximation functions for velocity and for pressure should be 2.</p>
<h1><a class="anchor" id="navier_stokes_implementation"></a>
Implementation</h1>
<p>The example class has necessary fields to store input parameters and internal data structures, as well as a set of functions for setting up and solving the problem:</p>
<div class="fragment"></div><!-- fragment --><p> The set of functions used in this tutorials in the following:</p>
<div class="fragment"></div><!-- fragment --><p> The function ExampleNavierStokes::runProblem is executed from the <code>main</code> function:</p>
<div class="fragment"></div><!-- fragment --> <h2><a class="anchor" id="navier_stokes_running_input_parameters"></a>
Reading mesh and input parameters</h2>
<p>The workflow of solving a problem using the finite-element method starts from reading the mesh and other input parameters:</p>
<div class="fragment"></div><!-- fragment --><p> Once the mesh is read, we find the set of tetrahedra corresponding to the computational domain. Furthermore, we identify the fluid-structure interface, i.e. the set of triangles corresponding to the surface of the sphere:</p>
<div class="fragment"></div><!-- fragment --> <h2><a class="anchor" id="navier_stokes_running_setup"></a>
Setting up fields, finite elements and the problem itself</h2>
<p>Once the domain and the fluid-structure interface are identified, we can setup the problem. First, we define the velocity and pressure fields. Note that for velocity we use space H1, while for pressure the user can choose between using also H1 space (continuous approximation, Taylor-Hood element), or a discontinuous approximation using L2 space. Note that in the former case, the approximation functions for pressure has to be one order lower than that of the velocity (e.g. order 2 for velocity and order 1 for pressure), while the the latter case the difference between the two has to be 2 orders (e.g. order 3 for velocity and order 1 for pressure).</p>
<p>Furthermore, the properties of hierarchical basis functions can be used to locally increase the approximation order for the elements on the fluid-structure interface, where the gradients of the velocity can be expected to be the highest due to the no-slip boundary condition on the surface of the sphere.</p>
<div class="fragment"></div><!-- fragment --><p> After that the finite elements operating on the set above fields can be defined. In particular, we define elements for solving Navier-Stokes equations, computation of the drag traction and force on the surface of the surface, and, finally, for computing the contribution of Neumann (natural) boundary conditions.</p>
<div class="fragment"></div><!-- fragment --><p> Once the finite elements are defined, we will need to create element instances and push necessary operators to their pipelines. First, we setup an element for solving Navier-Stokes (or if one prefers, Stokes) equations. Note that right-hand side and left-hand side elements are considered separately. In case of Navier-Stokes equations, operators are pushed to elements pipelines using function <a class="el" href="structNavierStokesElement.html#a9c21126c87d7a7005ef7d36ba830d6d8" title="Setting up operators for solving Navier-Stokes equations.">NavierStokesElement::setNavierStokesOperators</a>. In particular, the following operators are pushed to right-hand side:</p><ul>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleRhsVelocityLin.html" title="Assemble linear part of the velocity component of the RHS vector.">NavierStokesElement::OpAssembleRhsVelocityLin</a>,</li>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleRhsVelocityNonLin.html" title="Assemble non-linear part of the velocity component of the RHS vector.">NavierStokesElement::OpAssembleRhsVelocityNonLin</a>,</li>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleRhsPressure.html" title="Assemble the pressure component of the RHS vector.">NavierStokesElement::OpAssembleRhsPressure</a>,</li>
</ul>
<p>while for the left-hand side we push these operators:</p><ul>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleLhsDiagLin.html" title="Assemble linear (symmetric) part of the diagonal block of the LHS Operator for assembling linear (sym...">NavierStokesElement::OpAssembleLhsDiagLin</a>,</li>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleLhsDiagNonLin.html" title="Assemble non-linear (non-symmetric) part of the diagonal block of the LHS Operator for assembling non...">NavierStokesElement::OpAssembleLhsDiagNonLin</a>,</li>
<li><a class="el" href="structNavierStokesElement_1_1OpAssembleLhsOffDiag.html" title="Assemble off-diagonal block of the LHS Operator for assembling off-diagonal block of the LHS.">NavierStokesElement::OpAssembleLhsOffDiag</a>.</li>
</ul>
<p>Upon that, we setup in the same way elements for computing the drag traction and the drag force acting on the sphere using operators <a class="el" href="structNavierStokesElement_1_1OpCalcDragTraction.html" title="Calculate drag traction on the fluid-solid interface.">NavierStokesElement::OpCalcDragTraction</a> and <a class="el" href="structNavierStokesElement_1_1OpCalcDragForce.html" title="Calculate drag force on the fluid-solid interface.">NavierStokesElement::OpCalcDragForce</a>, respectively. Additionally, operators for the Neumann boundary conditions are set using the function <a class="el" href="structMetaNeumannForces.html#ad0f272e64b6937cc53769ecaa409d8b1" title="Set operators to finite elements calculating right hand side vector.">MetaNeumannForces::setMomentumFluxOperators</a> and the element for the Dirichlet boundary conditions is created as well. Finally, operators for post-processing output are created: in the volume and on the fluid-solid interface.</p>
<div class="fragment"></div><!-- fragment --><p> Note that the class for enforcing Dirichlet boundary conditions <a class="el" href="structDirichletDisplacementBc.html" title="Set Dirichlet boundary conditions on displacements.">DirichletDisplacementBc</a> used in the snippet above requires the algebraic data structures for storing components of the right-hand side vector, left-hand side matrix and the solution vector. Therefore, these data structures need to be created beforehand using PETSc:</p>
<div class="fragment"></div><!-- fragment --><p> However, one may note that creation of PETSCc vectors and matrices requires the instance of the <a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> Discrete Manager (DM), which needs a certain setup as well:</p>
<div class="fragment"></div><!-- fragment --><p> Finally, the last preparatory step required is the setup of the SNES functionality:</p>
<div class="fragment"></div><!-- fragment --> <h2><a class="anchor" id="navier_stokes_running_solving_problem"></a>
Solving the problem and post-processing the results</h2>
<div class="fragment"></div><!-- fragment --> <div class="fragment"></div><!-- fragment --> <h1><a class="anchor" id="navier_stokes_running"></a>
Running the example</h1>
<p>We will consider two cases: first, flow governed by Stokes equation, i.e. neglecting the nonlinear terms, and then we will solve full set Navier-Stokes equations. For both cases we will use the same mesh. We will start by partitioning this mesh: </p><div class="fragment"><div class="line">mofem_part -my_file sphere_test.cub -my_nparts 4 -output_file sphere_test_4.h5m</div>
</div><!-- fragment --><p> while <code>mofem_part</code> can be found in <code>$HOME/mofem_install/um/build_release/tools/</code>. Here we partitioned the mesh in 4 parts in order to be executed on 4 cores in a distributed-memory parallel environment. Note that any number of parts less or equal to number of physically available cores can be used.</p>
<h2><a class="anchor" id="navier_stokes_running_stokes"></a>
Stokes equation</h2>
<div class="fragment"><div class="line">mpirun -np 4 ./navier_stokes -my_file sphere_test_4.h5m \</div>
<div class="line">-my_order_u 2 \</div>
<div class="line">-my_order_p 1 \</div>
<div class="line">-my_discont_pressure 0 \</div>
<div class="line">-my_num_ho_levels 1 \</div>
<div class="line">-my_ho_geometry 1 \</div>
<div class="line">-my_step_num 1 \</div>
<div class="line">-my_velocity_scale 0.1 \</div>
<div class="line">-my_length_scale 2 \</div>
<div class="line">-my_stokes_flow 1 \</div>
<div class="line">-my_is_partitioned 1 </div>
</div><!-- fragment --><h2><a class="anchor" id="navier_stokes_running_navier_stokes"></a>
Navier-Stokes equations</h2>
<div class="fragment"><div class="line">mpirun -np 4 ./navier_stokes -my_file sphere_test_4.h5m \</div>
<div class="line">-my_order_u 2 \</div>
<div class="line">-my_order_p 1 \</div>
<div class="line">-my_discont_pressure 0 \</div>
<div class="line">-my_num_ho_levels 1 \</div>
<div class="line">-my_ho_geometry 1 \</div>
<div class="line">-my_step_num 2 \</div>
<div class="line">-my_velocity_scale 0.1 \</div>
<div class="line">-my_length_scale 2 \</div>
<div class="line">-my_stokes_flow 0 \</div>
<div class="line">-my_is_partitioned 1 </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.8.17
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>