<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: COR-4: Using fieldsplit solver and DM sub problem.</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
  <script>
    window.MathJax = {
      tex: {
        tags: 'all', // Enables equation numbering
      },
      loader: {
        load: ['[tex]/boldsymbol']
      }
    };
  </script>
  <script type="text/javascript " src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.15.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">COR-4: Using fieldsplit solver and DM sub problem.</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#poisson_tut3_block_matrix">Block matrix</a></li>
<li class="level1"><a href="#poisson_tut3_code_dissection">Code dissection</a></li>
<li class="level1"><a href="#poisson_tut3_adding_penalty">Creating penalty finite element instance</a><ul><li class="level2"><a href="#poisson_tut3_diagonal">Assembly of K and S matrices</a></li>
<li class="level2"><a href="#poisson_tut3_off_diagonal">Assembly of C matrix</a></li>
<li class="level2"><a href="#poisson_tut3_vector">Assembly of the right hand side vector</a></li>
<li class="level2"><a href="#poisson_tut3_nested_matrix">Creation of global nested matrix</a></li>
<li class="level2"><a href="#poisson_tut3_solver">Solving problem</a></li>
</ul>
</li>
<li class="level1"><a href="#poisson_tut3_running_program">Running the program</a></li>
<li class="level1"><a href="#poisson_tut3_excercise">Exercises</a></li>
</ul>
</div>
<div class="textblock"><p>In this tutorial, we show how to create sub-problems by using discrete manager (DM) and sub-problems DMs to create nested matrices and use them with field-split preconditioner. This example shows simplified use of field-split preconditioner, for more advanced example of use of sub discrete managers and field-split preconditioner see cell_forces.cpp</p>
<p>The field-split preconditioner is a block solver where on a block of matrices we apply Jacobi or Gaussâ€“Seidel iterations. Alternatively, if a matrix has 2x2 blocks, a Schur complement can be approximated by preconditioner. We do not intend to explain mathematical details of block solver but merely show how to use PETSc preconditioner, i.e. <em>PCFIELDSPLIT</em> (see <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCFIELDSPLIT.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCFIELDSPLIT.html</a>).</p>
<p>Block matrix is represented using nested matrix, see details MATNEST (see <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatCreateNest.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatCreateNest.html</a>).</p>
<p>We change only small part of the code described in tutorial <a class="el" href="poisson_tut1.html">COR-2: Solving the Poisson equation</a>.</p>
<h1><a class="anchor" id="poisson_tut3_block_matrix"></a>
Block matrix</h1>
<p>We solve the same problem to one shown in <a class="el" href="poisson_tut1.html">COR-2: Solving the Poisson equation</a>. However, to remove some issues with field-split solver, we will make the upper diagonal block of matrix invertible, by adding stabilisation matrix, which in this case has the interpretation of the penalty;  </p><p class="formulaDsp">
\[
\left[
\begin{array}{cc}
\mathbf{K}+\mathbf{S} &amp; \mathbf{C}^\textrm{T}\\
\mathbf{C} &amp; \mathbf{0}
\end{array}
\right]
\left\{
\begin{array}{c}
\mathbf{U}\\
\mathbf{L}
\end{array}
\right\}
=
\left[
\begin{array}{c}
\mathbf{F}+\mathbf{S}\overline{U} \\
\mathbf{g}
\end{array}
\right],\\
\mathbf{K}=
\int_\Omega (\nabla \boldsymbol\phi)^\textrm{T} \nabla \boldsymbol\phi \textrm{d}\Omega,\quad
\mathbf{C} = \int_{\partial\Omega} \boldsymbol\psi^\textrm{T} \boldsymbol\phi \textrm{d}\partial\Omega,\\
\mathbf{F} = \int_\Omega \boldsymbol\phi^\textrm{T} f \textrm{d}\Omega,\quad
\mathbf{g} = \int_{\partial\Omega} \boldsymbol\psi^\textrm{T} \overline{u} \textrm{d}\partial\Omega,\\
\mathbf{S} = \int_{\partial\Omega} \boldsymbol\phi^\textrm{T} \boldsymbol\phi \textrm{d}\partial\Omega.
\]
</p>
<h1><a class="anchor" id="poisson_tut3_code_dissection"></a>
Code dissection</h1>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \file analytical_poisson_field_split.cpp</span></div>
<div class="line"><span class="comment"> * \ingroup mofem_simple_interface</span></div>
<div class="line"><span class="comment"> * \example analytical_poisson_field_split.cpp</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * For more information and detailed explain of this</span></div>
<div class="line"><span class="comment"> * example see \ref poisson_tut3</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MoFEM_8hpp.html">MoFEM.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="PoissonOperators_8hpp.html">PoissonOperators.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="AuxPoissonFunctions_8hpp.html">AuxPoissonFunctions.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>[] = <span class="stringliteral">&quot;...\n\n&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_variable" href="dm__create__subdm_8cpp.html#a6295d47efda04de55c38cb8ea1cdb807">debug</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \brief Function</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This is prescribed exact function. If this function is given by polynomial</span></div>
<div class="line"><span class="comment"> * order of &quot;p&quot; and order of approximation is &quot;p&quot; or higher, solution of</span></div>
<div class="line"><span class="comment"> * finite element method is exact (with machine precision).</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  \f[</span></div>
<div class="line"><span class="comment"> *  u = 1+x^2+y^2+z^3</span></div>
<div class="line"><span class="comment"> *  \f]</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structExactFunction.html">ExactFunction</a> {</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code hl_function" href="structExactFunction.html#a624aa0f96fa6b76dffb91979376510f0">operator()</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y, <span class="keyword">const</span> <span class="keywordtype">double</span> z)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 1 + x * x + y * y + z * z * z;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \brief Exact gradient</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structExactFunctionGrad.html">ExactFunctionGrad</a> {</div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> <a class="code hl_function" href="structExactFunctionGrad.html#a6b0666c823934f237b6a40c8b5f86eb6">operator()</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y,</div>
<div class="line">                                         <span class="keyword">const</span> <span class="keywordtype">double</span> z)<span class="keyword"> const </span>{</div>
<div class="line">    <a class="code hl_class" href="classFTensor_1_1Tensor1.html">FTensor::Tensor1&lt;double, 3&gt;</a> grad;</div>
<div class="line">    grad(0) = 2 * x;</div>
<div class="line">    grad(1) = 2 * y;</div>
<div class="line">    grad(2) = 3 * z * z;</div>
<div class="line">    <span class="keywordflow">return</span> grad;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * \brief Laplacian of function.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This is Laplacian of \f$u\f$, it is calculated using formula</span></div>
<div class="line"><span class="comment"> * \f[</span></div>
<div class="line"><span class="comment"> * \nabla^2 u(x,y,z) = \nabla \cdot \nabla u</span></div>
<div class="line"><span class="comment"> * \frac{\partial^2 u}{\partial x^2}+</span></div>
<div class="line"><span class="comment"> * \frac{\partial^2 u}{\partial y^2}+</span></div>
<div class="line"><span class="comment"> * \frac{\partial^2 u}{\partial z^2}</span></div>
<div class="line"><span class="comment"> * \f]</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structExactLaplacianFunction.html">ExactLaplacianFunction</a> {</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code hl_function" href="structExactLaplacianFunction.html#a6b9269124ee9aebddf08ea9249a4b949">operator()</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y, <span class="keyword">const</span> <span class="keywordtype">double</span> z)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 4 + 6 * z;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structOpS.html">OpS</a> : <span class="keyword">public</span> FaceElementForcesAndSourcesCore::UserDataOperator {</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_struct" href="structOpS.html">OpS</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> beta = 1)</div>
<div class="line">      : FaceElementForcesAndSourcesCore::<a class="code hl_class" href="classUserDataOperator.html">UserDataOperator</a>(<span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, OPROWCOL,</div>
<div class="line">                                                          true),</div>
<div class="line">        <a class="code hl_variable" href="structOpS.html#a9af67d7ef1771a6993fcaacdaafddf37">bEta</a>(beta) {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * \brief Do calculations for give operator</span></div>
<div class="line"><span class="comment">   * @param  row_side row side number (local number) of entity on element</span></div>
<div class="line"><span class="comment">   * @param  col_side column side number (local number) of entity on element</span></div>
<div class="line"><span class="comment">   * @param  row_type type of row entity MBVERTEX, MBEDGE, MBTRI or MBTET</span></div>
<div class="line"><span class="comment">   * @param  col_type type of column entity MBVERTEX, MBEDGE, MBTRI or MBTET</span></div>
<div class="line"><span class="comment">   * @param  row_data data for row</span></div>
<div class="line"><span class="comment">   * @param  col_data data for column</span></div>
<div class="line"><span class="comment">   * @return          error code</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <a class="code hl_typedef" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="structOpS.html#a80922f33899ea48946cef5f0b2bbef15">doWork</a>(<span class="keywordtype">int</span> row_side, <span class="keywordtype">int</span> col_side, EntityType row_type,</div>
<div class="line">                        EntityType col_type,</div>
<div class="line">                        EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                        EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="comment">// get number of dofs on row</span></div>
<div class="line">    <a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a> = row_data.getIndices().size();</div>
<div class="line">    <span class="comment">// if no dofs on row, exit that work, nothing to do here</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>)</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">    <span class="comment">// get number of dofs on column</span></div>
<div class="line">    <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a> = col_data.getIndices().size();</div>
<div class="line">    <span class="comment">// if no dofs on Columbia, exit nothing to do here</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>)</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a>(0);</div>
<div class="line">    <span class="comment">// get number of integration points</span></div>
<div class="line">    <a class="code hl_variable" href="structOpS.html#a216a8b13cbbd7a9bb9ce35da08b8bccb">nbIntegrationPts</a> = getGaussPts().size2();</div>
<div class="line">    <span class="comment">// check if entity block is on matrix diagonal</span></div>
<div class="line">    <span class="keywordflow">if</span> (row_side == col_side &amp;&amp; row_type == col_type) {</div>
<div class="line">      <a class="code hl_variable" href="structOpS.html#ab946925517ebfa75faefc6be31f45d3d">isDiag</a> = <span class="keyword">true</span>; <span class="comment">// yes, it is</span></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code hl_variable" href="structOpS.html#ab946925517ebfa75faefc6be31f45d3d">isDiag</a> = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// integrate local matrix for entity block</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structOpS.html#a2a11648458c4ca82fa8a5a35b1021ec6">iNtegrate</a>(row_data, col_data);</div>
<div class="line">    <span class="comment">// assemble local matrix</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="structOpS.html#ac442dcd4228ef8e7caba8544497f48b4">aSsemble</a>(row_data, col_data);</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="structOpS.html#a9af67d7ef1771a6993fcaacdaafddf37">bEta</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  ///&lt; error code</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>;           <span class="comment">///&lt; number of dofs on rows</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>;           <span class="comment">///&lt; number if dof on column</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="structOpS.html#a216a8b13cbbd7a9bb9ce35da08b8bccb">nbIntegrationPts</a>; <span class="comment">///&lt; number of integration points</span></div>
<div class="line">  <span class="keywordtype">bool</span> <a class="code hl_variable" href="structOpS.html#ab946925517ebfa75faefc6be31f45d3d">isDiag</a>;          <span class="comment">///&lt; true if this block is on diagonal</span></div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classFTensor_1_1Index.html">FTensor::Index</a>&lt;<span class="charliteral">&#39;i&#39;</span>, 3&gt; <a class="code hl_variable" href="structOpS.html#ad70d449c569a139c407d9669e00c72c8">i</a>; <span class="comment">///&lt; summit Index</span></div>
<div class="line">  <a class="code hl_typedef" href="namespaceMoFEM_1_1Types.html#a71f706f784fbf6fd240806b70ed7d933">MatrixDouble</a> <a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>;      <span class="comment">///&lt; local entity block matrix</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * \brief Integrate grad-grad operator</span></div>
<div class="line"><span class="comment">   * @param  row_data row data (consist base functions on row entity)</span></div>
<div class="line"><span class="comment">   * @param  col_data column data (consist base functions on column entity)</span></div>
<div class="line"><span class="comment">   * @return          error code</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keyword">inline</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="structOpS.html#a2a11648458c4ca82fa8a5a35b1021ec6">iNtegrate</a>(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                                  EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="comment">// set size of local entity bock</span></div>
<div class="line">    <a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>.resize(<a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>, <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>, <span class="keyword">false</span>);</div>
<div class="line">    <span class="comment">// clear matrix</span></div>
<div class="line">    <a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>.clear();</div>
<div class="line">    <span class="comment">// get element area</span></div>
<div class="line">    <span class="keywordtype">double</span> area = getArea() * <a class="code hl_variable" href="structOpS.html#a9af67d7ef1771a6993fcaacdaafddf37">bEta</a>;</div>
<div class="line">    <span class="comment">// get integration weights</span></div>
<div class="line">    <span class="keyword">auto</span> t_w = getFTensor0IntegrationWeight();</div>
<div class="line">    <span class="comment">// get base function gradient on rows</span></div>
<div class="line">    <span class="keyword">auto</span> t_row_base = row_data.getFTensor0N();</div>
<div class="line">    <span class="comment">// loop over integration points</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gg = 0; gg != <a class="code hl_variable" href="structOpS.html#a216a8b13cbbd7a9bb9ce35da08b8bccb">nbIntegrationPts</a>; gg++) {</div>
<div class="line">      <span class="comment">// take into account Jacobean</span></div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> alpha = t_w * area;</div>
<div class="line">      <span class="comment">// take fist element to local matrix</span></div>
<div class="line">      <a class="code hl_class" href="classFTensor_1_1Tensor0.html">FTensor::Tensor0&lt;FTensor::PackPtr&lt;double *, 1&gt;</a>&gt; <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>(</div>
<div class="line">          &amp;*<a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>.data().begin());</div>
<div class="line">      <span class="comment">// loop over rows base functions</span></div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr != <a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>; rr++) {</div>
<div class="line">        <span class="comment">// get column base functions gradient at gauss point gg</span></div>
<div class="line">        <span class="keyword">auto</span> t_col_base = col_data.getFTensor0N(gg, 0);</div>
<div class="line">        <span class="comment">// loop over columns</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc != <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>; cc++) {</div>
<div class="line">          <span class="comment">// calculate element of local matrix</span></div>
<div class="line">          <a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> += alpha * t_row_base * t_col_base;</div>
<div class="line">          ++t_col_base; <span class="comment">// move to another gradient of base function on column</span></div>
<div class="line">          ++<a class="code hl_variable" href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a>;          <span class="comment">// move to another element of local matrix in column</span></div>
<div class="line">        }</div>
<div class="line">        ++t_row_base; <span class="comment">// move to another element of gradient of base function on</span></div>
<div class="line">                      <span class="comment">// row</span></div>
<div class="line">      }</div>
<div class="line">      ++t_w; <span class="comment">// move to another integration weight</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * \brief Assemble local entity block matrix</span></div>
<div class="line"><span class="comment">   * @param  row_data row data (consist base functions on row entity)</span></div>
<div class="line"><span class="comment">   * @param  col_data column data (consist base functions on column entity)</span></div>
<div class="line"><span class="comment">   * @return          error code</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keyword">inline</span> <a class="code hl_typedef" href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEMErrorCode</a> <a class="code hl_function" href="structOpS.html#ac442dcd4228ef8e7caba8544497f48b4">aSsemble</a>(EntitiesFieldData::EntData &amp;row_data,</div>
<div class="line">                                 EntitiesFieldData::EntData &amp;col_data) {</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a>;</div>
<div class="line">    <span class="comment">// get pointer to first global index on row</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> *row_indices = &amp;*row_data.getIndices().data().begin();</div>
<div class="line">    <span class="comment">// get pointer to first global index on column</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> *col_indices = &amp;*col_data.getIndices().data().begin();</div>
<div class="line">    Mat <a class="code hl_class" href="classB.html">B</a> = getFEMethod()-&gt;ksp_B != PETSC_NULLPTR ? getFEMethod()-&gt;ksp_B</div>
<div class="line">                                               : getFEMethod()-&gt;snes_B;</div>
<div class="line">    <span class="comment">// assemble local matrix</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MatSetValues</a>(<a class="code hl_class" href="classB.html">B</a>, <a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>, row_indices, <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>, col_indices,</div>
<div class="line">                        &amp;*<a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>.data().begin(), ADD_VALUES);</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="structOpS.html#ab946925517ebfa75faefc6be31f45d3d">isDiag</a>) {</div>
<div class="line">      <span class="comment">// if not diagonal term and since global matrix is symmetric assemble</span></div>
<div class="line">      <span class="comment">// transpose term.</span></div>
<div class="line">      <a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a> = trans(<a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MatSetValues</a>(<a class="code hl_class" href="classB.html">B</a>, <a class="code hl_variable" href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">nbCols</a>, col_indices, <a class="code hl_variable" href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">nbRows</a>, row_indices,</div>
<div class="line">                          &amp;*<a class="code hl_variable" href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">locMat</a>.data().begin(), ADD_VALUES);</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a>(0);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize PETSc</span></div>
<div class="line">  <a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::Core::Initialize</a>(&amp;argc, &amp;argv, (<span class="keywordtype">char</span> *)0, <a class="code hl_variable" href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a>);</div>
<div class="line">  <span class="comment">// Create MoAB database</span></div>
<div class="line">  moab::Core moab_core;              <span class="comment">// create database</span></div>
<div class="line">  moab::Interface &amp;moab = moab_core; <span class="comment">// create interface to database</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get command line options</span></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> = 3;                    <span class="comment">// default approximation order</span></div>
<div class="line">    PetscBool flg_test = PETSC_FALSE; <span class="comment">// true check if error is numerical error</span></div>
<div class="line">    PetscOptionsBegin(PETSC_COMM_WORLD, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Poisson&#39;s problem options&quot;</span>,</div>
<div class="line">                             <span class="stringliteral">&quot;none&quot;</span>);</div>
<div class="line">    <span class="comment">// Set approximation order</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsInt(<span class="stringliteral">&quot;-order&quot;</span>, <span class="stringliteral">&quot;approximation order&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>, &amp;<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>,</div>
<div class="line">                           PETSC_NULLPTR);</div>
<div class="line">    <span class="comment">// Set testing (used by CTest)</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PetscOptionsBool(<span class="stringliteral">&quot;-test&quot;</span>, <span class="stringliteral">&quot;if true is ctest&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, flg_test,</div>
<div class="line">                            &amp;flg_test, PETSC_NULLPTR);</div>
<div class="line">    PetscOptionsEnd();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create MoFEM database and link it to MoAB</span></div>
<div class="line">    <a class="code hl_struct" href="structMoFEM_1_1CoreTmp_3_010_01_4.html">MoFEM::Core</a> mofem_core(moab);           <span class="comment">// create database</span></div>
<div class="line">    <a class="code hl_struct" href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::Interface</a> &amp;m_field = mofem_core; <span class="comment">// create interface to database</span></div>
<div class="line">    <span class="comment">// Register DM Manager</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga899ec9d1ad35488bbe4273731f6d5c90">DMRegister_MoFEM</a>(<span class="stringliteral">&quot;DMMOFEM&quot;</span>); <span class="comment">// register MoFEM DM in PETSc</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create vector to store approximation global error</span></div>
<div class="line">    <a class="code hl_typedef" href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">Vec</a> global_error;</div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1AuxFunctions.html">PoissonExample::AuxFunctions</a>(m_field).<a class="code hl_function" href="structPoissonExample_1_1AuxFunctions.html#a0a81d42260b35b3eaff0836f78c911a9">createGhostVec</a>(&amp;global_error);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// First we crate elements, implementation of elements is problem</span></div>
<div class="line">    <span class="comment">// independent, we do not know yet what fields are present in the problem,</span></div>
<div class="line">    <span class="comment">// or even we do not decided yet what approximation base or spaces we are</span></div>
<div class="line">    <span class="comment">// going to use. Implementation of element is free from those constrains and</span></div>
<div class="line">    <span class="comment">// can be used in different context.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Elements used by KSP &amp; DM to assemble system of equations</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt;</div>
<div class="line">        domain_lhs_fe; <span class="comment">///&lt; Volume element for the matrix</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt;</div>
<div class="line">        boundary_lhs_fe; <span class="comment">///&lt; Boundary element for the matrix</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt;</div>
<div class="line">        domain_rhs_fe; <span class="comment">///&lt; Volume element to assemble vector</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt;</div>
<div class="line">        boundary_rhs_fe; <span class="comment">///&lt; Volume element to assemble vector</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt;</div>
<div class="line">        domain_error; <span class="comment">///&lt; Volume element evaluate error</span></div>
<div class="line">    boost::shared_ptr&lt;PoissonExample::PostProcFE&gt;</div>
<div class="line">        post_proc_volume; <span class="comment">///&lt; Volume element to Post-process results</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt; null; <span class="comment">///&lt; Null element do nothing</span></div>
<div class="line">    boost::shared_ptr&lt;ForcesAndSourcesCore&gt; boundary_penalty_lhs_fe;</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Add problem specific operators the generic finite elements to calculate</span></div>
<div class="line">      <span class="comment">// matrices and vectors.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1CreateFiniteElements.html">PoissonExample::CreateFiniteElements</a>(m_field)</div>
<div class="line">          .<a class="code hl_function" href="structPoissonExample_1_1CreateFiniteElements.html#ae7e856976912e3f952c8c5b96b674978">createFEToAssembleMatrixAndVector</a>(</div>
<div class="line">              <a class="code hl_struct" href="structExactFunction.html">ExactFunction</a>(), <a class="code hl_struct" href="structExactLaplacianFunction.html">ExactLaplacianFunction</a>(), domain_lhs_fe,</div>
<div class="line">              boundary_lhs_fe, domain_rhs_fe, boundary_rhs_fe, <span class="keyword">false</span>);</div>
<div class="line">      <span class="comment">// Add problem specific operators the generic finite elements to calculate</span></div>
<div class="line">      <span class="comment">// error on elements and global error in H1 norm</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1CreateFiniteElements.html">PoissonExample::CreateFiniteElements</a>(m_field)</div>
<div class="line">          .<a class="code hl_function" href="structPoissonExample_1_1CreateFiniteElements.html#ae250a14f45127e19c97e17df96252329">createFEToEvaluateError</a>(<a class="code hl_struct" href="structExactFunction.html">ExactFunction</a>(), <a class="code hl_struct" href="structExactFunctionGrad.html">ExactFunctionGrad</a>(),</div>
<div class="line">                                   global_error, domain_error);</div>
<div class="line">      <span class="comment">// Post-process results</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1CreateFiniteElements.html">PoissonExample::CreateFiniteElements</a>(m_field)</div>
<div class="line">          .<a class="code hl_function" href="structPoissonExample_1_1CreateFiniteElements.html#a63d3da59aa561779e9e56bf4284ceeea">creatFEToPostProcessResults</a>(post_proc_volume);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">double</span> beta = 1;</div>
<div class="line">      boundary_penalty_lhs_fe = boost::shared_ptr&lt;ForcesAndSourcesCore&gt;(</div>
<div class="line">          <span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
<div class="line">      boundary_penalty_lhs_fe-&gt;getRuleHook = <a class="code hl_struct" href="structPoissonExample_1_1FaceRule.html">PoissonExample::FaceRule</a>();</div>
<div class="line">      boundary_penalty_lhs_fe-&gt;getOpPtrVector().push_back(<span class="keyword">new</span> <a class="code hl_struct" href="structOpS.html">OpS</a>(beta));</div>
<div class="line">      boundary_rhs_fe-&gt;getOpPtrVector().push_back(</div>
<div class="line">          <span class="keyword">new</span> <a class="code hl_struct" href="structPoissonExample_1_1Op__g.html">PoissonExample::Op_g</a>(<a class="code hl_struct" href="structExactFunction.html">ExactFunction</a>(), <span class="stringliteral">&quot;U&quot;</span>, beta));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get simple interface is simplified version enabling quick and</span></div>
<div class="line">    <span class="comment">// easy construction of problem.</span></div>
<div class="line">    Simple *simple_interface;</div>
<div class="line">    <span class="comment">// Query interface and get pointer to Simple interface</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> m_field.<a class="code hl_function" href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">getInterface</a>(simple_interface);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Build problem with simple interface</span></div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Get options for simple interface from command line</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;getOptions();</div>
<div class="line">      <span class="comment">// Load mesh file to database</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;loadFile();</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Add field on domain and boundary. Field is declared by space and base</span></div>
<div class="line">      <span class="comment">// and rank. space can be H1. Hcurl, Hdiv and L2, base can be</span></div>
<div class="line">      <span class="comment">// AINSWORTH_LEGENDRE_BASE, DEMKOWICZ_JACOBI_BASE and more, where rank is</span></div>
<div class="line">      <span class="comment">// number of coefficients for dof.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Simple interface assumes that there are four types of field; 1) defined</span></div>
<div class="line">      <span class="comment">// on body domain, 2) fields defined on body boundary, 3) skeleton field</span></div>
<div class="line">      <span class="comment">// defined on finite element skeleton. Finally data field is defined on</span></div>
<div class="line">      <span class="comment">// body domain. Data field is not solved but used for post-process or to</span></div>
<div class="line">      <span class="comment">// keep material parameters, etc. Here we using it to calculate</span></div>
<div class="line">      <span class="comment">// approximation error on elements.</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Add domain field &quot;U&quot; in space H1 and Legendre base, Ainsworth recipe is</span></div>
<div class="line">      <span class="comment">// used to construct base functions.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;addDomainField(<span class="stringliteral">&quot;U&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>, <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>,</div>
<div class="line">                                              1);</div>
<div class="line">      <span class="comment">// Add Lagrange multiplier field on body boundary</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;addBoundaryField(<span class="stringliteral">&quot;L&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a>,</div>
<div class="line">                                                <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 1);</div>
<div class="line">      <span class="comment">// Add error (data) field, we need only L2 norm. Later order is set to 0,</span></div>
<div class="line">      <span class="comment">// so this is piecewise discontinuous constant approx., i.e. 1 DOF for</span></div>
<div class="line">      <span class="comment">// element. You can use more DOFs and collate moments of error to drive</span></div>
<div class="line">      <span class="comment">// anisotropic h/p-adaptivity, however this is beyond this example.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;addDataField(<span class="stringliteral">&quot;ERROR&quot;</span>, <a class="code hl_enumvalue" href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a0adffb24dae0c41be5b803f4d444f066">L2</a>,</div>
<div class="line">                                            <a class="code hl_enumvalue" href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a>, 1);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Set fields order domain and boundary fields.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;setFieldOrder(<span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line">                                             <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>); <span class="comment">// to approximate function</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;setFieldOrder(<span class="stringliteral">&quot;L&quot;</span>,</div>
<div class="line">                                             <a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a>); <span class="comment">// to Lagrange multipliers</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;setFieldOrder(</div>
<div class="line">          <span class="stringliteral">&quot;ERROR&quot;</span>, 0); <span class="comment">// approximation order for error</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Setup problem. At that point database is constructed, i.e. fields,</span></div>
<div class="line">      <span class="comment">// finite elements and problem data structures with local and global</span></div>
<div class="line">      <span class="comment">// indexing.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;setUp();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get access to PETSC-MoFEM DM manager.</span></div>
<div class="line">    <span class="comment">// or more derails see</span></div>
<div class="line">    <span class="comment">// &lt;http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/DM/index.html&gt;</span></div>
<div class="line">    <span class="comment">// Form that point internal MoFEM data structures are linked with PETSc</span></div>
<div class="line">    <span class="comment">// interface. If DM functions contains string MoFEM is is MoFEM specific DM</span></div>
<div class="line">    <span class="comment">// interface function, otherwise DM function part of standard PETSc</span></div>
<div class="line">    <span class="comment">// interface.</span></div>
<div class="line"> </div>
<div class="line">    DM dm;</div>
<div class="line">    <span class="comment">// Get dm</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> simple_interface-&gt;getDM(&amp;dm);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Solve problem, only PETEc interface here.</span></div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Create the right hand side vector and vector of unknowns</span></div>
<div class="line">      <a class="code hl_typedef" href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">Vec</a> <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateGlobalVector(dm, &amp;<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line">      <span class="comment">// Create unknown vector by creating duplicate copy of F vector. only</span></div>
<div class="line">      <span class="comment">// structure is duplicated no values.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDuplicate(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, &amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">      DM dm_sub_KK, dm_sub_LU;</div>
<div class="line">      ublas::matrix&lt;Mat&gt; nested_matrices(2, 2);</div>
<div class="line">      ublas::vector&lt;IS&gt; nested_is(2);</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreate(PETSC_COMM_WORLD, &amp;dm_sub_KK);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetType(dm_sub_KK, <span class="stringliteral">&quot;DMMOFEM&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga175a29f4cdd0e7b7ae6cc2a0d7ed1704">DMMoFEMCreateSubDM</a>(dm_sub_KK, dm, <span class="stringliteral">&quot;SUB_KK&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetFromOptions(dm_sub_KK);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga27babc6dfb0df28667682a98b5822739">DMMoFEMSetSquareProblem</a>(dm_sub_KK, PETSC_TRUE);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga62400e040ecf09a00b7ec3767fc7f124">DMMoFEMAddSubFieldRow</a>(dm_sub_KK, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gac7a16ef15dc01cc47e25241d138d85da">DMMoFEMAddSubFieldCol</a>(dm_sub_KK, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga20e87100aebf5aa51e07126ae1f5113d">DMMoFEMAddElement</a>(dm_sub_KK,</div>
<div class="line">                               simple_interface-&gt;getDomainFEName().c_str());</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga20e87100aebf5aa51e07126ae1f5113d">DMMoFEMAddElement</a>(dm_sub_KK,</div>
<div class="line">                               simple_interface-&gt;getBoundaryFEName().c_str());</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetUp(dm_sub_KK);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a57f23916af347632f819d3b5a0058218">DMMoFEMGetSubRowIS</a>(dm_sub_KK, &amp;nested_is[0]);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateMatrix(dm_sub_KK, &amp;nested_matrices(0, 0));</div>
<div class="line">      domain_lhs_fe-&gt;ksp_B = nested_matrices(0, 0);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(</div>
<div class="line">          dm_sub_KK, simple_interface-&gt;getDomainFEName(), domain_lhs_fe);</div>
<div class="line">      boundary_penalty_lhs_fe-&gt;ksp_B = nested_matrices(0, 0);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm_sub_KK,</div>
<div class="line">                                      simple_interface-&gt;getBoundaryFEName(),</div>
<div class="line">                                      boundary_penalty_lhs_fe);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyBegin(nested_matrices(0, 0), MAT_FINAL_ASSEMBLY);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyEnd(nested_matrices(0, 0), MAT_FINAL_ASSEMBLY);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm_sub_KK);</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreate(PETSC_COMM_WORLD, &amp;dm_sub_LU);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetType(dm_sub_LU, <span class="stringliteral">&quot;DMMOFEM&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga175a29f4cdd0e7b7ae6cc2a0d7ed1704">DMMoFEMCreateSubDM</a>(dm_sub_LU, dm, <span class="stringliteral">&quot;SUB_LU&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetFromOptions(dm_sub_LU);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga27babc6dfb0df28667682a98b5822739">DMMoFEMSetSquareProblem</a>(dm_sub_LU, PETSC_FALSE);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga62400e040ecf09a00b7ec3767fc7f124">DMMoFEMAddSubFieldRow</a>(dm_sub_LU, <span class="stringliteral">&quot;L&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gac7a16ef15dc01cc47e25241d138d85da">DMMoFEMAddSubFieldCol</a>(dm_sub_LU, <span class="stringliteral">&quot;U&quot;</span>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#ga20e87100aebf5aa51e07126ae1f5113d">DMMoFEMAddElement</a>(dm_sub_LU,</div>
<div class="line">                               simple_interface-&gt;getBoundaryFEName().c_str());</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetUp(dm_sub_LU);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="namespaceMoFEM.html#a57f23916af347632f819d3b5a0058218">DMMoFEMGetSubRowIS</a>(dm_sub_LU, &amp;nested_is[1]);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateMatrix(dm_sub_LU, &amp;nested_matrices(1, 0));</div>
<div class="line">      boundary_lhs_fe-&gt;ksp_B = nested_matrices(1, 0);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(</div>
<div class="line">          dm_sub_LU, simple_interface-&gt;getBoundaryFEName(), boundary_lhs_fe);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyBegin(nested_matrices(1, 0), MAT_FINAL_ASSEMBLY);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyEnd(nested_matrices(1, 0), MAT_FINAL_ASSEMBLY);</div>
<div class="line">      <span class="comment">// CHKERR MatCreateTranspose(nested_matrices(1,0),&amp;nested_matrices(0,1));</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatTranspose(nested_matrices(1, 0), MAT_INITIAL_MATRIX,</div>
<div class="line">                          &amp;nested_matrices(0, 1));</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm_sub_LU);</div>
<div class="line"> </div>
<div class="line">      domain_rhs_fe-&gt;ksp_f = <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm, simple_interface-&gt;getDomainFEName(),</div>
<div class="line">                                      domain_rhs_fe);</div>
<div class="line">      boundary_rhs_fe-&gt;ksp_f = <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm, simple_interface-&gt;getBoundaryFEName(),</div>
<div class="line">                                      boundary_rhs_fe);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyBegin(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyEnd(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line"> </div>
<div class="line">      Mat <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>;</div>
<div class="line">      nested_matrices(1, 1) = PETSC_NULLPTR;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code hl_variable" href="dm__create__subdm_8cpp.html#a6295d47efda04de55c38cb8ea1cdb807">debug</a>) {</div>
<div class="line">        MatType <a class="code hl_variable" href="namespaceconvert.html#a80e685c1c2056739a335dd39b1981ef7">type</a>;</div>
<div class="line">        MatGetType(nested_matrices(0, 0), &amp;type);</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;K &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceconvert.html#a80e685c1c2056739a335dd39b1981ef7">type</a> &lt;&lt; endl;</div>
<div class="line">        MatGetType(nested_matrices(1, 0), &amp;type);</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;C &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceconvert.html#a80e685c1c2056739a335dd39b1981ef7">type</a> &lt;&lt; endl;</div>
<div class="line">        MatGetType(nested_matrices(0, 1), &amp;type);</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;CT &quot;</span> &lt;&lt; <a class="code hl_variable" href="namespaceconvert.html#a80e685c1c2056739a335dd39b1981ef7">type</a> &lt;&lt; endl;</div>
<div class="line">        std::string wait;</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;UU&quot;</span> &lt;&lt; endl;</div>
<div class="line">        MatView(nested_matrices(0, 0), PETSC_VIEWER_DRAW_WORLD);</div>
<div class="line">        std::cin &gt;&gt; wait;</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;LU&quot;</span> &lt;&lt; endl;</div>
<div class="line">        MatView(nested_matrices(1, 0), PETSC_VIEWER_DRAW_WORLD);</div>
<div class="line">        std::cin &gt;&gt; wait;</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;UL&quot;</span> &lt;&lt; endl;</div>
<div class="line">        MatView(nested_matrices(0, 1), PETSC_VIEWER_DRAW_WORLD);</div>
<div class="line">        std::cin &gt;&gt; wait;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatCreateNest(PETSC_COMM_WORLD, 2, &amp;nested_is[0], 2, &amp;nested_is[0],</div>
<div class="line">                           &amp;nested_matrices(0, 0), &amp;<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Create solver and link it to DM</span></div>
<div class="line">      KSP solver;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPCreate(PETSC_COMM_WORLD, &amp;solver);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(solver);</div>
<div class="line">      <span class="comment">// Set operators</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetOperators(solver, <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>, <a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>);</div>
<div class="line">      PC pc;</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPGetPC(solver, &amp;pc);</div>
<div class="line">      PetscBool is_pcfs = PETSC_FALSE;</div>
<div class="line">      PetscObjectTypeCompare((PetscObject)pc, PCFIELDSPLIT, &amp;is_pcfs);</div>
<div class="line">      <span class="keywordflow">if</span> (is_pcfs) {</div>
<div class="line">        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PCFieldSplitSetIS(pc, NULL, nested_is[0]);</div>
<div class="line">        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PCFieldSplitSetIS(pc, NULL, nested_is[1]);</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        SETERRQ(PETSC_COMM_WORLD, <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line">                <span class="stringliteral">&quot;Only works with pre-conditioner PCFIELDSPLIT&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Set-up solver, is type of solver and pre-conditioners</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(solver);</div>
<div class="line">      <span class="comment">// At solution process, KSP solver using DM creates matrices, Calculate</span></div>
<div class="line">      <span class="comment">// values of the left hand side and the right hand side vector. then</span></div>
<div class="line">      <span class="comment">// solves system of equations. Results are stored in vector D.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(solver, <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Scatter solution on the mesh. Stores unknown vector on field on the</span></div>
<div class="line">      <span class="comment">// mesh.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gad94692d0472b346672a25c63e91fb930">DMoFEMMeshToGlobalVector</a>(dm, <a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>, INSERT_VALUES, SCATTER_REVERSE);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Clean data. Solver and vector are not needed any more.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPDestroy(&amp;solver);</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> = 0; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a> != 2; <a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>++) {</div>
<div class="line">        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> ISDestroy(&amp;nested_is[<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>]);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a> = 0; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a> != 2; <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>++) {</div>
<div class="line">          <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;nested_matrices(<a class="code hl_variable" href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a>, <a class="code hl_variable" href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a>));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatDestroy(&amp;<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDestroy(&amp;<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDestroy(&amp;<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Calculate error</span></div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Loop over all elements in mesh, and run users operators on each</span></div>
<div class="line">      <span class="comment">// element.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm, simple_interface-&gt;getDomainFEName(),</div>
<div class="line">                                      domain_error);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1AuxFunctions.html">PoissonExample::AuxFunctions</a>(m_field).<a class="code hl_function" href="structPoissonExample_1_1AuxFunctions.html#aa46eb103d077a4900ab68dec1c553ce0">assembleGhostVector</a>(</div>
<div class="line">          global_error);</div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1AuxFunctions.html">PoissonExample::AuxFunctions</a>(m_field).<a class="code hl_function" href="structPoissonExample_1_1AuxFunctions.html#ac14c3f26684ae673c003e7f990186073">printError</a>(global_error);</div>
<div class="line">      <span class="keywordflow">if</span> (flg_test == PETSC_TRUE) {</div>
<div class="line">        <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_struct" href="structPoissonExample_1_1AuxFunctions.html">PoissonExample::AuxFunctions</a>(m_field).<a class="code hl_function" href="structPoissonExample_1_1AuxFunctions.html#a6bc4cd5c9f9ee29f123a6f67fadf35f5">testError</a>(global_error);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Loop over all elements in the mesh and for each execute</span></div>
<div class="line">      <span class="comment">// post_proc_volume element and operators on it.</span></div>
<div class="line">      <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> <a class="code hl_function" href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">DMoFEMLoopFiniteElements</a>(dm, simple_interface-&gt;getDomainFEName(),</div>
<div class="line">                                      post_proc_volume);</div>
<div class="line">      <span class="comment">// Write results</span></div>
<div class="line">      post_proc_volume-&gt;writeFile(<span class="stringliteral">&quot;out_vol.h5m&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Destroy DM, no longer needed.</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Destroy ghost vector</span></div>
<div class="line">    <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecDestroy(&amp;global_error);</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#a1e74d797bf522e2b291419cddab27835">CATCH_ERRORS</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// finish work cleaning memory, getting statistics, etc.</span></div>
<div class="line">  <a class="code hl_function" href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa5abe3b5d998e2dc50e4ef6916915eb1">MoFEM::Core::Finalize</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aAuxPoissonFunctions_8hpp_html"><div class="ttname"><a href="AuxPoissonFunctions_8hpp.html">AuxPoissonFunctions.hpp</a></div></div>
<div class="ttc" id="aMoFEM_8hpp_html"><div class="ttname"><a href="MoFEM_8hpp.html">MoFEM.hpp</a></div></div>
<div class="ttc" id="aPoissonOperators_8hpp_html"><div class="ttname"><a href="PoissonOperators_8hpp.html">PoissonOperators.hpp</a></div></div>
<div class="ttc" id="aactivate__deactivate__dofs_8cpp_html_a29680e68c64040f4884f60691a193226"><div class="ttname"><a href="activate__deactivate__dofs_8cpp.html#a29680e68c64040f4884f60691a193226">help</a></div><div class="ttdeci">static char help[]</div><div class="ttdef"><b>Definition</b> <a href="activate__deactivate__dofs_8cpp_source.html#l00013">activate_deactivate_dofs.cpp:13</a></div></div>
<div class="ttc" id="aadol-c__atom_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="adol-c__atom_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="adol-c__atom_8cpp_source.html#l00046">adol-c_atom.cpp:46</a></div></div>
<div class="ttc" id="aapprox__sphere_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="approx__sphere_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">constexpr double a</div><div class="ttdef"><b>Definition</b> <a href="approx__sphere_8cpp_source.html#l00030">approx_sphere.cpp:30</a></div></div>
<div class="ttc" id="aclassB_html"><div class="ttname"><a href="classB.html">B</a></div></div>
<div class="ttc" id="aclassFTensor_1_1Index_html"><div class="ttname"><a href="classFTensor_1_1Index.html">FTensor::Index</a></div><div class="ttdef"><b>Definition</b> <a href="Index_8hpp_source.html#l00023">Index.hpp:24</a></div></div>
<div class="ttc" id="aclassFTensor_1_1Tensor0_html"><div class="ttname"><a href="classFTensor_1_1Tensor0.html">FTensor::Tensor0</a></div><div class="ttdef"><b>Definition</b> <a href="Tensor0_8hpp_source.html#l00016">Tensor0.hpp:17</a></div></div>
<div class="ttc" id="aclassFTensor_1_1Tensor1_html"><div class="ttname"><a href="classFTensor_1_1Tensor1.html">FTensor::Tensor1</a></div><div class="ttdef"><b>Definition</b> <a href="Tensor1__value_8hpp_source.html#l00008">Tensor1_value.hpp:9</a></div></div>
<div class="ttc" id="aclassUserDataOperator_html"><div class="ttname"><a href="classUserDataOperator.html">UserDataOperator</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a1e74d797bf522e2b291419cddab27835"><div class="ttname"><a href="definitions_8h.html#a1e74d797bf522e2b291419cddab27835">CATCH_ERRORS</a></div><div class="ttdeci">#define CATCH_ERRORS</div><div class="ttdoc">Catch errors.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00385">definitions.h:385</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d"><div class="ttname"><a href="definitions_8h.html#a2ed4ed94b56d2843840bb7c55adcf0c5a54a26843865f4712f50a74fa4f8d025d">AINSWORTH_LEGENDRE_BASE</a></div><div class="ttdeci">@ AINSWORTH_LEGENDRE_BASE</div><div class="ttdoc">Ainsworth Cole (Legendre) approx. base .</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00061">definitions.h:60</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a59cd650c2f6d3e0dc1ad1c29821e8692"><div class="ttname"><a href="definitions_8h.html#a59cd650c2f6d3e0dc1ad1c29821e8692">MoFEMFunctionReturnHot</a></div><div class="ttdeci">#define MoFEMFunctionReturnHot(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00463">definitions.h:463</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a5ed4cb303bab8cd0673ae12e5bc73c12a0adffb24dae0c41be5b803f4d444f066"><div class="ttname"><a href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a0adffb24dae0c41be5b803f4d444f066">L2</a></div><div class="ttdeci">@ L2</div><div class="ttdoc">field with C-1 continuity</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00088">definitions.h:88</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120"><div class="ttname"><a href="definitions_8h.html#a5ed4cb303bab8cd0673ae12e5bc73c12a7ec6526640e5add74fe4b322e6343120">H1</a></div><div class="ttdeci">@ H1</div><div class="ttdoc">continuous field</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00085">definitions.h:85</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a6c0b52978f1abc88bf8a1ba70b7308e3"><div class="ttname"><a href="definitions_8h.html#a6c0b52978f1abc88bf8a1ba70b7308e3">MoFEMFunctionBegin</a></div><div class="ttdeci">#define MoFEMFunctionBegin</div><div class="ttdoc">First executable line of each MoFEM function, used for error handling. Final line of MoFEM functions ...</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00359">definitions.h:359</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724"><div class="ttname"><a href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a></div><div class="ttdeci">@ MOFEM_DATA_INCONSISTENCY</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00031">definitions.h:31</a></div></div>
<div class="ttc" id="adefinitions_8h_html_acb0a46d159695a01bf667313b7788b45"><div class="ttname"><a href="definitions_8h.html#acb0a46d159695a01bf667313b7788b45">MoFEMFunctionReturn</a></div><div class="ttdeci">#define MoFEMFunctionReturn(a)</div><div class="ttdoc">Last executable line of each PETSc function used for error handling. Replaces return()</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00432">definitions.h:432</a></div></div>
<div class="ttc" id="adefinitions_8h_html_add80e5ef5f847b2d4b637029f0f671c3"><div class="ttname"><a href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a></div><div class="ttdeci">#define CHKERR</div><div class="ttdoc">Inline error check.</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00551">definitions.h:551</a></div></div>
<div class="ttc" id="adg__projection_8cpp_html_ad7eceded84ace5678d9df3e44f47d475"><div class="ttname"><a href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a></div><div class="ttdeci">constexpr int order</div><div class="ttdef"><b>Definition</b> <a href="dg__projection_8cpp_source.html#l00018">dg_projection.cpp:18</a></div></div>
<div class="ttc" id="adm__create__subdm_8cpp_html_a6295d47efda04de55c38cb8ea1cdb807"><div class="ttname"><a href="dm__create__subdm_8cpp.html#a6295d47efda04de55c38cb8ea1cdb807">debug</a></div><div class="ttdeci">static const bool debug</div><div class="ttdef"><b>Definition</b> <a href="dm__create__subdm_8cpp_source.html#l00012">dm_create_subdm.cpp:12</a></div></div>
<div class="ttc" id="afree__surface_8cpp_html_a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d"><div class="ttname"><a href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a></div><div class="ttdeci">@ F</div><div class="ttdef"><b>Definition</b> <a href="free__surface_8cpp_source.html#l00396">free_surface.cpp:396</a></div></div>
<div class="ttc" id="agroup__dm_html_ga175a29f4cdd0e7b7ae6cc2a0d7ed1704"><div class="ttname"><a href="group__dm.html#ga175a29f4cdd0e7b7ae6cc2a0d7ed1704">MoFEM::DMMoFEMCreateSubDM</a></div><div class="ttdeci">PetscErrorCode DMMoFEMCreateSubDM(DM subdm, DM dm, const char problem_name[])</div><div class="ttdoc">Must be called by user to set Sub DM MoFEM data structures.</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00215">DMMoFEM.cpp:215</a></div></div>
<div class="ttc" id="agroup__dm_html_ga20e87100aebf5aa51e07126ae1f5113d"><div class="ttname"><a href="group__dm.html#ga20e87100aebf5aa51e07126ae1f5113d">MoFEM::DMMoFEMAddElement</a></div><div class="ttdeci">PetscErrorCode DMMoFEMAddElement(DM dm, std::string fe_name)</div><div class="ttdoc">add element to dm</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00488">DMMoFEM.cpp:488</a></div></div>
<div class="ttc" id="agroup__dm_html_ga27babc6dfb0df28667682a98b5822739"><div class="ttname"><a href="group__dm.html#ga27babc6dfb0df28667682a98b5822739">MoFEM::DMMoFEMSetSquareProblem</a></div><div class="ttdeci">PetscErrorCode DMMoFEMSetSquareProblem(DM dm, PetscBool square_problem)</div><div class="ttdoc">set squared problem</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00450">DMMoFEM.cpp:450</a></div></div>
<div class="ttc" id="agroup__dm_html_ga62400e040ecf09a00b7ec3767fc7f124"><div class="ttname"><a href="group__dm.html#ga62400e040ecf09a00b7ec3767fc7f124">MoFEM::DMMoFEMAddSubFieldRow</a></div><div class="ttdeci">PetscErrorCode DMMoFEMAddSubFieldRow(DM dm, const char field_name[])</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00238">DMMoFEM.cpp:238</a></div></div>
<div class="ttc" id="agroup__dm_html_ga899ec9d1ad35488bbe4273731f6d5c90"><div class="ttname"><a href="group__dm.html#ga899ec9d1ad35488bbe4273731f6d5c90">MoFEM::DMRegister_MoFEM</a></div><div class="ttdeci">PetscErrorCode DMRegister_MoFEM(const char sname[])</div><div class="ttdoc">Register MoFEM problem.</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00043">DMMoFEM.cpp:43</a></div></div>
<div class="ttc" id="agroup__dm_html_gaa77602fddf773ab52fee8369cc135d7e"><div class="ttname"><a href="group__dm.html#gaa77602fddf773ab52fee8369cc135d7e">MoFEM::DMoFEMLoopFiniteElements</a></div><div class="ttdeci">PetscErrorCode DMoFEMLoopFiniteElements(DM dm, const char fe_name[], MoFEM::FEMethod *method, CacheTupleWeakPtr cache_ptr=CacheTupleSharedPtr())</div><div class="ttdoc">Executes FEMethod for finite elements in DM.</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00576">DMMoFEM.cpp:576</a></div></div>
<div class="ttc" id="agroup__dm_html_gac7a16ef15dc01cc47e25241d138d85da"><div class="ttname"><a href="group__dm.html#gac7a16ef15dc01cc47e25241d138d85da">MoFEM::DMMoFEMAddSubFieldCol</a></div><div class="ttdeci">PetscErrorCode DMMoFEMAddSubFieldCol(DM dm, const char field_name[])</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00280">DMMoFEM.cpp:280</a></div></div>
<div class="ttc" id="agroup__dm_html_gad94692d0472b346672a25c63e91fb930"><div class="ttname"><a href="group__dm.html#gad94692d0472b346672a25c63e91fb930">MoFEM::DMoFEMMeshToGlobalVector</a></div><div class="ttdeci">PetscErrorCode DMoFEMMeshToGlobalVector(DM dm, Vec g, InsertMode mode, ScatterMode scatter_mode)</div><div class="ttdoc">set ghosted vector values on all existing mesh entities</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00525">DMMoFEM.cpp:525</a></div></div>
<div class="ttc" id="ahcurl__divergence__operator__2d_8cpp_html_a4c0436605284b64f6b0b5482594d86bc"><div class="ttname"><a href="hcurl__divergence__operator__2d_8cpp.html#a4c0436605284b64f6b0b5482594d86bc">i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', SPACE_DIM &gt; i</div><div class="ttdef"><b>Definition</b> <a href="hcurl__divergence__operator__2d_8cpp_source.html#l00027">hcurl_divergence_operator_2d.cpp:27</a></div></div>
<div class="ttc" id="ainitial__diffusion_8cpp_html_ad8657a5ec76e12f3066fb4b4eb75ace9"><div class="ttname"><a href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a></div><div class="ttdeci">double D</div><div class="ttdef"><b>Definition</b> <a href="initial__diffusion_8cpp_source.html#l00044">initial_diffusion.cpp:44</a></div></div>
<div class="ttc" id="amatrix__function_8cpp_html_a8191f28ba278df9c5d32a75cadb2bbd5"><div class="ttname"><a href="matrix__function_8cpp.html#a8191f28ba278df9c5d32a75cadb2bbd5">j</a></div><div class="ttdeci">FTensor::Index&lt; 'j', 3 &gt; j</div><div class="ttdef"><b>Definition</b> <a href="matrix__function_8cpp_source.html#l00019">matrix_function.cpp:19</a></div></div>
<div class="ttc" id="anamespaceEigenMatrix_html_a34cd82caee17a35f38d6df0cf87ee75b"><div class="ttname"><a href="namespaceEigenMatrix.html#a34cd82caee17a35f38d6df0cf87ee75b">EigenMatrix::Vec</a></div><div class="ttdeci">const FTensor::Tensor2&lt; T, Dim, Dim &gt; Vec</div><div class="ttdef"><b>Definition</b> <a href="MatrixFunction_8hpp_source.html#l00064">MatrixFunction.hpp:64</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Exceptions_html_a8fb6351034eac301fc47fdf2748c1b45"><div class="ttname"><a href="namespaceMoFEM_1_1Exceptions.html#a8fb6351034eac301fc47fdf2748c1b45">MoFEM::Exceptions::MoFEMErrorCode</a></div><div class="ttdeci">PetscErrorCode MoFEMErrorCode</div><div class="ttdoc">MoFEM/PETSc error code.</div><div class="ttdef"><b>Definition</b> <a href="Exceptions_8hpp_source.html#l00056">Exceptions.hpp:56</a></div></div>
<div class="ttc" id="anamespaceMoFEM_1_1Types_html_a71f706f784fbf6fd240806b70ed7d933"><div class="ttname"><a href="namespaceMoFEM_1_1Types.html#a71f706f784fbf6fd240806b70ed7d933">MoFEM::Types::MatrixDouble</a></div><div class="ttdeci">UBlasMatrix&lt; double &gt; MatrixDouble</div><div class="ttdef"><b>Definition</b> <a href="Types_8hpp_source.html#l00077">Types.hpp:77</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a57f23916af347632f819d3b5a0058218"><div class="ttname"><a href="namespaceMoFEM.html#a57f23916af347632f819d3b5a0058218">MoFEM::DMMoFEMGetSubRowIS</a></div><div class="ttdeci">PetscErrorCode DMMoFEMGetSubRowIS(DM dm, IS *is)</div><div class="ttdoc">get sub problem is</div><div class="ttdef"><b>Definition</b> <a href="DMMoFEM_8cpp_source.html#l00330">DMMoFEM.cpp:330</a></div></div>
<div class="ttc" id="anamespaceMoFEM_html_a9c8c990b46b2b3994e4971b70f340074"><div class="ttname"><a href="namespaceMoFEM.html#a9c8c990b46b2b3994e4971b70f340074">MoFEM::MatSetValues</a></div><div class="ttdeci">MoFEMErrorCode MatSetValues(Mat M, const EntitiesFieldData::EntData &amp;row_data, const EntitiesFieldData::EntData &amp;col_data, const double *ptr, InsertMode iora)</div><div class="ttdoc">Assemble PETSc matrix.</div><div class="ttdef"><b>Definition</b> <a href="EntitiesFieldData_8hpp_source.html#l01644">EntitiesFieldData.hpp:1644</a></div></div>
<div class="ttc" id="anamespaceconvert_html_a80e685c1c2056739a335dd39b1981ef7"><div class="ttname"><a href="namespaceconvert.html#a80e685c1c2056739a335dd39b1981ef7">convert.type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition</b> <a href="convert_8py_source.html#l00064">convert.py:64</a></div></div>
<div class="ttc" id="aoperators__tests_8cpp_html_aaea25cacd18f8fc7fbbaa4311fe33b72"><div class="ttname"><a href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a></div><div class="ttdeci">constexpr AssemblyType A</div><div class="ttdef"><b>Definition</b> <a href="operators__tests_8cpp_source.html#l00030">operators_tests.cpp:30</a></div></div>
<div class="ttc" id="astructExactFunctionGrad_html"><div class="ttname"><a href="structExactFunctionGrad.html">ExactFunctionGrad</a></div><div class="ttdoc">Exact gradient.</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00043">analytical_nonlinear_poisson.cpp:43</a></div></div>
<div class="ttc" id="astructExactFunctionGrad_html_a6b0666c823934f237b6a40c8b5f86eb6"><div class="ttname"><a href="structExactFunctionGrad.html#a6b0666c823934f237b6a40c8b5f86eb6">ExactFunctionGrad::operator()</a></div><div class="ttdeci">FTensor::Tensor1&lt; double, 3 &gt; operator()(const double x, const double y, const double z) const</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00044">analytical_nonlinear_poisson.cpp:44</a></div></div>
<div class="ttc" id="astructExactFunction_html"><div class="ttname"><a href="structExactFunction.html">ExactFunction</a></div><div class="ttdoc">Function.</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00034">analytical_nonlinear_poisson.cpp:34</a></div></div>
<div class="ttc" id="astructExactFunction_html_a624aa0f96fa6b76dffb91979376510f0"><div class="ttname"><a href="structExactFunction.html#a624aa0f96fa6b76dffb91979376510f0">ExactFunction::operator()</a></div><div class="ttdeci">double operator()(const double x, const double y, const double z) const</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00035">analytical_nonlinear_poisson.cpp:35</a></div></div>
<div class="ttc" id="astructExactLaplacianFunction_html"><div class="ttname"><a href="structExactLaplacianFunction.html">ExactLaplacianFunction</a></div><div class="ttdoc">Laplacian of function.</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00058">analytical_nonlinear_poisson.cpp:58</a></div></div>
<div class="ttc" id="astructExactLaplacianFunction_html_a6b9269124ee9aebddf08ea9249a4b949"><div class="ttname"><a href="structExactLaplacianFunction.html#a6b9269124ee9aebddf08ea9249a4b949">ExactLaplacianFunction::operator()</a></div><div class="ttdeci">double operator()(const double x, const double y, const double z) const</div><div class="ttdef"><b>Definition</b> <a href="analytical__nonlinear__poisson_8cpp_source.html#l00059">analytical_nonlinear_poisson.cpp:59</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html">MoFEM::CoreTmp&lt; 0 &gt;</a></div><div class="ttdoc">Core (interface) class.</div><div class="ttdef"><b>Definition</b> <a href="Core_8hpp_source.html#l00082">Core.hpp:82</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_a137f1f2092d00ef0c1ec679db94b8cb0"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#a137f1f2092d00ef0c1ec679db94b8cb0">MoFEM::CoreTmp&lt; 0 &gt;::Initialize</a></div><div class="ttdeci">static MoFEMErrorCode Initialize(int *argc, char ***args, const char file[], const char help[])</div><div class="ttdoc">Initializes the MoFEM database PETSc, MOAB and MPI.</div><div class="ttdef"><b>Definition</b> <a href="Core_8cpp_source.html#l00072">Core.cpp:72</a></div></div>
<div class="ttc" id="astructMoFEM_1_1CoreTmp_3_010_01_4_html_aa5abe3b5d998e2dc50e4ef6916915eb1"><div class="ttname"><a href="structMoFEM_1_1CoreTmp_3_010_01_4.html#aa5abe3b5d998e2dc50e4ef6916915eb1">MoFEM::CoreTmp&lt; 0 &gt;::Finalize</a></div><div class="ttdeci">static MoFEMErrorCode Finalize()</div><div class="ttdoc">Checks for options to be called at the conclusion of the program.</div><div class="ttdef"><b>Definition</b> <a href="Core_8cpp_source.html#l00112">Core.cpp:112</a></div></div>
<div class="ttc" id="astructMoFEM_1_1DeprecatedCoreInterface_html"><div class="ttname"><a href="structMoFEM_1_1DeprecatedCoreInterface.html">MoFEM::DeprecatedCoreInterface</a></div><div class="ttdoc">Deprecated interface functions.</div><div class="ttdef"><b>Definition</b> <a href="DeprecatedCoreInterface_8hpp_source.html#l00016">DeprecatedCoreInterface.hpp:16</a></div></div>
<div class="ttc" id="astructMoFEM_1_1UnknownInterface_html_a7ab248ec45fca778800dcd92e5171beb"><div class="ttname"><a href="structMoFEM_1_1UnknownInterface.html#a7ab248ec45fca778800dcd92e5171beb">MoFEM::UnknownInterface::getInterface</a></div><div class="ttdeci">MoFEMErrorCode getInterface(IFACE *&amp;iface) const</div><div class="ttdoc">Get interface reference to pointer of interface.</div><div class="ttdef"><b>Definition</b> <a href="UnknownInterface_8hpp_source.html#l00093">UnknownInterface.hpp:93</a></div></div>
<div class="ttc" id="astructOpS_html"><div class="ttname"><a href="structOpS.html">OpS</a></div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00073">analytical_poisson_field_split.cpp:73</a></div></div>
<div class="ttc" id="astructOpS_html_a216a8b13cbbd7a9bb9ce35da08b8bccb"><div class="ttname"><a href="structOpS.html#a216a8b13cbbd7a9bb9ce35da08b8bccb">OpS::nbIntegrationPts</a></div><div class="ttdeci">int nbIntegrationPts</div><div class="ttdoc">number of integration points</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00127">analytical_poisson_field_split.cpp:127</a></div></div>
<div class="ttc" id="astructOpS_html_a2a11648458c4ca82fa8a5a35b1021ec6"><div class="ttname"><a href="structOpS.html#a2a11648458c4ca82fa8a5a35b1021ec6">OpS::iNtegrate</a></div><div class="ttdeci">MoFEMErrorCode iNtegrate(EntitiesFieldData::EntData &amp;row_data, EntitiesFieldData::EntData &amp;col_data)</div><div class="ttdoc">Integrate grad-grad operator.</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00139">analytical_poisson_field_split.cpp:139</a></div></div>
<div class="ttc" id="astructOpS_html_a57a5b2fee7843c7e0620cc12042f9acb"><div class="ttname"><a href="structOpS.html#a57a5b2fee7843c7e0620cc12042f9acb">OpS::nbRows</a></div><div class="ttdeci">int nbRows</div><div class="ttdoc">number of dofs on rows</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00125">analytical_poisson_field_split.cpp:125</a></div></div>
<div class="ttc" id="astructOpS_html_a80922f33899ea48946cef5f0b2bbef15"><div class="ttname"><a href="structOpS.html#a80922f33899ea48946cef5f0b2bbef15">OpS::doWork</a></div><div class="ttdeci">MoFEMErrorCode doWork(int row_side, int col_side, EntityType row_type, EntityType col_type, EntitiesFieldData::EntData &amp;row_data, EntitiesFieldData::EntData &amp;col_data)</div><div class="ttdoc">Do calculations for give operator.</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00090">analytical_poisson_field_split.cpp:90</a></div></div>
<div class="ttc" id="astructOpS_html_a8d7fe14b9ec36d2656400eafc71d8648"><div class="ttname"><a href="structOpS.html#a8d7fe14b9ec36d2656400eafc71d8648">OpS::nbCols</a></div><div class="ttdeci">int nbCols</div><div class="ttdoc">number if dof on column</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00126">analytical_poisson_field_split.cpp:126</a></div></div>
<div class="ttc" id="astructOpS_html_a9af67d7ef1771a6993fcaacdaafddf37"><div class="ttname"><a href="structOpS.html#a9af67d7ef1771a6993fcaacdaafddf37">OpS::bEta</a></div><div class="ttdeci">const double bEta</div><div class="ttdoc">error code</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00121">analytical_poisson_field_split.cpp:121</a></div></div>
<div class="ttc" id="astructOpS_html_aae62acd6f4d23cfa06684d41d193545a"><div class="ttname"><a href="structOpS.html#aae62acd6f4d23cfa06684d41d193545a">OpS::locMat</a></div><div class="ttdeci">MatrixDouble locMat</div><div class="ttdoc">local entity block matrix</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00131">analytical_poisson_field_split.cpp:131</a></div></div>
<div class="ttc" id="astructOpS_html_ab946925517ebfa75faefc6be31f45d3d"><div class="ttname"><a href="structOpS.html#ab946925517ebfa75faefc6be31f45d3d">OpS::isDiag</a></div><div class="ttdeci">bool isDiag</div><div class="ttdoc">true if this block is on diagonal</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00128">analytical_poisson_field_split.cpp:128</a></div></div>
<div class="ttc" id="astructOpS_html_ac442dcd4228ef8e7caba8544497f48b4"><div class="ttname"><a href="structOpS.html#ac442dcd4228ef8e7caba8544497f48b4">OpS::aSsemble</a></div><div class="ttdeci">MoFEMErrorCode aSsemble(EntitiesFieldData::EntData &amp;row_data, EntitiesFieldData::EntData &amp;col_data)</div><div class="ttdoc">Assemble local entity block matrix.</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00184">analytical_poisson_field_split.cpp:184</a></div></div>
<div class="ttc" id="astructOpS_html_ad70d449c569a139c407d9669e00c72c8"><div class="ttname"><a href="structOpS.html#ad70d449c569a139c407d9669e00c72c8">OpS::i</a></div><div class="ttdeci">FTensor::Index&lt; 'i', 3 &gt; i</div><div class="ttdoc">summit Index</div><div class="ttdef"><b>Definition</b> <a href="analytical__poisson__field__split_8cpp_source.html#l00130">analytical_poisson_field_split.cpp:130</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1AuxFunctions_html"><div class="ttname"><a href="structPoissonExample_1_1AuxFunctions.html">PoissonExample::AuxFunctions</a></div><div class="ttdef"><b>Definition</b> <a href="AuxPoissonFunctions_8hpp_source.html#l00014">AuxPoissonFunctions.hpp:14</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1AuxFunctions_html_a0a81d42260b35b3eaff0836f78c911a9"><div class="ttname"><a href="structPoissonExample_1_1AuxFunctions.html#a0a81d42260b35b3eaff0836f78c911a9">PoissonExample::AuxFunctions::createGhostVec</a></div><div class="ttdeci">MoFEMErrorCode createGhostVec(Vec *ghost_vec) const</div><div class="ttdef"><b>Definition</b> <a href="AuxPoissonFunctions_8hpp_source.html#l00030">AuxPoissonFunctions.hpp:30</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1AuxFunctions_html_a6bc4cd5c9f9ee29f123a6f67fadf35f5"><div class="ttname"><a href="structPoissonExample_1_1AuxFunctions.html#a6bc4cd5c9f9ee29f123a6f67fadf35f5">PoissonExample::AuxFunctions::testError</a></div><div class="ttdeci">MoFEMErrorCode testError(Vec ghost_vec)</div><div class="ttdoc">Test error.</div><div class="ttdef"><b>Definition</b> <a href="AuxPoissonFunctions_8hpp_source.html#l00073">AuxPoissonFunctions.hpp:73</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1AuxFunctions_html_aa46eb103d077a4900ab68dec1c553ce0"><div class="ttname"><a href="structPoissonExample_1_1AuxFunctions.html#aa46eb103d077a4900ab68dec1c553ce0">PoissonExample::AuxFunctions::assembleGhostVector</a></div><div class="ttdeci">MoFEMErrorCode assembleGhostVector(Vec ghost_vec) const</div><div class="ttdoc">Assemble error vector.</div><div class="ttdef"><b>Definition</b> <a href="AuxPoissonFunctions_8hpp_source.html#l00043">AuxPoissonFunctions.hpp:43</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1AuxFunctions_html_ac14c3f26684ae673c003e7f990186073"><div class="ttname"><a href="structPoissonExample_1_1AuxFunctions.html#ac14c3f26684ae673c003e7f990186073">PoissonExample::AuxFunctions::printError</a></div><div class="ttdeci">MoFEMErrorCode printError(Vec ghost_vec)</div><div class="ttdoc">Print error.</div><div class="ttdef"><b>Definition</b> <a href="AuxPoissonFunctions_8hpp_source.html#l00060">AuxPoissonFunctions.hpp:60</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1CreateFiniteElements_html"><div class="ttname"><a href="structPoissonExample_1_1CreateFiniteElements.html">PoissonExample::CreateFiniteElements</a></div><div class="ttdoc">Create finite elements instances.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00861">PoissonOperators.hpp:861</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1CreateFiniteElements_html_a63d3da59aa561779e9e56bf4284ceeea"><div class="ttname"><a href="structPoissonExample_1_1CreateFiniteElements.html#a63d3da59aa561779e9e56bf4284ceeea">PoissonExample::CreateFiniteElements::creatFEToPostProcessResults</a></div><div class="ttdeci">MoFEMErrorCode creatFEToPostProcessResults(boost::shared_ptr&lt; PostProcFE &gt; &amp;post_proc_volume) const</div><div class="ttdoc">Create finite element to post-process results.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00947">PoissonOperators.hpp:947</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1CreateFiniteElements_html_ae250a14f45127e19c97e17df96252329"><div class="ttname"><a href="structPoissonExample_1_1CreateFiniteElements.html#ae250a14f45127e19c97e17df96252329">PoissonExample::CreateFiniteElements::createFEToEvaluateError</a></div><div class="ttdeci">MoFEMErrorCode createFEToEvaluateError(boost::function&lt; double(const double, const double, const double)&gt; f_u, boost::function&lt; FTensor::Tensor1&lt; double, 3 &gt;(const double, const double, const double)&gt; g_u, Vec global_error, boost::shared_ptr&lt; ForcesAndSourcesCore &gt; &amp;domain_error) const</div><div class="ttdoc">Create finite element to calculate error.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00911">PoissonOperators.hpp:911</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1CreateFiniteElements_html_ae7e856976912e3f952c8c5b96b674978"><div class="ttname"><a href="structPoissonExample_1_1CreateFiniteElements.html#ae7e856976912e3f952c8c5b96b674978">PoissonExample::CreateFiniteElements::createFEToAssembleMatrixAndVector</a></div><div class="ttdeci">MoFEMErrorCode createFEToAssembleMatrixAndVector(boost::function&lt; double(const double, const double, const double)&gt; f_u, boost::function&lt; double(const double, const double, const double)&gt; f_source, boost::shared_ptr&lt; ForcesAndSourcesCore &gt; &amp;domain_lhs_fe, boost::shared_ptr&lt; ForcesAndSourcesCore &gt; &amp;boundary_lhs_fe, boost::shared_ptr&lt; ForcesAndSourcesCore &gt; &amp;domain_rhs_fe, boost::shared_ptr&lt; ForcesAndSourcesCore &gt; &amp;boundary_rhs_fe, bool trans=true) const</div><div class="ttdoc">Create finite element to calculate matrix and vectors.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00868">PoissonOperators.hpp:868</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1FaceRule_html"><div class="ttname"><a href="structPoissonExample_1_1FaceRule.html">PoissonExample::FaceRule</a></div><div class="ttdoc">Set integration rule to boundary elements.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00849">PoissonOperators.hpp:849</a></div></div>
<div class="ttc" id="astructPoissonExample_1_1Op__g_html"><div class="ttname"><a href="structPoissonExample_1_1Op__g.html">PoissonExample::Op_g</a></div><div class="ttdoc">Assemble constrains vector.</div><div class="ttdef"><b>Definition</b> <a href="PoissonOperators_8hpp_source.html#l00419">PoissonOperators.hpp:420</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="poisson_tut3_adding_penalty"></a>
Creating penalty finite element instance</h1>
<p>This code is largely the same as in <a class="el" href="analytical_poisson_8cpp-example.html">analytical_poisson.cpp</a>, with only two places where we introduce changes. We will focus only on those parts. First we make pointer new penalty finite element instance, </p><div class="fragment"><div class="line">boost::shared_ptr&lt;ForcesAndSourcesCore&gt; boundary_penalty_lhs_fe;</div>
</div><!-- fragment --><p> and create finite element class instance itself </p><div class="fragment"><div class="line">boundary_penalty_lhs_fe = boost::shared_ptr&lt;ForcesAndSourcesCore&gt;(<span class="keyword">new</span> FaceElementForcesAndSourcesCore(m_field));</div>
</div><!-- fragment --><p> with that at hand we can add appropriate user data operators </p><div class="fragment"><div class="line">boundary_penalty_lhs_fe-&gt;getOpPtrVector().push_back(<span class="keyword">new</span> PoissonExample::OpS(beta));</div>
</div><!-- fragment --><p>Implementation of penalty operator <a class="el" href="structOpS.html#a2a11648458c4ca82fa8a5a35b1021ec6">OpS::iNtegrate</a> is in file <a class="el" href="analytical_poisson_field_split_8cpp-example.html">analytical_poisson_field_split.cpp</a> and do not differ to what was shown in <a class="el" href="poisson_tut2.html">COR-3: Implementing operators for the Poisson equation</a>.</p>
<h1><a class="anchor" id="poisson_tut3_code_dissection"></a>
Code dissection</h1>
<p>We will start with declaration of data structure necessary for creation of nested matrix. Nested matrix is PETSc structure which is used to store block matrices and on which one can perform operations as on other matrices types. </p><div class="fragment"><div class="line">DM dm_sub_KK,dm_sub_LU;</div>
<div class="line">ublas::matrix&lt;Mat&gt; nested_matrices(2,2);</div>
<div class="line">ublas::vector&lt;IS&gt; nested_is(2);</div>
</div><!-- fragment --><p> Vector of <em>IS</em> (<a class="el" href="classIndex.html">Index</a> Set) is used to store global indices of block matrices.</p>
<h2><a class="anchor" id="poisson_tut3_diagonal"></a>
Assembly of K and S matrices</h2>
<ul>
<li>We create sub DM from DM <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreate(PETSC_COMM_WORLD,&amp;dm_sub_KK);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetType(dm_sub_KK,<span class="stringliteral">&quot;DMMOFEM&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMCreateSubDM(dm_sub_KK,dm,<span class="stringliteral">&quot;SUB_KK&quot;</span>); </div>
</div><!-- fragment --></li>
<li>Configure and set-up DM <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMSetSquareProblem(dm_sub_KK,PETSC_TRUE); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddSubFieldRow(dm_sub_KK,<span class="stringliteral">&quot;U&quot;</span>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddSubFieldCol(dm_sub_KK,<span class="stringliteral">&quot;U&quot;</span>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm_sub_KK,simple_interface-&gt;getDomainFEName()); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm_sub_KK,simple_interface-&gt;getBoundaryFEName()); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetUp(dm_sub_KK); </div>
</div><!-- fragment --></li>
<li>Get global indices of DM for sub DM for the upper diagonal block <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMGetSubRowIS(dm_sub_KK,&amp;nested_is[0]); </div>
</div><!-- fragment --></li>
<li>Create matrix and assemble matrix \(\mathbf{K}\) and penalty matrix \(\mathbf{S}\) by iteration over domain finite elements entities and boundary finite elements entities <div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateMatrix(dm_sub_KK,&amp;nested_matrices(0,0)); </div>
<div class="line">domain_lhs_fe-&gt;ksp_B = nested_matrices(0,0);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm_sub_KK,simple_interface-&gt;getDomainFEName(),domain_lhs_fe); </div>
<div class="line">boundary_penalty_lhs_fe-&gt;ksp_B = nested_matrices(0,0);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm_sub_KK,simple_interface-&gt;getBoundaryFEName(),boundary_penalty_lhs_fe); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyBegin(nested_matrices(0,0),MAT_FINAL_ASSEMBLY); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyEnd(nested_matrices(0,0),MAT_FINAL_ASSEMBLY); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm_sub_KK); </div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="poisson_tut3_off_diagonal"></a>
Assembly of C matrix</h2>
<p>Assembly of off-diagonal blocks is similar to diagonal term, note that of diagonal block is not square matrix and integration is only over finite elements entities on the boundary </p><div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreate(PETSC_COMM_WORLD,&amp;dm_sub_LU);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetType(dm_sub_LU,<span class="stringliteral">&quot;DMMOFEM&quot;</span>);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMCreateSubDM(dm_sub_LU,dm,<span class="stringliteral">&quot;SUB_LU&quot;</span>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMSetSquareProblem(dm_sub_LU,PETSC_FALSE); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddSubFieldRow(dm_sub_LU,<span class="stringliteral">&quot;L&quot;</span>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddSubFieldCol(dm_sub_LU,<span class="stringliteral">&quot;U&quot;</span>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMAddElement(dm_sub_LU,simple_interface-&gt;getBoundaryFEName()); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMSetUp(dm_sub_LU); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMMoFEMGetSubRowIS(dm_sub_LU,&amp;nested_is[1]); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMCreateMatrix(dm_sub_LU,&amp;nested_matrices(1,0)); </div>
<div class="line">boundary_lhs_fe-&gt;ksp_B = nested_matrices(1,0);</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm_sub_LU,simple_interface-&gt;getBoundaryFEName(),boundary_lhs_fe); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyBegin(nested_matrices(1,0),MAT_FINAL_ASSEMBLY); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatAssemblyEnd(nested_matrices(1,0),MAT_FINAL_ASSEMBLY); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatTranspose(nested_matrices(1,0),MAT_INITIAL_MATRIX,&amp;nested_matrices(0,1)); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMDestroy(&amp;dm_sub_LU); </div>
</div><!-- fragment --><h2><a class="anchor" id="poisson_tut3_vector"></a>
Assembly of the right hand side vector</h2>
<p>Now we assemble global the right hand side vector, in the usual way using global DM </p><div class="fragment"><div class="line">domain_rhs_fe-&gt;ksp_f = <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm,simple_interface-&gt;getDomainFEName(),domain_rhs_fe); </div>
<div class="line">boundary_rhs_fe-&gt;ksp_f = <a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> DMoFEMLoopFiniteElements(dm,simple_interface-&gt;getBoundaryFEName(),boundary_rhs_fe); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyBegin(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> VecAssemblyEnd(<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>); </div>
</div><!-- fragment --><h2><a class="anchor" id="poisson_tut3_nested_matrix"></a>
Creation of global nested matrix</h2>
<p>For details how to create nested matrix see PETSc manual (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatCreateNest.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MatCreateNest.html</a>) </p><div class="fragment"><div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> MatCreateNest(</div>
<div class="line">  PETSC_COMM_WORLD,</div>
<div class="line">  2,&amp;nested_is[0],2,&amp;nested_is[0],&amp;nested_matrices(0,0),&amp;<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a></div>
<div class="line">); </div>
</div><!-- fragment --><h2><a class="anchor" id="poisson_tut3_solver"></a>
Solving problem</h2>
<ul>
<li>Create solver instance, and set-up from command line <div class="fragment"><div class="line"><span class="comment">// Create solver and link it to DM</span></div>
<div class="line">KSP solver;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPCreate(PETSC_COMM_WORLD,&amp;solver); </div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetFromOptions(solver); </div>
<div class="line"><span class="comment">// Set operators</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetOperators(solver,<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>,<a class="code hl_variable" href="operators__tests_8cpp.html#aaea25cacd18f8fc7fbbaa4311fe33b72">A</a>); </div>
</div><!-- fragment --></li>
<li>Get access to solver pre-conditioner and set-up PCFIELDSPLIT (see <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCFIELDSPLIT.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCFIELDSPLIT.html</a>) <div class="fragment"><div class="line">PC pc;</div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPGetPC(solver,&amp;pc); </div>
<div class="line">PetscBool is_pcfs = PETSC_FALSE;</div>
<div class="line">PetscObjectTypeCompare((PetscObject)pc,PCFIELDSPLIT,&amp;is_pcfs);</div>
<div class="line"><span class="keywordflow">if</span>(is_pcfs) {</div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PCFieldSplitSetIS(pc,NULL,nested_is[0]); </div>
<div class="line">  <a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> PCFieldSplitSetIS(pc,NULL,nested_is[1]); </div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  SETERRQ(</div>
<div class="line">    PETSC_COMM_WORLD,</div>
<div class="line">    <a class="code hl_enumvalue" href="definitions_8h.html#a980bf270a5c3f2f984262f7e74786a2eac345e9ce83307109886a56dcaf5ab724">MOFEM_DATA_INCONSISTENCY</a>,</div>
<div class="line">    <span class="stringliteral">&quot;Only works with pre-conditioner PCFIELDSPLIT&quot;</span></div>
<div class="line">  );</div>
<div class="line">}</div>
</div><!-- fragment --> Note that we set nested matrix as operator for pre-conditioner, and using <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/PCFieldSplitSetIS.html">PCFieldSplitSetIS</a> we setting elements of the field to PCFIELDSPLIT pre-conditioner.</li>
<li>Finally set-up solver and solve system of equations <div class="fragment"><div class="line"><span class="comment">// Set-up solver, is type of solver and pre-conditioners</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSetUp(solver); </div>
<div class="line"><span class="comment">// At solution process, KSP solver uses DM creates matrices, Calculates</span></div>
<div class="line"><span class="comment">// values of the left hand side and the right hand side vector. then</span></div>
<div class="line"><span class="comment">// solves the system of equations. Results are stored in the vector D.</span></div>
<div class="line"><a class="code hl_define" href="definitions_8h.html#add80e5ef5f847b2d4b637029f0f671c3">CHKERR</a> KSPSolve(solver,<a class="code hl_enumvalue" href="free__surface_8cpp.html#a275fe82762dca6ff32ecbb73db0b3b84af382a63cc3d6491bf26b59e66f46826d">F</a>,<a class="code hl_variable" href="initial__diffusion_8cpp.html#ad8657a5ec76e12f3066fb4b4eb75ace9">D</a>); </div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="poisson_tut3_running_program"></a>
Running the program</h1>
<p>In order to run the program, one should first go to the directory where the problem is located, compile the code and then run the executable file. Typically, this can be done as follows</p>
<div class="fragment"><div class="line">cd mofem_install/um/build/basic_finite_elements/poisson</div>
<div class="line">make -j2</div>
<div class="line">mpirun -np 2  ./analytical_poisson_field_split -file_name cube_2part.h5m -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 3 -pc_type fieldsplit</div>
</div><!-- fragment --><p> where options in .petscrc file are </p><div class="fragment"><div class="line">-ksp_type fgmres</div>
<div class="line">-ksp_atol 1e-12</div>
<div class="line">-ksp_rtol 0</div>
<div class="line">-ksp_monitor ascii</div>
<div class="line">-pc_fieldsplit_type schur</div>
<div class="line">-pc_fieldsplit_schur_precondition self</div>
<div class="line">-fieldsplit_0_ksp_type gmres</div>
<div class="line"><span class="preprocessor">#-fieldsplit_0_ksp_monitor</span></div>
<div class="line">-fieldsplit_0_ksp_max_it 100</div>
<div class="line">-fieldsplit_0_ksp_atol 1e-6</div>
<div class="line">-fieldsplit_0_ksp_rtol 1e-6</div>
<div class="line">-fieldsplit_0_pc_type lu</div>
<div class="line">-fieldsplit_0_pc_factor_mat_solver_type mumps</div>
<div class="line">-fieldsplit_0_pc_type gamg</div>
<div class="line">-fieldsplit_0_pc_mg_smoothup 5</div>
<div class="line">-fieldsplit_0_pc_mg_smoothdown 5</div>
<div class="line">-fieldsplit_0_mg_coarse_ksp_type preonly</div>
<div class="line">-fieldsplit_0_mg_coarse_pc_type hypre</div>
<div class="line">-fieldsplit_0_mg_coarse_pc_hypre_type parasails</div>
<div class="line">-fieldsplit_0_mg_coarse_pc_hypre_parasails_sym SPD</div>
<div class="line">-fieldsplit_0_mg_coarse_pc_hypre_parasails_thresh 0.2</div>
<div class="line">-fieldsplit_0_mg_coarse_pc_hypre_parasails_logging 1</div>
<div class="line">-fieldsplit_1_ksp_type minres</div>
<div class="line">-fieldsplit_1_ksp_monitor</div>
<div class="line">-fieldsplit_1_ksp_max_it 100</div>
<div class="line">-fieldsplit_1_ksp_atol 1e-2</div>
<div class="line">-fieldsplit_1_ksp_rtol 1e-2</div>
<div class="line">-fieldsplit_1_pc_type lsc</div>
<div class="line">-fieldsplit_1_lsc_ksp_type cg</div>
<div class="line">-fieldsplit_1_lsc_ksp_atol 1e-5</div>
<div class="line">-fieldsplit_1_lsc_ksp_rtol 1e-5</div>
<div class="line">-fieldsplit_1_lsc_ksp_max_it 100</div>
<div class="line">-fieldsplit_1_lsc_pc_type hypre</div>
<div class="line">-fieldsplit_1_lsc_pc_hypre_type parasails</div>
<div class="line">-fieldsplit_1_lsc_pc_hypre_parasails_sym SPD</div>
<div class="line">-fieldsplit_1_lsc_pc_hypre_parasails_nlevels 1</div>
<div class="line">-fieldsplit_1_lsc_pc_hypre_parasails_thresh 0.2</div>
<div class="line">-fieldsplit_1_lsc_pc_hypre_parasails_logging 1</div>
</div><!-- fragment --><p> as result of this we get </p><pre class="fragment"> 0 KSP Residual norm 8.033746248668e-01
** ParaSails Setup Pattern Statistics ***********
symmetric             : 1
thresh                : 0.200000
num_levels            : 1
Max cost (average)    : 3.9e+01 (2.0e+01)
Nnz (ratio)           : 39 ( 0.07)
Max setup pattern time:      0.0
*************************************************
** ParaSails Setup Values Statistics ************
filter                : 0.100000
loadbal               : 0.000000
Final Nnz (ratio)     : 39 ( 0.07)
Max setup values time :      0.0
*************************************************
Setup (pattern and values) times:
 0:      0.0
 1:      0.0
ave:      0.0
*************************************************
** ParaSails Setup Pattern Statistics ***********
symmetric             : 1
thresh                : 0.200000
num_levels            : 1
Max cost (average)    : 6.0e+08 (4.9e+08)
Nnz (ratio)           : 103886 ( 1.48)
Max setup pattern time:      0.0
*************************************************
** ParaSails Setup Values Statistics ************
filter                : 0.100000
loadbal               : 0.000000
Final Nnz (ratio)     : 91505 ( 1.31)
Max setup values time :      0.4
*************************************************
Setup (pattern and values) times:
 0:      0.3
 1:      0.4
ave:      0.3
*************************************************
   Residual norms for fieldsplit_1_ solve.
   0 KSP Residual norm 8.569397744104e+03
   1 KSP Residual norm 2.381604391507e+03
   2 KSP Residual norm 1.122966950794e+03
   3 KSP Residual norm 6.059895318115e+02
   4 KSP Residual norm 2.785669509756e+02
   5 KSP Residual norm 1.439683032222e+02
   6 KSP Residual norm 6.002357292386e+01
 1 KSP Residual norm 7.690377439031e-04
   Residual norms for fieldsplit_1_ solve.
   0 KSP Residual norm 2.956833059930e+05
   1 KSP Residual norm 1.787320287092e+05
   2 KSP Residual norm 9.550287792776e+04
   3 KSP Residual norm 4.057604924174e+04
   4 KSP Residual norm 2.237002256464e+04
   5 KSP Residual norm 1.082742229824e+04
   6 KSP Residual norm 3.839937493403e+03
   7 KSP Residual norm 1.837737978611e+03
 2 KSP Residual norm 4.494035527480e-06
   Residual norms for fieldsplit_1_ solve.
   0 KSP Residual norm 2.705597685965e+05
   1 KSP Residual norm 1.587873121132e+05
   2 KSP Residual norm 7.567285121798e+04
   3 KSP Residual norm 4.027211131979e+04
   4 KSP Residual norm 2.030643277176e+04
   5 KSP Residual norm 9.996336070718e+03
   6 KSP Residual norm 4.499209738782e+03
   7 KSP Residual norm 2.298423470140e+03
 3 KSP Residual norm 2.350518497486e-08
   Residual norms for fieldsplit_1_ solve.
   0 KSP Residual norm 3.304403201367e+05
   1 KSP Residual norm 1.993083865911e+05
   2 KSP Residual norm 9.397960969595e+04
   3 KSP Residual norm 4.928650742565e+04
   4 KSP Residual norm 2.451251367195e+04
   5 KSP Residual norm 1.237756537851e+04
   6 KSP Residual norm 5.480296653554e+03
   7 KSP Residual norm 3.101516648503e+03
 4 KSP Residual norm 9.568748302483e-11
   Residual norms for fieldsplit_1_ solve.
   0 KSP Residual norm 4.448880690454e+05
   1 KSP Residual norm 2.628153049738e+05
   2 KSP Residual norm 1.281287424988e+05
   3 KSP Residual norm 7.292699051221e+04
   4 KSP Residual norm 3.180368227288e+04
   5 KSP Residual norm 1.546252803266e+04
   6 KSP Residual norm 6.807281733103e+03
   7 KSP Residual norm 3.144299396548e+03
 5 KSP Residual norm 5.494536394249e-13
Approximation error 3.391e-11
</pre><p> Note that KPS solver make 5 iterations to converge, since in this case, Schur complaint is approximated by pre-conditioner. If from other hand we use full Schur complement with and use direct solver </p><div class="fragment"><div class="line">mpirun -np 1 ./analytical_poisson_field_split \</div>
<div class="line">-file_name cube_1part.h5m -<a class="code hl_variable" href="dg__projection_8cpp.html#ad7eceded84ace5678d9df3e44f47d475">order</a> 3 \</div>
<div class="line">-pc_type fieldsplit \</div>
<div class="line">-pc_fieldsplit_schur_precondition full \</div>
<div class="line">-fieldsplit_1_pc_type lu -fieldsplit_1_pc_factor_mat_solver_packag mumps \</div>
<div class="line">-dm_mat_type aij</div>
</div><!-- fragment --><p> we will get </p><pre class="fragment">0 KSP Residual norm 8.033746248668e-01
1 KSP Residual norm 6.498236020454e-01
2 KSP Residual norm 9.691076621610e-12
</pre><p> Note that we converged in three steps in that case.</p>
<h1><a class="anchor" id="poisson_tut3_excercise"></a>
Exercises</h1>
<ul>
<li>Use direct solver for pre-conditioner for two blocks and check how it changes convergence </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.8
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>