<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.9.5"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: Cell engineering module</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="mod_gallery.html">Users modules</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Cell engineering module </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_users_modules_cell_engineering_README"></a></p>
<p >This module allows for numerical calculation of cell forces applied on a surface by means of a higher order finite element approach based on an linear elasticity theory and Betti's theorem. Only experimental data of displacements in X and Y direction is required. (possible further extensions if needed) For more instructions, tutorials visit <a href="http://mofem.eng.gla.ac.uk/mofem/html/pages.html">MoFEM page</a>.</p>
<p ><a href="http://mofem.eng.gla.ac.uk/mofem/html/cell__forces_8cpp.html">Implementation Documentation</a></p>
<h1><a class="anchor" id="autotoc_md67"></a>
How to cite?</h1>
<p ><a href="https://doi.org/10.5281/zenodo.439392"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.439392.svg" alt="DOI" style="pointer-events: none;" class="inline"/></a></p>
<p ><a href="https://doi.org/10.5281/zenodo.439395"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.439395.svg" alt="DOI" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md68"></a>
Install cell enginnering module module on your MoFEM build</h1>
<p >The simplest way to start using this module is install <a href="https://www.docker.com/">Docker</a> and pull pre-compiled module from the <a href="https://hub.docker.com/r/lorak41/cell_engineering/">Docker Hub</a>, </p><div class="fragment"><div class="line">docker pull likask/mofem_cell_engineering</div>
<div class="line">docker run --name cell_engineering likask/mofem_cell_engineering</div>
<div class="line">docker run --rm=true -it --volumes-from cell_engineering -v $HOME/mofem-cephas/mofem:/mofem -v $HOME:$HOME -e HOSTHOME=$HOME likask/mofem_cell_engineering /bin/bash</div>
</div><!-- fragment --><p >You can install this module on your <a class="el" href="namespace_mo_f_e_m.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> build as well. Go to your build (users modules)</p>
<div class="fragment"><div class="line">cd $MOFEM_INSTALL_DIR/um/users_modules/users_modules/</div>
<div class="line">git clone https://karol41@bitbucket.org/karol41/mofem_um_cell_engineering.git cell_engineering</div>
<div class="line">cd ..</div>
<div class="line"> </div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_FLAGS=&quot;-Wall&quot;  \</div>
<div class="line">-DCMAKE_CXX_FLAGS=&quot;-Wall -Wno-bind-to-temporary-copy -Wno-overloaded-virtual&quot; \</div>
<div class="line">-DCMAKE_EXE_LINKER_FLAGS=&quot;-L$MOFEM_INSTALL_DIR/local/lib&quot; users_modules</div>
<div class="line"> </div>
<div class="line">cd cell_engineering</div>
<div class="line">make</div>
</div><!-- fragment --><p >On Docker cmake command is slightly different:</p>
<div class="fragment"><div class="line">cmake -DBUILD_SHARED_LIBS=yes -DCMAKE_BUILD_TYPE=Release users_modules</div>
</div><!-- fragment --><p >Entire installation process can be also found on the <a href="https://www.youtube.com/watch?v=6opfKER7JHA">Youtube</a> video.</p>
<h1><a class="anchor" id="autotoc_md69"></a>
How does it work?</h1>
<p >Lets consider body containing two different layers of materials. If we are in possesion of displacement field (experimental data) occurring between those two layers we can calculate forces and deformation on the top surface.</p>
<p ><img src="doc/figures/cell_layers.png" alt="Problem geometry" class="inline"/></p>
<p >In the first step, we need to map provided experimentally displacement field on finite element mesh.</p>
<p ><img src="doc/figures/cell_engineering_forces_example.gif" alt="Cell forces" class="inline"/></p>
<p >Raw data usually contains lots of noise and doesn't coincide with the arrangement of triangles in the mesh. Therefore, least squares approximation is used to produce smooth, continuous displacement field. Strength of smoothing can be manipulated with different parameters. When generating the mesh in Cubit, we need to remember to properly define material properties (MAT_ELASTIC blockset) and indicate bottom (<em>101</em>) and top (<em>202</em>) surface of considered layer as SIDESETS 101 and 202, respectively. Checkout the example .cub or .jou files in /examples directory to see how it is done.</p>
<h1><a class="anchor" id="autotoc_md70"></a>
Check before run</h1>
<ul>
<li>Check where is your mesh file</li>
<li>Check where are your data XY (csv) files</li>
<li>Check where is your config file (if required)</li>
</ul>
<h1><a class="anchor" id="autotoc_md71"></a>
Displacements mapping</h1>
<p >In order to map experimental data on finite element mesh we execute the following command. </p><div class="fragment"><div class="line">./map_disp \</div>
<div class="line">-my_data_x ./examples/data_x.csv \</div>
<div class="line">-my_data_y ./examples/data_y.csv \</div>
<div class="line">-my_file ./examples/mesh_cell_force_map.cub \</div>
<div class="line">-ksp_type cg -pc_type lu -pc_factor_mat_solver_package mumps -ksp_monitor \</div>
<div class="line">-lambda 0.01 -my_order 4 -scale 0.05 -cube_size 1 -my_nparts 4</div>
</div><!-- fragment --><p> where</p>
<ul>
<li>loading data files, comma separated</li>
<li>loading mesh</li>
<li>solver settings</li>
<li>lambda parameter drives "the strength" of approximation (the higher the values, more smoothed field we achieve)</li>
<li>my_order sets order of approximation</li>
<li>scale the distance between experimental data points (default: 1 unit)</li>
<li>nparts set number of processors and partitioning mesh</li>
</ul>
<p >If only one layer is specified, another thin polymer layer could be created automatically using prism elements, </p><div class="fragment"><div class="line">./map_disp_prism \</div>
<div class="line">-my_thinckness 0.01 \</div>
<div class="line">-my_data_x ./examples/data_x.csv \</div>
<div class="line">-my_data_y ./examples/data_y.csv \</div>
<div class="line">-my_file ./examples/mesh_for_prisms.cub \</div>
<div class="line">-ksp_type cg -pc_type lu -pc_factor_mat_solver_package mumps -ksp_monitor \</div>
<div class="line">-lambda 0.01 -my_order 3 -scale 0.05 -cube_size 1 -my_nparts 4</div>
</div><!-- fragment --><p> where</p>
<ul>
<li>my_thinckness is a thickness of created layer on the top surface</li>
</ul>
<h1><a class="anchor" id="autotoc_md72"></a>
Cell forces calculation</h1>
<p >Code above produces output file (out.h5m) and analysis_mesh.h5m which can be subsequently used to calculate the required forces and stresses on the top surface of a given geometry. </p><div class="fragment"><div class="line">mpirun -np 4 ./cell_forces \</div>
<div class="line">-my_file analysis_mesh.h5m \</div>
<div class="line">-my_order 1 -my_order_force 2 -my_max_post_proc_ref_level 1 \</div>
<div class="line">-my_block_config ./examples/block_config.in \</div>
<div class="line">-ksp_type fgmres -ksp_monitor \</div>
<div class="line">-fieldsplit_1_ksp_type fgmres \</div>
<div class="line">-fieldsplit_1_pc_type lu \</div>
<div class="line">-fieldsplit_1_pc_factor_mat_solver_package mumps \</div>
<div class="line">-fieldsplit_1_ksp_max_it 100 \</div>
<div class="line">-fieldsplit_1_ksp_monitor  \</div>
<div class="line">-fieldsplit_0_ksp_type gmres \</div>
<div class="line">-fieldsplit_0_ksp_max_it 25 \</div>
<div class="line">-fieldsplit_0_fieldsplit_0_ksp_type preonly \</div>
<div class="line">-fieldsplit_0_fieldsplit_0_pc_type lu \</div>
<div class="line">-fieldsplit_0_fieldsplit_0_pc_factor_mat_solver_package mumps \</div>
<div class="line">-fieldsplit_0_fieldsplit_1_ksp_type preonly \</div>
<div class="line">-fieldsplit_0_fieldsplit_1_pc_type lu \</div>
<div class="line">-fieldsplit_0_fieldsplit_1_pc_factor_mat_solver_package mumps \</div>
<div class="line">-ksp_atol 1e-6 -ksp_rtol 0 -my_eps_u 1e-4 -my_curl 1</div>
</div><!-- fragment --><p> where</p>
<ul>
<li>loading mesh</li>
<li>solver settings</li>
<li>my_order sets order of approximation</li>
<li>block_config.in is a file where approximation order and material parameters could be set and changed</li>
</ul>
<h1><a class="anchor" id="autotoc_md73"></a>
Do output VTK files and open them in Paraview</h1>
<p >Stresses and displacements </p><div class="fragment"><div class="line">mbconvert out.h5m out.vtk &amp;&amp; open out.vtk</div>
</div><!-- fragment --><p> and to post-process tractions </p><div class="fragment"><div class="line">mbconvert out_tractions.h5m out_tractions.vtk</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md74"></a>
Acknowledgements</h1>
<p >This user module has been co-developed with Biomedical Engineering and Infrastructure and Environment departments in the School of Engineering at the University of Glasgow. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.9.5
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>