<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=9"/>
  <meta name="generator" content="Doxygen 1.8.17"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MoFEM: pluto</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <script type="text/javascript " src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML "></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["AMSmath.js"],
        TeX: { equationNumbers: { autoNumber: ["all"],
                                  useLabelIds: true
        } 
        }
    });
    </script>
  <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
  <link href="extra_style.css" rel="stylesheet" type="text/css"/>
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" href="favicon-32x32.png"/>
  <link rel="Bookmark" type="image/png" href="favicon-32x32.png"/>
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div style="background-color:#011A40" id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 30px;">
  <td id="projectlogo"><img alt="Logo" src="MoFEMLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <td style="padding-left: 0.5em;" bgcolor="#011A40"
   <div id="projectbrief"><font color="#FFFFFF">v0.14.0</font></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--Google analytics tags-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-65236130-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2J9RE2P3H5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2J9RE2P3H5');
</script><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">pluto </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="https://www.nasa.gov/sites/default/files/thumbnails/image/nh_pluto_10.png" alt="" class="inline"/></p>
<p><em>Source</em> <a href="https://www.nasa.gov">https://www.nasa.gov</a></p>
<h1><a class="anchor" id="autotoc_md154"></a>
Introduction</h1>
<p>In this example, we focus on modelling the <em>partial differential equation</em> with a <em>nonlinear boundary conditions</em>. We choose the problem of thermal equilibrium of the Pluto planet.The planet model is oversimplified. However, it serves the purpose; this example shows how to linearize partial differential equations and apply the Newton method. <br  />
</p>
<p><a class="el" href="namespaceMoFEM.html" title="implementation of Data Operators for Forces and Sources">MoFEM</a> is generic code, and other processes (chemical reactions, radioactive decay, etc.) can be included, to fit better reality. For example, an interesting modelling avenue would be to apply multi-scale analysis, with separate scales for space and time for processes on the surface and subsurface, or model extension to model transport phenomena with reaction-diffusion equation, or near surface convection diffusion problem.</p>
<p>+++</p>
<h1><a class="anchor" id="autotoc_md155"></a>
Part I</h1>
<h2><a class="anchor" id="autotoc_md156"></a>
Energy balance</h2>
<h3><a class="anchor" id="autotoc_md157"></a>
Conservation law</h3>
<p>The universal law of nature, that energy has to be conserved, that with the help of <a href="https://en.wikipedia.org/wiki/Divergence_theorem">divergence theorem</a> and <a href="https://en.wikipedia.org/wiki/Principle_of_locality">principle of locality</a>, can be expressed for every point of the body as follows, <br  />
</p>
<p>\begin{equation} \sum^2_{i=0} \frac{\partial q_i}{\partial x_i} - f(\mathbf{x}) = 0,\quad\forall \mathbf{x} \in \Omega \label{eq:conservation1} \tag{1} \end{equation}</p>
<p>where:</p><ul>
<li>$\mathbf{x}$ is point coordinates in <a href="https://en.wikipedia.org/wiki/Cartesian_coordinate_system">Cartesian coordinate system</a> in body $\Omega$,</li>
<li>$\mathbf{q}$ is energy flux $[W \cdot m^{-2}]$, and $q_i$ is coefficient of energy flux, where $i=0,1,2$. For example, $f(\mathbf{x})$ is an energy source, which results from the decay of radioactive materials, or chemical processes, or internal friction caused by changing gravity. We will set source term to zero, to keep it simple.</li>
</ul>
<p>Equation ($eq:conservation1}$) expressed with the indices applies to the Cartesian coordinate system only, to express it in the more abstract and general form we can write in absolute notation, as follows</p>
<p>\begin{equation} \nabla \cdot \mathbf{q} - f(x) = 0,\quad\forall \mathbf{x} \in \Omega \label{eq:conservation2} \tag{2} \end{equation}</p>
<p>where $\nabla \cdot$ is divergence symbol. Note that we later solve problem in cylindrical coordinate system, were equation expressed $(eq:conservation1})$ is not valid for such system, however absolute notation $(eq:conservation2})$ holds.</p>
<h3><a class="anchor" id="autotoc_md158"></a>
Thermal conduction</h3>
<p>The conection between energy flux and temerature gradient is given by [Fourier's law](<a href="https://en.wikipedia.org/wiki/Thermal_conduction#Fourier's_law">https://en.wikipedia.org/wiki/Thermal_conduction#Fourier's_law</a>),</p>
<p>\begin{equation} q_i(\mathbf{x}) = - k(\mathbf{x}) \frac{\partial T(\mathbf{x})}{\partial x_i} \label{eq:furier1} \tag{3} \end{equation}</p>
<p>where:</p><ul>
<li>$T(\mathbf{x})$ is temperature at point $\mathbf{x}$,</li>
<li>$\frac{\partial T(\mathbf{x})}{\partial x_i}$ is gradient of temperature, where $i=0,1,2$,</li>
<li>$k(\mathbf{x})$ heat conductivity $[W\cdot m^{-2}]$ at point $\mathbf{x}$ in the body.</li>
</ul>
<p>Furrie's law expresses observation that heat transfer rate is proportional to the negative gradient of temperature, i.e. heat energy flows from hot region to cold region. Furrie's law is a particular expression of the second law of thermodynamics. In the following, we assume that heat conductivity is homogenous through the planet, and its value is the average value for the rock.</p>
<p>The thermal conduction law expressed in absolute notation takes form as follows</p>
<p>\begin{equation} \mathbf{q}(\mathbf{x}) = - k \pmb\nabla T \label{eq:furier2} \tag{4} \end{equation}</p>
<h2><a class="anchor" id="autotoc_md159"></a>
Exchange of energy with the external world</h2>
<p>Pluto exchange energy and mass with the universe through the surface, for simplicity, we restrict ourself to two cases, i.e. sun irradiance, planet and outer space radiation. Total power of energy exchange through the surface is given by</p>
<p>\begin{equation} P = \int_\Gamma dP = \int_\Gamma dP^S + dP^r \quad [W] \label{eq:boundary} \tag{5} \end{equation}</p>
<p>where:</p><ul>
<li>$\Gamma$ is surface of the planet,</li>
<li>$dP^S$ is power surface infinitesimal element irradiation received from the sun,</li>
<li>$dP^r$ is power surface infinitesimal element radiation/</li>
</ul>
<h3><a class="anchor" id="autotoc_md160"></a>
Pluto’s insolation</h3>
<p>Following <a href="https://doi.org/10.1016/j.icarus.2014.12.028">Pluto's insolation history</a> we assume that energy flux from sin is</p>
<p>\begin{equation} dP^S(\mathbf{x},t) = I * dA \quad [W] \label{eq:solar_raddiation1} \tag{6} \end{equation}</p>
<p>where:</p><ul>
<li>$I$ $[W\cdot m^{-2}]$ is isolation valuees value take from <a href="https://doi.org/10.1016/j.icarus.2014.12.028">Pluto’s insolation history</a>,</li>
<li>$\mathbf{N}^S(t)$ is unit solar ray direction,</li>
<li>$d\mathbf{A}$ is surface area element.</li>
</ul>
<p><img src="http://mofem.eng.gla.ac.uk/mofem/html/pluto_insolation.png" alt="" class="inline"/></p>
<p>*Pluto's insolation</p>
<p>From <a href="https://doi.org/10.1016/j.icarus.2014.12.028">Pluto's insolation history</a>, Pluto's motion is complex in time due to its elliptical and eccentric orbit. To keep analysis simple, we arbitrary pick data for one full orbit (1767), where north and south pole have averaged isolation values $260$ $[W\cdot m^{-2}]$, and on the equator $260$ $[W\cdot m^{-2}]$. For simplicity, we will use</p>
<p>\begin{equation} I = -0.23 - 0.3 \sin{(\theta)} \label{eq:solar_raddiation2} \tag{7} \end{equation}</p>
<p>where $\theta$ is altitude of point $\mathbf{x}$ on Pluto surface, see <a href="https://en.wikipedia.org/wiki/Horizontal_coordinate_system">Horizontal_coordinate_system</a>.</p>
<h3><a class="anchor" id="autotoc_md161"></a>
Body and space radiation</h3>
<p>We will assume that surface of Pluto radiates energy in the space; it also receives energy from space, which has some relict temperature. We assume that outer space temperature is 3K degrees, following Wikipedia (<a href="https://en.wikipedia.org/wiki/Outer_space">https://en.wikipedia.org/wiki/Outer_space</a>). Balance of energy received by radiation be quantified by <a href="https://en.wikipedia.org/wiki/Planck%27s_law">Plank's law</a> integrated by all possible wave frequencies, see <a href="https://en.wikipedia.org/wiki/Thermal_radiation">https://en.wikipedia.org/wiki/Thermal_radiation</a>. Finally, you can express our ideas into the equation</p>
<p>\begin{equation} dP^r(\mathbf{x}) = \epsilon \sigma (T^4(\mathbf{x})-T_S^4) dA \quad [W] \label{eq:solar_raddiation4} \tag{8} \end{equation}</p>
<p>where:</p><ul>
<li>$dP^r$ is net thermal surface element radiation,</li>
<li>$\epsilon$ is emissivity,</li>
<li>$\sigma$ is <a href="https://en.wikipedia.org/wiki/Stefan–Boltzmann_law">Stefan–Boltzmann constant</a>,</li>
<li>$T(\mathbf{x})$ is temperature on Pluto surface at position $\mathbf{x}$,</li>
<li>$T_S$ is temperature of space,</li>
<li>$d\mathbf{A}$ is surface area element.</li>
<li>$\mathbf{x}$ is position.</li>
</ul>
<p>For simplicity, we will set $\epsilon=1$, assuming that radiation if for the black body. That might be true for outer space radiation but is not true for Pluto surface. However, it could be good enough approximation, considering that it is very cold on this planet, and the surface is rough, porous with the potentially large intrinsic surface area.</p>
<h2><a class="anchor" id="autotoc_md162"></a>
Equations in strong form</h2>
<p>Putting all equations together, we get boundary value problem in the indicess for Cartesian coordinate system \begin{equation} \left\{ \begin{array}{l} \frac{\partial}{\partial x_i} \left( k \frac{\partial T}{\partial x_i} \right)\quad \forall \mathbf{x} \in \Omega, \ q_i dA_i = dP^S + dP^r \quad\forall \mathbf{} \in \Gamma \end{array} \right. \label{eq:strong1} \tag{9} \end{equation} Note that we drop $\sum$ symbol in ($eq:conservation1}$), following <a href="https://en.wikipedia.org/wiki/Einstein_notation">Einstein notation</a>. Also, following Einstein notation, $q_i dA_i = \sum_{i=0}^2 q_i dA_i$.</p>
<p>When problem is expressed in that form, we call it that it is strong form. For clarity, we express above equation in coordinate system independent absolute notation \begin{equation} \left\{ \begin{array}{l} \nabla \cdot \left( k \pmb\nabla T \right) = 0\quad\forall \mathbf{x} \in \Omega, \ \mathbf{q}\cdot d\mathbf{A} = dP^S + dP^r \quad\forall \mathbf{x} \in \Gamma. <br  />
 \label{eq:strong2} \tag{10} \end{array} \right. \end{equation}</p>
<p>This is a nonlinear partial differential equation since radiation is a nonlinear function of unknown distribution of temperature. You can notice as well that time does not explicitly is involved in the equations. This is a consequence of the assumptions above. We are looking at long periods, like time over several Plutos years (Pluto orbit has ~248 years), where average values are our initial interest.</p>
<h1><a class="anchor" id="autotoc_md163"></a>
Part II</h1>
<div class="fragment"><div class="line"># Running code</div>
<div class="line"> </div>
<div class="line"># -ts_dt step size</div>
<div class="line"># -ts_max_time 1 final time, should be always 1, since that correspond to accurate solar irradiation</div>
<div class="line"># -snes_rtol relative tolearnce</div>
<div class="line"># -snes_atil absolute tolerance</div>
<div class="line"># -snes_linesearch_type line searcher type (see https://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/SNES/SNESLineSearchType.html)</div>
<div class="line"> </div>
<div class="line">import os</div>
<div class="line"> </div>
<div class="line">user_name=!whoami</div>
<div class="line">user_name=user_name[0]</div>
<div class="line">print(user_name)</div>
<div class="line"> </div>
<div class="line">if user_name == &#39;root&#39;:</div>
<div class="line">    home_dir = &#39;/mofem_install&#39;</div>
<div class="line">else:</div>
<div class="line">    home_dir=os.environ[&#39;HOME&#39;] </div>
<div class="line"> </div>
<div class="line">print(home_dir)</div>
<div class="line"> </div>
<div class="line">dt = 1e-1</div>
<div class="line">snes_rtol = 1e-12</div>
<div class="line">snes_atol = 1e-12</div>
<div class="line">log_file = &quot;log.txt&quot;</div>
<div class="line">wd=&#39;%s/um_view/tutorials/scl-8&#39; % home_dir</div>
<div class="line"> </div>
<div class="line">!cd {wd} &amp;&amp; ./radiation \</div>
<div class="line">-file_name pluto.h5m \</div>
<div class="line">-ts_dt {dt} \</div>
<div class="line">-ts_max_time 1 \</div>
<div class="line">-snes_rtol {snes_rtol} \</div>
<div class="line">-snes_atol {snes_atol} \</div>
<div class="line">-snes_max_it 20 \</div>
<div class="line">-snes_linesearch_type bt 2&gt;&amp;1 | tee {log_file}</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Convert h5m file into VTK file</div>
<div class="line">!cd {wd} &amp;&amp; /mofem_install/um_view/bin/mbconvert out_radiation.h5m out_radiation.vtk</div>
<div class="line">!ls {wd}</div>
</div><!-- fragment --><div class="fragment"><div class="line">newton_log_file=&quot;newton_log_file.txt&quot;</div>
<div class="line">!cd {wd} &amp;&amp; grep &quot;SNES Function norm&quot; {log_file} &gt; {newton_log_file} </div>
<div class="line"> </div>
<div class="line">import numpy as np</div>
<div class="line">import pandas as pd</div>
<div class="line">import matplotlib.pyplot as plt</div>
<div class="line">newton_data=pd.read_fwf(wd+&quot;/&quot;+newton_log_file, header=None)</div>
<div class="line"> </div>
<div class="line">plt.rcParams[&#39;figure.figsize&#39;] = [15, 10]</div>
<div class="line">plt.plot(newton_data[7].to_numpy(),&#39;r^-&#39;)</div>
<div class="line">plt.title(&#39;Neton method convergence&#39;)</div>
<div class="line">plt.ylabel(&#39;absolute residial&#39;)</div>
<div class="line">plt.xlabel(&#39;accumulated iterations&#39;)</div>
<div class="line">plt.yscale(&#39;log&#39;)</div>
<div class="line">plt.grid(True)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Plotting solution on mesh and temperature distribution</div>
<div class="line"> </div>
<div class="line">import os</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># Plot solution</div>
<div class="line">import pyvista as pv</div>
<div class="line">import matplotlib.pyplot as plt</div>
<div class="line">from matplotlib.colors import ListedColormap</div>
<div class="line">pv.start_xvfb()</div>
<div class="line"> </div>
<div class="line">mesh = pv.read(wd+&#39;/&#39;+&#39;out_radiation.vtk&#39;)</div>
<div class="line">my_cmap = plt.cm.get_cmap(&quot;jet&quot;, 12)</div>
<div class="line"> </div>
<div class="line"># Take a screen shot</div>
<div class="line">mesh.plot(</div>
<div class="line">    screenshot=wd+&#39;/myscreenshot.png&#39;,</div>
<div class="line">    show_grid=True,</div>
<div class="line">    show_edges=True,</div>
<div class="line">    cpos=&quot;xy&quot;,</div>
<div class="line">    scalars=&quot;T&quot;, </div>
<div class="line">    smooth_shading=True, </div>
<div class="line">    cmap=my_cmap,jupyter_backend=&#39;pythreejs&#39;)</div>
<div class="line"> </div>
<div class="line"># Print a screen shotOOO</div>
<div class="line"># import matplotlib.pyplot as plt</div>
<div class="line"># import matplotlib.image as mpimg</div>
<div class="line"># img = mpimg.imread(wd+&#39;/myscreenshot.png&#39;)</div>
<div class="line"># imgplot = plt.imshow(img)</div>
<div class="line"># plt.show()</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md164"></a>
Part III</h1>
<h2><a class="anchor" id="autotoc_md165"></a>
Equations in weak form</h2>
<p>Working with partial differential equations (PDEs) is hard for a computer. Computers are excellent with adding, subtracting and multiplying, but not with solving abstract PDEs. Over many years, many mathematical methods has bee invented which can transform PDEs into the algebraic equations, and then series of linear equations, which can be solved efficiently by computer.</p>
<p>One of the methods which change PDEs into the algebraic equation is the <a href="https://en.wikipedia.org/wiki/Galerkin_method">Galerkin method</a>. If Galerie is used with a particular method of dividing the computational domain and construction of the piecewise polynomial base, it leads to the Finite Element Method (FEM). Here we skip those details related to FEM and focus on formulation problem in a weak form and linearisation.</p>
<p>We take first equation from the strong form, multiply it by some sufficiently smooth functions $v$, multiply by it energy conservation equation, and integrate over domain, as result we get</p>
<p>\begin{equation} \int_\Omega v \frac{\partial}{\partial x_i} \left( k \frac{\partial T}{\partial x_i} \right) \textrm{d}V = 0. \label{eq:weak1} \tag{11} \end{equation}</p>
<p>We call function $v$ testing function, since it test if we satisfy equation $(eq:weak1})$. Of curse testing equation using one function $v$ is not enough, so we can take one by one many different $v$ functions and check if we fulfil equation (eq:weak1}) for each of them. In fact, we can have an infinite number of test functions $v$ against which we can test eq. (eq:weak1}). However, that is impractical, since testing for an infinite number of functions will take forever. The solution is the discretisation of the problem, i.e. test functions and temperature can be approximately expressed by a finite number of base functions (e.g. shape functions in finite elements), multiplied by coefficients (e.g. degrees of freedom in finite elements).</p>
<p>In the next step, we can <a href="https://en.wikipedia.org/wiki/Integration_by_parts">integrate by parts</a> as follows</p>
<p>\begin{equation}</p><ul>
<li>\int_\Omega \frac{\partial v}{\partial x_i} \left( k \frac{\partial T}{\partial x_i} \right) \textrm{d}V</li>
<li>\int_\Gamma v q_i dA_i = 0. \label{eq:waak2} \tag{12} \end{equation}</li>
</ul>
<p>and replace the second term using the second equation from the strong form in part I, as result w have</p>
<p>\begin{equation}</p><ul>
<li>\int_\Omega \frac{\partial v}{\partial x_i} \left( k \frac{\partial T}{\partial x_i} \right) \textrm{d}V</li>
<li>\int_\Gamma v \left( dP^S + dP^r \right) = 0 \label{eq:weak4} \tag{13} \end{equation}</li>
</ul>
<p>and finally</p>
<p>\begin{equation} r(T(\mathbf{x})) = - \int_\Omega \frac{\partial v}{\partial x_i} \left( k \frac{\partial T}{\partial x_i} \right) \textrm{d}V</p><ul>
<li>\int_\Gamma v dP^S</li>
<li>\int_\Gamma v \left[ \epsilon \sigma (T^4(\mathbf{x})-T^4_S) \right] dA = 0 \label{eq:weak5} \tag{14} \end{equation}</li>
</ul>
<p>Note that now we have one equation, instead of two-equation, for body domain and boundary, we have one equation expressed in the integral form which has to be fulfilled for set of test functions $v$. When the problem is expressed in that way is called a weak form, and boundary condition applied for heat flux is called natural boundary condition.</p>
<p>You can notice that initially second derivative was applied twice to the field of temperature $T(\mathbf{x})$, first time to calculate gradient, form which we get heat flux, the second time to divergence. By applying integration by parts, now one derivative form field of temperature $T(\mathbf{x})$ is "moved" to the test function $v(\mathbf{x})$. That is important, since not every function can have calculated integral when the second derivative is applied, like in ($eq:weak1}$).</p>
<p>Suppose we like to search for a solution among a set of functions. It is much easier, since it is a bigger set, to search among functions that can have integrated only first derivative, such functions can be piecewise polynomials.</p>
<p>Note, that piecewise polynomial enables us to approximate functions which have gradients jumps. Such functions have no integrable second derivatives, i.e. are not smooth enough. Moreover, piecewise polynomial is much easier to construct and implement efficiently, in particular in two or three dimensions.</p>
<p><img src="https://www.universetoday.com/wp-content/uploads/2008/05/Internal_Structure_of_Pluto.jpg" alt="" class="inline"/></p>
<p><em>Source</em> www.universetoday.com</p>
<p>Suppose the solution to the problem is a function of temperature, which is <a href="https://en.wikipedia.org/wiki/Analytic_function">analytical</a>. Then a solution of strong form equation and weak form equation is the same in the sense of some appropriate norm.</p>
<p>However weak form solution is more general and is applicable for problems where temperature distribution is non-analytical. For example, if we like to model Pluto that it has several internal layers, rock core, and outer core layers. Then weak form equation would give correct since at boundary between layers we could observe jumps of the temperature gradient, which can not be represented by an analytical function. From the other hand solution of strong form, equations will demand to divide domains into parts for each layer, and supplement equations by joining each part, enforcing continuity of displacement, and fluxes. Note that in the model showed above layers are not modelled, and the whole planet is modelled as a homogenous rock.</p>
<h2><a class="anchor" id="autotoc_md166"></a>
Linearisation</h2>
<p>You can notice that equation (eq:weak5}) is nonlinear, residual $r(T(\mathbf{x}))$, which non-linear function of temperature, i.e. you can find terms like $T^4$ in the equation. Thus we have to linearise $r(T(\mathbf{x}))$, with the help comes <a href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a> expansion, which will lead to Newton method.</p>
<p>We express distribution of temperature as previous value at Newton iteration $T_k(\mathbf{x})$ and temperature correction $\delta T_{k+1}(\mathbf{x})$, such that current temperature is</p>
<p>\begin{equation} T_{k+1}(\mathbf{x}) = T_k(\mathbf{x})+\delta T_{k+1}(\mathbf{x}). \label{eq:taylor1} \tag{15} \end{equation}</p>
<p>For convenience, we will write just $T_k$, instead of $T_k(\mathbf{x})$. Next, using Taylor series expansion, we get</p>
<p>\begin{equation} r(T_k+\delta T_{k+1})= r(T_k)</p><ul>
<li>\left.\frac{\partial r}{\partial T}\right|_{T=T_k} \delta T_{k+1}</li>
<li>\frac{1}{2!}\left.\frac{\partial^2 r}{\partial T^2}\right|_{T=T_k} (\delta T_{k+1})^2</li>
<li>\frac{1}{3!}\left.\frac{\partial^3 r}{\partial T^3}\right|_{T=T_k} (\delta T_{k+1})^3</li>
<li>\dots = 0 \label{eq:taylor2} \tag{16} \end{equation}</li>
</ul>
<p>This infinite Taylor series, however, if $\delta T_{k+1}$ is small, then $(\delta T_{k+1})^2$ is very small, and following powers are even smaller. Using that observation we can drop all terms beyond the linear term and use $\delta T_{k+1}$ to correct residual, as follow</p>
<p>\begin{equation} r(T_k+\delta T_{k+1}) \approx r(T_k) + \left.\frac{\partial r}{\partial T}\right|_{T=T_k} \delta T_{k+1} = 0. \label{eq:taylor3} \tag{17} \end{equation}</p>
<p>Solving equation ($eq:taylor2}$) is hard, it is much easier to solve ($eq:taylor3}$). Solution of ($eq:taylor2}$) can be obtained by solving ($eq:taylor3}$) iteratively. Starting with $k=0$, then $k=1,2,3,\dots$, until $r(T_k+\delta T_{k+1})$ is small as much we like. If $r(T_k+\delta T_{k+1})$ is zero, or approaching zero, then solution we have solution of ($eq:weak5}).</p>
<p>This method is called the Newton method. Iteration is repeatedly repeating, the same thing in the loop, and computers are good in such a thing. You can notice that ($eq:taylor3}$) is an equation, where field $\delta T_{k+1}$ is unknown which we will try to find. The computer will do iterations; however, at each iteration, we will have to transform ($eq:taylor3}$) into a suitable form for the computer. Next subsection is about that.</p>
<p>We know distribution of temperature at iteration $k$, i.e. $T_k$, since it assumed that it was calculated at previous iteration. We know what is form of $r(T_k)$, that is shown in eq. (eq:weak5}), to complete that section we need to derive how second term in ($eq:taylor3}$). That can be done simply by calculating derivative only nonlinear term $T^4$, \begin{equation} \left.\frac{\partial r}{\partial T}\right|_{T=T_k} \delta T_{k+1} = - \int_\Omega \frac{\partial v}{\partial x_i} \left( k \frac{\partial \delta T_{k+1}}{\partial x_i} \right) \textrm{d}V</p><ul>
<li>\int_\Gamma v \left[ \epsilon \sigma \left\{ 4T^3_k \right </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr cla ss="footer" />
<style>
  img[src="UoGLogo.png"] {
    height: 20px;
    padding-top: 0px;
    padding-right: 1px;
    padding-bottom: 3px;
    padding-left: 6px;
  }
</style>
<address class="footer">
  <small>
    Generated by
    <a href="http://www.doxygen.org/index.html"> Doxygen </a> 1.8.17
    and hosted at
    <a href="http://www.gla.ac.uk/schools/engineering/">
      <img class="footer" src="UoGLogo.png" alt="University of Glasgow" />
    </a>
  </small>
</address>
</body>
</html>